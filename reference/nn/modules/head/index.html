 <!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Explore docs covering Ultralytics YOLO detection, pose &amp; RTDETRDecoder. Comprehensive guides to help you understand Ultralytics nn modules." name="description"/><meta content="Ultralytics" name="author"/><link href="https://docs.ultralytics.com/reference/nn/modules/head/" rel="canonical"/><link href="../conv/" rel="prev"/><link href="../transformer/" rel="next"/><link href="/" hreflang="en" rel="alternate"/><link href="/zh/" hreflang="zh" rel="alternate"/><link href="/ko/" hreflang="ko" rel="alternate"/><link href="/ja/" hreflang="ja" rel="alternate"/><link href="/ru/" hreflang="ru" rel="alternate"/><link href="/de/" hreflang="de" rel="alternate"/><link href="/fr/" hreflang="fr" rel="alternate"/><link href="/es/" hreflang="es" rel="alternate"/><link href="/pt/" hreflang="pt" rel="alternate"/><link href="/it/" hreflang="it" rel="alternate"/><link href="/tr/" hreflang="tr" rel="alternate"/><link href="/vi/" hreflang="vi" rel="alternate"/><link href="/ar/" hreflang="ar" rel="alternate"/><link href="https://raw.githubusercontent.com/ultralytics/assets/refs/heads/main/logo/favicon-yolo.png" rel="icon"/><meta content="zensical-0.0.11" name="generator"/><title>Reference for ultralytics/nn/modules/head.py - Ultralytics YOLO Docs</title><link href="../../../../assets/stylesheets/modern/main.bd6182e7.min.css" rel="stylesheet"/><link href="../../../../assets/stylesheets/modern/palette.dfe2e883.min.css" rel="stylesheet"/><style>:root{}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link href="../../../../stylesheets/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2M5EHKC0BH"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2M5EHKC0BH",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2M5EHKC0BH",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<style data-doc-kind="true">.doc-kind{display:inline-flex;align-items:center;gap:0.25em;padding:0.21em 0.59em;border-radius:999px;font-weight:700;font-size:0.81em;letter-spacing:0.06em;text-transform:uppercase;line-height:1;color:var(--doc-kind-color,#f8fafc);background:var(--doc-kind-bg,rgba(255,255,255,0.12));}.doc-kind-class{--doc-kind-color:#039dfc;--doc-kind-bg:rgba(3,157,252,0.22);}.doc-kind-function{--doc-kind-color:#fc9803;--doc-kind-bg:rgba(252,152,3,0.22);}.doc-kind-method{--doc-kind-color:#ef5eff;--doc-kind-bg:rgba(239,94,255,0.22);}.doc-kind-property{--doc-kind-color:#02e835;--doc-kind-bg:rgba(2,232,53,0.22);}</style><meta content="Reference for ultralytics/nn/modules/head.py" name="title"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/><meta content="website" property="og:type"/><meta content="https://docs.ultralytics.com/reference/nn/modules/head/" property="og:url"/><meta content="Reference for ultralytics/nn/modules/head.py" property="og:title"/><meta content="" property="og:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="og:image"/><meta content="summary_large_image" property="twitter:card"/><meta content="https://docs.ultralytics.com/reference/nn/modules/head/" property="twitter:url"/><meta content="Reference for ultralytics/nn/modules/head.py" property="twitter:title"/><meta content="" property="twitter:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="twitter:image"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "headline": "Reference for ultralytics/nn/modules/head.py", "image": ["https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png"], "datePublished": "2023-11-12 02:49:37 +0100", "dateModified": "2025-11-23 19:53:50 +0100", "author": [{"@type": "Organization", "name": "Ultralytics", "url": "https://ultralytics.com/"}], "abstract": ""}</script></head><body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"><input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/><input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/><label class="md-overlay" for="__drawer"></label><div data-md-component="skip"><a class="md-skip" href="#reference-for-ultralyticsnnmodulesheadpy"> Skip to content </a></div><div data-md-component="announce"><aside class="md-banner"><div class="md-banner__inner md-grid md-typeset"><a class="banner-wrapper" href="https://www.ultralytics.com/news/ultralytics-raises-30m-series-a" target="_blank"><div class="banner-content-wrapper"><img alt="Ultralytics raises $30M Series A" height="40" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac336b5de2ae8b398bca_writting.svg"/><div class="vc-wrapper"><img alt="Elephant" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac33c95408144846afc7_image%201.png"/><img alt="SquareOne" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac3333068d9632cc6df8_image%202.png"/></div></div></a></div></aside></div><header class="md-header md-header--shadow md-header--lifted" data-md-component="header"><nav aria-label="Header" class="md-header__inner md-grid"><a aria-label="Ultralytics YOLO Docs" class="md-header__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a><label class="md-header__button md-icon" for="__drawer"><svg class="lucide lucide-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 5h16M4 12h16M4 19h16"></path></svg></label><div class="md-header__title" data-md-component="header-title"><div class="md-header__ellipsis"><div class="md-header__topic"><span class="md-ellipsis"> Ultralytics YOLO Docs </span></div><div class="md-header__topic" data-md-component="header-topic"><span class="md-ellipsis"> Reference for ultralytics/nn/modules/head.py </span></div></div></div><form class="md-header__option" data-md-component="palette"><input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg></label><input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label><input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label></form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option"><div class="md-select"><button aria-label="Select language" class="md-header__button md-icon"><svg class="lucide lucide-languages" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m5 8 6 6M4 14l6-6 2-3M2 5h12M7 2h1M22 22l-5-10-5 10M14 18h6"></path></svg></button><div class="md-select__inner"><ul class="md-select__list"><li class="md-select__item"><a class="md-select__link" href="/" hreflang="en"> ğŸ‡¬ğŸ‡§ English </a></li><li class="md-select__item"><a class="md-select__link" href="/zh/" hreflang="zh"> ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ </a></li><li class="md-select__item"><a class="md-select__link" href="/ko/" hreflang="ko"> ğŸ‡°ğŸ‡· í•œêµ­ì–´ </a></li><li class="md-select__item"><a class="md-select__link" href="/ja/" hreflang="ja"> ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª </a></li><li class="md-select__item"><a class="md-select__link" href="/ru/" hreflang="ru"> ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ </a></li><li class="md-select__item"><a class="md-select__link" href="/de/" hreflang="de"> ğŸ‡©ğŸ‡ª Deutsch </a></li><li class="md-select__item"><a class="md-select__link" href="/fr/" hreflang="fr"> ğŸ‡«ğŸ‡· FranÃ§ais </a></li><li class="md-select__item"><a class="md-select__link" href="/es/" hreflang="es"> ğŸ‡ªğŸ‡¸ EspaÃ±ol </a></li><li class="md-select__item"><a class="md-select__link" href="/pt/" hreflang="pt"> ğŸ‡µğŸ‡¹ PortuguÃªs </a></li><li class="md-select__item"><a class="md-select__link" href="/it/" hreflang="it"> ğŸ‡®ğŸ‡¹ Italiano </a></li><li class="md-select__item"><a class="md-select__link" href="/tr/" hreflang="tr"> ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e </a></li><li class="md-select__item"><a class="md-select__link" href="/vi/" hreflang="vi"> ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t </a></li><li class="md-select__item"><a class="md-select__link" href="/ar/" hreflang="ar"> ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© </a></li></ul></div></div></div><div class="md-header__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div></nav><nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"><div class="md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a class="md-tabs__link" href="../../../.."> Home </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../quickstart/"> Quickstart </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../modes/"> Modes </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../tasks/"> Tasks </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../models/"> Models </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../datasets/"> Datasets </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../solutions/"> Solutions </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../guides/"> Guides </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../integrations/"> Integrations </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../hub/"> HUB </a></li><li class="md-tabs__item md-tabs__item--active"><a class="md-tabs__link" href="../../../__init__/"> Reference </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../help/"> Help </a></li></ul></div></nav></header><div class="md-container" data-md-component="container"><main class="md-main" data-md-component="main"><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0"><label class="md-nav__title" for="__drawer"><a aria-label="Ultralytics YOLO Docs" class="md-nav__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a> Ultralytics YOLO Docs </label><div class="md-nav__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../.."><span class="md-ellipsis"> Home </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../quickstart/"><span class="md-ellipsis"> Quickstart </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../modes/"><span class="md-ellipsis"> Modes </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../tasks/"><span class="md-ellipsis"> Tasks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../models/"><span class="md-ellipsis"> Models </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../datasets/"><span class="md-ellipsis"> Datasets </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../solutions/"><span class="md-ellipsis"> Solutions </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../guides/"><span class="md-ellipsis"> Guides </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../integrations/"><span class="md-ellipsis"> Integrations </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../hub/"><span class="md-ellipsis"> HUB </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/><label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex=""><span class="md-ellipsis"> Reference </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1"><label class="md-nav__title" for="__nav_11"><span class="md-nav__icon md-icon"></span> Reference </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_2" type="checkbox"/><label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex=""><span class="md-ellipsis"> cfg </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_2_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_2"><span class="md-nav__icon md-icon"></span> cfg </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../cfg/__init__/"><span class="md-ellipsis"> __init__ </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_3" type="checkbox"/><label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex=""><span class="md-ellipsis"> data </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_3_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_3"><span class="md-nav__icon md-icon"></span> data </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../data/annotator/"><span class="md-ellipsis"> annotator </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/augment/"><span class="md-ellipsis"> augment </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/base/"><span class="md-ellipsis"> base </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/build/"><span class="md-ellipsis"> build </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/converter/"><span class="md-ellipsis"> converter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/dataset/"><span class="md-ellipsis"> dataset </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/loaders/"><span class="md-ellipsis"> loaders </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/split/"><span class="md-ellipsis"> split </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/split_dota/"><span class="md-ellipsis"> split_dota </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../data/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_4" type="checkbox"/><label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex=""><span class="md-ellipsis"> engine </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_4_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_4"><span class="md-nav__icon md-icon"></span> engine </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/exporter/"><span class="md-ellipsis"> exporter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/model/"><span class="md-ellipsis"> model </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/predictor/"><span class="md-ellipsis"> predictor </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/results/"><span class="md-ellipsis"> results </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/trainer/"><span class="md-ellipsis"> trainer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/tuner/"><span class="md-ellipsis"> tuner </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../engine/validator/"><span class="md-ellipsis"> validator </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_5" type="checkbox"/><label class="md-nav__link" for="__nav_11_5" id="__nav_11_5_label" tabindex=""><span class="md-ellipsis"> hub </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_5_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_5"><span class="md-nav__icon md-icon"></span> hub </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../hub/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../hub/auth/"><span class="md-ellipsis"> auth </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../hub/google/__init__/"><span class="md-ellipsis"> google </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../hub/session/"><span class="md-ellipsis"> session </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../hub/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_6" type="checkbox"/><label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex=""><span class="md-ellipsis"> models </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_6_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_6"><span class="md-nav__icon md-icon"></span> models </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/fastsam/model/"><span class="md-ellipsis"> fastsam </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/nas/model/"><span class="md-ellipsis"> nas </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/rtdetr/model/"><span class="md-ellipsis"> rtdetr </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/sam/amg/"><span class="md-ellipsis"> sam </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/utils/loss/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/yolo/classify/predict/"><span class="md-ellipsis"> yolo </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_7" type="checkbox"/><label class="md-nav__link" for="__nav_11_7" id="__nav_11_7_label" tabindex=""><span class="md-ellipsis"> nn </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_7_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_7"><span class="md-nav__icon md-icon"></span> nn </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../autobackend/"><span class="md-ellipsis"> autobackend </span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_7_2" type="checkbox"/><label class="md-nav__link" for="__nav_11_7_2" id="__nav_11_7_2_label" tabindex="0"><span class="md-ellipsis"> modules </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_7_2_label" class="md-nav" data-md-level="3"><label class="md-nav__title" for="__nav_11_7_2"><span class="md-nav__icon md-icon"></span> modules </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../activation/"><span class="md-ellipsis"> activation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../block/"><span class="md-ellipsis"> block </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../conv/"><span class="md-ellipsis"> conv </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/><label class="md-nav__link md-nav__link--active" for="__toc"><span class="md-ellipsis"> head </span><span class="md-nav__icon md-icon"></span></label><a class="md-nav__link md-nav__link--active" href="./"><span class="md-ellipsis"> head </span></a><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Detect</span></a><nav aria-label="Class ultralytics.nn.modules.head.Detect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect._inference"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _inference</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.decode_bboxes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> decode_bboxes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.forward_end2end"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_end2end</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.postprocess"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> postprocess</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Segment"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Segment</span></a><nav aria-label="Class ultralytics.nn.modules.head.Segment" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Segment.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> OBB</span></a><nav aria-label="Class ultralytics.nn.modules.head.OBB" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB.decode_bboxes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> decode_bboxes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Pose</span></a><nav aria-label="Class ultralytics.nn.modules.head.Pose" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose.kpts_decode"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> kpts_decode</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Classify"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Classify</span></a><nav aria-label="Class ultralytics.nn.modules.head.Classify" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Classify.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> WorldDetect</span></a><nav aria-label="Class ultralytics.nn.modules.head.WorldDetect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> LRPCHead</span></a><nav aria-label="Class ultralytics.nn.modules.head.LRPCHead" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead.conv2linear"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> conv2linear</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOEDetect</span></a><nav aria-label="Class ultralytics.nn.modules.head.YOLOEDetect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_lrpc</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.get_tpe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_tpe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.get_vpe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_vpe</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOESegment"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOESegment</span></a><nav aria-label="Class ultralytics.nn.modules.head.YOLOESegment" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOESegment.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> RTDETRDecoder</span></a><nav aria-label="Class ultralytics.nn.modules.head.RTDETRDecoder" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _generate_anchors</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _get_decoder_input</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _get_encoder_input</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _reset_parameters</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.v10Detect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> v10Detect</span></a><nav aria-label="Class ultralytics.nn.modules.head.v10Detect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.v10Detect.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="../transformer/"><span class="md-ellipsis"> transformer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="../../tasks/"><span class="md-ellipsis"> tasks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../text_model/"><span class="md-ellipsis"> text_model </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_8" type="checkbox"/><label class="md-nav__link" for="__nav_11_8" id="__nav_11_8_label" tabindex=""><span class="md-ellipsis"> solutions </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_8_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_8"><span class="md-nav__icon md-icon"></span> solutions </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/ai_gym/"><span class="md-ellipsis"> ai_gym </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/analytics/"><span class="md-ellipsis"> analytics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/config/"><span class="md-ellipsis"> config </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/distance_calculation/"><span class="md-ellipsis"> distance_calculation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/heatmap/"><span class="md-ellipsis"> heatmap </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/instance_segmentation/"><span class="md-ellipsis"> instance_segmentation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/object_blurrer/"><span class="md-ellipsis"> object_blurrer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/object_counter/"><span class="md-ellipsis"> object_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/object_cropper/"><span class="md-ellipsis"> object_cropper </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/parking_management/"><span class="md-ellipsis"> parking_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/queue_management/"><span class="md-ellipsis"> queue_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/region_counter/"><span class="md-ellipsis"> region_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/security_alarm/"><span class="md-ellipsis"> security_alarm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/similarity_search/"><span class="md-ellipsis"> similarity_search </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/solutions/"><span class="md-ellipsis"> solutions </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/speed_estimation/"><span class="md-ellipsis"> speed_estimation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/streamlit_inference/"><span class="md-ellipsis"> streamlit_inference </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/trackzone/"><span class="md-ellipsis"> trackzone </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../solutions/vision_eye/"><span class="md-ellipsis"> vision_eye </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_9" type="checkbox"/><label class="md-nav__link" for="__nav_11_9" id="__nav_11_9_label" tabindex=""><span class="md-ellipsis"> trackers </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_9_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_9"><span class="md-nav__icon md-icon"></span> trackers </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../trackers/basetrack/"><span class="md-ellipsis"> basetrack </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../trackers/bot_sort/"><span class="md-ellipsis"> bot_sort </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../trackers/byte_tracker/"><span class="md-ellipsis"> byte_tracker </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../trackers/track/"><span class="md-ellipsis"> track </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../trackers/utils/gmc/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_10" type="checkbox"/><label class="md-nav__link" for="__nav_11_10" id="__nav_11_10_label" tabindex=""><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_10_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_10"><span class="md-nav__icon md-icon"></span> utils </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/autobatch/"><span class="md-ellipsis"> autobatch </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/autodevice/"><span class="md-ellipsis"> autodevice </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/benchmarks/"><span class="md-ellipsis"> benchmarks </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../utils/callbacks/base/"><span class="md-ellipsis"> callbacks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/checks/"><span class="md-ellipsis"> checks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/cpu/"><span class="md-ellipsis"> cpu </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/dist/"><span class="md-ellipsis"> dist </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/downloads/"><span class="md-ellipsis"> downloads </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/errors/"><span class="md-ellipsis"> errors </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/events/"><span class="md-ellipsis"> events </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../utils/export/engine/"><span class="md-ellipsis"> export </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/files/"><span class="md-ellipsis"> files </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/git/"><span class="md-ellipsis"> git </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/instance/"><span class="md-ellipsis"> instance </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/logger/"><span class="md-ellipsis"> logger </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/loss/"><span class="md-ellipsis"> loss </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/metrics/"><span class="md-ellipsis"> metrics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/nms/"><span class="md-ellipsis"> nms </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/ops/"><span class="md-ellipsis"> ops </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/patches/"><span class="md-ellipsis"> patches </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/plotting/"><span class="md-ellipsis"> plotting </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/tal/"><span class="md-ellipsis"> tal </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/torch_utils/"><span class="md-ellipsis"> torch_utils </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/tqdm/"><span class="md-ellipsis"> tqdm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/triton/"><span class="md-ellipsis"> triton </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../utils/tuner/"><span class="md-ellipsis"> tuner </span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../help/"><span class="md-ellipsis"> Help </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Detect</span></a><nav aria-label="Class ultralytics.nn.modules.head.Detect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect._inference"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _inference</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.decode_bboxes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> decode_bboxes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.forward_end2end"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_end2end</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Detect.postprocess"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> postprocess</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Segment"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Segment</span></a><nav aria-label="Class ultralytics.nn.modules.head.Segment" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Segment.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> OBB</span></a><nav aria-label="Class ultralytics.nn.modules.head.OBB" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB.decode_bboxes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> decode_bboxes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.OBB.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Pose</span></a><nav aria-label="Class ultralytics.nn.modules.head.Pose" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Pose.kpts_decode"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> kpts_decode</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Classify"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Classify</span></a><nav aria-label="Class ultralytics.nn.modules.head.Classify" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.Classify.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> WorldDetect</span></a><nav aria-label="Class ultralytics.nn.modules.head.WorldDetect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.WorldDetect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> LRPCHead</span></a><nav aria-label="Class ultralytics.nn.modules.head.LRPCHead" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead.conv2linear"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> conv2linear</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.LRPCHead.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOEDetect</span></a><nav aria-label="Class ultralytics.nn.modules.head.YOLOEDetect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.bias_init"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> bias_init</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_lrpc</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.get_tpe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_tpe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOEDetect.get_vpe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_vpe</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOESegment"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOESegment</span></a><nav aria-label="Class ultralytics.nn.modules.head.YOLOESegment" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.YOLOESegment.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> RTDETRDecoder</span></a><nav aria-label="Class ultralytics.nn.modules.head.RTDETRDecoder" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _generate_anchors</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _get_decoder_input</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _get_encoder_input</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _reset_parameters</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.RTDETRDecoder.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.v10Detect"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> v10Detect</span></a><nav aria-label="Class ultralytics.nn.modules.head.v10Detect" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.modules.head.v10Detect.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content" data-md-component="content"><article class="md-content__inner md-typeset"><a class="md-content__button md-icon" href="https://github.com/ultralytics/ultralytics/tree/main/docs/en/reference/nn/modules/head.md" rel="edit" title="Edit this page"><svg class="lucide lucide-file-pen" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5"></path><path d="M14 2v4a2 2 0 0 0 2 2h4M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"></path></svg></a><h1 id="reference-for-ultralyticsnnmodulesheadpy">Reference for <code>ultralytics/nn/modules/head.py</code></h1><div class="admonition success"><p class="admonition-title">Improvements</p><p>This page is sourced from <a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py">https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py</a>. Have an improvement or example to add? Open a <a href="https://docs.ultralytics.com/help/contributing/">Pull Request</a> â€” thank you! ğŸ™</p></div><p><br/></p><div class="admonition abstract"><p class="admonition-title">Summary</p><div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="classes" name="__tabbed_1" type="radio"/><input id="methods" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="classes"><span class="doc-kind doc-kind-class">Classes</span></label><label for="methods"><span class="doc-kind doc-kind-method">Methods</span></label></div><div class="tabbed-content"><div class="tabbed-block"><ul><li><a href="#ultralytics.nn.modules.head.Detect"><code>Detect</code></a></li><li><a href="#ultralytics.nn.modules.head.Segment"><code>Segment</code></a></li><li><a href="#ultralytics.nn.modules.head.OBB"><code>OBB</code></a></li><li><a href="#ultralytics.nn.modules.head.Pose"><code>Pose</code></a></li><li><a href="#ultralytics.nn.modules.head.Classify"><code>Classify</code></a></li><li><a href="#ultralytics.nn.modules.head.WorldDetect"><code>WorldDetect</code></a></li><li><a href="#ultralytics.nn.modules.head.LRPCHead"><code>LRPCHead</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect"><code>YOLOEDetect</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOESegment"><code>YOLOESegment</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder"><code>RTDETRDecoder</code></a></li><li><a href="#ultralytics.nn.modules.head.v10Detect"><code>v10Detect</code></a></li></ul></div><div class="tabbed-block"><ul><li><a href="#ultralytics.nn.modules.head.Detect.forward"><code>Detect.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.Detect.forward_end2end"><code>Detect.forward_end2end</code></a></li><li><a href="#ultralytics.nn.modules.head.Detect._inference"><code>Detect._inference</code></a></li><li><a href="#ultralytics.nn.modules.head.Detect.bias_init"><code>Detect.bias_init</code></a></li><li><a href="#ultralytics.nn.modules.head.Detect.decode_bboxes"><code>Detect.decode_bboxes</code></a></li><li><a href="#ultralytics.nn.modules.head.Detect.postprocess"><code>Detect.postprocess</code></a></li><li><a href="#ultralytics.nn.modules.head.Segment.forward"><code>Segment.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.OBB.forward"><code>OBB.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.OBB.decode_bboxes"><code>OBB.decode_bboxes</code></a></li><li><a href="#ultralytics.nn.modules.head.Pose.forward"><code>Pose.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.Pose.kpts_decode"><code>Pose.kpts_decode</code></a></li><li><a href="#ultralytics.nn.modules.head.Classify.forward"><code>Classify.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.WorldDetect.forward"><code>WorldDetect.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.WorldDetect.bias_init"><code>WorldDetect.bias_init</code></a></li><li><a href="#ultralytics.nn.modules.head.LRPCHead.conv2linear"><code>LRPCHead.conv2linear</code></a></li><li><a href="#ultralytics.nn.modules.head.LRPCHead.forward"><code>LRPCHead.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.fuse"><code>YOLOEDetect.fuse</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.get_tpe"><code>YOLOEDetect.get_tpe</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.get_vpe"><code>YOLOEDetect.get_vpe</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc"><code>YOLOEDetect.forward_lrpc</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.forward"><code>YOLOEDetect.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOEDetect.bias_init"><code>YOLOEDetect.bias_init</code></a></li><li><a href="#ultralytics.nn.modules.head.YOLOESegment.forward"><code>YOLOESegment.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder.forward"><code>RTDETRDecoder.forward</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors"><code>RTDETRDecoder._generate_anchors</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input"><code>RTDETRDecoder._get_encoder_input</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input"><code>RTDETRDecoder._get_decoder_input</code></a></li><li><a href="#ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters"><code>RTDETRDecoder._reset_parameters</code></a></li><li><a href="#ultralytics.nn.modules.head.v10Detect.fuse"><code>v10Detect.fuse</code></a></li></ul></div></div></div></div><h2 id="ultralytics.nn.modules.head.Detect"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.Detect</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">Detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>YOLO Detect head for object detection models.</p><p>This class implements the detection head used in YOLO models for predicting bounding boxes and class probabilities. It supports both training and inference modes, with optional end-to-end detection capabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dynamic</code></td><td><code>bool</code></td><td>Force grid reconstruction.</td></tr><tr><td><code>export</code></td><td><code>bool</code></td><td>Export mode flag.</td></tr><tr><td><code>format</code></td><td><code>str</code></td><td>Export format.</td></tr><tr><td><code>end2end</code></td><td><code>bool</code></td><td>End-to-end detection mode.</td></tr><tr><td><code>max_det</code></td><td><code>int</code></td><td>Maximum detections per image.</td></tr><tr><td><code>shape</code></td><td><code>tuple</code></td><td>Input shape.</td></tr><tr><td><code>anchors</code></td><td><code>torch.Tensor</code></td><td>Anchor points.</td></tr><tr><td><code>strides</code></td><td><code>torch.Tensor</code></td><td>Feature map strides.</td></tr><tr><td><code>legacy</code></td><td><code>bool</code></td><td>Backward compatibility for v3/v5/v8/v9 models.</td></tr><tr><td><code>xyxy</code></td><td><code>bool</code></td><td>Output format, xyxy or xywh.</td></tr><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td></tr><tr><td><code>nl</code></td><td><code>int</code></td><td>Number of detection layers.</td></tr><tr><td><code>reg_max</code></td><td><code>int</code></td><td>DFL channels.</td></tr><tr><td><code>no</code></td><td><code>int</code></td><td>Number of outputs per anchor.</td></tr><tr><td><code>stride</code></td><td><code>torch.Tensor</code></td><td>Strides computed during build.</td></tr><tr><td><code>cv2</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for box regression.</td></tr><tr><td><code>cv3</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for classification.</td></tr><tr><td><code>dfl</code></td><td><code>nn.Module</code></td><td>Distribution Focal Loss layer.</td></tr><tr><td><code>one2one_cv2</code></td><td><code>nn.ModuleList</code></td><td>One-to-one convolution layers for box regression.</td></tr><tr><td><code>one2one_cv3</code></td><td><code>nn.ModuleList</code></td><td>One-to-one convolution layers for classification.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.Detect._inference"><code>_inference</code></a></td><td>Decode predicted bounding boxes and class probabilities based on multiple-level feature maps.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Detect.bias_init"><code>bias_init</code></a></td><td>Initialize Detect() biases, WARNING: requires stride availability.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Detect.decode_bboxes"><code>decode_bboxes</code></a></td><td>Decode bounding boxes from predictions.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Detect.forward"><code>forward</code></a></td><td>Concatenate and return predicted bounding boxes and class probabilities.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Detect.forward_end2end"><code>forward_end2end</code></a></td><td>Perform forward pass of the v10Detect module.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Detect.postprocess"><code>postprocess</code></a></td><td>Post-process YOLO model predictions.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">detection</span> <span class="n">head</span> <span class="k">for</span> <span class="mi">80</span> <span class="n">classes</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">detect</span> <span class="o">=</span> <span class="n">Detect</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L26-L212"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Detect</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO Detect head for object detection models.</span>
<span></span>
<span></span><span class="sd">    This class implements the detection head used in YOLO models for predicting bounding boxes and class probabilities.</span>
<span></span><span class="sd">    It supports both training and inference modes, with optional end-to-end detection capabilities.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        dynamic (bool): Force grid reconstruction.</span>
<span></span><span class="sd">        export (bool): Export mode flag.</span>
<span></span><span class="sd">        format (str): Export format.</span>
<span></span><span class="sd">        end2end (bool): End-to-end detection mode.</span>
<span></span><span class="sd">        max_det (int): Maximum detections per image.</span>
<span></span><span class="sd">        shape (tuple): Input shape.</span>
<span></span><span class="sd">        anchors (torch.Tensor): Anchor points.</span>
<span></span><span class="sd">        strides (torch.Tensor): Feature map strides.</span>
<span></span><span class="sd">        legacy (bool): Backward compatibility for v3/v5/v8/v9 models.</span>
<span></span><span class="sd">        xyxy (bool): Output format, xyxy or xywh.</span>
<span></span><span class="sd">        nc (int): Number of classes.</span>
<span></span><span class="sd">        nl (int): Number of detection layers.</span>
<span></span><span class="sd">        reg_max (int): DFL channels.</span>
<span></span><span class="sd">        no (int): Number of outputs per anchor.</span>
<span></span><span class="sd">        stride (torch.Tensor): Strides computed during build.</span>
<span></span><span class="sd">        cv2 (nn.ModuleList): Convolution layers for box regression.</span>
<span></span><span class="sd">        cv3 (nn.ModuleList): Convolution layers for classification.</span>
<span></span><span class="sd">        dfl (nn.Module): Distribution Focal Loss layer.</span>
<span></span><span class="sd">        one2one_cv2 (nn.ModuleList): One-to-one convolution layers for box regression.</span>
<span></span><span class="sd">        one2one_cv3 (nn.ModuleList): One-to-one convolution layers for classification.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Perform forward pass and return predictions.</span>
<span></span><span class="sd">        forward_end2end: Perform forward pass for end-to-end detection.</span>
<span></span><span class="sd">        bias_init: Initialize detection head biases.</span>
<span></span><span class="sd">        decode_bboxes: Decode bounding boxes from predictions.</span>
<span></span><span class="sd">        postprocess: Post-process model predictions.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a detection head for 80 classes</span>
<span></span><span class="sd">        &gt;&gt;&gt; detect = Detect(nc=80, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = detect(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="n">dynamic</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># force grid reconstruction</span>
<span></span>    <span class="n">export</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># export mode</span>
<span></span>    <span class="nb">format</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># export format</span>
<span></span>    <span class="n">end2end</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># end2end</span>
<span></span>    <span class="n">max_det</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># max_det</span>
<span></span>    <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># init</span>
<span></span>    <span class="n">strides</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># init</span>
<span></span>    <span class="n">legacy</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># backward compatibility for v3/v5/v8/v9 models</span>
<span></span>    <span class="n">xyxy</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># xyxy or xywh output</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the YOLO detection layer with specified number of classes and channels.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span>  <span class="c1"># number of classes</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>  <span class="c1"># number of detection layers</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># DFL channels (ch[0] // 16 to scale 4/8/12/16/20 for n/s/m/l/x)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span>  <span class="c1"># number of outputs per anchor</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>  <span class="c1"># strides computed during build</span>
<span></span>        <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="mi">16</span><span class="p">,</span> <span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>  <span class="c1"># channels</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span>
<span></span>            <span class="k">else</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>                <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">DWConv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">DWConv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span></span>                <span class="p">)</span>
<span></span>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span>
<span></span>            <span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dfl</span> <span class="o">=</span> <span class="n">DFL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
<span></span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">one2one_cv2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">one2one_cv3</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect._inference"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect._inference</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Decode predicted bounding boxes and class probabilities based on multiple-level feature maps.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td>List of feature maps from different detection layers.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Concatenated tensor of decoded bounding boxes and class probabilities.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L149-L167"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Decode predicted bounding boxes and class probabilities based on multiple-level feature maps.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (list[torch.Tensor]): List of feature maps from different detection layers.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Concatenated tensor of decoded bounding boxes and class probabilities.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="c1"># Inference path</span>
<span></span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># BCHW</span>
<span></span>    <span class="n">x_cat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">no</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">make_anchors</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
<span></span>
<span></span>    <span class="n">box</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">x_cat</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">dbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfl</span><span class="p">(</span><span class="n">box</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dbox</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect.bias_init"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect.bias_init</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize Detect() biases, WARNING: requires stride availability.</p><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L169-L180"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize Detect() biases, WARNING: requires stride availability."""</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># self.model[-1]  # Detect() module</span>
<span></span>    <span class="c1"># cf = torch.bincount(torch.tensor(np.concatenate(dataset.labels, 0)[:, 0]).long(), minlength=nc) + 1</span>
<span></span>    <span class="c1"># ncf = math.log(0.6 / (m.nc - 0.999999)) if cf is None else torch.log(cf / cf.sum())  # nominal class frequency</span>
<span></span>    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">cv2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cv3</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">stride</span><span class="p">):</span>  <span class="c1"># from</span>
<span></span>        <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># box</span>
<span></span>        <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span> <span class="n">m</span><span class="o">.</span><span class="n">nc</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="n">m</span><span class="o">.</span><span class="n">nc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">640</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># cls (.01 objects, 80 classes, 640 img)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span><span class="p">:</span>
<span></span>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">one2one_cv2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">one2one_cv3</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">stride</span><span class="p">):</span>  <span class="c1"># from</span>
<span></span>            <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># box</span>
<span></span>            <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span> <span class="n">m</span><span class="o">.</span><span class="n">nc</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="n">m</span><span class="o">.</span><span class="n">nc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">640</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># cls (.01 objects, 80 classes, 640 img)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect.decode_bboxes"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect.decode_bboxes</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">anchors</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">xywh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Decode bounding boxes from predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>bboxes</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>anchors</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>xywh</code></td><td><code>bool</code></td><td></td><td><code>True</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L182-L189"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">anchors</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">xywh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Decode bounding boxes from predictions."""</span>
<span></span>    <span class="k">return</span> <span class="n">dist2bbox</span><span class="p">(</span>
<span></span>        <span class="n">bboxes</span><span class="p">,</span>
<span></span>        <span class="n">anchors</span><span class="p">,</span>
<span></span>        <span class="n">xywh</span><span class="o">=</span><span class="n">xywh</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyxy</span><span class="p">,</span>
<span></span>        <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Concatenate and return predicted bounding boxes and class probabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L114-L124"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Concatenate and return predicted bounding boxes and class probabilities."""</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_end2end</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">):</span>
<span></span>        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>  <span class="c1"># Training path</span>
<span></span>        <span class="k">return</span> <span class="n">x</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inference</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect.forward_end2end"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect.forward_end2end</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_end2end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Perform forward pass of the v10Detect module.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td>Input feature maps from different levels.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>outputs (dict | tuple)</code></td><td>Training mode returns dict with one2many and one2one outputs. Inference mode returns</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L126-L147"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_end2end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Perform forward pass of the v10Detect module.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (list[torch.Tensor]): Input feature maps from different levels.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        outputs (dict | tuple): Training mode returns dict with one2many and one2one outputs. Inference mode returns</span>
<span></span><span class="sd">            processed detections or tuple with detections and raw outputs.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">x_detach</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span></span>    <span class="n">one2one</span> <span class="o">=</span> <span class="p">[</span>
<span></span>        <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">one2one_cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x_detach</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">one2one_cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x_detach</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
<span></span>    <span class="p">]</span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">):</span>
<span></span>        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>  <span class="c1"># Training path</span>
<span></span>        <span class="k">return</span> <span class="p">{</span><span class="s2">"one2many"</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">"one2one"</span><span class="p">:</span> <span class="n">one2one</span><span class="p">}</span>
<span></span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inference</span><span class="p">(</span><span class="n">one2one</span><span class="p">)</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_det</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">{</span><span class="s2">"one2many"</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s2">"one2one"</span><span class="p">:</span> <span class="n">one2one</span><span class="p">})</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Detect.postprocess"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Detect.postprocess</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">postprocess</span><span class="p">(</span><span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">max_det</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Post-process YOLO model predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>preds</code></td><td><code>torch.Tensor</code></td><td>Raw predictions with shape (batch_size, num_anchors, 4 + nc) with last dimension format [x, y, w, h, class_probs].</td><td><em>required</em></td></tr><tr><td><code>max_det</code></td><td><code>int</code></td><td>Maximum detections per image.</td><td><em>required</em></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>80</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Processed predictions with shape (batch_size, min(max_det, num_anchors), 6) and last</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L192-L212"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@staticmethod</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">postprocess</span><span class="p">(</span><span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">max_det</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Post-process YOLO model predictions.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        preds (torch.Tensor): Raw predictions with shape (batch_size, num_anchors, 4 + nc) with last dimension</span>
<span></span><span class="sd">            format [x, y, w, h, class_probs].</span>
<span></span><span class="sd">        max_det (int): Maximum detections per image.</span>
<span></span><span class="sd">        nc (int, optional): Number of classes.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Processed predictions with shape (batch_size, min(max_det, num_anchors), 6) and last</span>
<span></span><span class="sd">            dimension format [x, y, w, h, max_class_prob, class_index].</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">batch_size</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># i.e. shape(16,8400,84)</span>
<span></span>    <span class="n">boxes</span><span class="p">,</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">split</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="n">nc</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">index</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">max_det</span><span class="p">,</span> <span class="n">anchors</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">boxes</span> <span class="o">=</span> <span class="n">boxes</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span></span>    <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nc</span><span class="p">))</span>
<span></span>    <span class="n">scores</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">max_det</span><span class="p">,</span> <span class="n">anchors</span><span class="p">))</span>
<span></span>    <span class="n">i</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># batch indices</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">index</span> <span class="o">//</span> <span class="n">nc</span><span class="p">],</span> <span class="n">scores</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="n">index</span> <span class="o">%</span> <span class="n">nc</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">()],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.Segment"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.Segment</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>YOLO Segment head for segmentation models.</p><p>This class extends the Detect head to include mask prediction capabilities for instance segmentation tasks.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>nm</code></td><td><code>int</code></td><td>Number of masks.</td><td><code>32</code></td></tr><tr><td><code>npr</code></td><td><code>int</code></td><td>Number of protos.</td><td><code>256</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>nm</code></td><td><code>int</code></td><td>Number of masks.</td></tr><tr><td><code>npr</code></td><td><code>int</code></td><td>Number of protos.</td></tr><tr><td><code>proto</code></td><td><code>Proto</code></td><td>Prototype generation module.</td></tr><tr><td><code>cv4</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for mask coefficients.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.Segment.forward"><code>forward</code></a></td><td>Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">segmentation</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">segment</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">segment</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L215-L262"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Segment</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO Segment head for segmentation models.</span>
<span></span>
<span></span><span class="sd">    This class extends the Detect head to include mask prediction capabilities for instance segmentation tasks.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        nm (int): Number of masks.</span>
<span></span><span class="sd">        npr (int): Number of protos.</span>
<span></span><span class="sd">        proto (Proto): Prototype generation module.</span>
<span></span><span class="sd">        cv4 (nn.ModuleList): Convolution layers for mask coefficients.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Return model outputs and mask coefficients.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a segmentation head</span>
<span></span><span class="sd">        &gt;&gt;&gt; segment = Segment(nc=80, nm=32, npr=256, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = segment(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the YOLO model attributes such as the number of masks, prototypes, and the convolution layers.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            nm (int): Number of masks.</span>
<span></span><span class="sd">            npr (int): Number of protos.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nm</span> <span class="o">=</span> <span class="n">nm</span>  <span class="c1"># number of masks</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">npr</span> <span class="o">=</span> <span class="n">npr</span>  <span class="c1"># number of protos</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">proto</span> <span class="o">=</span> <span class="n">Proto</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">npr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">)</span>  <span class="c1"># protos</span>
<span></span>
<span></span>        <span class="n">c4</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Segment.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Segment.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div><p>Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L253-L262"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span></span><span class="w">    </span><span class="sd">"""Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients."""</span>
<span></span>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proto</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># mask protos</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># batch size</span>
<span></span>
<span></span>    <span class="n">mc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># mask coefficients</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">Detect</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">p</span>
<span></span>    <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">mc</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mc</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mc</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.OBB"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.OBB</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">OBB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ne</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>YOLO OBB detection head for detection with rotation models.</p><p>This class extends the Detect head to include oriented bounding box prediction with rotation angles.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>ne</code></td><td><code>int</code></td><td>Number of extra parameters.</td><td><code>1</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>ne</code></td><td><code>int</code></td><td>Number of extra parameters.</td></tr><tr><td><code>cv4</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for angle prediction.</td></tr><tr><td><code>angle</code></td><td><code>torch.Tensor</code></td><td>Predicted rotation angles.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.OBB.decode_bboxes"><code>decode_bboxes</code></a></td><td>Decode rotated bounding boxes.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.OBB.forward"><code>forward</code></a></td><td>Concatenate and return predicted bounding boxes and class probabilities.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">an</span> <span class="n">OBB</span> <span class="n">detection</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">obb</span> <span class="o">=</span> <span class="n">OBB</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">ne</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">obb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L265-L316"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OBB</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO OBB detection head for detection with rotation models.</span>
<span></span>
<span></span><span class="sd">    This class extends the Detect head to include oriented bounding box prediction with rotation angles.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        ne (int): Number of extra parameters.</span>
<span></span><span class="sd">        cv4 (nn.ModuleList): Convolution layers for angle prediction.</span>
<span></span><span class="sd">        angle (torch.Tensor): Predicted rotation angles.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Concatenate and return predicted bounding boxes and class probabilities.</span>
<span></span><span class="sd">        decode_bboxes: Decode rotated bounding boxes.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create an OBB detection head</span>
<span></span><span class="sd">        &gt;&gt;&gt; obb = OBB(nc=80, ne=1, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = obb(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ne</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize OBB with number of classes `nc` and layer channels `ch`.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            ne (int): Number of extra parameters.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">ne</span> <span class="o">=</span> <span class="n">ne</span>  <span class="c1"># number of extra parameters</span>
<span></span>
<span></span>        <span class="n">c4</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.OBB.decode_bboxes"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.OBB.decode_bboxes</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">anchors</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Decode rotated bounding boxes.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>bboxes</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>anchors</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L314-L316"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">anchors</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Decode rotated bounding boxes."""</span>
<span></span>    <span class="k">return</span> <span class="n">dist2rbox</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.OBB.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.OBB.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Concatenate and return predicted bounding boxes and class probabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L300-L312"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Concatenate and return predicted bounding boxes and class probabilities."""</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># batch size</span>
<span></span>    <span class="n">angle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># OBB theta logits</span>
<span></span>    <span class="c1"># NOTE: set `angle` as an attribute so that `decode_bboxes` could use it.</span>
<span></span>    <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.25</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># [-pi/4, 3pi/4]</span>
<span></span>    <span class="c1"># angle = angle.sigmoid() * math.pi / 2  # [0, pi/2]</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">Detect</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">angle</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">angle</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angle</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="p">))</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.Pose"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.Pose</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">Pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">kpt_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>YOLO Pose head for keypoints models.</p><p>This class extends the Detect head to include keypoint prediction capabilities for pose estimation tasks.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>kpt_shape</code></td><td><code>tuple</code></td><td>Number of keypoints, number of dims (2 for x,y or 3 for x,y,visible).</td><td><code>(17, 3)</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>kpt_shape</code></td><td><code>tuple</code></td><td>Number of keypoints and dimensions (2 for x,y or 3 for x,y,visible).</td></tr><tr><td><code>nk</code></td><td><code>int</code></td><td>Total number of keypoint values.</td></tr><tr><td><code>cv4</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for keypoint prediction.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.Pose.forward"><code>forward</code></a></td><td>Perform forward pass through YOLO model and return predictions.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.Pose.kpts_decode"><code>kpts_decode</code></a></td><td>Decode keypoints from predictions.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">pose</span> <span class="n">detection</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">pose</span> <span class="o">=</span> <span class="n">Pose</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">kpt_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">pose</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L319-L384"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Pose</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO Pose head for keypoints models.</span>
<span></span>
<span></span><span class="sd">    This class extends the Detect head to include keypoint prediction capabilities for pose estimation tasks.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        kpt_shape (tuple): Number of keypoints and dimensions (2 for x,y or 3 for x,y,visible).</span>
<span></span><span class="sd">        nk (int): Total number of keypoint values.</span>
<span></span><span class="sd">        cv4 (nn.ModuleList): Convolution layers for keypoint prediction.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Perform forward pass through YOLO model and return predictions.</span>
<span></span><span class="sd">        kpts_decode: Decode keypoints from predictions.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a pose detection head</span>
<span></span><span class="sd">        &gt;&gt;&gt; pose = Pose(nc=80, kpt_shape=(17, 3), ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = pose(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">kpt_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLO network with default parameters and Convolutional Layers.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            kpt_shape (tuple): Number of keypoints, number of dims (2 for x,y or 3 for x,y,visible).</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">kpt_shape</span> <span class="o">=</span> <span class="n">kpt_shape</span>  <span class="c1"># number of keypoints, number of dims (2 for x,y or 3 for x,y,visible)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nk</span> <span class="o">=</span> <span class="n">kpt_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">kpt_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># number of keypoints total</span>
<span></span>
<span></span>        <span class="n">c4</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Pose.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Pose.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Perform forward pass through YOLO model and return predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L355-L363"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Perform forward pass through YOLO model and return predictions."""</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># batch size</span>
<span></span>    <span class="n">kpt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (bs, 17*3, h*w)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">Detect</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">kpt</span>
<span></span>    <span class="n">pred_kpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpts_decode</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">kpt</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">pred_kpt</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pred_kpt</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kpt</span><span class="p">))</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Pose.kpts_decode"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Pose.kpts_decode</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">kpts_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">kpts</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Decode keypoints from predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>bs</code></td><td><code>int</code></td><td></td><td><em>required</em></td></tr><tr><td><code>kpts</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L365-L384"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">kpts_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">kpts</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Decode keypoints from predictions."""</span>
<span></span>    <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kpt_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span><span class="p">:</span>
<span></span>        <span class="c1"># NCNN fix</span>
<span></span>        <span class="n">y</span> <span class="o">=</span> <span class="n">kpts</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">kpt_shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
<span></span>        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span></span>            <span class="n">a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
<span></span>        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nk</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">y</span> <span class="o">=</span> <span class="n">kpts</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span></span>        <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span></span>            <span class="k">if</span> <span class="n">NOT_MACOS14</span><span class="p">:</span>
<span></span>                <span class="n">y</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span><span class="o">.</span><span class="n">sigmoid_</span><span class="p">()</span>
<span></span>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Apple macOS14 MPS bug https://github.com/ultralytics/ultralytics/pull/21878</span>
<span></span>                <span class="n">y</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
<span></span>        <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
<span></span>        <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="n">ndim</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
<span></span>        <span class="k">return</span> <span class="n">y</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.Classify"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.Classify</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">Classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>YOLO classification head, i.e. x(b,c1,20,20) to x(b,c2).</p><p>This class implements a classification head that transforms feature maps into class predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>c1</code></td><td><code>int</code></td><td>Number of input channels.</td><td><em>required</em></td></tr><tr><td><code>c2</code></td><td><code>int</code></td><td>Number of output classes.</td><td><em>required</em></td></tr><tr><td><code>k</code></td><td><code>int, optional</code></td><td>Kernel size.</td><td><code>1</code></td></tr><tr><td><code>s</code></td><td><code>int, optional</code></td><td>Stride.</td><td><code>1</code></td></tr><tr><td><code>p</code></td><td><code>int, optional</code></td><td>Padding.</td><td><code>None</code></td></tr><tr><td><code>g</code></td><td><code>int, optional</code></td><td>Groups.</td><td><code>1</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>export</code></td><td><code>bool</code></td><td>Export mode flag.</td></tr><tr><td><code>conv</code></td><td><code>Conv</code></td><td>Convolutional layer for feature transformation.</td></tr><tr><td><code>pool</code></td><td><code>nn.AdaptiveAvgPool2d</code></td><td>Global average pooling layer.</td></tr><tr><td><code>drop</code></td><td><code>nn.Dropout</code></td><td>Dropout layer for regularization.</td></tr><tr><td><code>linear</code></td><td><code>nn.Linear</code></td><td>Linear layer for final classification.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.Classify.forward"><code>forward</code></a></td><td>Perform forward pass of the YOLO model on input image data.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">classification</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">classify</span> <span class="o">=</span> <span class="n">Classify</span><span class="p">(</span><span class="n">c1</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L387-L437"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Classify</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO classification head, i.e. x(b,c1,20,20) to x(b,c2).</span>
<span></span>
<span></span><span class="sd">    This class implements a classification head that transforms feature maps into class predictions.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        export (bool): Export mode flag.</span>
<span></span><span class="sd">        conv (Conv): Convolutional layer for feature transformation.</span>
<span></span><span class="sd">        pool (nn.AdaptiveAvgPool2d): Global average pooling layer.</span>
<span></span><span class="sd">        drop (nn.Dropout): Dropout layer for regularization.</span>
<span></span><span class="sd">        linear (nn.Linear): Linear layer for final classification.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Perform forward pass of the YOLO model on input image data.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a classification head</span>
<span></span><span class="sd">        &gt;&gt;&gt; classify = Classify(c1=1024, c2=1000)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(1, 1024, 20, 20)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = classify(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="n">export</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># export mode</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLO classification head to transform input tensor from (b,c1,20,20) to (b,c2) shape.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            c1 (int): Number of input channels.</span>
<span></span><span class="sd">            c2 (int): Number of output classes.</span>
<span></span><span class="sd">            k (int, optional): Kernel size.</span>
<span></span><span class="sd">            s (int, optional): Stride.</span>
<span></span><span class="sd">            p (int, optional): Padding.</span>
<span></span><span class="sd">            g (int, optional): Groups.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="n">c_</span> <span class="o">=</span> <span class="mi">1280</span>  <span class="c1"># efficientnet_b0 size</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">AdaptiveAvgPool2d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># to x(b,c_,1,1)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>  <span class="c1"># to x(b,c2)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.Classify.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.Classify.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Perform forward pass of the YOLO model on input image data.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor] | torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L429-L437"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Perform forward pass of the YOLO model on input image data."""</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># get final output</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.WorldDetect"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.WorldDetect</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">WorldDetect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>Head for integrating YOLO detection models with semantic understanding from text embeddings.</p><p>This class extends the standard Detect head to incorporate text embeddings for enhanced semantic understanding in object detection tasks.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>embed</code></td><td><code>int</code></td><td>Embedding dimension.</td><td><code>512</code></td></tr><tr><td><code>with_bn</code></td><td><code>bool</code></td><td>Whether to use batch normalization in contrastive head.</td><td><code>False</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>cv3</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for embedding features.</td></tr><tr><td><code>cv4</code></td><td><code>nn.ModuleList</code></td><td>Contrastive head layers for text-vision alignment.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.WorldDetect.bias_init"><code>bias_init</code></a></td><td>Initialize Detect() biases, WARNING: requires stride availability.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.WorldDetect.forward"><code>forward</code></a></td><td>Concatenate and return predicted bounding boxes and class probabilities.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">WorldDetect</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">world_detect</span> <span class="o">=</span> <span class="n">WorldDetect</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">world_detect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L440-L492"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">WorldDetect</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Head for integrating YOLO detection models with semantic understanding from text embeddings.</span>
<span></span>
<span></span><span class="sd">    This class extends the standard Detect head to incorporate text embeddings for enhanced semantic understanding in</span>
<span></span><span class="sd">    object detection tasks.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        cv3 (nn.ModuleList): Convolution layers for embedding features.</span>
<span></span><span class="sd">        cv4 (nn.ModuleList): Contrastive head layers for text-vision alignment.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Concatenate and return predicted bounding boxes and class probabilities.</span>
<span></span><span class="sd">        bias_init: Initialize detection head biases.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a WorldDetect head</span>
<span></span><span class="sd">        &gt;&gt;&gt; world_detect = WorldDetect(nc=80, embed=512, with_bn=False, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; text = torch.randn(1, 80, 512)</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = world_detect(x, text)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLO detection layer with nc classes and layer channels ch.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            embed (int): Embedding dimension.</span>
<span></span><span class="sd">            with_bn (bool): Whether to use batch normalization in contrastive head.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="n">c3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">BNContrastiveHead</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_bn</span> <span class="k">else</span> <span class="n">ContrastiveHead</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.WorldDetect.bias_init"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.WorldDetect.bias_init</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize Detect() biases, WARNING: requires stride availability.</p><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L486-L492"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize Detect() biases, WARNING: requires stride availability."""</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># self.model[-1]  # Detect() module</span>
<span></span>    <span class="c1"># cf = torch.bincount(torch.tensor(np.concatenate(dataset.labels, 0)[:, 0]).long(), minlength=nc) + 1</span>
<span></span>    <span class="c1"># ncf = math.log(0.6 / (m.nc - 0.999999)) if cf is None else torch.log(cf / cf.sum())  # nominal class frequency</span>
<span></span>    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">cv2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cv3</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">stride</span><span class="p">):</span>  <span class="c1"># from</span>
<span></span>        <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># box</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.WorldDetect.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.WorldDetect.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Concatenate and return predicted bounding boxes and class probabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr><tr><td><code>text</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L476-L484"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Concatenate and return predicted bounding boxes and class probabilities."""</span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">):</span>
<span></span>        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">text</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span>  <span class="c1"># self.nc could be changed when inference with different texts</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inference</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.LRPCHead"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.LRPCHead</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">LRPCHead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">pf</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">loc</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Lightweight Region Proposal and Classification Head for efficient object detection.</p><p>This head combines region proposal filtering with classification to enable efficient detection with dynamic vocabulary support.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>vocab</code></td><td><code>nn.Module</code></td><td>Vocabulary/classification module.</td><td><em>required</em></td></tr><tr><td><code>pf</code></td><td><code>nn.Module</code></td><td>Proposal filter module.</td><td><em>required</em></td></tr><tr><td><code>loc</code></td><td><code>nn.Module</code></td><td>Localization module.</td><td><em>required</em></td></tr><tr><td><code>enabled</code></td><td><code>bool</code></td><td>Whether to enable the head functionality.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>vocab</code></td><td><code>nn.Module</code></td><td>Vocabulary/classification layer.</td></tr><tr><td><code>pf</code></td><td><code>nn.Module</code></td><td>Proposal filter module.</td></tr><tr><td><code>loc</code></td><td><code>nn.Module</code></td><td>Localization module.</td></tr><tr><td><code>enabled</code></td><td><code>bool</code></td><td>Whether the head is enabled.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.LRPCHead.conv2linear"><code>conv2linear</code></a></td><td>Convert a 1x1 convolutional layer to a linear layer.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.LRPCHead.forward"><code>forward</code></a></td><td>Process classification and localization features to generate detection proposals.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">an</span> <span class="n">LRPC</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">vocab</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">pf</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">head</span> <span class="o">=</span> <span class="n">LRPCHead</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L496-L556"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">LRPCHead</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Lightweight Region Proposal and Classification Head for efficient object detection.</span>
<span></span>
<span></span><span class="sd">    This head combines region proposal filtering with classification to enable efficient detection with dynamic</span>
<span></span><span class="sd">    vocabulary support.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        vocab (nn.Module): Vocabulary/classification layer.</span>
<span></span><span class="sd">        pf (nn.Module): Proposal filter module.</span>
<span></span><span class="sd">        loc (nn.Module): Localization module.</span>
<span></span><span class="sd">        enabled (bool): Whether the head is enabled.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        conv2linear: Convert a 1x1 convolutional layer to a linear layer.</span>
<span></span><span class="sd">        forward: Process classification and localization features to generate detection proposals.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create an LRPC head</span>
<span></span><span class="sd">        &gt;&gt;&gt; vocab = nn.Conv2d(256, 80, 1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; pf = nn.Conv2d(256, 1, 1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; loc = nn.Conv2d(256, 4, 1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; head = LRPCHead(vocab, pf, loc, enabled=True)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">pf</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">loc</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize LRPCHead with vocabulary, proposal filter, and localization components.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            vocab (nn.Module): Vocabulary/classification module.</span>
<span></span><span class="sd">            pf (nn.Module): Proposal filter module.</span>
<span></span><span class="sd">            loc (nn.Module): Localization module.</span>
<span></span><span class="sd">            enabled (bool): Whether to enable the head functionality.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2linear</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="n">vocab</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">pf</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.LRPCHead.conv2linear"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.LRPCHead.conv2linear</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">conv2linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conv</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span>
</code></pre></div><p>Convert a 1x1 convolutional layer to a linear layer.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>conv</code></td><td><code>nn.Conv2d</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L535-L541"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">conv2linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conv</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Convert a 1x1 convolutional layer to a linear layer."""</span>
<span></span>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">conv</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">conv</span><span class="o">.</span><span class="n">out_channels</span><span class="p">)</span>
<span></span>    <span class="n">linear</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">out_channels</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span></span>    <span class="n">linear</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span>
<span></span>    <span class="k">return</span> <span class="n">linear</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.LRPCHead.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.LRPCHead.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">loc_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">conf</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div><p>Process classification and localization features to generate detection proposals.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cls_feat</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>loc_feat</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>conf</code></td><td><code>float</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L543-L556"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">loc_feat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">conf</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span></span><span class="w">    </span><span class="sd">"""Process classification and localization features to generate detection proposals."""</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
<span></span>        <span class="n">pf_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pf</span><span class="p">(</span><span class="n">cls_feat</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span></span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">pf_score</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">conf</span>
<span></span>        <span class="n">cls_feat</span> <span class="o">=</span> <span class="n">cls_feat</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span></span>        <span class="n">cls_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">(</span><span class="n">cls_feat</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span> <span class="k">if</span> <span class="n">conf</span> <span class="k">else</span> <span class="n">cls_feat</span> <span class="o">*</span> <span class="n">mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">int</span><span class="p">())</span>
<span></span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">loc_feat</span><span class="p">),</span> <span class="n">cls_feat</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="n">mask</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">cls_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">(</span><span class="n">cls_feat</span><span class="p">)</span>
<span></span>        <span class="n">loc_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">(</span><span class="n">loc_feat</span><span class="p">)</span>
<span></span>        <span class="k">return</span> <span class="p">(</span><span class="n">loc_feat</span><span class="p">,</span> <span class="n">cls_feat</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
<span></span>            <span class="n">cls_feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">cls_feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">cls_feat</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span>
<span></span>        <span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.YOLOEDetect"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.YOLOEDetect</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">YOLOEDetect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>Head for integrating YOLO detection models with semantic understanding from text embeddings.</p><p>This class extends the standard Detect head to support text-guided detection with enhanced semantic understanding through text embeddings and visual prompt embeddings.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>embed</code></td><td><code>int</code></td><td>Embedding dimension.</td><td><code>512</code></td></tr><tr><td><code>with_bn</code></td><td><code>bool</code></td><td>Whether to use batch normalization in contrastive head.</td><td><code>False</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>is_fused</code></td><td><code>bool</code></td><td>Whether the model is fused for inference.</td></tr><tr><td><code>cv3</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for embedding features.</td></tr><tr><td><code>cv4</code></td><td><code>nn.ModuleList</code></td><td>Contrastive head layers for text-vision alignment.</td></tr><tr><td><code>reprta</code></td><td><code>Residual</code></td><td>Residual block for text prompt embeddings.</td></tr><tr><td><code>savpe</code></td><td><code>SAVPE</code></td><td>Spatial-aware visual prompt embeddings module.</td></tr><tr><td><code>embed</code></td><td><code>int</code></td><td>Embedding dimension.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.bias_init"><code>bias_init</code></a></td><td>Initialize biases for detection heads.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.forward"><code>forward</code></a></td><td>Process features with class prompt embeddings to generate detections.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc"><code>forward_lrpc</code></a></td><td>Process features with fused text embeddings to generate detections for prompt-free model.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.fuse"><code>fuse</code></a></td><td>Fuse text features with model weights for efficient inference.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.get_tpe"><code>get_tpe</code></a></td><td>Get text prompt embeddings with normalization.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.YOLOEDetect.get_vpe"><code>get_vpe</code></a></td><td>Get visual prompt embeddings with spatial awareness.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">YOLOEDetect</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">yoloe_detect</span> <span class="o">=</span> <span class="n">YOLOEDetect</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">cls_pe</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">yoloe_detect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cls_pe</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L559-L742"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">YOLOEDetect</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Head for integrating YOLO detection models with semantic understanding from text embeddings.</span>
<span></span>
<span></span><span class="sd">    This class extends the standard Detect head to support text-guided detection with enhanced semantic understanding</span>
<span></span><span class="sd">    through text embeddings and visual prompt embeddings.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        is_fused (bool): Whether the model is fused for inference.</span>
<span></span><span class="sd">        cv3 (nn.ModuleList): Convolution layers for embedding features.</span>
<span></span><span class="sd">        cv4 (nn.ModuleList): Contrastive head layers for text-vision alignment.</span>
<span></span><span class="sd">        reprta (Residual): Residual block for text prompt embeddings.</span>
<span></span><span class="sd">        savpe (SAVPE): Spatial-aware visual prompt embeddings module.</span>
<span></span><span class="sd">        embed (int): Embedding dimension.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        fuse: Fuse text features with model weights for efficient inference.</span>
<span></span><span class="sd">        get_tpe: Get text prompt embeddings with normalization.</span>
<span></span><span class="sd">        get_vpe: Get visual prompt embeddings with spatial awareness.</span>
<span></span><span class="sd">        forward_lrpc: Process features with fused text embeddings for prompt-free model.</span>
<span></span><span class="sd">        forward: Process features with class prompt embeddings to generate detections.</span>
<span></span><span class="sd">        bias_init: Initialize biases for detection heads.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a YOLOEDetect head</span>
<span></span><span class="sd">        &gt;&gt;&gt; yoloe_detect = YOLOEDetect(nc=80, embed=512, with_bn=True, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; cls_pe = torch.randn(1, 80, 512)</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = yoloe_detect(x, cls_pe)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="n">is_fused</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLO detection layer with nc classes and layer channels ch.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            embed (int): Embedding dimension.</span>
<span></span><span class="sd">            with_bn (bool): Whether to use batch normalization in contrastive head.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="n">c3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span></span>        <span class="k">assert</span> <span class="n">c3</span> <span class="o">&lt;=</span> <span class="n">embed</span>
<span></span>        <span class="k">assert</span> <span class="n">with_bn</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy</span>
<span></span>            <span class="k">else</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>                <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">DWConv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">DWConv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span></span>                <span class="p">)</span>
<span></span>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span>
<span></span>            <span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">BNContrastiveHead</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">with_bn</span> <span class="k">else</span> <span class="n">ContrastiveHead</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">reprta</span> <span class="o">=</span> <span class="n">Residual</span><span class="p">(</span><span class="n">SwiGLUFFN</span><span class="p">(</span><span class="n">embed</span><span class="p">,</span> <span class="n">embed</span><span class="p">))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">savpe</span> <span class="o">=</span> <span class="n">SAVPE</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">embed</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.bias_init"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.bias_init</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize biases for detection heads.</p><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L733-L742"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bias_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize biases for detection heads."""</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># self.model[-1]  # Detect() module</span>
<span></span>    <span class="c1"># cf = torch.bincount(torch.tensor(np.concatenate(dataset.labels, 0)[:, 0]).long(), minlength=nc) + 1</span>
<span></span>    <span class="c1"># ncf = math.log(0.6 / (m.nc - 0.999999)) if cf is None else torch.log(cf / cf.sum())  # nominal class frequency</span>
<span></span>    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">cv2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cv3</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cv4</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">stride</span><span class="p">):</span>  <span class="c1"># from</span>
<span></span>        <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># box</span>
<span></span>        <span class="c1"># b[-1].bias.data[:] = math.log(5 / m.nc / (640 / s) ** 2)  # cls (.01 objects, 80 classes, 640 img)</span>
<span></span>        <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span></span>        <span class="n">c</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span> <span class="o">/</span> <span class="n">m</span><span class="o">.</span><span class="n">nc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">640</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">cls_pe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Process features with class prompt embeddings to generate detections.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr><tr><td><code>cls_pe</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr><tr><td><code>return_mask</code></td><td><code>bool</code></td><td></td><td><code>False</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L721-L731"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">cls_pe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">return_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process features with class prompt embeddings to generate detections."""</span>
<span></span>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"lrpc"</span><span class="p">):</span>  <span class="c1"># for prompt-free inference</span>
<span></span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_lrpc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">return_mask</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">):</span>
<span></span>        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">cls_pe</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span>  <span class="c1"># self.nc could be changed when inference with different texts</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inference</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.forward_lrpc</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_lrpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">return_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span>
</code></pre></div><p>Process features with fused text embeddings to generate detections for prompt-free model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr><tr><td><code>return_mask</code></td><td><code>bool</code></td><td></td><td><code>False</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L683-L719"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_lrpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">return_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process features with fused text embeddings to generate detections for prompt-free model."""</span>
<span></span>    <span class="n">masks</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fused</span><span class="p">,</span> <span class="s2">"Prompt-free inference requires model to be fused!"</span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">):</span>
<span></span>        <span class="n">cls_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span></span>        <span class="n">loc_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lrpc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">LRPCHead</span><span class="p">)</span>
<span></span>        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lrpc</span><span class="p">[</span><span class="n">i</span><span class="p">](</span>
<span></span>            <span class="n">cls_feat</span><span class="p">,</span> <span class="n">loc_feat</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"conf"</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span></span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">make_anchors</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
<span></span>    <span class="n">box</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">reg_max</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="bp">cls</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"tflite"</span><span class="p">,</span> <span class="s2">"edgetpu"</span><span class="p">}:</span>
<span></span>        <span class="c1"># Precompute normalization factor to increase numerical stability</span>
<span></span>        <span class="c1"># See https://github.com/ultralytics/ultralytics/issues/7371</span>
<span></span>        <span class="n">grid_h</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span></span>        <span class="n">grid_w</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span></span>        <span class="n">grid_size</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">grid_w</span><span class="p">,</span> <span class="n">grid_h</span><span class="p">,</span> <span class="n">grid_w</span><span class="p">,</span> <span class="n">grid_h</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">box</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">)</span>
<span></span>        <span class="n">dbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfl</span><span class="p">(</span><span class="n">box</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">dbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_bboxes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfl</span><span class="p">(</span><span class="n">box</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strides</span>
<span></span>
<span></span>    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">masks</span><span class="p">)</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dbox</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="k">else</span> <span class="n">dbox</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">mask</span><span class="p">],</span> <span class="bp">cls</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">return_mask</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">((</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">mask</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.fuse"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.fuse</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_feats</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
</code></pre></div><p>Fuse text features with model weights for efficient inference.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>txt_feats</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L624-L668"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@smart_inference_mode</span><span class="p">()</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt_feats</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Fuse text features with model weights for efficient inference."""</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fused</span><span class="p">:</span>
<span></span>        <span class="k">return</span>
<span></span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">cls_head</span><span class="p">,</span> <span class="n">bn_head</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv4</span><span class="p">):</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_head</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">)</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bn_head</span><span class="p">,</span> <span class="n">BNContrastiveHead</span><span class="p">)</span>
<span></span>        <span class="n">conv</span> <span class="o">=</span> <span class="n">cls_head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">)</span>
<span></span>        <span class="n">logit_scale</span> <span class="o">=</span> <span class="n">bn_head</span><span class="o">.</span><span class="n">logit_scale</span>
<span></span>        <span class="n">bias</span> <span class="o">=</span> <span class="n">bn_head</span><span class="o">.</span><span class="n">bias</span>
<span></span>        <span class="n">norm</span> <span class="o">=</span> <span class="n">bn_head</span><span class="o">.</span><span class="n">norm</span>
<span></span>
<span></span>        <span class="n">t</span> <span class="o">=</span> <span class="n">txt_feats</span> <span class="o">*</span> <span class="n">logit_scale</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span></span>        <span class="n">conv</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span> <span class="o">=</span> <span class="n">fuse_conv_and_bn</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
<span></span>
<span></span>        <span class="n">w</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="n">b</span> <span class="o">=</span> <span class="n">conv</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span>
<span></span>
<span></span>        <span class="n">w</span> <span class="o">=</span> <span class="n">t</span> <span class="o">@</span> <span class="n">w</span>
<span></span>        <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">@</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="n">b2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bias</span>
<span></span>
<span></span>        <span class="n">conv</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<span></span>                <span class="n">conv</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span>
<span></span>                <span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span></span>                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span></span>            <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>        <span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span></span>        <span class="n">conv</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy_</span><span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span>
<span></span>        <span class="n">cls_head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv</span>
<span></span>
<span></span>        <span class="n">bn_head</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">reprta</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">reprta</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">is_fused</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.get_tpe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.get_tpe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_tpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tpe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div><p>Get text prompt embeddings with normalization.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>tpe</code></td><td><code>torch.Tensor | None</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L670-L672"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_tpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tpe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Get text prompt embeddings with normalization."""</span>
<span></span>    <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">tpe</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reprta</span><span class="p">(</span><span class="n">tpe</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOEDetect.get_vpe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOEDetect.get_vpe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_vpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">vpe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Get visual prompt embeddings with spatial awareness.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr><tr><td><code>vpe</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L674-L681"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_vpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">vpe</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Get visual prompt embeddings with spatial awareness."""</span>
<span></span>    <span class="k">if</span> <span class="n">vpe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># no visual prompt embeddings</span>
<span></span>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">vpe</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># (B, N, H, W)</span>
<span></span>        <span class="n">vpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">savpe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vpe</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="n">vpe</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>  <span class="c1"># (B, N, D)</span>
<span></span>    <span class="k">return</span> <span class="n">vpe</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.YOLOESegment"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.YOLOESegment</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">YOLOESegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>YOLOEDetect</code></p><p>YOLO segmentation head with text embedding capabilities.</p><p>This class extends YOLOEDetect to include mask prediction capabilities for instance segmentation tasks with text-guided semantic understanding.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>nm</code></td><td><code>int</code></td><td>Number of masks.</td><td><code>32</code></td></tr><tr><td><code>npr</code></td><td><code>int</code></td><td>Number of protos.</td><td><code>256</code></td></tr><tr><td><code>embed</code></td><td><code>int</code></td><td>Embedding dimension.</td><td><code>512</code></td></tr><tr><td><code>with_bn</code></td><td><code>bool</code></td><td>Whether to use batch normalization in contrastive head.</td><td><code>False</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>nm</code></td><td><code>int</code></td><td>Number of masks.</td></tr><tr><td><code>npr</code></td><td><code>int</code></td><td>Number of protos.</td></tr><tr><td><code>proto</code></td><td><code>Proto</code></td><td>Prototype generation module.</td></tr><tr><td><code>cv5</code></td><td><code>nn.ModuleList</code></td><td>Convolution layers for mask coefficients.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.YOLOESegment.forward"><code>forward</code></a></td><td>Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">YOLOESegment</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">yoloe_segment</span> <span class="o">=</span> <span class="n">YOLOESegment</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">yoloe_segment</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L745-L808"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">YOLOESegment</span><span class="p">(</span><span class="n">YOLOEDetect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO segmentation head with text embedding capabilities.</span>
<span></span>
<span></span><span class="sd">    This class extends YOLOEDetect to include mask prediction capabilities for instance segmentation tasks with</span>
<span></span><span class="sd">    text-guided semantic understanding.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        nm (int): Number of masks.</span>
<span></span><span class="sd">        npr (int): Number of protos.</span>
<span></span><span class="sd">        proto (Proto): Prototype generation module.</span>
<span></span><span class="sd">        cv5 (nn.ModuleList): Convolution layers for mask coefficients.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Return model outputs and mask coefficients.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a YOLOESegment head</span>
<span></span><span class="sd">        &gt;&gt;&gt; yoloe_segment = YOLOESegment(nc=80, nm=32, npr=256, embed=512, with_bn=True, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; text = torch.randn(1, 80, 512)</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = yoloe_segment(x, text)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">nm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">npr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLOESegment with class count, mask parameters, and embedding dimensions.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            nm (int): Number of masks.</span>
<span></span><span class="sd">            npr (int): Number of protos.</span>
<span></span><span class="sd">            embed (int): Embedding dimension.</span>
<span></span><span class="sd">            with_bn (bool): Whether to use batch normalization in contrastive head.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">with_bn</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nm</span> <span class="o">=</span> <span class="n">nm</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">npr</span> <span class="o">=</span> <span class="n">npr</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">proto</span> <span class="o">=</span> <span class="n">Proto</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">npr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">)</span>
<span></span>
<span></span>        <span class="n">c5</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv5</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c5</span><span class="p">,</span> <span class="n">c5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.YOLOESegment.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.YOLOESegment.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td></td><td><em>required</em></td></tr><tr><td><code>text</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L789-L808"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">text</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Return model outputs and mask coefficients if training, otherwise return outputs and mask coefficients."""</span>
<span></span>    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proto</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># mask protos</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># batch size</span>
<span></span>
<span></span>    <span class="n">mc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cv5</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># mask coefficients</span>
<span></span>    <span class="n">has_lrpc</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"lrpc"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lrpc</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">YOLOEDetect</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">x</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">YOLOEDetect</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">return_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">p</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">has_lrpc</span><span class="p">:</span>
<span></span>        <span class="n">mc</span> <span class="o">=</span> <span class="p">(</span><span class="n">mc</span> <span class="o">*</span> <span class="n">mask</span><span class="o">.</span><span class="n">int</span><span class="p">())</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="k">else</span> <span class="n">mc</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">mask</span><span class="p">]</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">mc</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mc</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mc</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.RTDETRDecoder"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.RTDETRDecoder</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
<span></span>    <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
<span></span>    <span class="n">hd</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>  <span class="c1"># hidden dim</span>
<span></span>    <span class="n">nq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># num queries</span>
<span></span>    <span class="n">ndp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># num decoder points</span>
<span></span>    <span class="n">nh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>  <span class="c1"># num head</span>
<span></span>    <span class="n">ndl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># num decoder layers</span>
<span></span>    <span class="n">d_ffn</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># dim of feedforward</span>
<span></span>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">act</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span></span>    <span class="n">eval_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="c1"># Training args</span>
<span></span>    <span class="n">nd</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># num denoising</span>
<span></span>    <span class="n">label_noise_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span></span>    <span class="n">box_noise_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span></span>    <span class="n">learnt_init_query</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Real-Time Deformable Transformer Decoder (RTDETRDecoder) module for object detection.</p><p>This decoder module utilizes Transformer architecture along with deformable convolutions to predict bounding boxes and class labels for objects in an image. It integrates features from multiple layers and runs through a series of Transformer decoder layers to output the final predictions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Channels in the backbone feature maps.</td><td><code>(512, 1024, 2048)</code></td></tr><tr><td><code>hd</code></td><td><code>int</code></td><td>Dimension of hidden layers.</td><td><code>256</code></td></tr><tr><td><code>nq</code></td><td><code>int</code></td><td>Number of query points.</td><td><code>300</code></td></tr><tr><td><code>ndp</code></td><td><code>int</code></td><td>Number of decoder points.</td><td><code>4</code></td></tr><tr><td><code>nh</code></td><td><code>int</code></td><td>Number of heads in multi-head attention.</td><td><code>8</code></td></tr><tr><td><code>ndl</code></td><td><code>int</code></td><td>Number of decoder layers.</td><td><code>6</code></td></tr><tr><td><code>d_ffn</code></td><td><code>int</code></td><td>Dimension of the feed-forward networks.</td><td><code>1024</code></td></tr><tr><td><code>dropout</code></td><td><code>float</code></td><td>Dropout rate.</td><td><code>0.0</code></td></tr><tr><td><code>act</code></td><td><code>nn.Module</code></td><td>Activation function.</td><td><code>nn.ReLU()</code></td></tr><tr><td><code>eval_idx</code></td><td><code>int</code></td><td>Evaluation index.</td><td><code>-1</code></td></tr><tr><td><code>nd</code></td><td><code>int</code></td><td>Number of denoising.</td><td><code>100</code></td></tr><tr><td><code>label_noise_ratio</code></td><td><code>float</code></td><td>Label noise ratio.</td><td><code>0.5</code></td></tr><tr><td><code>box_noise_scale</code></td><td><code>float</code></td><td>Box noise scale.</td><td><code>1.0</code></td></tr><tr><td><code>learnt_init_query</code></td><td><code>bool</code></td><td>Whether to learn initial query embeddings.</td><td><code>False</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>export</code></td><td><code>bool</code></td><td>Export mode flag.</td></tr><tr><td><code>hidden_dim</code></td><td><code>int</code></td><td>Dimension of hidden layers.</td></tr><tr><td><code>nhead</code></td><td><code>int</code></td><td>Number of heads in multi-head attention.</td></tr><tr><td><code>nl</code></td><td><code>int</code></td><td>Number of feature levels.</td></tr><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td></tr><tr><td><code>num_queries</code></td><td><code>int</code></td><td>Number of query points.</td></tr><tr><td><code>num_decoder_layers</code></td><td><code>int</code></td><td>Number of decoder layers.</td></tr><tr><td><code>input_proj</code></td><td><code>nn.ModuleList</code></td><td>Input projection layers for backbone features.</td></tr><tr><td><code>decoder</code></td><td><code>DeformableTransformerDecoder</code></td><td>Transformer decoder module.</td></tr><tr><td><code>denoising_class_embed</code></td><td><code>nn.Embedding</code></td><td>Class embeddings for denoising.</td></tr><tr><td><code>num_denoising</code></td><td><code>int</code></td><td>Number of denoising queries.</td></tr><tr><td><code>label_noise_ratio</code></td><td><code>float</code></td><td>Label noise ratio for training.</td></tr><tr><td><code>box_noise_scale</code></td><td><code>float</code></td><td>Box noise scale for training.</td></tr><tr><td><code>learnt_init_query</code></td><td><code>bool</code></td><td>Whether to learn initial query embeddings.</td></tr><tr><td><code>tgt_embed</code></td><td><code>nn.Embedding</code></td><td>Target embeddings for queries.</td></tr><tr><td><code>query_pos_head</code></td><td><code>MLP</code></td><td>Query position head.</td></tr><tr><td><code>enc_output</code></td><td><code>nn.Sequential</code></td><td>Encoder output layers.</td></tr><tr><td><code>enc_score_head</code></td><td><code>nn.Linear</code></td><td>Encoder score prediction head.</td></tr><tr><td><code>enc_bbox_head</code></td><td><code>MLP</code></td><td>Encoder bbox prediction head.</td></tr><tr><td><code>dec_score_head</code></td><td><code>nn.ModuleList</code></td><td>Decoder score prediction heads.</td></tr><tr><td><code>dec_bbox_head</code></td><td><code>nn.ModuleList</code></td><td>Decoder bbox prediction heads.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors"><code>_generate_anchors</code></a></td><td>Generate anchor bounding boxes for given shapes with specific grid size and validate them.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input"><code>_get_decoder_input</code></a></td><td>Generate and prepare the input required for the decoder from the provided features and shapes.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input"><code>_get_encoder_input</code></a></td><td>Process and return encoder inputs by getting projection features from input and concatenating them.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters"><code>_reset_parameters</code></a></td><td>Initialize or reset the parameters of the model's various components with predefined weights and biases.</td></tr><tr><td><a href="#ultralytics.nn.modules.head.RTDETRDecoder.forward"><code>forward</code></a></td><td>Run the forward pass of the module, returning bounding box and classification scores for the input.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">an</span> <span class="n">RTDETRDecoder</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">RTDETRDecoder</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span> <span class="n">hd</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">nq</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L811-L1130"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RTDETRDecoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Real-Time Deformable Transformer Decoder (RTDETRDecoder) module for object detection.</span>
<span></span>
<span></span><span class="sd">    This decoder module utilizes Transformer architecture along with deformable convolutions to predict bounding boxes</span>
<span></span><span class="sd">    and class labels for objects in an image. It integrates features from multiple layers and runs through a series of</span>
<span></span><span class="sd">    Transformer decoder layers to output the final predictions.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        export (bool): Export mode flag.</span>
<span></span><span class="sd">        hidden_dim (int): Dimension of hidden layers.</span>
<span></span><span class="sd">        nhead (int): Number of heads in multi-head attention.</span>
<span></span><span class="sd">        nl (int): Number of feature levels.</span>
<span></span><span class="sd">        nc (int): Number of classes.</span>
<span></span><span class="sd">        num_queries (int): Number of query points.</span>
<span></span><span class="sd">        num_decoder_layers (int): Number of decoder layers.</span>
<span></span><span class="sd">        input_proj (nn.ModuleList): Input projection layers for backbone features.</span>
<span></span><span class="sd">        decoder (DeformableTransformerDecoder): Transformer decoder module.</span>
<span></span><span class="sd">        denoising_class_embed (nn.Embedding): Class embeddings for denoising.</span>
<span></span><span class="sd">        num_denoising (int): Number of denoising queries.</span>
<span></span><span class="sd">        label_noise_ratio (float): Label noise ratio for training.</span>
<span></span><span class="sd">        box_noise_scale (float): Box noise scale for training.</span>
<span></span><span class="sd">        learnt_init_query (bool): Whether to learn initial query embeddings.</span>
<span></span><span class="sd">        tgt_embed (nn.Embedding): Target embeddings for queries.</span>
<span></span><span class="sd">        query_pos_head (MLP): Query position head.</span>
<span></span><span class="sd">        enc_output (nn.Sequential): Encoder output layers.</span>
<span></span><span class="sd">        enc_score_head (nn.Linear): Encoder score prediction head.</span>
<span></span><span class="sd">        enc_bbox_head (MLP): Encoder bbox prediction head.</span>
<span></span><span class="sd">        dec_score_head (nn.ModuleList): Decoder score prediction heads.</span>
<span></span><span class="sd">        dec_bbox_head (nn.ModuleList): Decoder bbox prediction heads.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        forward: Run forward pass and return bounding box and classification scores.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create an RTDETRDecoder</span>
<span></span><span class="sd">        &gt;&gt;&gt; decoder = RTDETRDecoder(nc=80, ch=(512, 1024, 2048), hd=256, nq=300)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 512, 64, 64), torch.randn(1, 1024, 32, 32), torch.randn(1, 2048, 16, 16)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = decoder(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="n">export</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># export mode</span>
<span></span>    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="n">dynamic</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
<span></span>        <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">),</span>
<span></span>        <span class="n">hd</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>  <span class="c1"># hidden dim</span>
<span></span>        <span class="n">nq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># num queries</span>
<span></span>        <span class="n">ndp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># num decoder points</span>
<span></span>        <span class="n">nh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>  <span class="c1"># num head</span>
<span></span>        <span class="n">ndl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># num decoder layers</span>
<span></span>        <span class="n">d_ffn</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># dim of feedforward</span>
<span></span>        <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">act</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
<span></span>        <span class="n">eval_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span></span>        <span class="c1"># Training args</span>
<span></span>        <span class="n">nd</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># num denoising</span>
<span></span>        <span class="n">label_noise_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span></span>        <span class="n">box_noise_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span></span>        <span class="n">learnt_init_query</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the RTDETRDecoder module with the given parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            ch (tuple): Channels in the backbone feature maps.</span>
<span></span><span class="sd">            hd (int): Dimension of hidden layers.</span>
<span></span><span class="sd">            nq (int): Number of query points.</span>
<span></span><span class="sd">            ndp (int): Number of decoder points.</span>
<span></span><span class="sd">            nh (int): Number of heads in multi-head attention.</span>
<span></span><span class="sd">            ndl (int): Number of decoder layers.</span>
<span></span><span class="sd">            d_ffn (int): Dimension of the feed-forward networks.</span>
<span></span><span class="sd">            dropout (float): Dropout rate.</span>
<span></span><span class="sd">            act (nn.Module): Activation function.</span>
<span></span><span class="sd">            eval_idx (int): Evaluation index.</span>
<span></span><span class="sd">            nd (int): Number of denoising.</span>
<span></span><span class="sd">            label_noise_ratio (float): Label noise ratio.</span>
<span></span><span class="sd">            box_noise_scale (float): Box noise scale.</span>
<span></span><span class="sd">            learnt_init_query (bool): Whether to learn initial query embeddings.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_dim</span> <span class="o">=</span> <span class="n">hd</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nhead</span> <span class="o">=</span> <span class="n">nh</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>  <span class="c1"># num level</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span> <span class="o">=</span> <span class="n">nq</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_decoder_layers</span> <span class="o">=</span> <span class="n">ndl</span>
<span></span>
<span></span>        <span class="c1"># Backbone feature projection</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">input_proj</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">hd</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="c1"># NOTE: simplified version but it's not consistent with .pt weights.</span>
<span></span>        <span class="c1"># self.input_proj = nn.ModuleList(Conv(x, hd, act=False) for x in ch)</span>
<span></span>
<span></span>        <span class="c1"># Transformer module</span>
<span></span>        <span class="n">decoder_layer</span> <span class="o">=</span> <span class="n">DeformableTransformerDecoderLayer</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">d_ffn</span><span class="p">,</span> <span class="n">dropout</span><span class="p">,</span> <span class="n">act</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">,</span> <span class="n">ndp</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">DeformableTransformerDecoder</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">decoder_layer</span><span class="p">,</span> <span class="n">ndl</span><span class="p">,</span> <span class="n">eval_idx</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Denoising part</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">denoising_class_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">hd</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_denoising</span> <span class="o">=</span> <span class="n">nd</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">label_noise_ratio</span> <span class="o">=</span> <span class="n">label_noise_ratio</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">box_noise_scale</span> <span class="o">=</span> <span class="n">box_noise_scale</span>
<span></span>
<span></span>        <span class="c1"># Decoder embedding</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">learnt_init_query</span> <span class="o">=</span> <span class="n">learnt_init_query</span>
<span></span>        <span class="k">if</span> <span class="n">learnt_init_query</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">tgt_embed</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">nq</span><span class="p">,</span> <span class="n">hd</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">query_pos_head</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hd</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Encoder head</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">enc_output</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">hd</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">hd</span><span class="p">))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">enc_score_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">enc_bbox_head</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Decoder head</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dec_score_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndl</span><span class="p">)])</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dec_bbox_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">MLP</span><span class="p">(</span><span class="n">hd</span><span class="p">,</span> <span class="n">hd</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndl</span><span class="p">)])</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters</span><span class="p">()</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.RTDETRDecoder._generate_anchors</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_generate_anchors</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">shapes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<span></span>    <span class="n">grid_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<span></span>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<span></span>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"cpu"</span><span class="p">,</span>
<span></span>    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
<span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div><p>Generate anchor bounding boxes for given shapes with specific grid size and validate them.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>shapes</code></td><td><code>list</code></td><td>List of feature map shapes.</td><td><em>required</em></td></tr><tr><td><code>grid_size</code></td><td><code>float, optional</code></td><td>Base size of grid cells.</td><td><code>0.05</code></td></tr><tr><td><code>dtype</code></td><td><code>torch.dtype, optional</code></td><td>Data type for tensors.</td><td><code>torch.float32</code></td></tr><tr><td><code>device</code></td><td><code>str, optional</code></td><td>Device to create tensors on.</td><td><code>"cpu"</code></td></tr><tr><td><code>eps</code></td><td><code>float, optional</code></td><td>Small value for numerical stability.</td><td><code>1e-2</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>anchors (torch.Tensor)</code></td><td>Generated anchor boxes.</td></tr><tr><td><code>valid_mask (torch.Tensor)</code></td><td>Valid mask for anchors.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L984-L1021"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_generate_anchors</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">shapes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<span></span>    <span class="n">grid_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<span></span>    <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
<span></span>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"cpu"</span><span class="p">,</span>
<span></span>    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
<span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span></span><span class="w">    </span><span class="sd">"""Generate anchor bounding boxes for given shapes with specific grid size and validate them.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        shapes (list): List of feature map shapes.</span>
<span></span><span class="sd">        grid_size (float, optional): Base size of grid cells.</span>
<span></span><span class="sd">        dtype (torch.dtype, optional): Data type for tensors.</span>
<span></span><span class="sd">        device (str, optional): Device to create tensors on.</span>
<span></span><span class="sd">        eps (float, optional): Small value for numerical stability.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        anchors (torch.Tensor): Generated anchor boxes.</span>
<span></span><span class="sd">        valid_mask (torch.Tensor): Valid mask for anchors.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
<span></span>        <span class="n">sy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>        <span class="n">sx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>        <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">"ij"</span><span class="p">)</span> <span class="k">if</span> <span class="n">TORCH_1_11</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="n">sx</span><span class="p">)</span>
<span></span>        <span class="n">grid_xy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (h, w, 2)</span>
<span></span>
<span></span>        <span class="n">valid_WH</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>        <span class="n">grid_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_xy</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">valid_WH</span>  <span class="c1"># (1, h, w, 2)</span>
<span></span>        <span class="n">wh</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">grid_xy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="n">i</span><span class="p">)</span>
<span></span>        <span class="n">anchors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">grid_xy</span><span class="p">,</span> <span class="n">wh</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>  <span class="c1"># (1, h*w, 4)</span>
<span></span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">anchors</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (1, h*w*nl, 4)</span>
<span></span>    <span class="n">valid_mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">anchors</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">anchors</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">eps</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 1, h*w*nl, 1</span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">anchors</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">anchors</span><span class="p">))</span>
<span></span>    <span class="n">anchors</span> <span class="o">=</span> <span class="n">anchors</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="o">~</span><span class="n">valid_mask</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">))</span>
<span></span>    <span class="k">return</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">valid_mask</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.RTDETRDecoder._get_decoder_input</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_get_decoder_input</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">feats</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span></span>    <span class="n">shapes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<span></span>    <span class="n">dn_embed</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">dn_bbox</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</code></pre></div><p>Generate and prepare the input required for the decoder from the provided features and shapes.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>feats</code></td><td><code>torch.Tensor</code></td><td>Processed features from encoder.</td><td><em>required</em></td></tr><tr><td><code>shapes</code></td><td><code>list</code></td><td>List of feature map shapes.</td><td><em>required</em></td></tr><tr><td><code>dn_embed</code></td><td><code>torch.Tensor, optional</code></td><td>Denoising embeddings.</td><td><code>None</code></td></tr><tr><td><code>dn_bbox</code></td><td><code>torch.Tensor, optional</code></td><td>Denoising bounding boxes.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>embeddings (torch.Tensor)</code></td><td>Query embeddings for decoder.</td></tr><tr><td><code>refer_bbox (torch.Tensor)</code></td><td>Reference bounding boxes.</td></tr><tr><td><code>enc_bboxes (torch.Tensor)</code></td><td>Encoded bounding boxes.</td></tr><tr><td><code>enc_scores (torch.Tensor)</code></td><td>Encoded scores.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L1049-L1106"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_get_decoder_input</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">feats</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
<span></span>    <span class="n">shapes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<span></span>    <span class="n">dn_embed</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">dn_bbox</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span></span><span class="w">    </span><span class="sd">"""Generate and prepare the input required for the decoder from the provided features and shapes.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        feats (torch.Tensor): Processed features from encoder.</span>
<span></span><span class="sd">        shapes (list): List of feature map shapes.</span>
<span></span><span class="sd">        dn_embed (torch.Tensor, optional): Denoising embeddings.</span>
<span></span><span class="sd">        dn_bbox (torch.Tensor, optional): Denoising bounding boxes.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        embeddings (torch.Tensor): Query embeddings for decoder.</span>
<span></span><span class="sd">        refer_bbox (torch.Tensor): Reference bounding boxes.</span>
<span></span><span class="sd">        enc_bboxes (torch.Tensor): Encoded bounding boxes.</span>
<span></span><span class="sd">        enc_scores (torch.Tensor): Encoded scores.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">!=</span> <span class="n">shapes</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_anchors</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">feats</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">feats</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span>
<span></span>
<span></span>    <span class="c1"># Prepare input for decoder</span>
<span></span>    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_mask</span> <span class="o">*</span> <span class="n">feats</span><span class="p">)</span>  <span class="c1"># bs, h*w, 256</span>
<span></span>    <span class="n">enc_outputs_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_score_head</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c1"># (bs, h*w, nc)</span>
<span></span>
<span></span>    <span class="c1"># Query selection</span>
<span></span>    <span class="c1"># (bs, num_queries)</span>
<span></span>    <span class="n">topk_ind</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">enc_outputs_scores</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="c1"># (bs, num_queries)</span>
<span></span>    <span class="n">batch_ind</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">topk_ind</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># (bs, num_queries, 256)</span>
<span></span>    <span class="n">top_k_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">batch_ind</span><span class="p">,</span> <span class="n">topk_ind</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="c1"># (bs, num_queries, 4)</span>
<span></span>    <span class="n">top_k_anchors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span><span class="p">[:,</span> <span class="n">topk_ind</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Dynamic anchors + static content</span>
<span></span>    <span class="n">refer_bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enc_bbox_head</span><span class="p">(</span><span class="n">top_k_features</span><span class="p">)</span> <span class="o">+</span> <span class="n">top_k_anchors</span>
<span></span>
<span></span>    <span class="n">enc_bboxes</span> <span class="o">=</span> <span class="n">refer_bbox</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">dn_bbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">refer_bbox</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">dn_bbox</span><span class="p">,</span> <span class="n">refer_bbox</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">enc_scores</span> <span class="o">=</span> <span class="n">enc_outputs_scores</span><span class="p">[</span><span class="n">batch_ind</span><span class="p">,</span> <span class="n">topk_ind</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgt_embed</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">learnt_init_query</span> <span class="k">else</span> <span class="n">top_k_features</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="n">refer_bbox</span> <span class="o">=</span> <span class="n">refer_bbox</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">learnt_init_query</span><span class="p">:</span>
<span></span>            <span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">dn_embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">dn_embed</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">refer_bbox</span><span class="p">,</span> <span class="n">enc_bboxes</span><span class="p">,</span> <span class="n">enc_scores</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.RTDETRDecoder._get_encoder_input</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_get_encoder_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
</code></pre></div><p>Process and return encoder inputs by getting projection features from input and concatenating them.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td>List of feature maps from the backbone.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>feats (torch.Tensor)</code></td><td>Processed features.</td></tr><tr><td><code>shapes (list)</code></td><td>List of feature map shapes.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L1023-L1047"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_get_encoder_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
<span></span><span class="w">    </span><span class="sd">"""Process and return encoder inputs by getting projection features from input and concatenating them.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (list[torch.Tensor]): List of feature maps from the backbone.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        feats (torch.Tensor): Processed features.</span>
<span></span><span class="sd">        shapes (list): List of feature map shapes.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="c1"># Get projection features</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_proj</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">feat</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
<span></span>    <span class="c1"># Get encoder inputs</span>
<span></span>    <span class="n">feats</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
<span></span>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<span></span>        <span class="c1"># [b, c, h, w] -&gt; [b, h*w, c]</span>
<span></span>        <span class="n">feats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span></span>        <span class="c1"># [nl, 2]</span>
<span></span>        <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span>
<span></span>
<span></span>    <span class="c1"># [b, h*w, c]</span>
<span></span>    <span class="n">feats</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">feats</span><span class="p">,</span> <span class="n">shapes</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.RTDETRDecoder._reset_parameters</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize or reset the parameters of the model's various components with predefined weights and biases.</p><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L1108-L1130"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_reset_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize or reset the parameters of the model's various components with predefined weights and biases."""</span>
<span></span>    <span class="c1"># Class and bbox head init</span>
<span></span>    <span class="n">bias_cls</span> <span class="o">=</span> <span class="n">bias_init_with_prob</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span>
<span></span>    <span class="c1"># NOTE: the weight initialization in `linear_init` would cause NaN when training with custom datasets.</span>
<span></span>    <span class="c1"># linear_init(self.enc_score_head)</span>
<span></span>    <span class="n">constant_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_score_head</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">bias_cls</span><span class="p">)</span>
<span></span>    <span class="n">constant_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_bbox_head</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span></span>    <span class="n">constant_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_bbox_head</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">cls_</span><span class="p">,</span> <span class="n">reg_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dec_score_head</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dec_bbox_head</span><span class="p">):</span>
<span></span>        <span class="c1"># linear_init(cls_)</span>
<span></span>        <span class="n">constant_</span><span class="p">(</span><span class="n">cls_</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="n">bias_cls</span><span class="p">)</span>
<span></span>        <span class="n">constant_</span><span class="p">(</span><span class="n">reg_</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span></span>        <span class="n">constant_</span><span class="p">(</span><span class="n">reg_</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">linear_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_output</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span></span>    <span class="n">xavier_uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enc_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">learnt_init_query</span><span class="p">:</span>
<span></span>        <span class="n">xavier_uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tgt_embed</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span></span>    <span class="n">xavier_uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_pos_head</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span></span>    <span class="n">xavier_uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_pos_head</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_proj</span><span class="p">:</span>
<span></span>        <span class="n">xavier_uniform_</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.RTDETRDecoder.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.RTDETRDecoder.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Run the forward pass of the module, returning bounding box and classification scores for the input.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>list[torch.Tensor]</code></td><td>List of feature maps from the backbone.</td><td><em>required</em></td></tr><tr><td><code>batch</code></td><td><code>dict, optional</code></td><td>Batch information for training.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>outputs (tuple | torch.Tensor)</code></td><td>During training, returns a tuple of bounding boxes, scores, and other</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L935-L982"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Run the forward pass of the module, returning bounding box and classification scores for the input.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (list[torch.Tensor]): List of feature maps from the backbone.</span>
<span></span><span class="sd">        batch (dict, optional): Batch information for training.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        outputs (tuple | torch.Tensor): During training, returns a tuple of bounding boxes, scores, and other</span>
<span></span><span class="sd">            metadata. During inference, returns a tensor of shape (bs, 300, 4+nc) containing bounding boxes and</span>
<span></span><span class="sd">            class scores.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.models.utils.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_cdn_group</span>
<span></span>
<span></span>    <span class="c1"># Input projection and embedding</span>
<span></span>    <span class="n">feats</span><span class="p">,</span> <span class="n">shapes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_encoder_input</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Prepare denoising training</span>
<span></span>    <span class="n">dn_embed</span><span class="p">,</span> <span class="n">dn_bbox</span><span class="p">,</span> <span class="n">attn_mask</span><span class="p">,</span> <span class="n">dn_meta</span> <span class="o">=</span> <span class="n">get_cdn_group</span><span class="p">(</span>
<span></span>        <span class="n">batch</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_queries</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">denoising_class_embed</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_denoising</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">label_noise_ratio</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">box_noise_scale</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>
<span></span>    <span class="n">embed</span><span class="p">,</span> <span class="n">refer_bbox</span><span class="p">,</span> <span class="n">enc_bboxes</span><span class="p">,</span> <span class="n">enc_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_decoder_input</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">dn_embed</span><span class="p">,</span> <span class="n">dn_bbox</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Decoder</span>
<span></span>    <span class="n">dec_bboxes</span><span class="p">,</span> <span class="n">dec_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
<span></span>        <span class="n">embed</span><span class="p">,</span>
<span></span>        <span class="n">refer_bbox</span><span class="p">,</span>
<span></span>        <span class="n">feats</span><span class="p">,</span>
<span></span>        <span class="n">shapes</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dec_bbox_head</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dec_score_head</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">query_pos_head</span><span class="p">,</span>
<span></span>        <span class="n">attn_mask</span><span class="o">=</span><span class="n">attn_mask</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">dec_bboxes</span><span class="p">,</span> <span class="n">dec_scores</span><span class="p">,</span> <span class="n">enc_bboxes</span><span class="p">,</span> <span class="n">enc_scores</span><span class="p">,</span> <span class="n">dn_meta</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">x</span>
<span></span>    <span class="c1"># (bs, 300, 4+nc)</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">dec_bboxes</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dec_scores</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">export</span> <span class="k">else</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.modules.head.v10Detect"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.modules.head.v10Detect</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">v10Detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span>
</code></pre></div><p><strong>Bases:</strong> <code>Detect</code></p><p>v10 Detection head from <a href="https://arxiv.org/pdf/2405.14458">https://arxiv.org/pdf/2405.14458</a>.</p><p>This class implements the YOLOv10 detection head with dual-assignment training and consistent dual predictions for improved efficiency and performance.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes.</td><td><code>80</code></td></tr><tr><td><code>ch</code></td><td><code>tuple</code></td><td>Tuple of channel sizes from backbone feature maps.</td><td><code>()</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>end2end</code></td><td><code>bool</code></td><td>End-to-end detection mode.</td></tr><tr><td><code>max_det</code></td><td><code>int</code></td><td>Maximum number of detections.</td></tr><tr><td><code>cv3</code></td><td><code>nn.ModuleList</code></td><td>Light classification head layers.</td></tr><tr><td><code>one2one_cv3</code></td><td><code>nn.ModuleList</code></td><td>One-to-one classification head layers.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.modules.head.v10Detect.fuse"><code>fuse</code></a></td><td>Remove the one2many head for inference optimization.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">v10Detect</span> <span class="n">head</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">v10_detect</span> <span class="o">=</span> <span class="n">v10Detect</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">v10_detect</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L1133-L1182"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">v10Detect</span><span class="p">(</span><span class="n">Detect</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""v10 Detection head from https://arxiv.org/pdf/2405.14458.</span>
<span></span>
<span></span><span class="sd">    This class implements the YOLOv10 detection head with dual-assignment training and consistent dual predictions for</span>
<span></span><span class="sd">    improved efficiency and performance.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        end2end (bool): End-to-end detection mode.</span>
<span></span><span class="sd">        max_det (int): Maximum number of detections.</span>
<span></span><span class="sd">        cv3 (nn.ModuleList): Light classification head layers.</span>
<span></span><span class="sd">        one2one_cv3 (nn.ModuleList): One-to-one classification head layers.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize the v10Detect object with specified number of classes and input channels.</span>
<span></span><span class="sd">        forward: Perform forward pass of the v10Detect module.</span>
<span></span><span class="sd">        bias_init: Initialize biases of the Detect module.</span>
<span></span><span class="sd">        fuse: Remove the one2many head for inference optimization.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create a v10Detect head</span>
<span></span><span class="sd">        &gt;&gt;&gt; v10_detect = v10Detect(nc=80, ch=(256, 512, 1024))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = [torch.randn(1, 256, 80, 80), torch.randn(1, 512, 40, 40), torch.randn(1, 1024, 20, 20)]</span>
<span></span><span class="sd">        &gt;&gt;&gt; outputs = v10_detect(x)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="n">end2end</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">ch</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the v10Detect object with the specified number of classes and input channels.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            nc (int): Number of classes.</span>
<span></span><span class="sd">            ch (tuple): Tuple of channel sizes from backbone feature maps.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
<span></span>        <span class="n">c3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>  <span class="c1"># channels</span>
<span></span>        <span class="c1"># Light cls head</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span></span>                <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">x</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">c3</span><span class="p">),</span> <span class="n">Conv</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span></span>                <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ch</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">one2one_cv3</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv3</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.modules.head.v10Detect.fuse"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.modules.head.v10Detect.fuse</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Remove the one2many head for inference optimization.</p><details><summary>Source code in <code>ultralytics/nn/modules/head.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/modules/head.py#L1180-L1182"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Remove the one2many head for inference optimization."""</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">cv2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/></p><br/><br/><div class="git-info"><div class="dates-container"><span class="date-item" title="This page was first created on November 12, 2023"><span class="hover-item">ğŸ“…</span> Created 2 years ago </span><span class="date-item" title="This page was last updated on November 23, 2025"><span class="hover-item">âœï¸</span> Updated 22 days ago </span></div><div class="authors-container"><a class="author-link" href="https://github.com/glenn-jocher" title="glenn-jocher (9 changes)"><img alt="glenn-jocher" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/26833433?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/Burhan-Q" title="Burhan-Q (2 changes)"><img alt="Burhan-Q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62214284?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/Laughing-q" title="Laughing-q (1 change)"><img alt="Laughing-q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/61612323?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/RizwanMunawar" title="RizwanMunawar (1 change)"><img alt="RizwanMunawar" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62513924?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/jk4e" title="jk4e (1 change)"><img alt="jk4e" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/116908874?v=4&amp;s=96"/></a></div></div><div class="share-buttons"><button class="share-button hover-item" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fnn%2Fmodules%2Fhead%2F', 'TwitterShare', 'width=550,height=680,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-x-twitter"></i> Tweet </button><button class="share-button hover-item linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fnn%2Fmodules%2Fhead%2F', 'LinkedinShare', 'width=550,height=730,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-linkedin-in"></i> Share </button></div><br/></article></div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div><button class="md-top md-icon" data-md-component="top" hidden="" type="button"><svg class="lucide lucide-circle-arrow-up" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4M12 16V8"></path></svg> Back to top
</button></main><footer class="md-footer"><nav aria-label="Footer" class="md-footer__inner md-grid"><a aria-label="Previous: conv" class="md-footer__link md-footer__link--prev" href="../conv/"><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-left" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 19-7-7 7-7M19 12H5"></path></svg></div><div class="md-footer__title"><span class="md-footer__direction"> Previous </span><div class="md-ellipsis"> conv </div></div></a><a aria-label="Next: transformer" class="md-footer__link md-footer__link--next" href="../transformer/"><div class="md-footer__title"><span class="md-footer__direction"> Next </span><div class="md-ellipsis"> transformer </div></div><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14M12 5l7 7-7 7"></path></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-copyright"><div class="md-copyright__highlight"><a href="https://www.ultralytics.com/" target="_blank">Â© 2025 Ultralytics Inc.</a> All rights reserved. </div> Made with <a href="https://zensical.org/" rel="noopener" target="_blank"> Zensical </a></div><div class="md-social"><a class="md-social__link" href="https://github.com/ultralytics" rel="noopener" target="_blank" title="github.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://www.linkedin.com/company/ultralytics/" rel="noopener" target="_blank" title="www.linkedin.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://x.com/ultralytics" rel="noopener" target="_blank" title="x.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://youtube.com/ultralytics?sub_confirmation=1" rel="noopener" target="_blank" title="youtube.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://hub.docker.com/r/ultralytics/ultralytics/" rel="noopener" target="_blank" title="hub.docker.com"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://pypi.org/project/ultralytics/" rel="noopener" target="_blank" title="pypi.org"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://discord.com/invite/ultralytics" rel="noopener" target="_blank" title="discord.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://reddit.com/r/ultralytics" rel="noopener" target="_blank" title="reddit.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://weixin.qq.com/r/mp/LxckPDfEgWr_rXNf90I9" rel="noopener" target="_blank" title="weixin.qq.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6" fill="currentColor"></path></svg></a></div></div></div></footer></div><div class="md-dialog" data-md-component="dialog"><div class="md-dialog__inner md-typeset"></div></div><div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate":null,"base":"../../../..","features":["content.action.edit","content.code.annotate","content.code.copy","content.tooltips","toc.follow","navigation.top","navigation.tabs","navigation.tabs.sticky","navigation.prune","navigation.footer","navigation.tracking","navigation.instant","navigation.instant.progress","navigation.indexes","navigation.sections","content.tabs.link"],"search":"../../../../assets/javascripts/workers/search.5df7522c.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
<script src="../../../../assets/javascripts/bundle.21aa498e.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ultralytics/llm@v0.1.6/js/chat.min.js"></script>
<script src="https://unpkg.com/tablesort@5.6.0/dist/tablesort.min.js"></script>
<script src="../../../../javascript/extra.js"></script>
<script src="../../../../javascript/giscus.js"></script>
<script src="../../../../javascript/tablesort.js"></script>
</body></html>