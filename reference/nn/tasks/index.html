 <!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Dive into the intricacies of YOLO tasks.py. Learn about DetectionModel, PoseModel and more for powerful AI development." name="description"/><meta content="Ultralytics" name="author"/><link href="https://docs.ultralytics.com/reference/nn/tasks/" rel="canonical"/><link href="../modules/utils/" rel="prev"/><link href="../text_model/" rel="next"/><link href="/" hreflang="en" rel="alternate"/><link href="/zh/" hreflang="zh" rel="alternate"/><link href="/ko/" hreflang="ko" rel="alternate"/><link href="/ja/" hreflang="ja" rel="alternate"/><link href="/ru/" hreflang="ru" rel="alternate"/><link href="/de/" hreflang="de" rel="alternate"/><link href="/fr/" hreflang="fr" rel="alternate"/><link href="/es/" hreflang="es" rel="alternate"/><link href="/pt/" hreflang="pt" rel="alternate"/><link href="/it/" hreflang="it" rel="alternate"/><link href="/tr/" hreflang="tr" rel="alternate"/><link href="/vi/" hreflang="vi" rel="alternate"/><link href="/ar/" hreflang="ar" rel="alternate"/><link href="https://raw.githubusercontent.com/ultralytics/assets/refs/heads/main/logo/favicon-yolo.png" rel="icon"/><meta content="zensical-0.0.14" name="generator"/><title>Reference for ultralytics/nn/tasks.py - Ultralytics YOLO Docs</title><link href="../../../assets/stylesheets/modern/main.f1b6466b.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/modern/palette.dfe2e883.min.css" rel="stylesheet"/><style>:root{}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link href="../../../stylesheets/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2M5EHKC0BH"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2M5EHKC0BH",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2M5EHKC0BH",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<style data-doc-kind="true">.doc-kind{display:inline-flex;align-items:center;gap:0.25em;padding:0.21em 0.59em;border-radius:999px;font-weight:700;font-size:0.81em;letter-spacing:0.06em;text-transform:uppercase;line-height:1;color:var(--doc-kind-color,#f8fafc);background:var(--doc-kind-bg,rgba(255,255,255,0.12));}.doc-kind-class{--doc-kind-color:#039dfc;--doc-kind-bg:rgba(3,157,252,0.22);}.doc-kind-function{--doc-kind-color:#fc9803;--doc-kind-bg:rgba(252,152,3,0.22);}.doc-kind-method{--doc-kind-color:#ef5eff;--doc-kind-bg:rgba(239,94,255,0.22);}.doc-kind-property{--doc-kind-color:#02e835;--doc-kind-bg:rgba(2,232,53,0.22);}</style><meta content="Reference for ultralytics/nn/tasks.py" name="title"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/><meta content="website" property="og:type"/><meta content="https://docs.ultralytics.com/reference/nn/tasks/" property="og:url"/><meta content="Reference for ultralytics/nn/tasks.py" property="og:title"/><meta content="" property="og:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="og:image"/><meta content="summary_large_image" property="twitter:card"/><meta content="https://docs.ultralytics.com/reference/nn/tasks/" property="twitter:url"/><meta content="Reference for ultralytics/nn/tasks.py" property="twitter:title"/><meta content="" property="twitter:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="twitter:image"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "headline": "Reference for ultralytics/nn/tasks.py", "image": ["https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png"], "datePublished": "2023-11-12 02:49:37 +0100", "dateModified": "2025-11-23 19:53:50 +0100", "author": [{"@type": "Organization", "name": "Ultralytics", "url": "https://ultralytics.com/"}], "abstract": ""}</script></head><body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"><input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/><input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/><label class="md-overlay" for="__drawer"></label><div data-md-component="skip"><a class="md-skip" href="#reference-for-ultralyticsnntaskspy"> Skip to content </a></div><div data-md-component="announce"><aside class="md-banner"><div class="md-banner__inner md-grid md-typeset"><a class="banner-wrapper" href="https://www.ultralytics.com/news/ultralytics-raises-30m-series-a" target="_blank"><div class="banner-content-wrapper"><img alt="Ultralytics raises $30M Series A" height="40" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac336b5de2ae8b398bca_writting.svg"/><div class="vc-wrapper"><img alt="Elephant" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac33c95408144846afc7_image%201.png"/><img alt="SquareOne" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac3333068d9632cc6df8_image%202.png"/></div></div></a></div></aside></div><header class="md-header md-header--shadow md-header--lifted" data-md-component="header"><nav aria-label="Header" class="md-header__inner md-grid"><a aria-label="Ultralytics YOLO Docs" class="md-header__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a><label class="md-header__button md-icon" for="__drawer"><svg class="lucide lucide-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 5h16M4 12h16M4 19h16"></path></svg></label><div class="md-header__title" data-md-component="header-title"><div class="md-header__ellipsis"><div class="md-header__topic"><span class="md-ellipsis"> Ultralytics YOLO Docs </span></div><div class="md-header__topic" data-md-component="header-topic"><span class="md-ellipsis"> Reference for ultralytics/nn/tasks.py </span></div></div></div><form class="md-header__option" data-md-component="palette"><input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg></label><input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label><input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label></form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option"><div class="md-select"><button aria-label="Select language" class="md-header__button md-icon"><svg class="lucide lucide-languages" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m5 8 6 6M4 14l6-6 2-3M2 5h12M7 2h1M22 22l-5-10-5 10M14 18h6"></path></svg></button><div class="md-select__inner"><ul class="md-select__list"><li class="md-select__item"><a class="md-select__link" href="/" hreflang="en"> ğŸ‡¬ğŸ‡§ English </a></li><li class="md-select__item"><a class="md-select__link" href="/zh/" hreflang="zh"> ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ </a></li><li class="md-select__item"><a class="md-select__link" href="/ko/" hreflang="ko"> ğŸ‡°ğŸ‡· í•œêµ­ì–´ </a></li><li class="md-select__item"><a class="md-select__link" href="/ja/" hreflang="ja"> ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª </a></li><li class="md-select__item"><a class="md-select__link" href="/ru/" hreflang="ru"> ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ </a></li><li class="md-select__item"><a class="md-select__link" href="/de/" hreflang="de"> ğŸ‡©ğŸ‡ª Deutsch </a></li><li class="md-select__item"><a class="md-select__link" href="/fr/" hreflang="fr"> ğŸ‡«ğŸ‡· FranÃ§ais </a></li><li class="md-select__item"><a class="md-select__link" href="/es/" hreflang="es"> ğŸ‡ªğŸ‡¸ EspaÃ±ol </a></li><li class="md-select__item"><a class="md-select__link" href="/pt/" hreflang="pt"> ğŸ‡µğŸ‡¹ PortuguÃªs </a></li><li class="md-select__item"><a class="md-select__link" href="/it/" hreflang="it"> ğŸ‡®ğŸ‡¹ Italiano </a></li><li class="md-select__item"><a class="md-select__link" href="/tr/" hreflang="tr"> ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e </a></li><li class="md-select__item"><a class="md-select__link" href="/vi/" hreflang="vi"> ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t </a></li><li class="md-select__item"><a class="md-select__link" href="/ar/" hreflang="ar"> ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© </a></li></ul></div></div></div><div class="md-header__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div></nav><nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"><div class="md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a class="md-tabs__link" href="../../.."> Home </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../quickstart/"> Quickstart </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../modes/"> Modes </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../tasks/"> Tasks </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../models/"> Models </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../datasets/"> Datasets </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../solutions/"> Solutions </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../guides/"> Guides </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../integrations/"> Integrations </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../hub/"> HUB </a></li><li class="md-tabs__item md-tabs__item--active"><a class="md-tabs__link" href="../../__init__/"> Reference </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../help/"> Help </a></li></ul></div></nav></header><div class="md-container" data-md-component="container"><main class="md-main" data-md-component="main"><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0"><label class="md-nav__title" for="__drawer"><a aria-label="Ultralytics YOLO Docs" class="md-nav__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a> Ultralytics YOLO Docs </label><div class="md-nav__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../.."><span class="md-ellipsis"> Home </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../quickstart/"><span class="md-ellipsis"> Quickstart </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../modes/"><span class="md-ellipsis"> Modes </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../tasks/"><span class="md-ellipsis"> Tasks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../models/"><span class="md-ellipsis"> Models </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../datasets/"><span class="md-ellipsis"> Datasets </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../solutions/"><span class="md-ellipsis"> Solutions </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../guides/"><span class="md-ellipsis"> Guides </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../integrations/"><span class="md-ellipsis"> Integrations </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../hub/"><span class="md-ellipsis"> HUB </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/><label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex=""><span class="md-ellipsis"> Reference </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1"><label class="md-nav__title" for="__nav_11"><span class="md-nav__icon md-icon"></span> Reference </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_2" type="checkbox"/><label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex=""><span class="md-ellipsis"> cfg </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_2_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_2"><span class="md-nav__icon md-icon"></span> cfg </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../cfg/__init__/"><span class="md-ellipsis"> __init__ </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_3" type="checkbox"/><label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex=""><span class="md-ellipsis"> data </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_3_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_3"><span class="md-nav__icon md-icon"></span> data </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../data/annotator/"><span class="md-ellipsis"> annotator </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/augment/"><span class="md-ellipsis"> augment </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/base/"><span class="md-ellipsis"> base </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/build/"><span class="md-ellipsis"> build </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/converter/"><span class="md-ellipsis"> converter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/dataset/"><span class="md-ellipsis"> dataset </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/loaders/"><span class="md-ellipsis"> loaders </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/split/"><span class="md-ellipsis"> split </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/split_dota/"><span class="md-ellipsis"> split_dota </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../data/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_4" type="checkbox"/><label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex=""><span class="md-ellipsis"> engine </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_4_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_4"><span class="md-nav__icon md-icon"></span> engine </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../engine/exporter/"><span class="md-ellipsis"> exporter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/model/"><span class="md-ellipsis"> model </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/predictor/"><span class="md-ellipsis"> predictor </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/results/"><span class="md-ellipsis"> results </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/trainer/"><span class="md-ellipsis"> trainer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/tuner/"><span class="md-ellipsis"> tuner </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../engine/validator/"><span class="md-ellipsis"> validator </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_5" type="checkbox"/><label class="md-nav__link" for="__nav_11_5" id="__nav_11_5_label" tabindex=""><span class="md-ellipsis"> hub </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_5_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_5"><span class="md-nav__icon md-icon"></span> hub </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../hub/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../hub/auth/"><span class="md-ellipsis"> auth </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../hub/google/__init__/"><span class="md-ellipsis"> google </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../hub/session/"><span class="md-ellipsis"> session </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../hub/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_6" type="checkbox"/><label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex=""><span class="md-ellipsis"> models </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_6_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_6"><span class="md-nav__icon md-icon"></span> models </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/fastsam/model/"><span class="md-ellipsis"> fastsam </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/nas/model/"><span class="md-ellipsis"> nas </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/rtdetr/model/"><span class="md-ellipsis"> rtdetr </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/sam/amg/"><span class="md-ellipsis"> sam </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/utils/loss/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../models/yolo/classify/predict/"><span class="md-ellipsis"> yolo </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_7" type="checkbox"/><label class="md-nav__link" for="__nav_11_7" id="__nav_11_7_label" tabindex=""><span class="md-ellipsis"> nn </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_7_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_7"><span class="md-nav__icon md-icon"></span> nn </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../autobackend/"><span class="md-ellipsis"> autobackend </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../modules/activation/"><span class="md-ellipsis"> modules </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/><label class="md-nav__link md-nav__link--active" for="__toc"><span class="md-ellipsis"> tasks </span><span class="md-nav__icon md-icon"></span></label><a class="md-nav__link md-nav__link--active" href="./"><span class="md-ellipsis"> tasks </span></a><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> BaseModel</span></a><nav aria-label="Class ultralytics.nn.tasks.BaseModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._apply"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _apply</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._predict_augment"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_augment</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._predict_once"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_once</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._profile_one_layer"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _profile_one_layer</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.info"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> info</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.is_fused"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> is_fused</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.load"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> DetectionModel</span></a><nav aria-label="Class ultralytics.nn.tasks.DetectionModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._clip_augmented"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _clip_augmented</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._descale_pred"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _descale_pred</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._predict_augment"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_augment</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.OBBModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> OBBModel</span></a><nav aria-label="Class ultralytics.nn.tasks.OBBModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.OBBModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SegmentationModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SegmentationModel</span></a><nav aria-label="Class ultralytics.nn.tasks.SegmentationModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SegmentationModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.PoseModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PoseModel</span></a><nav aria-label="Class ultralytics.nn.tasks.PoseModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.PoseModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> ClassificationModel</span></a><nav aria-label="Class ultralytics.nn.tasks.ClassificationModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel._from_yaml"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _from_yaml</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel.reshape_outputs"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> reshape_outputs</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> RTDETRDetectionModel</span></a><nav aria-label="Class ultralytics.nn.tasks.RTDETRDetectionModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel._apply"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _apply</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> WorldModel</span></a><nav aria-label="Class ultralytics.nn.tasks.WorldModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.get_text_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_text_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.set_classes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_classes</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOEModel</span></a><nav aria-label="Class ultralytics.nn.tasks.YOLOEModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_cls_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_cls_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_text_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_text_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_visual_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_visual_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_vocab"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_vocab</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.set_classes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_classes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.set_vocab"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_vocab</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOESegModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOESegModel</span></a><nav aria-label="Class ultralytics.nn.tasks.YOLOESegModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOESegModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.Ensemble"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Ensemble</span></a><nav aria-label="Class ultralytics.nn.tasks.Ensemble" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.Ensemble.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeClass"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SafeClass</span></a><nav aria-label="Class ultralytics.nn.tasks.SafeClass" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeClass.__call__"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> __call__</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeUnpickler"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SafeUnpickler</span></a><nav aria-label="Class ultralytics.nn.tasks.SafeUnpickler" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeUnpickler.find_class"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> find_class</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.temporary_modules"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> temporary_modules</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.torch_safe_load"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> torch_safe_load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.load_checkpoint"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> load_checkpoint</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.parse_model"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> parse_model</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.yaml_model_load"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> yaml_model_load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.guess_model_scale"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> guess_model_scale</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.guess_model_task"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> guess_model_task</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="../text_model/"><span class="md-ellipsis"> text_model </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_8" type="checkbox"/><label class="md-nav__link" for="__nav_11_8" id="__nav_11_8_label" tabindex=""><span class="md-ellipsis"> solutions </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_8_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_8"><span class="md-nav__icon md-icon"></span> solutions </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/ai_gym/"><span class="md-ellipsis"> ai_gym </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/analytics/"><span class="md-ellipsis"> analytics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/config/"><span class="md-ellipsis"> config </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/distance_calculation/"><span class="md-ellipsis"> distance_calculation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/heatmap/"><span class="md-ellipsis"> heatmap </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/instance_segmentation/"><span class="md-ellipsis"> instance_segmentation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/object_blurrer/"><span class="md-ellipsis"> object_blurrer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/object_counter/"><span class="md-ellipsis"> object_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/object_cropper/"><span class="md-ellipsis"> object_cropper </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/parking_management/"><span class="md-ellipsis"> parking_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/queue_management/"><span class="md-ellipsis"> queue_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/region_counter/"><span class="md-ellipsis"> region_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/security_alarm/"><span class="md-ellipsis"> security_alarm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/similarity_search/"><span class="md-ellipsis"> similarity_search </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/solutions/"><span class="md-ellipsis"> solutions </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/speed_estimation/"><span class="md-ellipsis"> speed_estimation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/streamlit_inference/"><span class="md-ellipsis"> streamlit_inference </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/trackzone/"><span class="md-ellipsis"> trackzone </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../solutions/vision_eye/"><span class="md-ellipsis"> vision_eye </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_9" type="checkbox"/><label class="md-nav__link" for="__nav_11_9" id="__nav_11_9_label" tabindex=""><span class="md-ellipsis"> trackers </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_9_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_9"><span class="md-nav__icon md-icon"></span> trackers </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../trackers/basetrack/"><span class="md-ellipsis"> basetrack </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../trackers/bot_sort/"><span class="md-ellipsis"> bot_sort </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../trackers/byte_tracker/"><span class="md-ellipsis"> byte_tracker </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../trackers/track/"><span class="md-ellipsis"> track </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../trackers/utils/gmc/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_10" type="checkbox"/><label class="md-nav__link" for="__nav_11_10" id="__nav_11_10_label" tabindex=""><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_10_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_10"><span class="md-nav__icon md-icon"></span> utils </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../utils/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/autobatch/"><span class="md-ellipsis"> autobatch </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/autodevice/"><span class="md-ellipsis"> autodevice </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/benchmarks/"><span class="md-ellipsis"> benchmarks </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../utils/callbacks/base/"><span class="md-ellipsis"> callbacks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/checks/"><span class="md-ellipsis"> checks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/cpu/"><span class="md-ellipsis"> cpu </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/dist/"><span class="md-ellipsis"> dist </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/downloads/"><span class="md-ellipsis"> downloads </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/errors/"><span class="md-ellipsis"> errors </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/events/"><span class="md-ellipsis"> events </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../utils/export/engine/"><span class="md-ellipsis"> export </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/files/"><span class="md-ellipsis"> files </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/git/"><span class="md-ellipsis"> git </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/instance/"><span class="md-ellipsis"> instance </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/logger/"><span class="md-ellipsis"> logger </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/loss/"><span class="md-ellipsis"> loss </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/metrics/"><span class="md-ellipsis"> metrics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/nms/"><span class="md-ellipsis"> nms </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/ops/"><span class="md-ellipsis"> ops </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/patches/"><span class="md-ellipsis"> patches </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/plotting/"><span class="md-ellipsis"> plotting </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/tal/"><span class="md-ellipsis"> tal </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/torch_utils/"><span class="md-ellipsis"> torch_utils </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/tqdm/"><span class="md-ellipsis"> tqdm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/triton/"><span class="md-ellipsis"> triton </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../utils/tuner/"><span class="md-ellipsis"> tuner </span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../help/"><span class="md-ellipsis"> Help </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> BaseModel</span></a><nav aria-label="Class ultralytics.nn.tasks.BaseModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._apply"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _apply</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._predict_augment"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_augment</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._predict_once"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_once</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel._profile_one_layer"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _profile_one_layer</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.fuse"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> fuse</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.info"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> info</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.is_fused"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> is_fused</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.load"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.BaseModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> DetectionModel</span></a><nav aria-label="Class ultralytics.nn.tasks.DetectionModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._clip_augmented"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _clip_augmented</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._descale_pred"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _descale_pred</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel._predict_augment"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _predict_augment</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.DetectionModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.OBBModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> OBBModel</span></a><nav aria-label="Class ultralytics.nn.tasks.OBBModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.OBBModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SegmentationModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SegmentationModel</span></a><nav aria-label="Class ultralytics.nn.tasks.SegmentationModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SegmentationModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.PoseModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PoseModel</span></a><nav aria-label="Class ultralytics.nn.tasks.PoseModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.PoseModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> ClassificationModel</span></a><nav aria-label="Class ultralytics.nn.tasks.ClassificationModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel._from_yaml"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _from_yaml</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.ClassificationModel.reshape_outputs"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> reshape_outputs</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> RTDETRDetectionModel</span></a><nav aria-label="Class ultralytics.nn.tasks.RTDETRDetectionModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel._apply"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _apply</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> init_criterion</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.RTDETRDetectionModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> WorldModel</span></a><nav aria-label="Class ultralytics.nn.tasks.WorldModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.get_text_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_text_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.WorldModel.set_classes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_classes</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOEModel</span></a><nav aria-label="Class ultralytics.nn.tasks.YOLOEModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_cls_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_cls_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_text_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_text_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_visual_pe"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_visual_pe</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.get_vocab"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> get_vocab</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.predict"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> predict</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.set_classes"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_classes</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOEModel.set_vocab"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_vocab</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOESegModel"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> YOLOESegModel</span></a><nav aria-label="Class ultralytics.nn.tasks.YOLOESegModel" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.YOLOESegModel.loss"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> loss</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.Ensemble"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Ensemble</span></a><nav aria-label="Class ultralytics.nn.tasks.Ensemble" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.Ensemble.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeClass"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SafeClass</span></a><nav aria-label="Class ultralytics.nn.tasks.SafeClass" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeClass.__call__"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> __call__</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeUnpickler"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> SafeUnpickler</span></a><nav aria-label="Class ultralytics.nn.tasks.SafeUnpickler" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.SafeUnpickler.find_class"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> find_class</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.temporary_modules"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> temporary_modules</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.torch_safe_load"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> torch_safe_load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.load_checkpoint"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> load_checkpoint</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.parse_model"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> parse_model</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.yaml_model_load"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> yaml_model_load</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.guess_model_scale"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> guess_model_scale</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.nn.tasks.guess_model_task"><span class="md-ellipsis"><span class="doc-kind doc-kind-function">function</span> guess_model_task</span></a></li></ul></nav></div></div></div><div class="md-content" data-md-component="content"><article class="md-content__inner md-typeset"><a class="md-content__button md-icon" href="https://github.com/ultralytics/ultralytics/tree/main/docs/en/reference/nn/tasks.md" rel="edit" title="Edit this page"><svg class="lucide lucide-file-pen" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34"></path><path d="M14 2v5a1 1 0 0 0 1 1h5M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z"></path></svg></a><h1 id="reference-for-ultralyticsnntaskspy">Reference for <code>ultralytics/nn/tasks.py</code></h1><div class="admonition success"><p class="admonition-title">Improvements</p><p>This page is sourced from <a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py">https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py</a>. Have an improvement or example to add? Open a <a href="https://docs.ultralytics.com/help/contributing/">Pull Request</a> â€” thank you! ğŸ™</p></div><p><br/></p><div class="admonition abstract"><p class="admonition-title">Summary</p><div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="classes" name="__tabbed_1" type="radio"/><input id="methods" name="__tabbed_1" type="radio"/><input id="functions" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="classes"><span class="doc-kind doc-kind-class">Classes</span></label><label for="methods"><span class="doc-kind doc-kind-method">Methods</span></label><label for="functions"><span class="doc-kind doc-kind-function">Functions</span></label></div><div class="tabbed-content"><div class="tabbed-block"><ul><li><a href="#ultralytics.nn.tasks.BaseModel"><code>BaseModel</code></a></li><li><a href="#ultralytics.nn.tasks.DetectionModel"><code>DetectionModel</code></a></li><li><a href="#ultralytics.nn.tasks.OBBModel"><code>OBBModel</code></a></li><li><a href="#ultralytics.nn.tasks.SegmentationModel"><code>SegmentationModel</code></a></li><li><a href="#ultralytics.nn.tasks.PoseModel"><code>PoseModel</code></a></li><li><a href="#ultralytics.nn.tasks.ClassificationModel"><code>ClassificationModel</code></a></li><li><a href="#ultralytics.nn.tasks.RTDETRDetectionModel"><code>RTDETRDetectionModel</code></a></li><li><a href="#ultralytics.nn.tasks.WorldModel"><code>WorldModel</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel"><code>YOLOEModel</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOESegModel"><code>YOLOESegModel</code></a></li><li><a href="#ultralytics.nn.tasks.Ensemble"><code>Ensemble</code></a></li><li><a href="#ultralytics.nn.tasks.SafeClass"><code>SafeClass</code></a></li><li><a href="#ultralytics.nn.tasks.SafeUnpickler"><code>SafeUnpickler</code></a></li></ul></div><div class="tabbed-block"><ul><li><a href="#ultralytics.nn.tasks.BaseModel.forward"><code>BaseModel.forward</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.predict"><code>BaseModel.predict</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel._predict_once"><code>BaseModel._predict_once</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel._predict_augment"><code>BaseModel._predict_augment</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel._profile_one_layer"><code>BaseModel._profile_one_layer</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.fuse"><code>BaseModel.fuse</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.is_fused"><code>BaseModel.is_fused</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.info"><code>BaseModel.info</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel._apply"><code>BaseModel._apply</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.load"><code>BaseModel.load</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.loss"><code>BaseModel.loss</code></a></li><li><a href="#ultralytics.nn.tasks.BaseModel.init_criterion"><code>BaseModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.DetectionModel._predict_augment"><code>DetectionModel._predict_augment</code></a></li><li><a href="#ultralytics.nn.tasks.DetectionModel._descale_pred"><code>DetectionModel._descale_pred</code></a></li><li><a href="#ultralytics.nn.tasks.DetectionModel._clip_augmented"><code>DetectionModel._clip_augmented</code></a></li><li><a href="#ultralytics.nn.tasks.DetectionModel.init_criterion"><code>DetectionModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.OBBModel.init_criterion"><code>OBBModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.SegmentationModel.init_criterion"><code>SegmentationModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.PoseModel.init_criterion"><code>PoseModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.ClassificationModel._from_yaml"><code>ClassificationModel._from_yaml</code></a></li><li><a href="#ultralytics.nn.tasks.ClassificationModel.reshape_outputs"><code>ClassificationModel.reshape_outputs</code></a></li><li><a href="#ultralytics.nn.tasks.ClassificationModel.init_criterion"><code>ClassificationModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.RTDETRDetectionModel._apply"><code>RTDETRDetectionModel._apply</code></a></li><li><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion"><code>RTDETRDetectionModel.init_criterion</code></a></li><li><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.loss"><code>RTDETRDetectionModel.loss</code></a></li><li><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.predict"><code>RTDETRDetectionModel.predict</code></a></li><li><a href="#ultralytics.nn.tasks.WorldModel.set_classes"><code>WorldModel.set_classes</code></a></li><li><a href="#ultralytics.nn.tasks.WorldModel.get_text_pe"><code>WorldModel.get_text_pe</code></a></li><li><a href="#ultralytics.nn.tasks.WorldModel.predict"><code>WorldModel.predict</code></a></li><li><a href="#ultralytics.nn.tasks.WorldModel.loss"><code>WorldModel.loss</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.get_text_pe"><code>YOLOEModel.get_text_pe</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.get_visual_pe"><code>YOLOEModel.get_visual_pe</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.set_vocab"><code>YOLOEModel.set_vocab</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.get_vocab"><code>YOLOEModel.get_vocab</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.set_classes"><code>YOLOEModel.set_classes</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.get_cls_pe"><code>YOLOEModel.get_cls_pe</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.predict"><code>YOLOEModel.predict</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOEModel.loss"><code>YOLOEModel.loss</code></a></li><li><a href="#ultralytics.nn.tasks.YOLOESegModel.loss"><code>YOLOESegModel.loss</code></a></li><li><a href="#ultralytics.nn.tasks.Ensemble.forward"><code>Ensemble.forward</code></a></li><li><a href="#ultralytics.nn.tasks.SafeClass.__call__"><code>SafeClass.__call__</code></a></li><li><a href="#ultralytics.nn.tasks.SafeUnpickler.find_class"><code>SafeUnpickler.find_class</code></a></li></ul></div><div class="tabbed-block"><ul><li><a href="#ultralytics.nn.tasks.temporary_modules"><code>temporary_modules</code></a></li><li><a href="#ultralytics.nn.tasks.torch_safe_load"><code>torch_safe_load</code></a></li><li><a href="#ultralytics.nn.tasks.load_checkpoint"><code>load_checkpoint</code></a></li><li><a href="#ultralytics.nn.tasks.parse_model"><code>parse_model</code></a></li><li><a href="#ultralytics.nn.tasks.yaml_model_load"><code>yaml_model_load</code></a></li><li><a href="#ultralytics.nn.tasks.guess_model_scale"><code>guess_model_scale</code></a></li><li><a href="#ultralytics.nn.tasks.guess_model_task"><code>guess_model_task</code></a></li></ul></div></div></div></div><h2 id="ultralytics.nn.tasks.BaseModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.BaseModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">BaseModel</span><span class="p">()</span>
</code></pre></div><p><strong>Bases:</strong> <code>torch.nn.Module</code></p><p>Base class for all YOLO models in the Ultralytics family.</p><p>This class provides common functionality for YOLO models including forward pass handling, model fusion, information display, and weight loading capabilities.</p><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>model</code></td><td><code>torch.nn.Module</code></td><td>The neural network model.</td></tr><tr><td><code>save</code></td><td><code>list</code></td><td>List of layer indices to save outputs from.</td></tr><tr><td><code>stride</code></td><td><code>torch.Tensor</code></td><td>Model stride values.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.BaseModel._apply"><code>_apply</code></a></td><td>Apply a function to all tensors in the model that are not parameters or registered buffers.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel._predict_augment"><code>_predict_augment</code></a></td><td>Perform augmentations on input image x and return augmented inference.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel._predict_once"><code>_predict_once</code></a></td><td>Perform a forward pass through the network.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel._profile_one_layer"><code>_profile_one_layer</code></a></td><td>Profile the computation time and FLOPs of a single layer of the model on a given input.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.forward"><code>forward</code></a></td><td>Perform forward pass of the model for either training or inference.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.fuse"><code>fuse</code></a></td><td>Fuse the <code>Conv2d()</code> and <code>BatchNorm2d()</code> layers of the model into a single layer for improved computation</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.info"><code>info</code></a></td><td>Print model information.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the BaseModel.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.is_fused"><code>is_fused</code></a></td><td>Check if the model has less than a certain threshold of BatchNorm layers.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.load"><code>load</code></a></td><td>Load weights into the model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.loss"><code>loss</code></a></td><td>Compute loss.</td></tr><tr><td><a href="#ultralytics.nn.tasks.BaseModel.predict"><code>predict</code></a></td><td>Perform a forward pass through the network.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">a</span> <span class="n">BaseModel</span> <span class="n">instance</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">BaseModel</span><span class="p">()</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>  <span class="c1"># Display model information</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L97-L332"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel._apply"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel._apply</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</code></pre></div><p>Apply a function to all tensors in the model that are not parameters or registered buffers.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>fn</code></td><td><code>function</code></td><td>The function to apply to the model.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>BaseModel</code></td><td>An updated BaseModel object.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L272-L289"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Apply a function to all tensors in the model that are not parameters or registered buffers.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        fn (function): The function to apply to the model.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (BaseModel): An updated BaseModel object.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Detect()</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
<span></span>        <span class="n">m</span><span class="p">,</span> <span class="n">Detect</span>
<span></span>    <span class="p">):</span>  <span class="c1"># includes all Detect subclasses like Segment, Pose, OBB, WorldDetect, YOLOEDetect, YOLOESegment</span>
<span></span>        <span class="n">m</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">stride</span><span class="p">)</span>
<span></span>        <span class="n">m</span><span class="o">.</span><span class="n">anchors</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">anchors</span><span class="p">)</span>
<span></span>        <span class="n">m</span><span class="o">.</span><span class="n">strides</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">strides</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel._predict_augment"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel._predict_augment</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_augment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div><p>Perform augmentations on input image x and return augmented inference.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L186-L192"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_augment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform augmentations on input image x and return augmented inference."""</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not support 'augment=True' prediction. "</span>
<span></span>        <span class="sa">f</span><span class="s2">"Reverting to single-scale prediction."</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_once</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel._predict_once"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel._predict_once</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">embed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Perform a forward pass through the network.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input tensor to the model.</td><td><em>required</em></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>Print the computation time of each layer if True.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>Save the feature maps of the model if True.</td><td><code>False</code></td></tr><tr><td><code>embed</code></td><td><code>list, optional</code></td><td>A list of feature vectors/embeddings to return.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>The last output of the model.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L156-L184"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform a forward pass through the network.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The input tensor to the model.</span>
<span></span><span class="sd">        profile (bool): Print the computation time of each layer if True.</span>
<span></span><span class="sd">        visualize (bool): Save the feature maps of the model if True.</span>
<span></span><span class="sd">        embed (list, optional): A list of feature vectors/embeddings to return.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): The last output of the model.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># outputs</span>
<span></span>    <span class="n">embed</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span></span>    <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># if not from previous layer</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>  <span class="c1"># from earlier layers</span>
<span></span>        <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_one_layer</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># run</span>
<span></span>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># save output</span>
<span></span>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
<span></span>            <span class="n">feature_visualization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">visualize</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="n">embed</span><span class="p">:</span>
<span></span>            <span class="n">embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">adaptive_avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># flatten</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">max_idx</span><span class="p">:</span>
<span></span>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel._profile_one_layer"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel._profile_one_layer</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_profile_one_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
</code></pre></div><p>Profile the computation time and FLOPs of a single layer of the model on a given input.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>m</code></td><td><code>torch.nn.Module</code></td><td>The layer to be profiled.</td><td><em>required</em></td></tr><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input data to the layer.</td><td><em>required</em></td></tr><tr><td><code>dt</code></td><td><code>list</code></td><td>A list to store the computation time of the layer.</td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L194-L217"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_profile_one_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Profile the computation time and FLOPs of a single layer of the model on a given input.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        m (torch.nn.Module): The layer to be profiled.</span>
<span></span><span class="sd">        x (torch.Tensor): The input data to the layer.</span>
<span></span><span class="sd">        dt (list): A list to store the computation time of the layer.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">thop</span>
<span></span>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span></span>        <span class="n">thop</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># conda support without 'ultralytics-thop' installed</span>
<span></span>
<span></span>    <span class="n">c</span> <span class="o">=</span> <span class="n">m</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>  <span class="c1"># is final layer list, copy input as inplace fix</span>
<span></span>    <span class="n">flops</span> <span class="o">=</span> <span class="n">thop</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">x</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e9</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">thop</span> <span class="k">else</span> <span class="mi">0</span>  <span class="c1"># GFLOPs</span>
<span></span>    <span class="n">t</span> <span class="o">=</span> <span class="n">time_sync</span><span class="p">()</span>
<span></span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span></span>        <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">dt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time_sync</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'time (ms)'</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'GFLOPs'</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'params'</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2">  module"</span><span class="p">)</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">dt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">flops</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">np</span><span class="si">:</span><span class="s2">10.0f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'-'</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'-'</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2">  Total"</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div><p>Perform forward pass of the model for either training or inference.</p><p>If x is a dict, calculates and returns the loss for training. Otherwise, returns predictions for inference.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor | dict</code></td><td>Input tensor for inference, or dict with image tensor and labels for training.</td><td><em>required</em></td></tr><tr><td><code>*args</code></td><td><code>Any</code></td><td>Variable length argument list.</td><td><em>required</em></td></tr><tr><td><code>**kwargs</code></td><td><code>Any</code></td><td>Arbitrary keyword arguments.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Loss if x is a dict (training), or network predictions (inference).</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L122-L137"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform forward pass of the model for either training or inference.</span>
<span></span>
<span></span><span class="sd">    If x is a dict, calculates and returns the loss for training. Otherwise, returns predictions for inference.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor | dict): Input tensor for inference, or dict with image tensor and labels for training.</span>
<span></span><span class="sd">        *args (Any): Variable length argument list.</span>
<span></span><span class="sd">        **kwargs (Any): Arbitrary keyword arguments.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Loss if x is a dict (training), or network predictions (inference).</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># for cases of training and validating while training.</span>
<span></span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.fuse"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.fuse</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Fuse the <code>Conv2d()</code> and <code>BatchNorm2d()</code> layers of the model into a single layer for improved computation</p><p>efficiency.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>verbose</code></td><td></td><td></td><td><code>True</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.nn.Module</code></td><td>The fused model is returned.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L219-L248"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Fuse the `Conv2d()` and `BatchNorm2d()` layers of the model into a single layer for improved computation</span>
<span></span><span class="sd">    efficiency.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.nn.Module): The fused model is returned.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fused</span><span class="p">():</span>
<span></span>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">Conv</span><span class="p">,</span> <span class="n">Conv2</span><span class="p">,</span> <span class="n">DWConv</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"bn"</span><span class="p">):</span>
<span></span>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Conv2</span><span class="p">):</span>
<span></span>                    <span class="n">m</span><span class="o">.</span><span class="n">fuse_convs</span><span class="p">()</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">fuse_conv_and_bn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">conv</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span>  <span class="c1"># update conv</span>
<span></span>                <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"bn"</span><span class="p">)</span>  <span class="c1"># remove batchnorm</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">forward_fuse</span>  <span class="c1"># update forward</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ConvTranspose</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"bn"</span><span class="p">):</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">conv_transpose</span> <span class="o">=</span> <span class="n">fuse_deconv_and_bn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">conv_transpose</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">bn</span><span class="p">)</span>
<span></span>                <span class="nb">delattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"bn"</span><span class="p">)</span>  <span class="c1"># remove batchnorm</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">forward_fuse</span>  <span class="c1"># update forward</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">RepConv</span><span class="p">):</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">fuse_convs</span><span class="p">()</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">forward_fuse</span>  <span class="c1"># update forward</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">RepVGGDW</span><span class="p">):</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">forward_fuse</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">v10Detect</span><span class="p">):</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>  <span class="c1"># remove one2many head</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.info"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.info</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">imgsz</span> <span class="o">=</span> <span class="mi">640</span><span class="p">)</span>
</code></pre></div><p>Print model information.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>detailed</code></td><td><code>bool</code></td><td>If True, prints out detailed information about the model.</td><td><code>False</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>If True, prints out the model information.</td><td><code>True</code></td></tr><tr><td><code>imgsz</code></td><td><code>int</code></td><td>The size of the image that the model will be trained on.</td><td><code>640</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L262-L270"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imgsz</span><span class="o">=</span><span class="mi">640</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Print model information.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        detailed (bool): If True, prints out detailed information about the model.</span>
<span></span><span class="sd">        verbose (bool): If True, prints out the model information.</span>
<span></span><span class="sd">        imgsz (int): The size of the image that the model will be trained on.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">return</span> <span class="n">model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="n">detailed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">imgsz</span><span class="o">=</span><span class="n">imgsz</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the BaseModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L330-L332"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the BaseModel."""</span>
<span></span>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"compute_loss() needs to be implemented by task heads"</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.is_fused"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.is_fused</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_fused</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div><p>Check if the model has less than a certain threshold of BatchNorm layers.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>thresh</code></td><td><code>int, optional</code></td><td>The threshold number of BatchNorm layers.</td><td><code>10</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>bool</code></td><td>True if the number of BatchNorm layers in the model is less than the threshold, False otherwise.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L250-L260"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_fused</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Check if the model has less than a certain threshold of BatchNorm layers.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        thresh (int, optional): The threshold number of BatchNorm layers.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (bool): True if the number of BatchNorm layers in the model is less than the threshold, False otherwise.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">bn</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">"Norm"</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span>  <span class="c1"># normalization layers, i.e. BatchNorm2d()</span>
<span></span>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">bn</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">thresh</span>  <span class="c1"># True if &lt; 'thresh' BatchNorm layers in model</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.load"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.load</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Load weights into the model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>weights</code></td><td><code>dict | torch.nn.Module</code></td><td>The pre-trained weights to be loaded.</td><td><em>required</em></td></tr><tr><td><code>verbose</code></td><td><code>bool, optional</code></td><td>Whether to log the transfer progress.</td><td><code>True</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L291-L314"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Load weights into the model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        weights (dict | torch.nn.Module): The pre-trained weights to be loaded.</span>
<span></span><span class="sd">        verbose (bool, optional): Whether to log the transfer progress.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="s2">"model"</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">weights</span>  <span class="c1"># torchvision models are not dicts</span>
<span></span>    <span class="n">csd</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>  <span class="c1"># checkpoint state_dict as FP32</span>
<span></span>    <span class="n">updated_csd</span> <span class="o">=</span> <span class="n">intersect_dicts</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>  <span class="c1"># intersect</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">updated_csd</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># load</span>
<span></span>    <span class="n">len_updated_csd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">updated_csd</span><span class="p">)</span>
<span></span>    <span class="n">first_conv</span> <span class="o">=</span> <span class="s2">"model.0.conv.weight"</span>  <span class="c1"># hard-coded to yolo models for now</span>
<span></span>    <span class="c1"># mostly used to boost multi-channel training</span>
<span></span>    <span class="n">state_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">first_conv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">updated_csd</span> <span class="ow">and</span> <span class="n">first_conv</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
<span></span>        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">first_conv</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span></span>        <span class="n">cc1</span><span class="p">,</span> <span class="n">cc2</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">cw</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">first_conv</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span></span>        <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">cw</span> <span class="o">==</span> <span class="n">w</span><span class="p">:</span>
<span></span>            <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">cc1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">cc2</span><span class="p">)</span>
<span></span>            <span class="n">state_dict</span><span class="p">[</span><span class="n">first_conv</span><span class="p">][:</span><span class="n">c1</span><span class="p">,</span> <span class="p">:</span><span class="n">c2</span><span class="p">]</span> <span class="o">=</span> <span class="n">csd</span><span class="p">[</span><span class="n">first_conv</span><span class="p">][:</span><span class="n">c1</span><span class="p">,</span> <span class="p">:</span><span class="n">c2</span><span class="p">]</span>
<span></span>            <span class="n">len_updated_csd</span> <span class="o">+=</span> <span class="mi">1</span>
<span></span>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Transferred </span><span class="si">{</span><span class="n">len_updated_csd</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span><span class="si">}</span><span class="s2"> items from pretrained weights"</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.loss"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.loss</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Compute loss.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>batch</code></td><td><code>dict</code></td><td>Batch to compute loss on.</td><td><em>required</em></td></tr><tr><td><code>preds</code></td><td><code>torch.Tensor | list[torch.Tensor], optional</code></td><td>Predictions.</td><td><code>None</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L316-L328"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Compute loss.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        batch (dict): Batch to compute loss on.</span>
<span></span><span class="sd">        preds (torch.Tensor | list[torch.Tensor], optional): Predictions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"criterion"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_criterion</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">preds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">])</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.BaseModel.predict"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.BaseModel.predict</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">augment</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">embed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Perform a forward pass through the network.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input tensor to the model.</td><td><em>required</em></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>Print the computation time of each layer if True.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>Save the feature maps of the model if True.</td><td><code>False</code></td></tr><tr><td><code>augment</code></td><td><code>bool</code></td><td>Augment image during prediction.</td><td><code>False</code></td></tr><tr><td><code>embed</code></td><td><code>list, optional</code></td><td>A list of feature vectors/embeddings to return.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>The last output of the model.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L139-L154"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform a forward pass through the network.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The input tensor to the model.</span>
<span></span><span class="sd">        profile (bool): Print the computation time of each layer if True.</span>
<span></span><span class="sd">        visualize (bool): Save the feature maps of the model if True.</span>
<span></span><span class="sd">        augment (bool): Augment image during prediction.</span>
<span></span><span class="sd">        embed (list, optional): A list of feature vectors/embeddings to return.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): The last output of the model.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="n">augment</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_augment</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_once</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">visualize</span><span class="p">,</span> <span class="n">embed</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.DetectionModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.DetectionModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">DetectionModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolo11n.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>BaseModel</code></p><p>YOLO detection model.</p><p>This class implements the YOLO detection architecture, handling model initialization, forward pass, augmented inference, and loss computation for object detection tasks.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolo11n.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>yaml</code></td><td><code>dict</code></td><td>Model configuration dictionary.</td></tr><tr><td><code>model</code></td><td><code>torch.nn.Sequential</code></td><td>The neural network model.</td></tr><tr><td><code>save</code></td><td><code>list</code></td><td>List of layer indices to save outputs from.</td></tr><tr><td><code>names</code></td><td><code>dict</code></td><td>Class names dictionary.</td></tr><tr><td><code>inplace</code></td><td><code>bool</code></td><td>Whether to use inplace operations.</td></tr><tr><td><code>end2end</code></td><td><code>bool</code></td><td>Whether the model uses end-to-end detection.</td></tr><tr><td><code>stride</code></td><td><code>torch.Tensor</code></td><td>Model stride values.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.DetectionModel._clip_augmented"><code>_clip_augmented</code></a></td><td>Clip YOLO augmented inference tails.</td></tr><tr><td><a href="#ultralytics.nn.tasks.DetectionModel._descale_pred"><code>_descale_pred</code></a></td><td>De-scale predictions following augmented inference (inverse operation).</td></tr><tr><td><a href="#ultralytics.nn.tasks.DetectionModel._predict_augment"><code>_predict_augment</code></a></td><td>Perform augmentations on input image x and return augmented inference and train outputs.</td></tr><tr><td><a href="#ultralytics.nn.tasks.DetectionModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the DetectionModel.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">detection</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">DetectionModel</span><span class="p">(</span><span class="s2">"yolo11n.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L335-L484"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DetectionModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO detection model.</span>
<span></span>
<span></span><span class="sd">    This class implements the YOLO detection architecture, handling model initialization, forward pass, augmented</span>
<span></span><span class="sd">    inference, and loss computation for object detection tasks.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        yaml (dict): Model configuration dictionary.</span>
<span></span><span class="sd">        model (torch.nn.Sequential): The neural network model.</span>
<span></span><span class="sd">        save (list): List of layer indices to save outputs from.</span>
<span></span><span class="sd">        names (dict): Class names dictionary.</span>
<span></span><span class="sd">        inplace (bool): Whether to use inplace operations.</span>
<span></span><span class="sd">        end2end (bool): Whether the model uses end-to-end detection.</span>
<span></span><span class="sd">        stride (torch.Tensor): Model stride values.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize the YOLO detection model.</span>
<span></span><span class="sd">        _predict_augment: Perform augmented inference.</span>
<span></span><span class="sd">        _descale_pred: De-scale predictions following augmented inference.</span>
<span></span><span class="sd">        _clip_augmented: Clip YOLO augmented inference tails.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a detection model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = DetectionModel("yolo11n.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolo11n.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the YOLO detection model with the given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span> <span class="o">=</span> <span class="n">cfg</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">yaml_model_load</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># cfg dict</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"backbone"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"Silence"</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>                <span class="s2">"YOLOv9 `Silence` module is deprecated in favor of torch.nn.Identity. "</span>
<span></span>                <span class="s2">"Please delete local *.pt file and re-download the latest model checkpoint."</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"backbone"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"nn.Identity"</span>
<span></span>
<span></span>        <span class="c1"># Define model</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"channels"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span>  <span class="c1"># save channels</span>
<span></span>        <span class="k">if</span> <span class="n">nc</span> <span class="ow">and</span> <span class="n">nc</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">]:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Overriding model.yaml nc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s1">'nc'</span><span class="p">]</span><span class="si">}</span><span class="s2"> with nc=</span><span class="si">{</span><span class="n">nc</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span>  <span class="c1"># override YAML value</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">parse_model</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">),</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  <span class="c1"># model, savelist</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">])}</span>  <span class="c1"># default names dict</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"inplace"</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Build strides</span>
<span></span>        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Detect()</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Detect</span><span class="p">):</span>  <span class="c1"># includes all Detect subclasses like Segment, Pose, OBB, YOLOEDetect, YOLOESegment</span>
<span></span>            <span class="n">s</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># 2x min stride</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inplace</span>
<span></span>
<span></span>            <span class="k">def</span><span class="w"> </span><span class="nf">_forward</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span></span><span class="w">                </span><span class="sd">"""Perform a forward pass through the model, handling different Detect subclass types accordingly."""</span>
<span></span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end2end</span><span class="p">:</span>
<span></span>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s2">"one2many"</span><span class="p">]</span>
<span></span>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">Segment</span><span class="p">,</span> <span class="n">YOLOESegment</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">OBB</span><span class="p">))</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># Avoid changing batch statistics until training begins</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Setting it to True to properly return strides</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">s</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_forward</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))])</span>  <span class="c1"># forward</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">stride</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>  <span class="c1"># Set model back to training(default) mode</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">bias_init</span><span class="p">()</span>  <span class="c1"># only run once</span>
<span></span>        <span class="k">else</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">32</span><span class="p">])</span>  <span class="c1"># default stride for i.e. RTDETR</span>
<span></span>
<span></span>        <span class="c1"># Init weights, biases</span>
<span></span>        <span class="n">initialize_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.DetectionModel._clip_augmented"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.DetectionModel._clip_augmented</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_clip_augmented</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div><p>Clip YOLO augmented inference tails.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>y</code></td><td><code>list[torch.Tensor]</code></td><td>List of detection tensors.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>list[torch.Tensor]</code></td><td>Clipped detection tensors.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L464-L480"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_clip_augmented</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Clip YOLO augmented inference tails.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        y (list[torch.Tensor]): List of detection tensors.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (list[torch.Tensor]): Clipped detection tensors.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nl</span>  <span class="c1"># number of detection layers (P3-P5)</span>
<span></span>    <span class="n">g</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">4</span><span class="o">**</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">))</span>  <span class="c1"># grid points</span>
<span></span>    <span class="n">e</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># exclude layer count</span>
<span></span>    <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">4</span><span class="o">**</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c1"># indices</span>
<span></span>    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># large</span>
<span></span>    <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">4</span> <span class="o">**</span> <span class="p">(</span><span class="n">nl</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c1"># indices</span>
<span></span>    <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">:]</span>  <span class="c1"># small</span>
<span></span>    <span class="k">return</span> <span class="n">y</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.DetectionModel._descale_pred"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.DetectionModel._descale_pred</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_descale_pred</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">flips</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><p>De-scale predictions following augmented inference (inverse operation).</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>p</code></td><td><code>torch.Tensor</code></td><td>Predictions tensor.</td><td><em>required</em></td></tr><tr><td><code>flips</code></td><td><code>int</code></td><td>Flip type (0=none, 2=ud, 3=lr).</td><td><em>required</em></td></tr><tr><td><code>scale</code></td><td><code>float</code></td><td>Scale factor.</td><td><em>required</em></td></tr><tr><td><code>img_size</code></td><td><code>tuple</code></td><td>Original image size (height, width).</td><td><em>required</em></td></tr><tr><td><code>dim</code></td><td><code>int</code></td><td>Dimension to split at.</td><td><code>1</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>De-scaled predictions.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L443-L462"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@staticmethod</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">_descale_pred</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">flips</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""De-scale predictions following augmented inference (inverse operation).</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        p (torch.Tensor): Predictions tensor.</span>
<span></span><span class="sd">        flips (int): Flip type (0=none, 2=ud, 3=lr).</span>
<span></span><span class="sd">        scale (float): Scale factor.</span>
<span></span><span class="sd">        img_size (tuple): Original image size (height, width).</span>
<span></span><span class="sd">        dim (int): Dimension to split at.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): De-scaled predictions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">p</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">/=</span> <span class="n">scale</span>  <span class="c1"># de-scale</span>
<span></span>    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wh</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dim</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">flips</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span></span>        <span class="n">y</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>  <span class="c1"># de-flip ud</span>
<span></span>    <span class="k">elif</span> <span class="n">flips</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span>  <span class="c1"># de-flip lr</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wh</span><span class="p">,</span> <span class="bp">cls</span><span class="p">),</span> <span class="n">dim</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.DetectionModel._predict_augment"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.DetectionModel._predict_augment</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_augment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</code></pre></div><p>Perform augmentations on input image x and return augmented inference and train outputs.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>Input image tensor.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Augmented inference output.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L418-L440"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_predict_augment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform augmentations on input image x and return augmented inference and train outputs.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): Input image tensor.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Augmented inference output.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">"DetectionModel"</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Model does not support 'augment=True', reverting to single-scale prediction."</span><span class="p">)</span>
<span></span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict_once</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">img_size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># height, width</span>
<span></span>    <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">]</span>  <span class="c1"># scales</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># flips (2-ud, 3-lr)</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># outputs</span>
<span></span>    <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span></span>        <span class="n">xi</span> <span class="o">=</span> <span class="n">scale_img</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span> <span class="k">if</span> <span class="n">fi</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">gs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span></span>        <span class="n">yi</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># forward</span>
<span></span>        <span class="n">yi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_descale_pred</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">img_size</span><span class="p">)</span>
<span></span>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clip_augmented</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># clip augmented tails</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="kc">None</span>  <span class="c1"># augmented inference, train</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.DetectionModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.DetectionModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the DetectionModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L482-L484"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the DetectionModel."""</span>
<span></span>    <span class="k">return</span> <span class="n">E2EDetectLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="n">v8DetectionLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.OBBModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.OBBModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">OBBModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolo11n-obb.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>YOLO Oriented Bounding Box (OBB) model.</p><p>This class extends DetectionModel to handle oriented bounding box detection tasks, providing specialized loss computation for rotated object detection.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolo11n-obb.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.OBBModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the model.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">an</span> <span class="n">OBB</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">OBBModel</span><span class="p">(</span><span class="s2">"yolo11n-obb.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L487-L516"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OBBModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO Oriented Bounding Box (OBB) model.</span>
<span></span>
<span></span><span class="sd">    This class extends DetectionModel to handle oriented bounding box detection tasks, providing specialized loss</span>
<span></span><span class="sd">    computation for rotated object detection.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLO OBB model.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion for OBB detection.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize an OBB model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = OBBModel("yolo11n-obb.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolo11n-obb.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLO OBB model with given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.OBBModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.OBBModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the model.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L514-L516"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the model."""</span>
<span></span>    <span class="k">return</span> <span class="n">v8OBBLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.SegmentationModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.SegmentationModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">SegmentationModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolo11n-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>YOLO segmentation model.</p><p>This class extends DetectionModel to handle instance segmentation tasks, providing specialized loss computation for pixel-level object detection and segmentation.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolo11n-seg.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.SegmentationModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the SegmentationModel.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">segmentation</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">SegmentationModel</span><span class="p">(</span><span class="s2">"yolo11n-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L519-L548"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SegmentationModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO segmentation model.</span>
<span></span>
<span></span><span class="sd">    This class extends DetectionModel to handle instance segmentation tasks, providing specialized loss computation for</span>
<span></span><span class="sd">    pixel-level object detection and segmentation.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLO segmentation model.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion for segmentation.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a segmentation model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = SegmentationModel("yolo11n-seg.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolo11n-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize Ultralytics YOLO segmentation model with given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.SegmentationModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.SegmentationModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the SegmentationModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L546-L548"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the SegmentationModel."""</span>
<span></span>    <span class="k">return</span> <span class="n">v8SegmentationLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.PoseModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.PoseModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">PoseModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolo11n-pose.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_kpt_shape</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>YOLO pose model.</p><p>This class extends DetectionModel to handle human pose estimation tasks, providing specialized loss computation for keypoint detection and pose estimation.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolo11n-pose.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>data_kpt_shape</code></td><td><code>tuple</code></td><td>Shape of keypoints data.</td><td><code>(None, None)</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>kpt_shape</code></td><td><code>tuple</code></td><td>Shape of keypoints data (num_keypoints, num_dimensions).</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.PoseModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the PoseModel.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">pose</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">PoseModel</span><span class="p">(</span><span class="s2">"yolo11n-pose.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_kpt_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L551-L589"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PoseModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO pose model.</span>
<span></span>
<span></span><span class="sd">    This class extends DetectionModel to handle human pose estimation tasks, providing specialized loss computation for</span>
<span></span><span class="sd">    keypoint detection and pose estimation.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        kpt_shape (tuple): Shape of keypoints data (num_keypoints, num_dimensions).</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLO pose model.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion for pose estimation.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a pose model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = PoseModel("yolo11n-pose.yaml", ch=3, nc=1, data_kpt_shape=(17, 3))</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolo11n-pose.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_kpt_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize Ultralytics YOLO Pose model.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            data_kpt_shape (tuple): Shape of keypoints data.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span></span>            <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml_model_load</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># load model YAML</span>
<span></span>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">data_kpt_shape</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_kpt_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s2">"kpt_shape"</span><span class="p">]):</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Overriding model.yaml kpt_shape=</span><span class="si">{</span><span class="n">cfg</span><span class="p">[</span><span class="s1">'kpt_shape'</span><span class="p">]</span><span class="si">}</span><span class="s2"> with kpt_shape=</span><span class="si">{</span><span class="n">data_kpt_shape</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>            <span class="n">cfg</span><span class="p">[</span><span class="s2">"kpt_shape"</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_kpt_shape</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.PoseModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.PoseModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the PoseModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L587-L589"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the PoseModel."""</span>
<span></span>    <span class="k">return</span> <span class="n">v8PoseLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.ClassificationModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.ClassificationModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">ClassificationModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolo11n-cls.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>BaseModel</code></p><p>YOLO classification model.</p><p>This class implements the YOLO classification architecture for image classification tasks, providing model initialization, configuration, and output reshaping capabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolo11n-cls.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>yaml</code></td><td><code>dict</code></td><td>Model configuration dictionary.</td></tr><tr><td><code>model</code></td><td><code>torch.nn.Sequential</code></td><td>The neural network model.</td></tr><tr><td><code>stride</code></td><td><code>torch.Tensor</code></td><td>Model stride values.</td></tr><tr><td><code>names</code></td><td><code>dict</code></td><td>Class names dictionary.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.ClassificationModel._from_yaml"><code>_from_yaml</code></a></td><td>Set Ultralytics YOLO model configurations and define the model architecture.</td></tr><tr><td><a href="#ultralytics.nn.tasks.ClassificationModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the ClassificationModel.</td></tr><tr><td><a href="#ultralytics.nn.tasks.ClassificationModel.reshape_outputs"><code>reshape_outputs</code></a></td><td>Update a TorchVision classification model to class count 'n' if required.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">classification</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">ClassificationModel</span><span class="p">(</span><span class="s2">"yolo11n-cls.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L592-L681"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ClassificationModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO classification model.</span>
<span></span>
<span></span><span class="sd">    This class implements the YOLO classification architecture for image classification tasks, providing model</span>
<span></span><span class="sd">    initialization, configuration, and output reshaping capabilities.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        yaml (dict): Model configuration dictionary.</span>
<span></span><span class="sd">        model (torch.nn.Sequential): The neural network model.</span>
<span></span><span class="sd">        stride (torch.Tensor): Model stride values.</span>
<span></span><span class="sd">        names (dict): Class names dictionary.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize ClassificationModel.</span>
<span></span><span class="sd">        _from_yaml: Set model configurations and define architecture.</span>
<span></span><span class="sd">        reshape_outputs: Update model to specified class count.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a classification model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = ClassificationModel("yolo11n-cls.yaml", ch=3, nc=1000)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolo11n-cls.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize ClassificationModel with YAML, channels, number of classes, verbose flag.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">_from_yaml</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.ClassificationModel._from_yaml"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.ClassificationModel._from_yaml</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</code></pre></div><p>Set Ultralytics YOLO model configurations and define the model architecture.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><em>required</em></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><em>required</em></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><em>required</em></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L628-L649"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set Ultralytics YOLO model configurations and define the model architecture.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">        ch (int): Number of input channels.</span>
<span></span><span class="sd">        nc (int, optional): Number of classes.</span>
<span></span><span class="sd">        verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span> <span class="o">=</span> <span class="n">cfg</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">yaml_model_load</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>  <span class="c1"># cfg dict</span>
<span></span>
<span></span>    <span class="c1"># Define model</span>
<span></span>    <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"channels"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"channels"</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>  <span class="c1"># input channels</span>
<span></span>    <span class="k">if</span> <span class="n">nc</span> <span class="ow">and</span> <span class="n">nc</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">]:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Overriding model.yaml nc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s1">'nc'</span><span class="p">]</span><span class="si">}</span><span class="s2"> with nc=</span><span class="si">{</span><span class="n">nc</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">]</span> <span class="o">=</span> <span class="n">nc</span>  <span class="c1"># override YAML value</span>
<span></span>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">nc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"nc"</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
<span></span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"nc not specified. Must specify nc in model.yaml or function arguments."</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">parse_model</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">),</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  <span class="c1"># model, savelist</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># no stride constraints</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml</span><span class="p">[</span><span class="s2">"nc"</span><span class="p">])}</span>  <span class="c1"># default names dict</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.ClassificationModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.ClassificationModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the ClassificationModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L679-L681"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the ClassificationModel."""</span>
<span></span>    <span class="k">return</span> <span class="n">v8ClassificationLoss</span><span class="p">()</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.ClassificationModel.reshape_outputs"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.ClassificationModel.reshape_outputs</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">reshape_outputs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
</code></pre></div><p>Update a TorchVision classification model to class count 'n' if required.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>model</code></td><td><code>torch.nn.Module</code></td><td>Model to update.</td><td><em>required</em></td></tr><tr><td><code>nc</code></td><td><code>int</code></td><td>New number of classes.</td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L652-L677"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@staticmethod</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">reshape_outputs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Update a TorchVision classification model to class count 'n' if required.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        model (torch.nn.Module): Model to update.</span>
<span></span><span class="sd">        nc (int): New number of classes.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">name</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">model</span><span class="o">.</span><span class="n">model</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"model"</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">named_children</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last module</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Classify</span><span class="p">):</span>  <span class="c1"># YOLO Classify() head</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">out_features</span> <span class="o">!=</span> <span class="n">nc</span><span class="p">:</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">in_features</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<span></span>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>  <span class="c1"># ResNet, EfficientNet</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">out_features</span> <span class="o">!=</span> <span class="n">nc</span><span class="p">:</span>
<span></span>            <span class="nb">setattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">in_features</span><span class="p">,</span> <span class="n">nc</span><span class="p">))</span>
<span></span>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">):</span>
<span></span>        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="p">]</span>
<span></span>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
<span></span>            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">)</span>  <span class="c1"># last torch.nn.Linear index</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">out_features</span> <span class="o">!=</span> <span class="n">nc</span><span class="p">:</span>
<span></span>                <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">in_features</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
<span></span>            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">types</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">)</span>  <span class="c1"># last torch.nn.Conv2d index</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">out_channels</span> <span class="o">!=</span> <span class="n">nc</span><span class="p">:</span>
<span></span>                <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<span></span>                    <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span></span>                <span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.RTDETRDetectionModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.RTDETRDetectionModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">RTDETRDetectionModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"rtdetr-l.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>RTDETR (Real-time DEtection and Tracking using Transformers) Detection Model class.</p><p>This class is responsible for constructing the RTDETR architecture, defining loss functions, and facilitating both the training and inference processes. RTDETR is an object detection and tracking model that extends from the DetectionModel base class.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Configuration file name or path.</td><td><code>"rtdetr-l.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Print additional information during initialization.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>nc</code></td><td><code>int</code></td><td>Number of classes for detection.</td></tr><tr><td><code>criterion</code></td><td><code>RTDETRDetectionLoss</code></td><td>Loss function for training.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.RTDETRDetectionModel._apply"><code>_apply</code></a></td><td>Apply a function to all tensors in the model that are not parameters or registered buffers.</td></tr><tr><td><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion"><code>init_criterion</code></a></td><td>Initialize the loss criterion for the RTDETRDetectionModel.</td></tr><tr><td><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.loss"><code>loss</code></a></td><td>Compute the loss for the given batch of data.</td></tr><tr><td><a href="#ultralytics.nn.tasks.RTDETRDetectionModel.predict"><code>predict</code></a></td><td>Perform a forward pass through the model.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">an</span> <span class="n">RTDETR</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">RTDETRDetectionModel</span><span class="p">(</span><span class="s2">"rtdetr-l.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L684-L817"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RTDETRDetectionModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""RTDETR (Real-time DEtection and Tracking using Transformers) Detection Model class.</span>
<span></span>
<span></span><span class="sd">    This class is responsible for constructing the RTDETR architecture, defining loss functions, and facilitating both</span>
<span></span><span class="sd">    the training and inference processes. RTDETR is an object detection and tracking model that extends from the</span>
<span></span><span class="sd">    DetectionModel base class.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        nc (int): Number of classes for detection.</span>
<span></span><span class="sd">        criterion (RTDETRDetectionLoss): Loss function for training.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize the RTDETRDetectionModel.</span>
<span></span><span class="sd">        init_criterion: Initialize the loss criterion.</span>
<span></span><span class="sd">        loss: Compute loss for training.</span>
<span></span><span class="sd">        predict: Perform forward pass through the model.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize an RTDETR model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = RTDETRDetectionModel("rtdetr-l.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"rtdetr-l.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the RTDETRDetectionModel.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Configuration file name or path.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Print additional information during initialization.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.RTDETRDetectionModel._apply"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.RTDETRDetectionModel._apply</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</code></pre></div><p>Apply a function to all tensors in the model that are not parameters or registered buffers.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>fn</code></td><td><code>function</code></td><td>The function to apply to the model.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>RTDETRDetectionModel</code></td><td>An updated BaseModel object.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L718-L731"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Apply a function to all tensors in the model that are not parameters or registered buffers.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        fn (function): The function to apply to the model.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (RTDETRDetectionModel): An updated BaseModel object.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_apply</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="n">m</span><span class="o">.</span><span class="n">anchors</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">anchors</span><span class="p">)</span>
<span></span>    <span class="n">m</span><span class="o">.</span><span class="n">valid_mask</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">valid_mask</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.RTDETRDetectionModel.init_criterion</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Initialize the loss criterion for the RTDETRDetectionModel.</p><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L733-L737"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">init_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize the loss criterion for the RTDETRDetectionModel."""</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.models.utils.loss</span><span class="w"> </span><span class="kn">import</span> <span class="n">RTDETRDetectionLoss</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">RTDETRDetectionLoss</span><span class="p">(</span><span class="n">nc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">use_vfl</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.RTDETRDetectionModel.loss"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.RTDETRDetectionModel.loss</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Compute the loss for the given batch of data.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>batch</code></td><td><code>dict</code></td><td>Dictionary containing image and label data.</td><td><em>required</em></td></tr><tr><td><code>preds</code></td><td><code>torch.Tensor, optional</code></td><td>Precomputed model predictions.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>loss_sum (torch.Tensor)</code></td><td>Total loss value.</td></tr><tr><td><code>loss_items (torch.Tensor)</code></td><td>Main three losses in a tensor.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L739-L783"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Compute the loss for the given batch of data.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        batch (dict): Dictionary containing image and label data.</span>
<span></span><span class="sd">        preds (torch.Tensor, optional): Precomputed model predictions.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        loss_sum (torch.Tensor): Total loss value.</span>
<span></span><span class="sd">        loss_items (torch.Tensor): Main three losses in a tensor.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"criterion"</span><span class="p">):</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_criterion</span><span class="p">()</span>
<span></span>
<span></span>    <span class="n">img</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">]</span>
<span></span>    <span class="c1"># NOTE: preprocess gt_bbox and gt_labels to list.</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>    <span class="n">batch_idx</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">"batch_idx"</span><span class="p">]</span>
<span></span>    <span class="n">gt_groups</span> <span class="o">=</span> <span class="p">[(</span><span class="n">batch_idx</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bs</span><span class="p">)]</span>
<span></span>    <span class="n">targets</span> <span class="o">=</span> <span class="p">{</span>
<span></span>        <span class="s2">"cls"</span><span class="p">:</span> <span class="n">batch</span><span class="p">[</span><span class="s2">"cls"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<span></span>        <span class="s2">"bboxes"</span><span class="p">:</span> <span class="n">batch</span><span class="p">[</span><span class="s2">"bboxes"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
<span></span>        <span class="s2">"batch_idx"</span><span class="p">:</span> <span class="n">batch_idx</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<span></span>        <span class="s2">"gt_groups"</span><span class="p">:</span> <span class="n">gt_groups</span><span class="p">,</span>
<span></span>    <span class="p">}</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">preds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>
<span></span>    <span class="n">dec_bboxes</span><span class="p">,</span> <span class="n">dec_scores</span><span class="p">,</span> <span class="n">enc_bboxes</span><span class="p">,</span> <span class="n">enc_scores</span><span class="p">,</span> <span class="n">dn_meta</span> <span class="o">=</span> <span class="n">preds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="k">else</span> <span class="n">preds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="k">if</span> <span class="n">dn_meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">dn_bboxes</span><span class="p">,</span> <span class="n">dn_scores</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">dn_bboxes</span><span class="p">,</span> <span class="n">dec_bboxes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dec_bboxes</span><span class="p">,</span> <span class="n">dn_meta</span><span class="p">[</span><span class="s2">"dn_num_split"</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span></span>        <span class="n">dn_scores</span><span class="p">,</span> <span class="n">dec_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dec_scores</span><span class="p">,</span> <span class="n">dn_meta</span><span class="p">[</span><span class="s2">"dn_num_split"</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">dec_bboxes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">enc_bboxes</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dec_bboxes</span><span class="p">])</span>  <span class="c1"># (7, bs, 300, 4)</span>
<span></span>    <span class="n">dec_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">enc_scores</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dec_scores</span><span class="p">])</span>
<span></span>
<span></span>    <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span>
<span></span>        <span class="p">(</span><span class="n">dec_bboxes</span><span class="p">,</span> <span class="n">dec_scores</span><span class="p">),</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dn_bboxes</span><span class="o">=</span><span class="n">dn_bboxes</span><span class="p">,</span> <span class="n">dn_scores</span><span class="o">=</span><span class="n">dn_scores</span><span class="p">,</span> <span class="n">dn_meta</span><span class="o">=</span><span class="n">dn_meta</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="c1"># NOTE: There are like 12 losses in RTDETR, backward with all losses but only show the main three losses.</span>
<span></span>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span>
<span></span>        <span class="p">[</span><span class="n">loss</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"loss_giou"</span><span class="p">,</span> <span class="s2">"loss_class"</span><span class="p">,</span> <span class="s2">"loss_bbox"</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">device</span>
<span></span>    <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.RTDETRDetectionModel.predict"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.RTDETRDetectionModel.predict</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">augment</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">embed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Perform a forward pass through the model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input tensor.</td><td><em>required</em></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>If True, profile the computation time for each layer.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>If True, save feature maps for visualization.</td><td><code>False</code></td></tr><tr><td><code>batch</code></td><td><code>dict, optional</code></td><td>Ground truth data for evaluation.</td><td><code>None</code></td></tr><tr><td><code>augment</code></td><td><code>bool</code></td><td>If True, perform data augmentation during inference.</td><td><code>False</code></td></tr><tr><td><code>embed</code></td><td><code>list, optional</code></td><td>A list of feature vectors/embeddings to return.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Model's output tensor.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L785-L817"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform a forward pass through the model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The input tensor.</span>
<span></span><span class="sd">        profile (bool): If True, profile the computation time for each layer.</span>
<span></span><span class="sd">        visualize (bool): If True, save feature maps for visualization.</span>
<span></span><span class="sd">        batch (dict, optional): Ground truth data for evaluation.</span>
<span></span><span class="sd">        augment (bool): If True, perform data augmentation during inference.</span>
<span></span><span class="sd">        embed (list, optional): A list of feature vectors/embeddings to return.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Model's output tensor.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># outputs</span>
<span></span>    <span class="n">embed</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span></span>    <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># except the head part</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># if not from previous layer</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>  <span class="c1"># from earlier layers</span>
<span></span>        <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_one_layer</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># run</span>
<span></span>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># save output</span>
<span></span>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
<span></span>            <span class="n">feature_visualization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">visualize</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="n">embed</span><span class="p">:</span>
<span></span>            <span class="n">embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">adaptive_avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># flatten</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">max_idx</span><span class="p">:</span>
<span></span>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">head</span><span class="p">([</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">head</span><span class="o">.</span><span class="n">f</span><span class="p">],</span> <span class="n">batch</span><span class="p">)</span>  <span class="c1"># head inference</span>
<span></span>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.WorldModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.WorldModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">WorldModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yolov8s-world.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>YOLOv8 World Model.</p><p>This class implements the YOLOv8 World model for open-vocabulary object detection, supporting text-based class specification and CLIP model integration for zero-shot detection capabilities.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yolov8s-world.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>txt_feats</code></td><td><code>torch.Tensor</code></td><td>Text feature embeddings for classes.</td></tr><tr><td><code>clip_model</code></td><td><code>torch.nn.Module</code></td><td>CLIP model for text encoding.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.WorldModel.get_text_pe"><code>get_text_pe</code></a></td><td>Get text positional embeddings for offline inference without CLIP model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.WorldModel.loss"><code>loss</code></a></td><td>Compute loss.</td></tr><tr><td><a href="#ultralytics.nn.tasks.WorldModel.predict"><code>predict</code></a></td><td>Perform a forward pass through the model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.WorldModel.set_classes"><code>set_classes</code></a></td><td>Set classes in advance so that model could do offline-inference without clip model.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">world</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">WorldModel</span><span class="p">(</span><span class="s2">"yolov8s-world.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">set_classes</span><span class="p">([</span><span class="s2">"person"</span><span class="p">,</span> <span class="s2">"car"</span><span class="p">,</span> <span class="s2">"bicycle"</span><span class="p">])</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L820-L947"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">WorldModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLOv8 World Model.</span>
<span></span>
<span></span><span class="sd">    This class implements the YOLOv8 World model for open-vocabulary object detection, supporting text-based class</span>
<span></span><span class="sd">    specification and CLIP model integration for zero-shot detection capabilities.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        txt_feats (torch.Tensor): Text feature embeddings for classes.</span>
<span></span><span class="sd">        clip_model (torch.nn.Module): CLIP model for text encoding.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLOv8 world model.</span>
<span></span><span class="sd">        set_classes: Set classes for offline inference.</span>
<span></span><span class="sd">        get_text_pe: Get text positional embeddings.</span>
<span></span><span class="sd">        predict: Perform forward pass with text features.</span>
<span></span><span class="sd">        loss: Compute loss with text features.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a world model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = WorldModel("yolov8s-world.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; model.set_classes(["person", "car", "bicycle"])</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yolov8s-world.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLOv8 world model with given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">txt_feats</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">or</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>  <span class="c1"># features placeholder</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">clip_model</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># CLIP model placeholder</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.WorldModel.get_text_pe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.WorldModel.get_text_pe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_text_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Get text positional embeddings for offline inference without CLIP model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>text</code></td><td><code>list[str]</code></td><td>List of class names.</td><td><em>required</em></td></tr><tr><td><code>batch</code></td><td><code>int</code></td><td>Batch size for processing text tokens.</td><td><code>80</code></td></tr><tr><td><code>cache_clip_model</code></td><td><code>bool</code></td><td>Whether to cache the CLIP model.</td><td><code>True</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Text positional embeddings.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L868-L889"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_text_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Get text positional embeddings for offline inference without CLIP model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        text (list[str]): List of class names.</span>
<span></span><span class="sd">        batch (int): Batch size for processing text tokens.</span>
<span></span><span class="sd">        cache_clip_model (bool): Whether to cache the CLIP model.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Text positional embeddings.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.nn.text_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_text_model</span>
<span></span>
<span></span>    <span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"clip_model"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cache_clip_model</span><span class="p">:</span>
<span></span>        <span class="c1"># For backwards compatibility of models lacking clip_model attribute</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">clip_model</span> <span class="o">=</span> <span class="n">build_text_model</span><span class="p">(</span><span class="s2">"clip:ViT-B/32"</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_model</span> <span class="k">if</span> <span class="n">cache_clip_model</span> <span class="k">else</span> <span class="n">build_text_model</span><span class="p">(</span><span class="s2">"clip:ViT-B/32"</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="n">text_token</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">encode_text</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">text_token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">batch</span><span class="p">)]</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt_feats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">txt_feats</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.WorldModel.loss"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.WorldModel.loss</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Compute loss.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>batch</code></td><td><code>dict</code></td><td>Batch to compute loss on.</td><td><em>required</em></td></tr><tr><td><code>preds</code></td><td><code>torch.Tensor | list[torch.Tensor], optional</code></td><td>Predictions.</td><td><code>None</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L935-L947"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Compute loss.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        batch (dict): Batch to compute loss on.</span>
<span></span><span class="sd">        preds (torch.Tensor | list[torch.Tensor], optional): Predictions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"criterion"</span><span class="p">):</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_criterion</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">preds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">],</span> <span class="n">txt_feats</span><span class="o">=</span><span class="n">batch</span><span class="p">[</span><span class="s2">"txt_feats"</span><span class="p">])</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.WorldModel.predict"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.WorldModel.predict</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">txt_feats</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">augment</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">embed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Perform a forward pass through the model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input tensor.</td><td><em>required</em></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>If True, profile the computation time for each layer.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>If True, save feature maps for visualization.</td><td><code>False</code></td></tr><tr><td><code>txt_feats</code></td><td><code>torch.Tensor, optional</code></td><td>The text features, use it if it's given.</td><td><code>None</code></td></tr><tr><td><code>augment</code></td><td><code>bool</code></td><td>If True, perform data augmentation during inference.</td><td><code>False</code></td></tr><tr><td><code>embed</code></td><td><code>list, optional</code></td><td>A list of feature vectors/embeddings to return.</td><td><code>None</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Model's output tensor.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L891-L933"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">txt_feats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform a forward pass through the model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The input tensor.</span>
<span></span><span class="sd">        profile (bool): If True, profile the computation time for each layer.</span>
<span></span><span class="sd">        visualize (bool): If True, save feature maps for visualization.</span>
<span></span><span class="sd">        txt_feats (torch.Tensor, optional): The text features, use it if it's given.</span>
<span></span><span class="sd">        augment (bool): If True, perform data augmentation during inference.</span>
<span></span><span class="sd">        embed (list, optional): A list of feature vectors/embeddings to return.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Model's output tensor.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_feats</span> <span class="k">if</span> <span class="n">txt_feats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">txt_feats</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">export</span><span class="p">:</span>
<span></span>        <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">ori_txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span></span>    <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># outputs</span>
<span></span>    <span class="n">embed</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span></span>    <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>  <span class="c1"># except the head part</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># if not from previous layer</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>  <span class="c1"># from earlier layers</span>
<span></span>        <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_one_layer</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">C2fAttn</span><span class="p">):</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">txt_feats</span><span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">WorldDetect</span><span class="p">):</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ori_txt_feats</span><span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ImagePoolingAttn</span><span class="p">):</span>
<span></span>            <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">txt_feats</span><span class="p">)</span>
<span></span>        <span class="k">else</span><span class="p">:</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># run</span>
<span></span>
<span></span>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># save output</span>
<span></span>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
<span></span>            <span class="n">feature_visualization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">visualize</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="n">embed</span><span class="p">:</span>
<span></span>            <span class="n">embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">adaptive_avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># flatten</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">max_idx</span><span class="p">:</span>
<span></span>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.WorldModel.set_classes"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.WorldModel.set_classes</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Set classes in advance so that model could do offline-inference without clip model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>text</code></td><td><code>list[str]</code></td><td>List of class names.</td><td><em>required</em></td></tr><tr><td><code>batch</code></td><td><code>int</code></td><td>Batch size for processing text tokens.</td><td><code>80</code></td></tr><tr><td><code>cache_clip_model</code></td><td><code>bool</code></td><td>Whether to cache the CLIP model.</td><td><code>True</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L857-L866"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set classes in advance so that model could do offline-inference without clip model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        text (list[str]): List of class names.</span>
<span></span><span class="sd">        batch (int): Batch size for processing text tokens.</span>
<span></span><span class="sd">        cache_clip_model (bool): Whether to cache the CLIP model.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">txt_feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text_pe</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span> <span class="n">cache_clip_model</span><span class="o">=</span><span class="n">cache_clip_model</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.YOLOEModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.YOLOEModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">YOLOEModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yoloe-v8s.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>DetectionModel</code></p><p>YOLOE detection model.</p><p>This class implements the YOLOE architecture for efficient object detection with text and visual prompts, supporting both prompt-based and prompt-free inference modes.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yoloe-v8s.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>pe</code></td><td><code>torch.Tensor</code></td><td>Prompt embeddings for classes.</td></tr><tr><td><code>clip_model</code></td><td><code>torch.nn.Module</code></td><td>CLIP model for text encoding.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.get_cls_pe"><code>get_cls_pe</code></a></td><td>Get class positional embeddings.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.get_text_pe"><code>get_text_pe</code></a></td><td>Get text positional embeddings for offline inference without CLIP model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.get_visual_pe"><code>get_visual_pe</code></a></td><td>Get visual embeddings.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.get_vocab"><code>get_vocab</code></a></td><td>Get fused vocabulary layer from the model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.loss"><code>loss</code></a></td><td>Compute loss.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.predict"><code>predict</code></a></td><td>Perform a forward pass through the model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.set_classes"><code>set_classes</code></a></td><td>Set classes in advance so that model could do offline-inference without clip model.</td></tr><tr><td><a href="#ultralytics.nn.tasks.YOLOEModel.set_vocab"><code>set_vocab</code></a></td><td>Set vocabulary for the prompt-free model.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">YOLOE</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">YOLOEModel</span><span class="p">(</span><span class="s2">"yoloe-v8s.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">,</span> <span class="n">tpe</span><span class="o">=</span><span class="n">text_embeddings</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L950-L1186"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">YOLOEModel</span><span class="p">(</span><span class="n">DetectionModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLOE detection model.</span>
<span></span>
<span></span><span class="sd">    This class implements the YOLOE architecture for efficient object detection with text and visual prompts, supporting</span>
<span></span><span class="sd">    both prompt-based and prompt-free inference modes.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        pe (torch.Tensor): Prompt embeddings for classes.</span>
<span></span><span class="sd">        clip_model (torch.nn.Module): CLIP model for text encoding.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLOE model.</span>
<span></span><span class="sd">        get_text_pe: Get text positional embeddings.</span>
<span></span><span class="sd">        get_visual_pe: Get visual embeddings.</span>
<span></span><span class="sd">        set_vocab: Set vocabulary for prompt-free model.</span>
<span></span><span class="sd">        get_vocab: Get fused vocabulary layer.</span>
<span></span><span class="sd">        set_classes: Set classes for offline inference.</span>
<span></span><span class="sd">        get_cls_pe: Get class positional embeddings.</span>
<span></span><span class="sd">        predict: Perform forward pass with prompts.</span>
<span></span><span class="sd">        loss: Compute loss with prompts.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a YOLOE model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = YOLOEModel("yoloe-v8s.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor, tpe=text_embeddings)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yoloe-v8s.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLOE model with given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.get_cls_pe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.get_cls_pe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_cls_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tpe</span><span class="p">,</span> <span class="n">vpe</span><span class="p">)</span>
</code></pre></div><p>Get class positional embeddings.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>tpe</code></td><td><code>torch.Tensor, optional</code></td><td>Text positional embeddings.</td><td><em>required</em></td></tr><tr><td><code>vpe</code></td><td><code>torch.Tensor, optional</code></td><td>Visual positional embeddings.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Class positional embeddings.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1101-L1120"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_cls_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tpe</span><span class="p">,</span> <span class="n">vpe</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Get class positional embeddings.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        tpe (torch.Tensor, optional): Text positional embeddings.</span>
<span></span><span class="sd">        vpe (torch.Tensor, optional): Visual positional embeddings.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Class positional embeddings.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">all_pe</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>    <span class="k">if</span> <span class="n">tpe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="n">tpe</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
<span></span>        <span class="n">all_pe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpe</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">vpe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="n">vpe</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
<span></span>        <span class="n">all_pe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vpe</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_pe</span><span class="p">:</span>
<span></span>        <span class="n">all_pe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"pe"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">512</span><span class="p">)))</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">all_pe</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.get_text_pe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.get_text_pe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_text_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">without_reprta</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>Get text positional embeddings for offline inference without CLIP model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>text</code></td><td><code>list[str]</code></td><td>List of class names.</td><td><em>required</em></td></tr><tr><td><code>batch</code></td><td><code>int</code></td><td>Batch size for processing text tokens.</td><td><code>80</code></td></tr><tr><td><code>cache_clip_model</code></td><td><code>bool</code></td><td>Whether to cache the CLIP model.</td><td><code>False</code></td></tr><tr><td><code>without_reprta</code></td><td><code>bool</code></td><td>Whether to return text embeddings without reprta module processing.</td><td><code>False</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Text positional embeddings.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L989-L1018"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@smart_inference_mode</span><span class="p">()</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_text_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">cache_clip_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">without_reprta</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Get text positional embeddings for offline inference without CLIP model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        text (list[str]): List of class names.</span>
<span></span><span class="sd">        batch (int): Batch size for processing text tokens.</span>
<span></span><span class="sd">        cache_clip_model (bool): Whether to cache the CLIP model.</span>
<span></span><span class="sd">        without_reprta (bool): Whether to return text embeddings without reprta module processing.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Text positional embeddings.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.nn.text_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_text_model</span>
<span></span>
<span></span>    <span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"clip_model"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cache_clip_model</span><span class="p">:</span>
<span></span>        <span class="c1"># For backwards compatibility of models lacking clip_model attribute</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">clip_model</span> <span class="o">=</span> <span class="n">build_text_model</span><span class="p">(</span><span class="s2">"mobileclip:blt"</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_model</span> <span class="k">if</span> <span class="n">cache_clip_model</span> <span class="k">else</span> <span class="n">build_text_model</span><span class="p">(</span><span class="s2">"mobileclip:blt"</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="n">text_token</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">encode_text</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">text_token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">batch</span><span class="p">)]</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt_feats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">txt_feats</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="n">txt_feats</span> <span class="o">=</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">txt_feats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span></span>    <span class="k">if</span> <span class="n">without_reprta</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">txt_feats</span>
<span></span>
<span></span>    <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">head</span><span class="o">.</span><span class="n">get_tpe</span><span class="p">(</span><span class="n">txt_feats</span><span class="p">)</span>  <span class="c1"># run auxiliary text head</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.get_visual_pe"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.get_visual_pe</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_visual_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">)</span>
</code></pre></div><p>Get visual embeddings.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>img</code></td><td><code>torch.Tensor</code></td><td>Input image tensor.</td><td><em>required</em></td></tr><tr><td><code>visual</code></td><td><code>torch.Tensor</code></td><td>Visual features.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Visual positional embeddings.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1021-L1031"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@smart_inference_mode</span><span class="p">()</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_visual_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">visual</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Get visual embeddings.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        img (torch.Tensor): Input image tensor.</span>
<span></span><span class="sd">        visual (torch.Tensor): Visual features.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Visual positional embeddings.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">vpe</span><span class="o">=</span><span class="n">visual</span><span class="p">,</span> <span class="n">return_vpe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.get_vocab"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.get_vocab</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div><p>Get fused vocabulary layer from the model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>names</code></td><td><code>list</code></td><td>List of class names.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>nn.ModuleList</code></td><td>List of vocabulary modules.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1061-L1084"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Get fused vocabulary layer from the model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        names (list): List of class names.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (nn.ModuleList): List of vocabulary modules.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span>
<span></span>    <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="n">head</span><span class="o">.</span><span class="n">is_fused</span>
<span></span>
<span></span>    <span class="n">tpe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text_pe</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">set_classes</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">tpe</span><span class="p">)</span>
<span></span>    <span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<span></span>    <span class="n">head</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pe</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>  <span class="c1"># fuse prompt embeddings to classify head</span>
<span></span>
<span></span>    <span class="n">vocab</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
<span></span>    <span class="k">for</span> <span class="n">cls_head</span> <span class="ow">in</span> <span class="n">head</span><span class="o">.</span><span class="n">cv3</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_head</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">)</span>
<span></span>        <span class="n">vocab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cls_head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span></span>    <span class="k">return</span> <span class="n">vocab</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.loss"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.loss</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Compute loss.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>batch</code></td><td><code>dict</code></td><td>Batch to compute loss on.</td><td><em>required</em></td></tr><tr><td><code>preds</code></td><td><code>torch.Tensor | list[torch.Tensor], optional</code></td><td>Predictions.</td><td><code>None</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1171-L1186"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Compute loss.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        batch (dict): Batch to compute loss on.</span>
<span></span><span class="sd">        preds (torch.Tensor | list[torch.Tensor], optional): Predictions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"criterion"</span><span class="p">):</span>
<span></span>        <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.utils.loss</span><span class="w"> </span><span class="kn">import</span> <span class="n">TVPDetectLoss</span>
<span></span>
<span></span>        <span class="n">visual_prompt</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"visuals"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># TODO</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">TVPDetectLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">visual_prompt</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_criterion</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">preds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">],</span> <span class="n">tpe</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"txt_feats"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">vpe</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"visuals"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.predict"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.predict</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tpe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vpe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_vpe</span><span class="o">=</span><span class="kc">False</span>
<span></span><span class="p">)</span>
</code></pre></div><p>Perform a forward pass through the model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>The input tensor.</td><td><em>required</em></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>If True, profile the computation time for each layer.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>If True, save feature maps for visualization.</td><td><code>False</code></td></tr><tr><td><code>tpe</code></td><td><code>torch.Tensor, optional</code></td><td>Text positional embeddings.</td><td><code>None</code></td></tr><tr><td><code>augment</code></td><td><code>bool</code></td><td>If True, perform data augmentation during inference.</td><td><code>False</code></td></tr><tr><td><code>embed</code></td><td><code>list, optional</code></td><td>A list of feature vectors/embeddings to return.</td><td><code>None</code></td></tr><tr><td><code>vpe</code></td><td><code>torch.Tensor, optional</code></td><td>Visual positional embeddings.</td><td><code>None</code></td></tr><tr><td><code>return_vpe</code></td><td><code>bool</code></td><td>If True, return visual positional embeddings.</td><td><code>False</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>torch.Tensor</code></td><td>Model's output tensor.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1122-L1169"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tpe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vpe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_vpe</span><span class="o">=</span><span class="kc">False</span>
<span></span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Perform a forward pass through the model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The input tensor.</span>
<span></span><span class="sd">        profile (bool): If True, profile the computation time for each layer.</span>
<span></span><span class="sd">        visualize (bool): If True, save feature maps for visualization.</span>
<span></span><span class="sd">        tpe (torch.Tensor, optional): Text positional embeddings.</span>
<span></span><span class="sd">        augment (bool): If True, perform data augmentation during inference.</span>
<span></span><span class="sd">        embed (list, optional): A list of feature vectors/embeddings to return.</span>
<span></span><span class="sd">        vpe (torch.Tensor, optional): Visual positional embeddings.</span>
<span></span><span class="sd">        return_vpe (bool): If True, return visual positional embeddings.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): Model's output tensor.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>  <span class="c1"># outputs</span>
<span></span>    <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>    <span class="n">embed</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span></span>    <span class="n">max_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">embed</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>  <span class="c1"># except the head part</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># if not from previous layer</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">x</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>  <span class="c1"># from earlier layers</span>
<span></span>        <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_one_layer</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">):</span>
<span></span>            <span class="n">vpe</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_vpe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">vpe</span><span class="p">)</span> <span class="k">if</span> <span class="n">vpe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<span></span>            <span class="k">if</span> <span class="n">return_vpe</span><span class="p">:</span>
<span></span>                <span class="k">assert</span> <span class="n">vpe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span></span>                <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span>
<span></span>                <span class="k">return</span> <span class="n">vpe</span>
<span></span>            <span class="n">cls_pe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cls_pe</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_tpe</span><span class="p">(</span><span class="n">tpe</span><span class="p">),</span> <span class="n">vpe</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="n">cls_pe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">export</span><span class="p">:</span>
<span></span>                <span class="n">cls_pe</span> <span class="o">=</span> <span class="n">cls_pe</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cls_pe</span><span class="p">)</span>
<span></span>        <span class="k">else</span><span class="p">:</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># run</span>
<span></span>
<span></span>        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># save output</span>
<span></span>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
<span></span>            <span class="n">feature_visualization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">visualize</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="ow">in</span> <span class="n">embed</span><span class="p">:</span>
<span></span>            <span class="n">embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">adaptive_avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># flatten</span>
<span></span>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">i</span> <span class="o">==</span> <span class="n">max_idx</span><span class="p">:</span>
<span></span>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.set_classes"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.set_classes</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div><p>Set classes in advance so that model could do offline-inference without clip model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>names</code></td><td><code>list[str]</code></td><td>List of class names.</td><td><em>required</em></td></tr><tr><td><code>embeddings</code></td><td><code>torch.Tensor</code></td><td>Embeddings tensor.</td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1086-L1099"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set classes in advance so that model could do offline-inference without clip model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        names (list[str]): List of class names.</span>
<span></span><span class="sd">        embeddings (torch.Tensor): Embeddings tensor.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"lrpc"</span><span class="p">),</span> <span class="p">(</span>
<span></span>        <span class="s2">"Prompt-free model does not support setting classes. Please try with Text/Visual prompt models."</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">pe</span> <span class="o">=</span> <span class="n">embeddings</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">check_class_names</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOEModel.set_vocab"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOEModel.set_vocab</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div><p>Set vocabulary for the prompt-free model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>vocab</code></td><td><code>nn.ModuleList</code></td><td>List of vocabulary items.</td><td><em>required</em></td></tr><tr><td><code>names</code></td><td><code>list[str]</code></td><td>List of class names.</td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1033-L1059"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_vocab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set vocabulary for the prompt-free model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        vocab (nn.ModuleList): List of vocabulary items.</span>
<span></span><span class="sd">        names (list[str]): List of class names.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span>
<span></span>    <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Cache anchors for head</span>
<span></span>    <span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<span></span>    <span class="bp">self</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">"imgsz"</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">"imgsz"</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>  <span class="c1"># warmup</span>
<span></span>
<span></span>    <span class="c1"># re-parameterization for prompt-free model</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lrpc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>        <span class="n">LRPCHead</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">enabled</span><span class="o">=</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
<span></span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pf</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">head</span><span class="o">.</span><span class="n">cv3</span><span class="p">,</span> <span class="n">head</span><span class="o">.</span><span class="n">cv2</span><span class="p">))</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">loc_head</span><span class="p">,</span> <span class="n">cls_head</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">head</span><span class="o">.</span><span class="n">cv2</span><span class="p">,</span> <span class="n">head</span><span class="o">.</span><span class="n">cv3</span><span class="p">):</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loc_head</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">)</span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_head</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">)</span>
<span></span>        <span class="k">del</span> <span class="n">loc_head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>        <span class="k">del</span> <span class="n">cls_head</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">check_class_names</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.YOLOESegModel"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.YOLOESegModel</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">YOLOESegModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span> <span class="o">=</span> <span class="s2">"yoloe-v8s-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>YOLOEModel</code>, <code>SegmentationModel</code></p><p>YOLOE segmentation model.</p><p>This class extends YOLOEModel to handle instance segmentation tasks with text and visual prompts, providing specialized loss computation for pixel-level object detection and segmentation.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>cfg</code></td><td><code>str | dict</code></td><td>Model configuration file path or dictionary.</td><td><code>"yoloe-v8s-seg.yaml"</code></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>nc</code></td><td><code>int, optional</code></td><td>Number of classes.</td><td><code>None</code></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to display model information.</td><td><code>True</code></td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.YOLOESegModel.loss"><code>loss</code></a></td><td>Compute loss.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Initialize</span> <span class="n">a</span> <span class="n">YOLOE</span> <span class="n">segmentation</span> <span class="n">model</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">YOLOESegModel</span><span class="p">(</span><span class="s2">"yoloe-v8s-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">,</span> <span class="n">tpe</span><span class="o">=</span><span class="n">text_embeddings</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1189-L1231"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">YOLOESegModel</span><span class="p">(</span><span class="n">YOLOEModel</span><span class="p">,</span> <span class="n">SegmentationModel</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLOE segmentation model.</span>
<span></span>
<span></span><span class="sd">    This class extends YOLOEModel to handle instance segmentation tasks with text and visual prompts, providing</span>
<span></span><span class="sd">    specialized loss computation for pixel-level object detection and segmentation.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize YOLOE segmentation model.</span>
<span></span><span class="sd">        loss: Compute loss with prompts for segmentation.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Initialize a YOLOE segmentation model</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = YOLOESegModel("yoloe-v8s-seg.yaml", ch=3, nc=80)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = model.predict(image_tensor, tpe=text_embeddings)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="s2">"yoloe-v8s-seg.yaml"</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize YOLOE segmentation model with given config and parameters.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            cfg (str | dict): Model configuration file path or dictionary.</span>
<span></span><span class="sd">            ch (int): Number of input channels.</span>
<span></span><span class="sd">            nc (int, optional): Number of classes.</span>
<span></span><span class="sd">            verbose (bool): Whether to display model information.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">nc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.YOLOESegModel.loss"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.YOLOESegModel.loss</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Compute loss.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>batch</code></td><td><code>dict</code></td><td>Batch to compute loss on.</td><td><em>required</em></td></tr><tr><td><code>preds</code></td><td><code>torch.Tensor | list[torch.Tensor], optional</code></td><td>Predictions.</td><td><code>None</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1216-L1231"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Compute loss.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        batch (dict): Batch to compute loss on.</span>
<span></span><span class="sd">        preds (torch.Tensor | list[torch.Tensor], optional): Predictions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"criterion"</span><span class="p">):</span>
<span></span>        <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.utils.loss</span><span class="w"> </span><span class="kn">import</span> <span class="n">TVPSegmentLoss</span>
<span></span>
<span></span>        <span class="n">visual_prompt</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"visuals"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># TODO</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">TVPSegmentLoss</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">visual_prompt</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_criterion</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">preds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">],</span> <span class="n">tpe</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"txt_feats"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">vpe</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"visuals"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.Ensemble"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.Ensemble</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">Ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>torch.nn.ModuleList</code></p><p>Ensemble of models.</p><p>This class allows combining multiple YOLO models into an ensemble for improved performance through model averaging or other ensemble techniques.</p><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.Ensemble.forward"><code>forward</code></a></td><td>Generate the YOLO network's final layer.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="n">Create</span> <span class="n">an</span> <span class="n">ensemble</span> <span class="n">of</span> <span class="n">models</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">ensemble</span> <span class="o">=</span> <span class="n">Ensemble</span><span class="p">()</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">(</span><span class="n">image_tensor</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1234-L1273"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Ensemble</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Ensemble of models.</span>
<span></span>
<span></span><span class="sd">    This class allows combining multiple YOLO models into an ensemble for improved performance through model averaging</span>
<span></span><span class="sd">    or other ensemble techniques.</span>
<span></span>
<span></span><span class="sd">    Methods:</span>
<span></span><span class="sd">        __init__: Initialize an ensemble of models.</span>
<span></span><span class="sd">        forward: Generate predictions from all models in the ensemble.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        Create an ensemble of models</span>
<span></span><span class="sd">        &gt;&gt;&gt; ensemble = Ensemble()</span>
<span></span><span class="sd">        &gt;&gt;&gt; ensemble.append(model1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; ensemble.append(model2)</span>
<span></span><span class="sd">        &gt;&gt;&gt; results = ensemble(image_tensor)</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize an ensemble of models."""</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.Ensemble.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.Ensemble.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">augment</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>Generate the YOLO network's final layer.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td>Input tensor.</td><td><em>required</em></td></tr><tr><td><code>augment</code></td><td><code>bool</code></td><td>Whether to augment the input.</td><td><code>False</code></td></tr><tr><td><code>profile</code></td><td><code>bool</code></td><td>Whether to profile the model.</td><td><code>False</code></td></tr><tr><td><code>visualize</code></td><td><code>bool</code></td><td>Whether to visualize the features.</td><td><code>False</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>y (torch.Tensor)</code></td><td>Concatenated predictions from all models.</td></tr><tr><td><code>train_out (None)</code></td><td>Always None for ensemble inference.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1256-L1273"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Generate the YOLO network's final layer.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): Input tensor.</span>
<span></span><span class="sd">        augment (bool): Whether to augment the input.</span>
<span></span><span class="sd">        profile (bool): Whether to profile the model.</span>
<span></span><span class="sd">        visualize (bool): Whether to visualize the features.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        y (torch.Tensor): Concatenated predictions from all models.</span>
<span></span><span class="sd">        train_out (None): Always None for ensemble inference.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">module</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">augment</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">visualize</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
<span></span>    <span class="c1"># y = torch.stack(y).max(0)[0]  # max ensemble</span>
<span></span>    <span class="c1"># y = torch.stack(y).mean(0)  # mean ensemble</span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># nms ensemble, y shape(B, HW, C)</span>
<span></span>    <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># inference, train output</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.SafeClass"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.SafeClass</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">SafeClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div><p>A placeholder class to replace unknown classes during unpickling.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>*args</code></td><td></td><td></td><td><em>required</em></td></tr><tr><td><code>**kwargs</code></td><td></td><td></td><td><em>required</em></td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.SafeClass.__call__"><code>__call__</code></a></td><td>Run SafeClass instance, ignoring all arguments.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1327-L1336"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SafeClass</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""A placeholder class to replace unknown classes during unpickling."""</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize SafeClass instance, ignoring all arguments."""</span>
<span></span>        <span class="k">pass</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.SafeClass.__call__"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.SafeClass.__call__</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div><p>Run SafeClass instance, ignoring all arguments.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>*args</code></td><td></td><td></td><td><em>required</em></td></tr><tr><td><code>**kwargs</code></td><td></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1334-L1336"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Run SafeClass instance, ignoring all arguments."""</span>
<span></span>    <span class="k">pass</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.SafeUnpickler"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.nn.tasks.SafeUnpickler</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">SafeUnpickler</span><span class="p">()</span>
</code></pre></div><p><strong>Bases:</strong> <code>pickle.Unpickler</code></p><p>Custom Unpickler that replaces unknown classes with SafeClass.</p><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.nn.tasks.SafeUnpickler.find_class"><code>find_class</code></a></td><td>Attempt to find a class, returning SafeClass if not among safe modules.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1339-L1364"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SafeUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">):</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.nn.tasks.SafeUnpickler.find_class"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.nn.tasks.SafeUnpickler.find_class</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">find_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div><p>Attempt to find a class, returning SafeClass if not among safe modules.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>module</code></td><td><code>str</code></td><td>Module name.</td><td><em>required</em></td></tr><tr><td><code>name</code></td><td><code>str</code></td><td>Class name.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>type</code></td><td>Found class or SafeClass.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1342-L1364"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">find_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Attempt to find a class, returning SafeClass if not among safe modules.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        module (str): Module name.</span>
<span></span><span class="sd">        name (str): Class name.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (type): Found class or SafeClass.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">safe_modules</span> <span class="o">=</span> <span class="p">(</span>
<span></span>        <span class="s2">"torch"</span><span class="p">,</span>
<span></span>        <span class="s2">"collections"</span><span class="p">,</span>
<span></span>        <span class="s2">"collections.abc"</span><span class="p">,</span>
<span></span>        <span class="s2">"builtins"</span><span class="p">,</span>
<span></span>        <span class="s2">"math"</span><span class="p">,</span>
<span></span>        <span class="s2">"numpy"</span><span class="p">,</span>
<span></span>        <span class="c1"># Add other modules considered safe</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">safe_modules</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">SafeClass</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.temporary_modules"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.temporary_modules</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">temporary_modules</span><span class="p">(</span><span class="n">modules</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div><p>Context manager for temporarily adding or modifying modules in Python's module cache (<code>sys.modules</code>).</p><p>This function can be used to change the module paths during runtime. It's useful when refactoring code, where you've moved a module from one location to another, but you still want to support the old import paths for backwards compatibility.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>modules</code></td><td><code>dict, optional</code></td><td>A dictionary mapping old module paths to new module paths.</td><td><code>None</code></td></tr><tr><td><code>attributes</code></td><td><code>dict, optional</code></td><td>A dictionary mapping old module attributes to new module attributes.</td><td><code>None</code></td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">temporary_modules</span><span class="p">({</span><span class="s2">"old.module"</span><span class="p">:</span> <span class="s2">"new.module"</span><span class="p">},</span> <span class="p">{</span><span class="s2">"old.module.attribute"</span><span class="p">:</span> <span class="s2">"new.module.attribute"</span><span class="p">}):</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">old.module</span>  <span class="c1"># this will now import new.module</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">old.module</span><span class="w"> </span><span class="kn">import</span> <span class="n">attribute</span>  <span class="c1"># this will now import new.module.attribute</span>
</code></pre></div><div class="admonition note"><p class="admonition-title">Notes</p><p>The changes are only in effect inside the context manager and are undone once the context manager exits.
Be aware that directly manipulating <code>sys.modules</code> can lead to unpredictable results, especially in larger
applications or libraries. Use this function with caution.</p></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1280-L1324"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">temporary_modules</span><span class="p">(</span><span class="n">modules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Context manager for temporarily adding or modifying modules in Python's module cache (`sys.modules`).</span>
<span></span>
<span></span><span class="sd">    This function can be used to change the module paths during runtime. It's useful when refactoring code, where you've</span>
<span></span><span class="sd">    moved a module from one location to another, but you still want to support the old import paths for backwards</span>
<span></span><span class="sd">    compatibility.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        modules (dict, optional): A dictionary mapping old module paths to new module paths.</span>
<span></span><span class="sd">        attributes (dict, optional): A dictionary mapping old module attributes to new module attributes.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; with temporary_modules({"old.module": "new.module"}, {"old.module.attribute": "new.module.attribute"}):</span>
<span></span><span class="sd">        &gt;&gt;&gt; import old.module  # this will now import new.module</span>
<span></span><span class="sd">        &gt;&gt;&gt; from old.module import attribute  # this will now import new.module.attribute</span>
<span></span>
<span></span><span class="sd">    Notes:</span>
<span></span><span class="sd">        The changes are only in effect inside the context manager and are undone once the context manager exits.</span>
<span></span><span class="sd">        Be aware that directly manipulating `sys.modules` can lead to unpredictable results, especially in larger</span>
<span></span><span class="sd">        applications or libraries. Use this function with caution.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">if</span> <span class="n">modules</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>
<span></span>    <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">importlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">import_module</span>
<span></span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="c1"># Set attributes in sys.modules under their old name</span>
<span></span>        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span></span>            <span class="n">old_module</span><span class="p">,</span> <span class="n">old_attr</span> <span class="o">=</span> <span class="n">old</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>            <span class="n">new_module</span><span class="p">,</span> <span class="n">new_attr</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span></span>            <span class="nb">setattr</span><span class="p">(</span><span class="n">import_module</span><span class="p">(</span><span class="n">old_module</span><span class="p">),</span> <span class="n">old_attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">import_module</span><span class="p">(</span><span class="n">new_module</span><span class="p">),</span> <span class="n">new_attr</span><span class="p">))</span>
<span></span>
<span></span>        <span class="c1"># Set modules in sys.modules under their old name</span>
<span></span>        <span class="k">for</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="ow">in</span> <span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span></span>            <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old</span><span class="p">]</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
<span></span>
<span></span>        <span class="k">yield</span>
<span></span>    <span class="k">finally</span><span class="p">:</span>
<span></span>        <span class="c1"># Remove the temporary module paths</span>
<span></span>        <span class="k">for</span> <span class="n">old</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
<span></span>            <span class="k">if</span> <span class="n">old</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
<span></span>                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old</span><span class="p">]</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.torch_safe_load"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.torch_safe_load</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">torch_safe_load</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">safe_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>Attempt to load a PyTorch model with the torch.load() function. If a ModuleNotFoundError is raised, it catches</p><p>the error, logs a warning message, and attempts to install the missing module via the check_requirements() function. After installation, the function again attempts to load the model using torch.load().</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>weight</code></td><td><code>str</code></td><td>The file path of the PyTorch model.</td><td><em>required</em></td></tr><tr><td><code>safe_only</code></td><td><code>bool</code></td><td>If True, replace unknown classes with SafeClass during loading.</td><td><code>False</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>ckpt (dict)</code></td><td>The loaded model checkpoint.</td></tr><tr><td><code>file (str)</code></td><td>The loaded filename.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.nn.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">torch_safe_load</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">ckpt</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">torch_safe_load</span><span class="p">(</span><span class="s2">"path/to/best.pt"</span><span class="p">,</span> <span class="n">safe_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1367-L1445"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">torch_safe_load</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">safe_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Attempt to load a PyTorch model with the torch.load() function. If a ModuleNotFoundError is raised, it catches</span>
<span></span><span class="sd">    the error, logs a warning message, and attempts to install the missing module via the check_requirements()</span>
<span></span><span class="sd">    function. After installation, the function again attempts to load the model using torch.load().</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        weight (str): The file path of the PyTorch model.</span>
<span></span><span class="sd">        safe_only (bool): If True, replace unknown classes with SafeClass during loading.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        ckpt (dict): The loaded model checkpoint.</span>
<span></span><span class="sd">        file (str): The loaded filename.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; from ultralytics.nn.tasks import torch_safe_load</span>
<span></span><span class="sd">        &gt;&gt;&gt; ckpt, file = torch_safe_load("path/to/best.pt", safe_only=True)</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.utils.downloads</span><span class="w"> </span><span class="kn">import</span> <span class="n">attempt_download_asset</span>
<span></span>
<span></span>    <span class="n">check_suffix</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">".pt"</span><span class="p">)</span>
<span></span>    <span class="n">file</span> <span class="o">=</span> <span class="n">attempt_download_asset</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>  <span class="c1"># search online if missing locally</span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="k">with</span> <span class="n">temporary_modules</span><span class="p">(</span>
<span></span>            <span class="n">modules</span><span class="o">=</span><span class="p">{</span>
<span></span>                <span class="s2">"ultralytics.yolo.utils"</span><span class="p">:</span> <span class="s2">"ultralytics.utils"</span><span class="p">,</span>
<span></span>                <span class="s2">"ultralytics.yolo.v8"</span><span class="p">:</span> <span class="s2">"ultralytics.models.yolo"</span><span class="p">,</span>
<span></span>                <span class="s2">"ultralytics.yolo.data"</span><span class="p">:</span> <span class="s2">"ultralytics.data"</span><span class="p">,</span>
<span></span>            <span class="p">},</span>
<span></span>            <span class="n">attributes</span><span class="o">=</span><span class="p">{</span>
<span></span>                <span class="s2">"ultralytics.nn.modules.block.Silence"</span><span class="p">:</span> <span class="s2">"torch.nn.Identity"</span><span class="p">,</span>  <span class="c1"># YOLOv9e</span>
<span></span>                <span class="s2">"ultralytics.nn.tasks.YOLOv10DetectionModel"</span><span class="p">:</span> <span class="s2">"ultralytics.nn.tasks.DetectionModel"</span><span class="p">,</span>  <span class="c1"># YOLOv10</span>
<span></span>                <span class="s2">"ultralytics.utils.loss.v10DetectLoss"</span><span class="p">:</span> <span class="s2">"ultralytics.utils.loss.E2EDetectLoss"</span><span class="p">,</span>  <span class="c1"># YOLOv10</span>
<span></span>            <span class="p">},</span>
<span></span>        <span class="p">):</span>
<span></span>            <span class="k">if</span> <span class="n">safe_only</span><span class="p">:</span>
<span></span>                <span class="c1"># Load via custom pickle module</span>
<span></span>                <span class="n">safe_pickle</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s2">"safe_pickle"</span><span class="p">)</span>
<span></span>                <span class="n">safe_pickle</span><span class="o">.</span><span class="n">Unpickler</span> <span class="o">=</span> <span class="n">SafeUnpickler</span>
<span></span>                <span class="n">safe_pickle</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">file_obj</span><span class="p">:</span> <span class="n">SafeUnpickler</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span></span>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span></span>                    <span class="n">ckpt</span> <span class="o">=</span> <span class="n">torch_load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pickle_module</span><span class="o">=</span><span class="n">safe_pickle</span><span class="p">)</span>
<span></span>            <span class="k">else</span><span class="p">:</span>
<span></span>                <span class="n">ckpt</span> <span class="o">=</span> <span class="n">torch_load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">"cpu"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">except</span> <span class="ne">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># e.name is missing module name</span>
<span></span>        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"models"</span><span class="p">:</span>
<span></span>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span></span>                <span class="n">emojis</span><span class="p">(</span>
<span></span>                    <span class="sa">f</span><span class="s2">"ERROR âŒï¸ </span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2"> appears to be an Ultralytics YOLOv5 model originally trained "</span>
<span></span>                    <span class="sa">f</span><span class="s2">"with https://github.com/ultralytics/yolov5.</span><span class="se">\n</span><span class="s2">This model is NOT forwards compatible with "</span>
<span></span>                    <span class="sa">f</span><span class="s2">"YOLOv8 at https://github.com/ultralytics/ultralytics."</span>
<span></span>                    <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Recommend fixes are to train a new model using the latest 'ultralytics' package or to "</span>
<span></span>                    <span class="sa">f</span><span class="s2">"run a command with an official Ultralytics model, i.e. 'yolo predict model=yolo11n.pt'"</span>
<span></span>                <span class="p">)</span>
<span></span>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span></span>        <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"numpy._core"</span><span class="p">:</span>
<span></span>            <span class="k">raise</span> <span class="ne">ModuleNotFoundError</span><span class="p">(</span>
<span></span>                <span class="n">emojis</span><span class="p">(</span>
<span></span>                    <span class="sa">f</span><span class="s2">"ERROR âŒï¸ </span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2"> requires numpy&gt;=1.26.1, however numpy==</span><span class="si">{</span><span class="nb">__import__</span><span class="p">(</span><span class="s1">'numpy'</span><span class="p">)</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2"> is installed."</span>
<span></span>                <span class="p">)</span>
<span></span>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2"> appears to require '</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">', which is not in Ultralytics requirements."</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">AutoInstall will run now for '</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' but this feature will be removed in the future."</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Recommend fixes are to train a new model using the latest 'ultralytics' package or to "</span>
<span></span>            <span class="sa">f</span><span class="s2">"run a command with an official Ultralytics model, i.e. 'yolo predict model=yolo11n.pt'"</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">check_requirements</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># install missing module</span>
<span></span>        <span class="n">ckpt</span> <span class="o">=</span> <span class="n">torch_load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s2">"cpu"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ckpt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span></span>        <span class="c1"># File is likely a YOLO instance saved with i.e. torch.save(model, "saved_model.pt")</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"The file '</span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s2">' appears to be improperly saved or formatted. "</span>
<span></span>            <span class="sa">f</span><span class="s2">"For optimal results, use model.save('filename.pt') to correctly save YOLO models."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">ckpt</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"model"</span><span class="p">:</span> <span class="n">ckpt</span><span class="o">.</span><span class="n">model</span><span class="p">}</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">ckpt</span><span class="p">,</span> <span class="n">file</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.load_checkpoint"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.load_checkpoint</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_checkpoint</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">fuse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div><p>Load a single model weights.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>weight</code></td><td><code>str | Path</code></td><td>Model weight path.</td><td><em>required</em></td></tr><tr><td><code>device</code></td><td><code>torch.device, optional</code></td><td>Device to load model to.</td><td><code>None</code></td></tr><tr><td><code>inplace</code></td><td><code>bool</code></td><td>Whether to do inplace operations.</td><td><code>True</code></td></tr><tr><td><code>fuse</code></td><td><code>bool</code></td><td>Whether to fuse model.</td><td><code>False</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>model (torch.nn.Module)</code></td><td>Loaded model.</td></tr><tr><td><code>ckpt (dict)</code></td><td>Model checkpoint dictionary.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1448-L1482"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_checkpoint</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fuse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Load a single model weights.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        weight (str | Path): Model weight path.</span>
<span></span><span class="sd">        device (torch.device, optional): Device to load model to.</span>
<span></span><span class="sd">        inplace (bool): Whether to do inplace operations.</span>
<span></span><span class="sd">        fuse (bool): Whether to fuse model.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        model (torch.nn.Module): Loaded model.</span>
<span></span><span class="sd">        ckpt (dict): Model checkpoint dictionary.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">ckpt</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">torch_safe_load</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>  <span class="c1"># load ckpt</span>
<span></span>    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">DEFAULT_CFG_DICT</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">ckpt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"train_args"</span><span class="p">,</span> <span class="p">{}))}</span>  <span class="c1"># combine model and default args, preferring model args</span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">ckpt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"ema"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ckpt</span><span class="p">[</span><span class="s2">"model"</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>  <span class="c1"># FP32 model</span>
<span></span>
<span></span>    <span class="c1"># Model compatibility updates</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>  <span class="c1"># attach args to model</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">pt_path</span> <span class="o">=</span> <span class="n">weight</span>  <span class="c1"># attach *.pt file path to model</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"task"</span><span class="p">,</span> <span class="n">guess_model_task</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"stride"</span><span class="p">):</span>
<span></span>        <span class="n">model</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">32.0</span><span class="p">])</span>
<span></span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span> <span class="k">if</span> <span class="n">fuse</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"fuse"</span><span class="p">)</span> <span class="k">else</span> <span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># model in eval mode</span>
<span></span>
<span></span>    <span class="c1"># Module updates</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
<span></span>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"inplace"</span><span class="p">):</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">inplace</span> <span class="o">=</span> <span class="n">inplace</span>
<span></span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Upsample</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"recompute_scale_factor"</span><span class="p">):</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">recompute_scale_factor</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># torch 1.11.0 compatibility</span>
<span></span>
<span></span>    <span class="c1"># Return model and ckpt</span>
<span></span>    <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">ckpt</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.parse_model"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.parse_model</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">parse_model</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Parse a YOLO model.yaml dictionary into a PyTorch model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>d</code></td><td><code>dict</code></td><td>Model dictionary.</td><td><em>required</em></td></tr><tr><td><code>ch</code></td><td><code>int</code></td><td>Input channels.</td><td><em>required</em></td></tr><tr><td><code>verbose</code></td><td><code>bool</code></td><td>Whether to print model details.</td><td><code>True</code></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>model (torch.nn.Sequential)</code></td><td>PyTorch model.</td></tr><tr><td><code>save (list)</code></td><td>Sorted list of output layers.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1485-L1660"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">parse_model</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Parse a YOLO model.yaml dictionary into a PyTorch model.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        d (dict): Model dictionary.</span>
<span></span><span class="sd">        ch (int): Input channels.</span>
<span></span><span class="sd">        verbose (bool): Whether to print model details.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        model (torch.nn.Sequential): PyTorch model.</span>
<span></span><span class="sd">        save (list): Sorted list of output layers.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span></span>
<span></span>    <span class="c1"># Args</span>
<span></span>    <span class="n">legacy</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># backward compatibility for v3/v5/v8/v9 models</span>
<span></span>    <span class="n">max_channels</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
<span></span>    <span class="n">nc</span><span class="p">,</span> <span class="n">act</span><span class="p">,</span> <span class="n">scales</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"nc"</span><span class="p">,</span> <span class="s2">"activation"</span><span class="p">,</span> <span class="s2">"scales"</span><span class="p">))</span>
<span></span>    <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">kpt_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"depth_multiple"</span><span class="p">,</span> <span class="s2">"width_multiple"</span><span class="p">,</span> <span class="s2">"kpt_shape"</span><span class="p">))</span>
<span></span>    <span class="n">scale</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"scale"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">scales</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">scale</span><span class="p">:</span>
<span></span>            <span class="n">scale</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">scales</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"no model scale passed. Assuming scale='</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">'."</span><span class="p">)</span>
<span></span>        <span class="n">depth</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">max_channels</span> <span class="o">=</span> <span class="n">scales</span><span class="p">[</span><span class="n">scale</span><span class="p">]</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">act</span><span class="p">:</span>
<span></span>        <span class="n">Conv</span><span class="o">.</span><span class="n">default_act</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>  <span class="c1"># redefine default activation, i.e. Conv.default_act = torch.nn.SiLU()</span>
<span></span>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'activation:'</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">act</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># print</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">''</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}{</span><span class="s1">'from'</span><span class="si">:</span><span class="s2">&gt;20</span><span class="si">}{</span><span class="s1">'n'</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}{</span><span class="s1">'params'</span><span class="si">:</span><span class="s2">&gt;10</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">'module'</span><span class="si">:</span><span class="s2">&lt;45</span><span class="si">}{</span><span class="s1">'arguments'</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>    <span class="n">ch</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span><span class="p">]</span>
<span></span>    <span class="n">layers</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">ch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># layers, savelist, ch out</span>
<span></span>    <span class="n">base_modules</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>
<span></span>        <span class="p">{</span>
<span></span>            <span class="n">Classify</span><span class="p">,</span>
<span></span>            <span class="n">Conv</span><span class="p">,</span>
<span></span>            <span class="n">ConvTranspose</span><span class="p">,</span>
<span></span>            <span class="n">GhostConv</span><span class="p">,</span>
<span></span>            <span class="n">Bottleneck</span><span class="p">,</span>
<span></span>            <span class="n">GhostBottleneck</span><span class="p">,</span>
<span></span>            <span class="n">SPP</span><span class="p">,</span>
<span></span>            <span class="n">SPPF</span><span class="p">,</span>
<span></span>            <span class="n">C2fPSA</span><span class="p">,</span>
<span></span>            <span class="n">C2PSA</span><span class="p">,</span>
<span></span>            <span class="n">DWConv</span><span class="p">,</span>
<span></span>            <span class="n">Focus</span><span class="p">,</span>
<span></span>            <span class="n">BottleneckCSP</span><span class="p">,</span>
<span></span>            <span class="n">C1</span><span class="p">,</span>
<span></span>            <span class="n">C2</span><span class="p">,</span>
<span></span>            <span class="n">C2f</span><span class="p">,</span>
<span></span>            <span class="n">C3k2</span><span class="p">,</span>
<span></span>            <span class="n">RepNCSPELAN4</span><span class="p">,</span>
<span></span>            <span class="n">ELAN1</span><span class="p">,</span>
<span></span>            <span class="n">ADown</span><span class="p">,</span>
<span></span>            <span class="n">AConv</span><span class="p">,</span>
<span></span>            <span class="n">SPPELAN</span><span class="p">,</span>
<span></span>            <span class="n">C2fAttn</span><span class="p">,</span>
<span></span>            <span class="n">C3</span><span class="p">,</span>
<span></span>            <span class="n">C3TR</span><span class="p">,</span>
<span></span>            <span class="n">C3Ghost</span><span class="p">,</span>
<span></span>            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">,</span>
<span></span>            <span class="n">DWConvTranspose2d</span><span class="p">,</span>
<span></span>            <span class="n">C3x</span><span class="p">,</span>
<span></span>            <span class="n">RepC3</span><span class="p">,</span>
<span></span>            <span class="n">PSA</span><span class="p">,</span>
<span></span>            <span class="n">SCDown</span><span class="p">,</span>
<span></span>            <span class="n">C2fCIB</span><span class="p">,</span>
<span></span>            <span class="n">A2C2f</span><span class="p">,</span>
<span></span>        <span class="p">}</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">repeat_modules</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span>  <span class="c1"># modules with 'repeat' arguments</span>
<span></span>        <span class="p">{</span>
<span></span>            <span class="n">BottleneckCSP</span><span class="p">,</span>
<span></span>            <span class="n">C1</span><span class="p">,</span>
<span></span>            <span class="n">C2</span><span class="p">,</span>
<span></span>            <span class="n">C2f</span><span class="p">,</span>
<span></span>            <span class="n">C3k2</span><span class="p">,</span>
<span></span>            <span class="n">C2fAttn</span><span class="p">,</span>
<span></span>            <span class="n">C3</span><span class="p">,</span>
<span></span>            <span class="n">C3TR</span><span class="p">,</span>
<span></span>            <span class="n">C3Ghost</span><span class="p">,</span>
<span></span>            <span class="n">C3x</span><span class="p">,</span>
<span></span>            <span class="n">RepC3</span><span class="p">,</span>
<span></span>            <span class="n">C2fPSA</span><span class="p">,</span>
<span></span>            <span class="n">C2fCIB</span><span class="p">,</span>
<span></span>            <span class="n">C2PSA</span><span class="p">,</span>
<span></span>            <span class="n">A2C2f</span><span class="p">,</span>
<span></span>        <span class="p">}</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">"backbone"</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s2">"head"</span><span class="p">]):</span>  <span class="c1"># from, number, module, args</span>
<span></span>        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="nb">getattr</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
<span></span>            <span class="k">if</span> <span class="s2">"nn."</span> <span class="ow">in</span> <span class="n">m</span>
<span></span>            <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="s2">"torchvision"</span><span class="p">)</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">16</span><span class="p">:])</span>
<span></span>            <span class="k">if</span> <span class="s2">"torchvision.ops."</span> <span class="ow">in</span> <span class="n">m</span>
<span></span>            <span class="k">else</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">m</span><span class="p">]</span>
<span></span>        <span class="p">)</span>  <span class="c1"># get module</span>
<span></span>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span></span>                <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span></span>                    <span class="n">args</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">a</span><span class="p">]</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">else</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span></span>        <span class="n">n</span> <span class="o">=</span> <span class="n">n_</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">depth</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span>  <span class="c1"># depth gain</span>
<span></span>        <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">base_modules</span><span class="p">:</span>
<span></span>            <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="k">if</span> <span class="n">c2</span> <span class="o">!=</span> <span class="n">nc</span><span class="p">:</span>  <span class="c1"># if c2 not equal to number of classes (i.e. for Classify() output)</span>
<span></span>                <span class="n">c2</span> <span class="o">=</span> <span class="n">make_divisible</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">max_channels</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">C2fAttn</span><span class="p">:</span>  <span class="c1"># set 1) embed channels and 2) num heads</span>
<span></span>                <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_divisible</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_channels</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span></span>                <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_channels</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">//</span> <span class="mi">32</span><span class="p">))</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span></span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">repeat_modules</span><span class="p">:</span>
<span></span>                <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># number of repeats</span>
<span></span>                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">C3k2</span><span class="p">:</span>  <span class="c1"># for M/L/X sizes</span>
<span></span>                <span class="n">legacy</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>                <span class="k">if</span> <span class="n">scale</span> <span class="ow">in</span> <span class="s2">"mlx"</span><span class="p">:</span>
<span></span>                    <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">A2C2f</span><span class="p">:</span>
<span></span>                <span class="n">legacy</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>                <span class="k">if</span> <span class="n">scale</span> <span class="ow">in</span> <span class="s2">"lx"</span><span class="p">:</span>  <span class="c1"># for L/X sizes</span>
<span></span>                    <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="kc">True</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">C2fCIB</span><span class="p">:</span>
<span></span>                <span class="n">legacy</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">AIFI</span><span class="p">:</span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">]</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">frozenset</span><span class="p">({</span><span class="n">HGStem</span><span class="p">,</span> <span class="n">HGBlock</span><span class="p">}):</span>
<span></span>            <span class="n">c1</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">HGBlock</span><span class="p">:</span>
<span></span>                <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># number of repeats</span>
<span></span>                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">ResNetLayer</span><span class="p">:</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">else</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">:</span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">]]</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">Concat</span><span class="p">:</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">frozenset</span><span class="p">(</span>
<span></span>            <span class="p">{</span><span class="n">Detect</span><span class="p">,</span> <span class="n">WorldDetect</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">,</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">YOLOESegment</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">OBB</span><span class="p">,</span> <span class="n">ImagePoolingAttn</span><span class="p">,</span> <span class="n">v10Detect</span><span class="p">}</span>
<span></span>        <span class="p">):</span>
<span></span>            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">])</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">Segment</span> <span class="ow">or</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">YOLOESegment</span><span class="p">:</span>
<span></span>                <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_divisible</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_channels</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">{</span><span class="n">Detect</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">,</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">YOLOESegment</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">OBB</span><span class="p">}:</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="n">legacy</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">RTDETRDecoder</span><span class="p">:</span>  <span class="c1"># special case, channels arg must be passed in index 1</span>
<span></span>            <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">])</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">CBLinear</span><span class="p">:</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="n">c1</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="n">CBFuse</span><span class="p">:</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span></span>        <span class="k">elif</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">frozenset</span><span class="p">({</span><span class="n">TorchVision</span><span class="p">,</span> <span class="n">Index</span><span class="p">}):</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="n">c1</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
<span></span>            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span></span>        <span class="k">else</span><span class="p">:</span>
<span></span>            <span class="n">c2</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
<span></span>
<span></span>        <span class="n">m_</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">m</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># module</span>
<span></span>        <span class="n">t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"__main__."</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>  <span class="c1"># module type</span>
<span></span>        <span class="n">m_</span><span class="o">.</span><span class="n">np</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m_</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>  <span class="c1"># number params</span>
<span></span>        <span class="n">m_</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">m_</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">m_</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span>  <span class="c1"># attach index, 'from' index, type</span>
<span></span>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}{</span><span class="n">f</span><span class="si">!s:</span><span class="s2">&gt;20</span><span class="si">}{</span><span class="n">n_</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}{</span><span class="n">m_</span><span class="o">.</span><span class="n">np</span><span class="si">:</span><span class="s2">10.0f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">&lt;45</span><span class="si">}{</span><span class="n">args</span><span class="si">!s:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># print</span>
<span></span>        <span class="n">save</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">([</span><span class="n">f</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># append to savelist</span>
<span></span>        <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span></span>            <span class="n">ch</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>        <span class="n">ch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">layers</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.yaml_model_load"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.yaml_model_load</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">yaml_model_load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div><p>Load a YOLOv8 model from a YAML file.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>path</code></td><td><code>str | Path</code></td><td>Path to the YAML file.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dict</code></td><td>Model dictionary.</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1663-L1683"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">yaml_model_load</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Load a YOLOv8 model from a YAML file.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        path (str | Path): Path to the YAML file.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (dict): Model dictionary.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">stem</span> <span class="ow">in</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"yolov</span><span class="si">{</span><span class="n">d</span><span class="si">}{</span><span class="n">x</span><span class="si">}</span><span class="s2">6"</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">"nsmlx"</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
<span></span>        <span class="n">new_stem</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(\d+)([nslmx])6(.+)?$"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">"\1\2-p6\3"</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ultralytics YOLO P6 models now use -p6 suffix. Renaming </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_stem</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
<span></span>        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">new_stem</span> <span class="o">+</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">unified_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(\d+)([nslmx])(.+)?$"</span><span class="p">,</span> <span class="sa">r</span><span class="s2">"\1\3"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>  <span class="c1"># i.e. yolov8x.yaml -&gt; yolov8.yaml</span>
<span></span>    <span class="n">yaml_file</span> <span class="o">=</span> <span class="n">check_yaml</span><span class="p">(</span><span class="n">unified_path</span><span class="p">,</span> <span class="n">hard</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">check_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span></span>    <span class="n">d</span> <span class="o">=</span> <span class="n">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">)</span>  <span class="c1"># model dict</span>
<span></span>    <span class="n">d</span><span class="p">[</span><span class="s2">"scale"</span><span class="p">]</span> <span class="o">=</span> <span class="n">guess_model_scale</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span></span>    <span class="n">d</span><span class="p">[</span><span class="s2">"yaml_file"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.guess_model_scale"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.guess_model_scale</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">guess_model_scale</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</code></pre></div><p>Extract the size character n, s, m, l, or x of the model's scale from the model path.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>model_path</code></td><td><code>str | Path</code></td><td>The path to the YOLO model's YAML file.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>str</code></td><td>The size character of the model's scale (n, s, m, l, or x).</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1686-L1698"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">guess_model_scale</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Extract the size character n, s, m, l, or x of the model's scale from the model path.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        model_path (str | Path): The path to the YOLO model's YAML file.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (str): The size character of the model's scale (n, s, m, l, or x).</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"yolo(e-)?[v]?\d+([nslmx])"</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<span></span>        <span class="k">return</span> <span class="s2">""</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.nn.tasks.guess_model_task"><span class="doc-kind doc-kind-function">function</span> <code>ultralytics.nn.tasks.guess_model_task</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">guess_model_task</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div><p>Guess the task of a PyTorch model from its architecture or configuration.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>model</code></td><td><code>torch.nn.Module | dict</code></td><td>PyTorch model or model configuration in YAML format.</td><td><em>required</em></td></tr></tbody></table><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>str</code></td><td>Task of the model ('detect', 'segment', 'classify', 'pose', 'obb').</td></tr></tbody></table><details><summary>Source code in <code>ultralytics/nn/tasks.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/nn/tasks.py#L1701-L1768"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">guess_model_task</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Guess the task of a PyTorch model from its architecture or configuration.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        model (torch.nn.Module | dict): PyTorch model or model configuration in YAML format.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (str): Task of the model ('detect', 'segment', 'classify', 'pose', 'obb').</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">cfg2task</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Guess from YAML dictionary."""</span>
<span></span>        <span class="n">m</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">"head"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># output module name</span>
<span></span>        <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"classify"</span><span class="p">,</span> <span class="s2">"classifier"</span><span class="p">,</span> <span class="s2">"cls"</span><span class="p">,</span> <span class="s2">"fc"</span><span class="p">}:</span>
<span></span>            <span class="k">return</span> <span class="s2">"classify"</span>
<span></span>        <span class="k">if</span> <span class="s2">"detect"</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"detect"</span>
<span></span>        <span class="k">if</span> <span class="s2">"segment"</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"segment"</span>
<span></span>        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">"pose"</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"pose"</span>
<span></span>        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">"obb"</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"obb"</span>
<span></span>
<span></span>    <span class="c1"># Guess from model cfg</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<span></span>        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span></span>            <span class="k">return</span> <span class="n">cfg2task</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span></span>    <span class="c1"># Guess from PyTorch model</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>  <span class="c1"># PyTorch model</span>
<span></span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">"model.args"</span><span class="p">,</span> <span class="s2">"model.model.args"</span><span class="p">,</span> <span class="s2">"model.model.model.args"</span><span class="p">:</span>
<span></span>            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span></span>                <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="s2">"task"</span><span class="p">]</span>  <span class="c1"># nosec B307: safe eval of known attribute paths</span>
<span></span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">"model.yaml"</span><span class="p">,</span> <span class="s2">"model.model.yaml"</span><span class="p">,</span> <span class="s2">"model.model.model.yaml"</span><span class="p">:</span>
<span></span>            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span></span>                <span class="k">return</span> <span class="n">cfg2task</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># nosec B307: safe eval of known attribute paths</span>
<span></span>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
<span></span>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">Segment</span><span class="p">,</span> <span class="n">YOLOESegment</span><span class="p">)):</span>
<span></span>                <span class="k">return</span> <span class="s2">"segment"</span>
<span></span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Classify</span><span class="p">):</span>
<span></span>                <span class="k">return</span> <span class="s2">"classify"</span>
<span></span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Pose</span><span class="p">):</span>
<span></span>                <span class="k">return</span> <span class="s2">"pose"</span>
<span></span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">OBB</span><span class="p">):</span>
<span></span>                <span class="k">return</span> <span class="s2">"obb"</span>
<span></span>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">Detect</span><span class="p">,</span> <span class="n">WorldDetect</span><span class="p">,</span> <span class="n">YOLOEDetect</span><span class="p">,</span> <span class="n">v10Detect</span><span class="p">)):</span>
<span></span>                <span class="k">return</span> <span class="s2">"detect"</span>
<span></span>
<span></span>    <span class="c1"># Guess from model filename</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
<span></span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="s2">"-seg"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">stem</span> <span class="ow">or</span> <span class="s2">"segment"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"segment"</span>
<span></span>        <span class="k">elif</span> <span class="s2">"-cls"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">stem</span> <span class="ow">or</span> <span class="s2">"classify"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"classify"</span>
<span></span>        <span class="k">elif</span> <span class="s2">"-pose"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">stem</span> <span class="ow">or</span> <span class="s2">"pose"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"pose"</span>
<span></span>        <span class="k">elif</span> <span class="s2">"-obb"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">stem</span> <span class="ow">or</span> <span class="s2">"obb"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"obb"</span>
<span></span>        <span class="k">elif</span> <span class="s2">"detect"</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
<span></span>            <span class="k">return</span> <span class="s2">"detect"</span>
<span></span>
<span></span>    <span class="c1"># Unable to determine task from model</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>        <span class="s2">"Unable to automatically guess model task, assuming 'task=detect'. "</span>
<span></span>        <span class="s2">"Explicitly define task for your model, i.e. 'task=detect', 'segment', 'classify','pose' or 'obb'."</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="s2">"detect"</span>  <span class="c1"># assume detect</span>
</code></pre></div></details><p><br/><br/></p><br/><br/><div class="git-info"><div class="dates-container"><span class="date-item" title="This page was first created on November 12, 2023"><span class="hover-item">ğŸ“…</span> Created 2 years ago </span><span class="date-item" title="This page was last updated on November 23, 2025"><span class="hover-item">âœï¸</span> Updated 27 days ago </span></div><div class="authors-container"><a class="author-link" href="https://github.com/glenn-jocher" title="glenn-jocher (12 changes)"><img alt="glenn-jocher" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/26833433?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/RizwanMunawar" title="RizwanMunawar (1 change)"><img alt="RizwanMunawar" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62513924?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/jk4e" title="jk4e (1 change)"><img alt="jk4e" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/116908874?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/Burhan-Q" title="Burhan-Q (1 change)"><img alt="Burhan-Q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62214284?v=4&amp;s=96"/></a></div></div><div class="share-buttons"><button class="share-button hover-item" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fnn%2Ftasks%2F', 'TwitterShare', 'width=550,height=680,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-x-twitter"></i> Tweet </button><button class="share-button hover-item linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fnn%2Ftasks%2F', 'LinkedinShare', 'width=550,height=730,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-linkedin-in"></i> Share </button></div><br/></article></div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div><button class="md-top md-icon" data-md-component="top" hidden="" type="button"><svg class="lucide lucide-circle-arrow-up" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4M12 16V8"></path></svg> Back to top
</button></main><footer class="md-footer"><nav aria-label="Footer" class="md-footer__inner md-grid"><a aria-label="Previous: utils" class="md-footer__link md-footer__link--prev" href="../modules/utils/"><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-left" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 19-7-7 7-7M19 12H5"></path></svg></div><div class="md-footer__title"><span class="md-footer__direction"> Previous </span><div class="md-ellipsis"> utils </div></div></a><a aria-label="Next: text_model" class="md-footer__link md-footer__link--next" href="../text_model/"><div class="md-footer__title"><span class="md-footer__direction"> Next </span><div class="md-ellipsis"> text_model </div></div><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14M12 5l7 7-7 7"></path></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-copyright"><div class="md-copyright__highlight"><a href="https://www.ultralytics.com/" target="_blank">Â© 2025 Ultralytics Inc.</a> All rights reserved. </div> Made with <a href="https://zensical.org/" rel="noopener" target="_blank"> Zensical </a></div><div class="md-social"><a class="md-social__link" href="https://github.com/ultralytics" rel="noopener" target="_blank" title="github.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://www.linkedin.com/company/ultralytics/" rel="noopener" target="_blank" title="www.linkedin.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://x.com/ultralytics" rel="noopener" target="_blank" title="x.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://youtube.com/ultralytics?sub_confirmation=1" rel="noopener" target="_blank" title="youtube.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://hub.docker.com/r/ultralytics/ultralytics/" rel="noopener" target="_blank" title="hub.docker.com"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://pypi.org/project/ultralytics/" rel="noopener" target="_blank" title="pypi.org"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://discord.com/invite/ultralytics" rel="noopener" target="_blank" title="discord.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://reddit.com/r/ultralytics" rel="noopener" target="_blank" title="reddit.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://weixin.qq.com/r/mp/LxckPDfEgWr_rXNf90I9" rel="noopener" target="_blank" title="weixin.qq.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6" fill="currentColor"></path></svg></a></div></div></div></footer></div><div class="md-dialog" data-md-component="dialog"><div class="md-dialog__inner md-typeset"></div></div><div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate":null,"base":"../../..","features":["content.action.edit","content.code.annotate","content.code.copy","content.tooltips","toc.follow","navigation.top","navigation.tabs","navigation.tabs.sticky","navigation.prune","navigation.footer","navigation.tracking","navigation.instant","navigation.instant.progress","navigation.indexes","navigation.sections","content.tabs.link"],"search":"../../../assets/javascripts/workers/search.1bfe1b73.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
<script src="../../../assets/javascripts/bundle.6008f134.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ultralytics/llm@v0.1.8/js/chat.min.js"></script>
<script src="https://unpkg.com/tablesort@5.6.0/dist/tablesort.min.js"></script>
<script src="../../../javascript/extra.js"></script>
<script src="../../../javascript/giscus.js"></script>
<script src="../../../javascript/tablesort.js"></script>
</body></html>