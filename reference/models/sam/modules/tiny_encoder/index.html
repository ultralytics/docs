 <!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Explore the detailed implementation of TinyViT architecture including Conv2d_BN, PatchEmbed, MBConv, and more in Ultralytics." name="description"/><meta content="Ultralytics" name="author"/><link href="https://docs.ultralytics.com/reference/models/sam/modules/tiny_encoder/" rel="canonical"/><link href="../sam/" rel="prev"/><link href="../transformer/" rel="next"/><link href="/" hreflang="en" rel="alternate"/><link href="/zh/" hreflang="zh" rel="alternate"/><link href="/ko/" hreflang="ko" rel="alternate"/><link href="/ja/" hreflang="ja" rel="alternate"/><link href="/ru/" hreflang="ru" rel="alternate"/><link href="/de/" hreflang="de" rel="alternate"/><link href="/fr/" hreflang="fr" rel="alternate"/><link href="/es/" hreflang="es" rel="alternate"/><link href="/pt/" hreflang="pt" rel="alternate"/><link href="/it/" hreflang="it" rel="alternate"/><link href="/tr/" hreflang="tr" rel="alternate"/><link href="/vi/" hreflang="vi" rel="alternate"/><link href="/ar/" hreflang="ar" rel="alternate"/><link href="https://raw.githubusercontent.com/ultralytics/assets/refs/heads/main/logo/favicon-yolo.png" rel="icon"/><meta content="zensical-0.0.9" name="generator"/><title>Reference for ultralytics/models/sam/modules/tiny_encoder.py</title><link href="../../../../../assets/stylesheets/modern/main.2644c6b7.min.css" rel="stylesheet"/><link href="../../../../../assets/stylesheets/modern/palette.dfe2e883.min.css" rel="stylesheet"/><style>:root{}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link href="../../../../../stylesheets/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2M5EHKC0BH"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2M5EHKC0BH",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2M5EHKC0BH",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<style data-doc-kind="true">.doc-kind{display:inline-flex;align-items:center;gap:0.25em;padding:0.21em 0.59em;border-radius:999px;font-weight:700;font-size:0.81em;letter-spacing:0.06em;text-transform:uppercase;line-height:1;color:var(--doc-kind-color,#f8fafc);background:var(--doc-kind-bg,rgba(255,255,255,0.12));}.doc-kind-class{--doc-kind-color:#039dfc;--doc-kind-bg:rgba(3,157,252,0.22);}.doc-kind-function{--doc-kind-color:#fc9803;--doc-kind-bg:rgba(252,152,3,0.22);}.doc-kind-method{--doc-kind-color:#ef5eff;--doc-kind-bg:rgba(239,94,255,0.22);}.doc-kind-property{--doc-kind-color:#02e835;--doc-kind-bg:rgba(2,232,53,0.22);}</style><meta content="Reference for ultralytics/models/sam/modules/tiny_encoder.py" name="title"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/><meta content="website" property="og:type"/><meta content="https://docs.ultralytics.com/reference/models/sam/modules/tiny_encoder/" property="og:url"/><meta content="Reference for ultralytics/models/sam/modules/tiny_encoder.py" property="og:title"/><meta content="" property="og:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="og:image"/><meta content="summary_large_image" property="twitter:card"/><meta content="https://docs.ultralytics.com/reference/models/sam/modules/tiny_encoder/" property="twitter:url"/><meta content="Reference for ultralytics/models/sam/modules/tiny_encoder.py" property="twitter:title"/><meta content="" property="twitter:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="twitter:image"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "headline": "Reference for ultralytics/models/sam/modules/tiny_encoder.py", "image": ["https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png"], "datePublished": "2023-11-12 02:49:37 +0100", "dateModified": "2025-11-23 19:53:50 +0100", "author": [{"@type": "Organization", "name": "Ultralytics", "url": "https://ultralytics.com/"}], "abstract": ""}</script></head><body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"><input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/><input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/><label class="md-overlay" for="__drawer"></label><div data-md-component="skip"><a class="md-skip" href="#reference-for-ultralyticsmodelssammodulestiny_encoderpy"> Skip to content </a></div><div data-md-component="announce"><aside class="md-banner"><div class="md-banner__inner md-grid md-typeset"><a class="banner-wrapper" href="https://www.ultralytics.com/news/ultralytics-raises-30m-series-a" target="_blank"><div class="banner-content-wrapper"><img alt="Ultralytics raises $30M Series A" height="40" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac336b5de2ae8b398bca_writting.svg"/><div class="vc-wrapper"><img alt="Elephant" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac33c95408144846afc7_image%201.png"/><img alt="SquareOne" height="28" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/691dac3333068d9632cc6df8_image%202.png"/></div></div></a></div></aside></div><header class="md-header md-header--shadow md-header--lifted" data-md-component="header"><nav aria-label="Header" class="md-header__inner md-grid"><a aria-label="Ultralytics YOLO Docs" class="md-header__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a><label class="md-header__button md-icon" for="__drawer"><svg class="lucide lucide-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 5h16M4 12h16M4 19h16"></path></svg></label><div class="md-header__title" data-md-component="header-title"><div class="md-header__ellipsis"><div class="md-header__topic"><span class="md-ellipsis"> Ultralytics YOLO Docs </span></div><div class="md-header__topic" data-md-component="header-topic"><span class="md-ellipsis"> Reference for ultralytics/models/sam/modules/tiny_encoder.py </span></div></div></div><form class="md-header__option" data-md-component="palette"><input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg></label><input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label><input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/><label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg></label></form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option"><div class="md-select"><button aria-label="Select language" class="md-header__button md-icon"><svg class="lucide lucide-languages" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m5 8 6 6M4 14l6-6 2-3M2 5h12M7 2h1M22 22l-5-10-5 10M14 18h6"></path></svg></button><div class="md-select__inner"><ul class="md-select__list"><li class="md-select__item"><a class="md-select__link" href="/" hreflang="en"> ğŸ‡¬ğŸ‡§ English </a></li><li class="md-select__item"><a class="md-select__link" href="/zh/" hreflang="zh"> ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡ </a></li><li class="md-select__item"><a class="md-select__link" href="/ko/" hreflang="ko"> ğŸ‡°ğŸ‡· í•œêµ­ì–´ </a></li><li class="md-select__item"><a class="md-select__link" href="/ja/" hreflang="ja"> ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª </a></li><li class="md-select__item"><a class="md-select__link" href="/ru/" hreflang="ru"> ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹ </a></li><li class="md-select__item"><a class="md-select__link" href="/de/" hreflang="de"> ğŸ‡©ğŸ‡ª Deutsch </a></li><li class="md-select__item"><a class="md-select__link" href="/fr/" hreflang="fr"> ğŸ‡«ğŸ‡· FranÃ§ais </a></li><li class="md-select__item"><a class="md-select__link" href="/es/" hreflang="es"> ğŸ‡ªğŸ‡¸ EspaÃ±ol </a></li><li class="md-select__item"><a class="md-select__link" href="/pt/" hreflang="pt"> ğŸ‡µğŸ‡¹ PortuguÃªs </a></li><li class="md-select__item"><a class="md-select__link" href="/it/" hreflang="it"> ğŸ‡®ğŸ‡¹ Italiano </a></li><li class="md-select__item"><a class="md-select__link" href="/tr/" hreflang="tr"> ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e </a></li><li class="md-select__item"><a class="md-select__link" href="/vi/" hreflang="vi"> ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t </a></li><li class="md-select__item"><a class="md-select__link" href="/ar/" hreflang="ar"> ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© </a></li></ul></div></div></div><label class="md-header__button md-icon" for="__search"><svg class="lucide lucide-search" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m21 21-4.34-4.34"></path><circle cx="11" cy="11" r="8"></circle></svg></label><div aria-label="Search" class="md-search" data-md-component="search" role="dialog"><button class="md-search__button" type="button"> Search </button></div><div class="md-header__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div></nav><nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"><div class="md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../.."> Home </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../quickstart/"> Quickstart </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../modes/"> Modes </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../tasks/"> Tasks </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../models/"> Models </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../datasets/"> Datasets </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../solutions/"> Solutions </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../guides/"> Guides </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../integrations/"> Integrations </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../hub/"> HUB </a></li><li class="md-tabs__item md-tabs__item--active"><a class="md-tabs__link" href="../../../../__init__/"> Reference </a></li><li class="md-tabs__item"><a class="md-tabs__link" href="../../../../../help/"> Help </a></li></ul></div></nav></header><div class="md-container" data-md-component="container"><main class="md-main" data-md-component="main"><div class="md-main__inner md-grid"><div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0"><label class="md-nav__title" for="__drawer"><a aria-label="Ultralytics YOLO Docs" class="md-nav__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs"><img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/></a> Ultralytics YOLO Docs </label><div class="md-nav__source"><a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository"><div class="md-source__icon md-icon"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></div><div class="md-source__repository"> ultralytics/ultralytics </div></a></div><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../.."><span class="md-ellipsis"> Home </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../quickstart/"><span class="md-ellipsis"> Quickstart </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../modes/"><span class="md-ellipsis"> Modes </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../tasks/"><span class="md-ellipsis"> Tasks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../models/"><span class="md-ellipsis"> Models </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../datasets/"><span class="md-ellipsis"> Datasets </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../solutions/"><span class="md-ellipsis"> Solutions </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../guides/"><span class="md-ellipsis"> Guides </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../integrations/"><span class="md-ellipsis"> Integrations </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../hub/"><span class="md-ellipsis"> HUB </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/><label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex=""><span class="md-ellipsis"> Reference </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1"><label class="md-nav__title" for="__nav_11"><span class="md-nav__icon md-icon"></span> Reference </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_2" type="checkbox"/><label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex=""><span class="md-ellipsis"> cfg </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_2_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_2"><span class="md-nav__icon md-icon"></span> cfg </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../cfg/__init__/"><span class="md-ellipsis"> __init__ </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_3" type="checkbox"/><label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex=""><span class="md-ellipsis"> data </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_3_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_3"><span class="md-nav__icon md-icon"></span> data </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/annotator/"><span class="md-ellipsis"> annotator </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/augment/"><span class="md-ellipsis"> augment </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/base/"><span class="md-ellipsis"> base </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/build/"><span class="md-ellipsis"> build </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/converter/"><span class="md-ellipsis"> converter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/dataset/"><span class="md-ellipsis"> dataset </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/loaders/"><span class="md-ellipsis"> loaders </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/split/"><span class="md-ellipsis"> split </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/split_dota/"><span class="md-ellipsis"> split_dota </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../data/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_4" type="checkbox"/><label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex=""><span class="md-ellipsis"> engine </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_4_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_4"><span class="md-nav__icon md-icon"></span> engine </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/exporter/"><span class="md-ellipsis"> exporter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/model/"><span class="md-ellipsis"> model </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/predictor/"><span class="md-ellipsis"> predictor </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/results/"><span class="md-ellipsis"> results </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/trainer/"><span class="md-ellipsis"> trainer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/tuner/"><span class="md-ellipsis"> tuner </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../engine/validator/"><span class="md-ellipsis"> validator </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_5" type="checkbox"/><label class="md-nav__link" for="__nav_11_5" id="__nav_11_5_label" tabindex=""><span class="md-ellipsis"> hub </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_5_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_5"><span class="md-nav__icon md-icon"></span> hub </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../hub/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../hub/auth/"><span class="md-ellipsis"> auth </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../hub/google/__init__/"><span class="md-ellipsis"> google </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../hub/session/"><span class="md-ellipsis"> session </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../hub/utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_6" type="checkbox"/><label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex=""><span class="md-ellipsis"> models </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_6_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_6"><span class="md-nav__icon md-icon"></span> models </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../fastsam/model/"><span class="md-ellipsis"> fastsam </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../nas/model/"><span class="md-ellipsis"> nas </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../rtdetr/model/"><span class="md-ellipsis"> rtdetr </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_6_4" type="checkbox"/><label class="md-nav__link" for="__nav_11_6_4" id="__nav_11_6_4_label" tabindex="0"><span class="md-ellipsis"> sam </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_6_4_label" class="md-nav" data-md-level="3"><label class="md-nav__title" for="__nav_11_6_4"><span class="md-nav__icon md-icon"></span> sam </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../amg/"><span class="md-ellipsis"> amg </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../build/"><span class="md-ellipsis"> build </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../model/"><span class="md-ellipsis"> model </span></a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input checked="" class="md-nav__toggle md-toggle" id="__nav_11_6_4_4" type="checkbox"/><label class="md-nav__link" for="__nav_11_6_4_4" id="__nav_11_6_4_4_label" tabindex="0"><span class="md-ellipsis"> modules </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="true" aria-labelledby="__nav_11_6_4_4_label" class="md-nav" data-md-level="4"><label class="md-nav__title" for="__nav_11_6_4_4"><span class="md-nav__icon md-icon"></span> modules </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../blocks/"><span class="md-ellipsis"> blocks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../decoders/"><span class="md-ellipsis"> decoders </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../encoders/"><span class="md-ellipsis"> encoders </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../memory_attention/"><span class="md-ellipsis"> memory_attention </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../sam/"><span class="md-ellipsis"> sam </span></a></li><li class="md-nav__item md-nav__item--active"><input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/><label class="md-nav__link md-nav__link--active" for="__toc"><span class="md-ellipsis"> tiny_encoder </span><span class="md-nav__icon md-icon"></span></label><a class="md-nav__link md-nav__link--active" href="./"><span class="md-ellipsis"> tiny_encoder </span></a><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Conv2d_BN"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Conv2d_BN</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PatchEmbed</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.PatchEmbed" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MBConv"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> MBConv</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.MBConv" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MBConv.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PatchMerging</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.PatchMerging" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> ConvLayer</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.ConvLayer" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MLP"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> MLP</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.MLP" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MLP.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Attention</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.Attention" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention.train"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> train</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> TinyViTBlock</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> extra_repr</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> BasicLayer</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.BasicLayer" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> extra_repr</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> TinyViT</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.TinyViT" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _init_weights</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_features</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> no_weight_decay_keywords</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_imgsz</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_layer_lr_decay</span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="../transformer/"><span class="md-ellipsis"> transformer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../utils/"><span class="md-ellipsis"> utils </span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="../../predict/"><span class="md-ellipsis"> predict </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../utils/loss/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../yolo/classify/predict/"><span class="md-ellipsis"> yolo </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_7" type="checkbox"/><label class="md-nav__link" for="__nav_11_7" id="__nav_11_7_label" tabindex=""><span class="md-ellipsis"> nn </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_7_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_7"><span class="md-nav__icon md-icon"></span> nn </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../nn/autobackend/"><span class="md-ellipsis"> autobackend </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../nn/modules/activation/"><span class="md-ellipsis"> modules </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../nn/tasks/"><span class="md-ellipsis"> tasks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../nn/text_model/"><span class="md-ellipsis"> text_model </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_8" type="checkbox"/><label class="md-nav__link" for="__nav_11_8" id="__nav_11_8_label" tabindex=""><span class="md-ellipsis"> solutions </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_8_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_8"><span class="md-nav__icon md-icon"></span> solutions </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/ai_gym/"><span class="md-ellipsis"> ai_gym </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/analytics/"><span class="md-ellipsis"> analytics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/config/"><span class="md-ellipsis"> config </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/distance_calculation/"><span class="md-ellipsis"> distance_calculation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/heatmap/"><span class="md-ellipsis"> heatmap </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/instance_segmentation/"><span class="md-ellipsis"> instance_segmentation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/object_blurrer/"><span class="md-ellipsis"> object_blurrer </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/object_counter/"><span class="md-ellipsis"> object_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/object_cropper/"><span class="md-ellipsis"> object_cropper </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/parking_management/"><span class="md-ellipsis"> parking_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/queue_management/"><span class="md-ellipsis"> queue_management </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/region_counter/"><span class="md-ellipsis"> region_counter </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/security_alarm/"><span class="md-ellipsis"> security_alarm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/similarity_search/"><span class="md-ellipsis"> similarity_search </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/solutions/"><span class="md-ellipsis"> solutions </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/speed_estimation/"><span class="md-ellipsis"> speed_estimation </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/streamlit_inference/"><span class="md-ellipsis"> streamlit_inference </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/trackzone/"><span class="md-ellipsis"> trackzone </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../solutions/vision_eye/"><span class="md-ellipsis"> vision_eye </span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_9" type="checkbox"/><label class="md-nav__link" for="__nav_11_9" id="__nav_11_9_label" tabindex=""><span class="md-ellipsis"> trackers </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_9_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_9"><span class="md-nav__icon md-icon"></span> trackers </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../trackers/basetrack/"><span class="md-ellipsis"> basetrack </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../trackers/bot_sort/"><span class="md-ellipsis"> bot_sort </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../trackers/byte_tracker/"><span class="md-ellipsis"> byte_tracker </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../trackers/track/"><span class="md-ellipsis"> track </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../trackers/utils/gmc/"><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></li><li class="md-nav__item md-nav__item--section md-nav__item--nested"><input class="md-nav__toggle md-toggle" id="__nav_11_10" type="checkbox"/><label class="md-nav__link" for="__nav_11_10" id="__nav_11_10_label" tabindex=""><span class="md-ellipsis"> utils </span><span class="md-nav__icon md-icon"></span></label><nav aria-expanded="false" aria-labelledby="__nav_11_10_label" class="md-nav" data-md-level="2"><label class="md-nav__title" for="__nav_11_10"><span class="md-nav__icon md-icon"></span> utils </label><ul class="md-nav__list" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/__init__/"><span class="md-ellipsis"> __init__ </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/autobatch/"><span class="md-ellipsis"> autobatch </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/autodevice/"><span class="md-ellipsis"> autodevice </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/benchmarks/"><span class="md-ellipsis"> benchmarks </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../utils/callbacks/base/"><span class="md-ellipsis"> callbacks </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/checks/"><span class="md-ellipsis"> checks </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/cpu/"><span class="md-ellipsis"> cpu </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/dist/"><span class="md-ellipsis"> dist </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/downloads/"><span class="md-ellipsis"> downloads </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/errors/"><span class="md-ellipsis"> errors </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/events/"><span class="md-ellipsis"> events </span></a></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../utils/export/engine/"><span class="md-ellipsis"> export </span><span class="md-nav__icon md-icon"></span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/files/"><span class="md-ellipsis"> files </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/git/"><span class="md-ellipsis"> git </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/instance/"><span class="md-ellipsis"> instance </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/logger/"><span class="md-ellipsis"> logger </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/loss/"><span class="md-ellipsis"> loss </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/metrics/"><span class="md-ellipsis"> metrics </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/nms/"><span class="md-ellipsis"> nms </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/ops/"><span class="md-ellipsis"> ops </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/patches/"><span class="md-ellipsis"> patches </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/plotting/"><span class="md-ellipsis"> plotting </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/tal/"><span class="md-ellipsis"> tal </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/torch_utils/"><span class="md-ellipsis"> torch_utils </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/tqdm/"><span class="md-ellipsis"> tqdm </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/triton/"><span class="md-ellipsis"> triton </span></a></li><li class="md-nav__item"><a class="md-nav__link" href="../../../../utils/tuner/"><span class="md-ellipsis"> tuner </span></a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--pruned md-nav__item--nested"><a class="md-nav__link" href="../../../../../help/"><span class="md-ellipsis"> Help </span><span class="md-nav__icon md-icon"></span></a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav aria-label="On this page" class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc"><span class="md-nav__icon md-icon"></span> On this page </label><ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Conv2d_BN"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Conv2d_BN</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PatchEmbed</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.PatchEmbed" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MBConv"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> MBConv</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.MBConv" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MBConv.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> PatchMerging</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.PatchMerging" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> ConvLayer</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.ConvLayer" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MLP"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> MLP</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.MLP" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.MLP.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> Attention</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.Attention" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.Attention.train"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> train</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> TinyViTBlock</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> extra_repr</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> BasicLayer</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.BasicLayer" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> extra_repr</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li></ul></nav></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT"><span class="md-ellipsis"><span class="doc-kind doc-kind-class">class</span> TinyViT</span></a><nav aria-label="Class ultralytics.models.sam.modules.tiny_encoder.TinyViT" class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> _init_weights</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> forward_features</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> no_weight_decay_keywords</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_imgsz</span></a></li><li class="md-nav__item"><a class="md-nav__link" href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay"><span class="md-ellipsis"><span class="doc-kind doc-kind-method">method</span> set_layer_lr_decay</span></a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content" data-md-component="content"><article class="md-content__inner md-typeset"><a class="md-content__button md-icon" href="https://github.com/ultralytics/ultralytics/tree/main/docs/en/reference/models/sam/modules/tiny_encoder.md" rel="edit" title="Edit this page"><svg class="lucide lucide-file-pen" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5"></path><path d="M14 2v4a2 2 0 0 0 2 2h4M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"></path></svg></a><h1 id="reference-for-ultralyticsmodelssammodulestiny_encoderpy">Reference for <code>ultralytics/models/sam/modules/tiny_encoder.py</code></h1><div class="admonition success"><p class="admonition-title">Improvements</p><p>This page is sourced from <a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py">https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py</a>. Have an improvement or example to add? Open a <a href="https://docs.ultralytics.com/help/contributing/">Pull Request</a> â€” thank you! ğŸ™</p></div><p><br/></p><div class="admonition abstract"><p class="admonition-title">Summary</p><div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="classes" name="__tabbed_1" type="radio"/><input id="methods" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="classes"><span class="doc-kind doc-kind-class">Classes</span></label><label for="methods"><span class="doc-kind doc-kind-method">Methods</span></label></div><div class="tabbed-content"><div class="tabbed-block"><ul><li><a href="#ultralytics.models.sam.modules.tiny_encoder.Conv2d_BN"><code>Conv2d_BN</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed"><code>PatchEmbed</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.MBConv"><code>MBConv</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging"><code>PatchMerging</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer"><code>ConvLayer</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.MLP"><code>MLP</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.Attention"><code>Attention</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock"><code>TinyViTBlock</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer"><code>BasicLayer</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT"><code>TinyViT</code></a></li></ul></div><div class="tabbed-block"><ul><li><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward"><code>PatchEmbed.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.MBConv.forward"><code>MBConv.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward"><code>PatchMerging.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward"><code>ConvLayer.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.MLP.forward"><code>MLP.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.Attention.train"><code>Attention.train</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.Attention.forward"><code>Attention.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward"><code>TinyViTBlock.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr"><code>TinyViTBlock.extra_repr</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward"><code>BasicLayer.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr"><code>BasicLayer.extra_repr</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay"><code>TinyViT.set_layer_lr_decay</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights"><code>TinyViT._init_weights</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords"><code>TinyViT.no_weight_decay_keywords</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features"><code>TinyViT.forward_features</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward"><code>TinyViT.forward</code></a></li><li><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz"><code>TinyViT.set_imgsz</code></a></li></ul></div></div></div></div><h2 id="ultralytics.models.sam.modules.tiny_encoder.Conv2d_BN"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.Conv2d_BN</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">ks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span></span>    <span class="n">dilation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="n">groups</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="n">bn_weight_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>torch.nn.Sequential</code></p><p>A sequential container that performs 2D convolution followed by batch normalization.</p><p>This module combines a 2D convolution layer with batch normalization, providing a common building block for convolutional neural networks. The batch normalization weights and biases are initialized to specific values for optimal training performance.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>a</code></td><td><code>int</code></td><td>Number of input channels.</td><td><em>required</em></td></tr><tr><td><code>b</code></td><td><code>int</code></td><td>Number of output channels.</td><td><em>required</em></td></tr><tr><td><code>ks</code></td><td><code>int, optional</code></td><td>Kernel size for the convolution.</td><td><code>1</code></td></tr><tr><td><code>stride</code></td><td><code>int, optional</code></td><td>Stride for the convolution.</td><td><code>1</code></td></tr><tr><td><code>pad</code></td><td><code>int, optional</code></td><td>Padding for the convolution.</td><td><code>0</code></td></tr><tr><td><code>dilation</code></td><td><code>int, optional</code></td><td>Dilation factor for the convolution.</td><td><code>1</code></td></tr><tr><td><code>groups</code></td><td><code>int, optional</code></td><td>Number of groups for the convolution.</td><td><code>1</code></td></tr><tr><td><code>bn_weight_init</code></td><td><code>float, optional</code></td><td>Initial value for batch normalization weight.</td><td><code>1</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>c</code></td><td><code>torch.nn.Conv2d</code></td><td>2D convolution layer.</td></tr><tr><td><code>bn</code></td><td><code>torch.nn.BatchNorm2d</code></td><td>Batch normalization layer.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">conv_bn</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">conv_bn</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L24-L71"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Conv2d_BN</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""A sequential container that performs 2D convolution followed by batch normalization.</span>
<span></span>
<span></span><span class="sd">    This module combines a 2D convolution layer with batch normalization, providing a common building block for</span>
<span></span><span class="sd">    convolutional neural networks. The batch normalization weights and biases are initialized to specific values for</span>
<span></span><span class="sd">    optimal training performance.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        c (torch.nn.Conv2d): 2D convolution layer.</span>
<span></span><span class="sd">        bn (torch.nn.BatchNorm2d): Batch normalization layer.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; conv_bn = Conv2d_BN(3, 64, ks=3, stride=1, pad=1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; input_tensor = torch.randn(1, 3, 224, 224)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = conv_bn(input_tensor)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 64, 224, 224])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">ks</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>        <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>        <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span></span>        <span class="n">dilation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>        <span class="n">groups</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>        <span class="n">bn_weight_init</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize a sequential container with 2D convolution followed by batch normalization.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            a (int): Number of input channels.</span>
<span></span><span class="sd">            b (int): Number of output channels.</span>
<span></span><span class="sd">            ks (int, optional): Kernel size for the convolution.</span>
<span></span><span class="sd">            stride (int, optional): Stride for the convolution.</span>
<span></span><span class="sd">            pad (int, optional): Padding for the convolution.</span>
<span></span><span class="sd">            dilation (int, optional): Dilation factor for the convolution.</span>
<span></span><span class="sd">            groups (int, optional): Number of groups for the convolution.</span>
<span></span><span class="sd">            bn_weight_init (float, optional): Initial value for batch normalization weight.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">"c"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">ks</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">dilation</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span></span>        <span class="n">bn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span></span>        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">bn</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">bn_weight_init</span><span class="p">)</span>
<span></span>        <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">bn</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">"bn"</span><span class="p">,</span> <span class="n">bn</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.PatchEmbed"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.PatchEmbed</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">PatchEmbed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">activation</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Embed images into patches and project them into a specified embedding dimension.</p><p>This module converts input images into patch embeddings using a sequence of convolutional layers, effectively downsampling the spatial dimensions while increasing the channel dimension.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>in_chans</code></td><td><code>int</code></td><td>Number of input channels.</td><td><em>required</em></td></tr><tr><td><code>embed_dim</code></td><td><code>int</code></td><td>Dimension of the embedding.</td><td><em>required</em></td></tr><tr><td><code>resolution</code></td><td><code>int</code></td><td>Input image resolution.</td><td><em>required</em></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function to use between convolutions.</td><td><em>required</em></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>patches_resolution</code></td><td><code>tuple[int, int]</code></td><td>Resolution of the patches after embedding.</td></tr><tr><td><code>num_patches</code></td><td><code>int</code></td><td>Total number of patches.</td></tr><tr><td><code>in_chans</code></td><td><code>int</code></td><td>Number of input channels.</td></tr><tr><td><code>embed_dim</code></td><td><code>int</code></td><td>Dimension of the embedding.</td></tr><tr><td><code>seq</code></td><td><code>nn.Sequential</code></td><td>Sequence of convolutional and activation layers for patch embedding.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward"><code>forward</code></a></td><td>Process input tensor through patch embedding sequence, converting images to patch embeddings.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">patch_embed</span> <span class="o">=</span> <span class="n">PatchEmbed</span><span class="p">(</span><span class="n">in_chans</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">embed_dim</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">patch_embed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L74-L120"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PatchEmbed</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Embed images into patches and project them into a specified embedding dimension.</span>
<span></span>
<span></span><span class="sd">    This module converts input images into patch embeddings using a sequence of convolutional layers, effectively</span>
<span></span><span class="sd">    downsampling the spatial dimensions while increasing the channel dimension.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        patches_resolution (tuple[int, int]): Resolution of the patches after embedding.</span>
<span></span><span class="sd">        num_patches (int): Total number of patches.</span>
<span></span><span class="sd">        in_chans (int): Number of input channels.</span>
<span></span><span class="sd">        embed_dim (int): Dimension of the embedding.</span>
<span></span><span class="sd">        seq (nn.Sequential): Sequence of convolutional and activation layers for patch embedding.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; import torch</span>
<span></span><span class="sd">        &gt;&gt;&gt; patch_embed = PatchEmbed(in_chans=3, embed_dim=96, resolution=224, activation=nn.GELU)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(1, 3, 224, 224)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = patch_embed(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 96, 56, 56])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">embed_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">activation</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize patch embedding with convolutional layers for image-to-patch conversion and projection.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            in_chans (int): Number of input channels.</span>
<span></span><span class="sd">            embed_dim (int): Dimension of the embedding.</span>
<span></span><span class="sd">            resolution (int): Input image resolution.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function to use between convolutions.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="n">img_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_2tuple</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">in_chans</span> <span class="o">=</span> <span class="n">in_chans</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">embed_dim</span> <span class="o">=</span> <span class="n">embed_dim</span>
<span></span>        <span class="n">n</span> <span class="o">=</span> <span class="n">embed_dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span></span>            <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">in_chans</span><span class="p">,</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span></span>            <span class="n">activation</span><span class="p">(),</span>
<span></span>            <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span></span>        <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.PatchEmbed.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Process input tensor through patch embedding sequence, converting images to patch embeddings.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L118-L120"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process input tensor through patch embedding sequence, converting images to patch embeddings."""</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.MBConv"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.MBConv</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">MBConv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">out_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">expand_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Mobile Inverted Bottleneck Conv (MBConv) layer, part of the EfficientNet architecture.</p><p>This module implements the mobile inverted bottleneck convolution with expansion, depthwise convolution, and projection phases, along with residual connections for improved gradient flow.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>in_chans</code></td><td><code>int</code></td><td>Number of input channels.</td><td><em>required</em></td></tr><tr><td><code>out_chans</code></td><td><code>int</code></td><td>Number of output channels.</td><td><em>required</em></td></tr><tr><td><code>expand_ratio</code></td><td><code>float</code></td><td>Channel expansion ratio for the hidden layer.</td><td><em>required</em></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function to use.</td><td><em>required</em></td></tr><tr><td><code>drop_path</code></td><td><code>float</code></td><td>Drop path rate for stochastic depth.</td><td><em>required</em></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>in_chans</code></td><td><code>int</code></td><td>Number of input channels.</td></tr><tr><td><code>hidden_chans</code></td><td><code>int</code></td><td>Number of hidden channels after expansion.</td></tr><tr><td><code>out_chans</code></td><td><code>int</code></td><td>Number of output channels.</td></tr><tr><td><code>conv1</code></td><td><code>Conv2d_BN</code></td><td>First convolutional layer for channel expansion.</td></tr><tr><td><code>act1</code></td><td><code>nn.Module</code></td><td>First activation function.</td></tr><tr><td><code>conv2</code></td><td><code>Conv2d_BN</code></td><td>Depthwise convolutional layer.</td></tr><tr><td><code>act2</code></td><td><code>nn.Module</code></td><td>Second activation function.</td></tr><tr><td><code>conv3</code></td><td><code>Conv2d_BN</code></td><td>Final convolutional layer for projection.</td></tr><tr><td><code>act3</code></td><td><code>nn.Module</code></td><td>Third activation function.</td></tr><tr><td><code>drop_path</code></td><td><code>nn.Module</code></td><td>Drop path layer (Identity for inference).</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.MBConv.forward"><code>forward</code></a></td><td>Implement the forward pass of MBConv, applying convolutions and skip connection.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">in_chans</span><span class="p">,</span> <span class="n">out_chans</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">mbconv</span> <span class="o">=</span> <span class="n">MBConv</span><span class="p">(</span><span class="n">in_chans</span><span class="p">,</span> <span class="n">out_chans</span><span class="p">,</span> <span class="n">expand_ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">,</span> <span class="n">drop_path</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">in_chans</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">mbconv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L123-L188"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MBConv</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Mobile Inverted Bottleneck Conv (MBConv) layer, part of the EfficientNet architecture.</span>
<span></span>
<span></span><span class="sd">    This module implements the mobile inverted bottleneck convolution with expansion, depthwise convolution, and</span>
<span></span><span class="sd">    projection phases, along with residual connections for improved gradient flow.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        in_chans (int): Number of input channels.</span>
<span></span><span class="sd">        hidden_chans (int): Number of hidden channels after expansion.</span>
<span></span><span class="sd">        out_chans (int): Number of output channels.</span>
<span></span><span class="sd">        conv1 (Conv2d_BN): First convolutional layer for channel expansion.</span>
<span></span><span class="sd">        act1 (nn.Module): First activation function.</span>
<span></span><span class="sd">        conv2 (Conv2d_BN): Depthwise convolutional layer.</span>
<span></span><span class="sd">        act2 (nn.Module): Second activation function.</span>
<span></span><span class="sd">        conv3 (Conv2d_BN): Final convolutional layer for projection.</span>
<span></span><span class="sd">        act3 (nn.Module): Third activation function.</span>
<span></span><span class="sd">        drop_path (nn.Module): Drop path layer (Identity for inference).</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; in_chans, out_chans = 32, 64</span>
<span></span><span class="sd">        &gt;&gt;&gt; mbconv = MBConv(in_chans, out_chans, expand_ratio=4, activation=nn.ReLU, drop_path=0.1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(1, in_chans, 56, 56)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = mbconv(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 64, 56, 56])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">out_chans</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">expand_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">activation</span><span class="p">,</span> <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the MBConv layer with specified input/output channels, expansion ratio, and activation.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            in_chans (int): Number of input channels.</span>
<span></span><span class="sd">            out_chans (int): Number of output channels.</span>
<span></span><span class="sd">            expand_ratio (float): Channel expansion ratio for the hidden layer.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function to use.</span>
<span></span><span class="sd">            drop_path (float): Drop path rate for stochastic depth.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">in_chans</span> <span class="o">=</span> <span class="n">in_chans</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">in_chans</span> <span class="o">*</span> <span class="n">expand_ratio</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">out_chans</span> <span class="o">=</span> <span class="n">out_chans</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">in_chans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">act1</span> <span class="o">=</span> <span class="n">activation</span><span class="p">()</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">act2</span> <span class="o">=</span> <span class="n">activation</span><span class="p">()</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_chans</span><span class="p">,</span> <span class="n">out_chans</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bn_weight_init</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">act3</span> <span class="o">=</span> <span class="n">activation</span><span class="p">()</span>
<span></span>
<span></span>        <span class="c1"># NOTE: `DropPath` is needed only for training.</span>
<span></span>        <span class="c1"># self.drop_path = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">drop_path</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.MBConv.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.MBConv.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Implement the forward pass of MBConv, applying convolutions and skip connection.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L178-L188"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Implement the forward pass of MBConv, applying convolutions and skip connection."""</span>
<span></span>    <span class="n">shortcut</span> <span class="o">=</span> <span class="n">x</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">+=</span> <span class="n">shortcut</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">act3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.PatchMerging"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.PatchMerging</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="n">PatchMerging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">activation</span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Merge neighboring patches in the feature map and project to a new dimension.</p><p>This class implements a patch merging operation that combines spatial information and adjusts the feature dimension using a series of convolutional layers with batch normalization. It effectively reduces spatial resolution while potentially increasing channel dimensions.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>The input resolution (height, width) of the feature map.</td><td><em>required</em></td></tr><tr><td><code>dim</code></td><td><code>int</code></td><td>The input dimension of the feature map.</td><td><em>required</em></td></tr><tr><td><code>out_dim</code></td><td><code>int</code></td><td>The output dimension after merging and projection.</td><td><em>required</em></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>The activation function used between convolutions.</td><td><em>required</em></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>The input resolution (height, width) of the feature map.</td></tr><tr><td><code>dim</code></td><td><code>int</code></td><td>The input dimension of the feature map.</td></tr><tr><td><code>out_dim</code></td><td><code>int</code></td><td>The output dimension after merging and projection.</td></tr><tr><td><code>act</code></td><td><code>nn.Module</code></td><td>The activation function used between convolutions.</td></tr><tr><td><code>conv1</code></td><td><code>Conv2d_BN</code></td><td>The first convolutional layer for dimension projection.</td></tr><tr><td><code>conv2</code></td><td><code>Conv2d_BN</code></td><td>The second convolutional layer for spatial merging.</td></tr><tr><td><code>conv3</code></td><td><code>Conv2d_BN</code></td><td>The third convolutional layer for final projection.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward"><code>forward</code></a></td><td>Apply patch merging and dimension projection to the input feature map.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">input_resolution</span> <span class="o">=</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">patch_merging</span> <span class="o">=</span> <span class="n">PatchMerging</span><span class="p">(</span><span class="n">input_resolution</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">patch_merging</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3136</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L191-L250"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PatchMerging</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Merge neighboring patches in the feature map and project to a new dimension.</span>
<span></span>
<span></span><span class="sd">    This class implements a patch merging operation that combines spatial information and adjusts the feature dimension</span>
<span></span><span class="sd">    using a series of convolutional layers with batch normalization. It effectively reduces spatial resolution while</span>
<span></span><span class="sd">    potentially increasing channel dimensions.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        input_resolution (tuple[int, int]): The input resolution (height, width) of the feature map.</span>
<span></span><span class="sd">        dim (int): The input dimension of the feature map.</span>
<span></span><span class="sd">        out_dim (int): The output dimension after merging and projection.</span>
<span></span><span class="sd">        act (nn.Module): The activation function used between convolutions.</span>
<span></span><span class="sd">        conv1 (Conv2d_BN): The first convolutional layer for dimension projection.</span>
<span></span><span class="sd">        conv2 (Conv2d_BN): The second convolutional layer for spatial merging.</span>
<span></span><span class="sd">        conv3 (Conv2d_BN): The third convolutional layer for final projection.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; input_resolution = (56, 56)</span>
<span></span><span class="sd">        &gt;&gt;&gt; patch_merging = PatchMerging(input_resolution, dim=64, out_dim=128, activation=nn.ReLU)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(4, 64, 56, 56)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = patch_merging(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([4, 3136, 128])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">activation</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the PatchMerging module for merging and projecting neighboring patches in feature maps.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            input_resolution (tuple[int, int]): The input resolution (height, width) of the feature map.</span>
<span></span><span class="sd">            dim (int): The input dimension of the feature map.</span>
<span></span><span class="sd">            out_dim (int): The output dimension after merging and projection.</span>
<span></span><span class="sd">            activation (nn.Module): The activation function used between convolutions.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">out_dim</span> <span class="o">=</span> <span class="n">out_dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">act</span> <span class="o">=</span> <span class="n">activation</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span></span>        <span class="n">stride_c</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">out_dim</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">448</span><span class="p">,</span> <span class="mi">576</span><span class="p">}</span> <span class="k">else</span> <span class="mi">2</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">out_dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride_c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">out_dim</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">out_dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.PatchMerging.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Apply patch merging and dimension projection to the input feature map.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L236-L250"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Apply patch merging and dimension projection to the input feature map."""</span>
<span></span>    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<span></span>        <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span>
<span></span>        <span class="n">B</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>        <span class="c1"># (B, C, H, W)</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.ConvLayer"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.ConvLayer</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>    <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">activation</span><span class="p">,</span>
<span></span>    <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">downsample</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>    <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">conv_expand_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Convolutional Layer featuring multiple MobileNetV3-style inverted bottleneck convolutions (MBConv).</p><p>This layer optionally applies downsample operations to the output and supports gradient checkpointing for memory efficiency during training.</p><p>This layer consists of multiple MobileNetV3-style inverted bottleneck convolutions (MBConv) and optionally applies downsampling to the output.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>The dimensionality of the input and output.</td><td><em>required</em></td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>The resolution of the input image.</td><td><em>required</em></td></tr><tr><td><code>depth</code></td><td><code>int</code></td><td>The number of MBConv layers in the block.</td><td><em>required</em></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function applied after each convolution.</td><td><em>required</em></td></tr><tr><td><code>drop_path</code></td><td><code>float | list[float], optional</code></td><td>Drop path rate. Single float or a list of floats for each MBConv.</td><td><code>0.0</code></td></tr><tr><td><code>downsample</code></td><td><code>Optional[nn.Module], optional</code></td><td>Function for downsampling the output. None to skip downsampling.</td><td><code>None</code></td></tr><tr><td><code>use_checkpoint</code></td><td><code>bool, optional</code></td><td>Whether to use gradient checkpointing to save memory.</td><td><code>False</code></td></tr><tr><td><code>out_dim</code></td><td><code>Optional[int], optional</code></td><td>Output dimensions. None means it will be the same as <code>dim</code>.</td><td><code>None</code></td></tr><tr><td><code>conv_expand_ratio</code></td><td><code>float, optional</code></td><td>Expansion ratio for the MBConv layers.</td><td><code>4.0</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>Dimensionality of the input and output.</td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>Resolution of the input image.</td></tr><tr><td><code>depth</code></td><td><code>int</code></td><td>Number of MBConv layers in the block.</td></tr><tr><td><code>use_checkpoint</code></td><td><code>bool</code></td><td>Whether to use gradient checkpointing to save memory.</td></tr><tr><td><code>blocks</code></td><td><code>nn.ModuleList</code></td><td>List of MBConv layers.</td></tr><tr><td><code>downsample</code></td><td><code>Optional[nn.Module]</code></td><td>Function for downsampling the output.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward"><code>forward</code></a></td><td>Process input through convolutional layers, applying MBConv blocks and optional downsampling.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">conv_layer</span> <span class="o">=</span> <span class="n">ConvLayer</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">conv_layer</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3136</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L253-L334"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ConvLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Convolutional Layer featuring multiple MobileNetV3-style inverted bottleneck convolutions (MBConv).</span>
<span></span>
<span></span><span class="sd">    This layer optionally applies downsample operations to the output and supports gradient checkpointing for memory</span>
<span></span><span class="sd">    efficiency during training.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        dim (int): Dimensionality of the input and output.</span>
<span></span><span class="sd">        input_resolution (tuple[int, int]): Resolution of the input image.</span>
<span></span><span class="sd">        depth (int): Number of MBConv layers in the block.</span>
<span></span><span class="sd">        use_checkpoint (bool): Whether to use gradient checkpointing to save memory.</span>
<span></span><span class="sd">        blocks (nn.ModuleList): List of MBConv layers.</span>
<span></span><span class="sd">        downsample (Optional[nn.Module]): Function for downsampling the output.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; input_tensor = torch.randn(1, 64, 56, 56)</span>
<span></span><span class="sd">        &gt;&gt;&gt; conv_layer = ConvLayer(64, (56, 56), depth=3, activation=nn.ReLU)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = conv_layer(input_tensor)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 3136, 128])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>        <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">activation</span><span class="p">,</span>
<span></span>        <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">downsample</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>        <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">conv_expand_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the ConvLayer with the given dimensions and settings.</span>
<span></span>
<span></span><span class="sd">        This layer consists of multiple MobileNetV3-style inverted bottleneck convolutions (MBConv) and optionally</span>
<span></span><span class="sd">        applies downsampling to the output.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            dim (int): The dimensionality of the input and output.</span>
<span></span><span class="sd">            input_resolution (tuple[int, int]): The resolution of the input image.</span>
<span></span><span class="sd">            depth (int): The number of MBConv layers in the block.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function applied after each convolution.</span>
<span></span><span class="sd">            drop_path (float | list[float], optional): Drop path rate. Single float or a list of floats for each MBConv.</span>
<span></span><span class="sd">            downsample (Optional[nn.Module], optional): Function for downsampling the output. None to skip downsampling.</span>
<span></span><span class="sd">            use_checkpoint (bool, optional): Whether to use gradient checkpointing to save memory.</span>
<span></span><span class="sd">            out_dim (Optional[int], optional): Output dimensions. None means it will be the same as `dim`.</span>
<span></span><span class="sd">            conv_expand_ratio (float, optional): Expansion ratio for the MBConv layers.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">use_checkpoint</span> <span class="o">=</span> <span class="n">use_checkpoint</span>
<span></span>
<span></span>        <span class="c1"># Build blocks</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>            <span class="p">[</span>
<span></span>                <span class="n">MBConv</span><span class="p">(</span>
<span></span>                    <span class="n">dim</span><span class="p">,</span>
<span></span>                    <span class="n">dim</span><span class="p">,</span>
<span></span>                    <span class="n">conv_expand_ratio</span><span class="p">,</span>
<span></span>                    <span class="n">activation</span><span class="p">,</span>
<span></span>                    <span class="n">drop_path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_path</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">drop_path</span><span class="p">,</span>
<span></span>                <span class="p">)</span>
<span></span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
<span></span>            <span class="p">]</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Patch merging layer</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="kc">None</span>
<span></span>            <span class="k">if</span> <span class="n">downsample</span> <span class="ow">is</span> <span class="kc">None</span>
<span></span>            <span class="k">else</span> <span class="n">downsample</span><span class="p">(</span><span class="n">input_resolution</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="o">=</span><span class="n">out_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">)</span>
<span></span>        <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.ConvLayer.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Process input through convolutional layers, applying MBConv blocks and optional downsampling.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L330-L334"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process input through convolutional layers, applying MBConv blocks and optional downsampling."""</span>
<span></span>    <span class="k">for</span> <span class="n">blk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">(</span><span class="n">blk</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_checkpoint</span> <span class="k">else</span> <span class="n">blk</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># warn: checkpoint is slow import</span>
<span></span>    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.MLP"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.MLP</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">hidden_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">out_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span>    <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>Multi-layer Perceptron (MLP) module for transformer architectures.</p><p>This module applies layer normalization, two fully-connected layers with an activation function in between, and dropout. It is commonly used in transformer-based architectures for processing token embeddings.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>in_features</code></td><td><code>int</code></td><td>Number of input features.</td><td><em>required</em></td></tr><tr><td><code>hidden_features</code></td><td><code>Optional[int], optional</code></td><td>Number of hidden features.</td><td><code>None</code></td></tr><tr><td><code>out_features</code></td><td><code>Optional[int], optional</code></td><td>Number of output features.</td><td><code>None</code></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function applied after the first fully-connected layer.</td><td><code>nn.GELU</code></td></tr><tr><td><code>drop</code></td><td><code>float, optional</code></td><td>Dropout probability.</td><td><code>0.0</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>norm</code></td><td><code>nn.LayerNorm</code></td><td>Layer normalization applied to the input.</td></tr><tr><td><code>fc1</code></td><td><code>nn.Linear</code></td><td>First fully-connected layer.</td></tr><tr><td><code>fc2</code></td><td><code>nn.Linear</code></td><td>Second fully-connected layer.</td></tr><tr><td><code>act</code></td><td><code>nn.Module</code></td><td>Activation function applied after the first fully-connected layer.</td></tr><tr><td><code>drop</code></td><td><code>nn.Dropout</code></td><td>Dropout layer applied after the activation function.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.MLP.forward"><code>forward</code></a></td><td>Apply MLP operations: layer norm, FC layers, activation, and dropout to the input tensor.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">mlp</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">hidden_features</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">mlp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">32</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L337-L393"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Multi-layer Perceptron (MLP) module for transformer architectures.</span>
<span></span>
<span></span><span class="sd">    This module applies layer normalization, two fully-connected layers with an activation function in between, and</span>
<span></span><span class="sd">    dropout. It is commonly used in transformer-based architectures for processing token embeddings.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        norm (nn.LayerNorm): Layer normalization applied to the input.</span>
<span></span><span class="sd">        fc1 (nn.Linear): First fully-connected layer.</span>
<span></span><span class="sd">        fc2 (nn.Linear): Second fully-connected layer.</span>
<span></span><span class="sd">        act (nn.Module): Activation function applied after the first fully-connected layer.</span>
<span></span><span class="sd">        drop (nn.Dropout): Dropout layer applied after the activation function.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; import torch</span>
<span></span><span class="sd">        &gt;&gt;&gt; from torch import nn</span>
<span></span><span class="sd">        &gt;&gt;&gt; mlp = MLP(in_features=256, hidden_features=512, out_features=256, activation=nn.GELU, drop=0.1)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(32, 100, 256)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = mlp(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([32, 100, 256])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">in_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">hidden_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">out_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span>        <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize a multi-layer perceptron with configurable input, hidden, and output dimensions.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            in_features (int): Number of input features.</span>
<span></span><span class="sd">            hidden_features (Optional[int], optional): Number of hidden features.</span>
<span></span><span class="sd">            out_features (Optional[int], optional): Number of output features.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function applied after the first fully-connected layer.</span>
<span></span><span class="sd">            drop (float, optional): Dropout probability.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="n">out_features</span> <span class="o">=</span> <span class="n">out_features</span> <span class="ow">or</span> <span class="n">in_features</span>
<span></span>        <span class="n">hidden_features</span> <span class="o">=</span> <span class="n">hidden_features</span> <span class="ow">or</span> <span class="n">in_features</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">in_features</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="p">,</span> <span class="n">hidden_features</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_features</span><span class="p">,</span> <span class="n">out_features</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">act</span> <span class="o">=</span> <span class="n">activation</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">drop</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">drop</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.MLP.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.MLP.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Apply MLP operations: layer norm, FC layers, activation, and dropout to the input tensor.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L386-L393"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Apply MLP operations: layer norm, FC layers, activation, and dropout to the input tensor."""</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.Attention"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.Attention</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">key_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<span></span>    <span class="n">attn_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span></span>    <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>torch.nn.Module</code></p><p>Multi-head attention module with spatial awareness and trainable attention biases.</p><p>This module implements a multi-head attention mechanism with support for spatial awareness, applying attention biases based on spatial resolution. It includes trainable attention biases for each unique offset between spatial positions in the resolution grid.</p><p>This module implements a multi-head attention mechanism with support for spatial awareness, applying attention biases based on spatial resolution. It includes trainable attention biases for each unique offset between spatial positions in the resolution grid.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>The dimensionality of the input and output.</td><td><em>required</em></td></tr><tr><td><code>key_dim</code></td><td><code>int</code></td><td>The dimensionality of the keys and queries.</td><td><em>required</em></td></tr><tr><td><code>num_heads</code></td><td><code>int, optional</code></td><td>Number of attention heads.</td><td><code>8</code></td></tr><tr><td><code>attn_ratio</code></td><td><code>float, optional</code></td><td>Attention ratio, affecting the dimensions of the value vectors.</td><td><code>4</code></td></tr><tr><td><code>resolution</code></td><td><code>tuple[int, int], optional</code></td><td>Spatial resolution of the input feature map.</td><td><code>(14, 14)</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>num_heads</code></td><td><code>int</code></td><td>Number of attention heads.</td></tr><tr><td><code>scale</code></td><td><code>float</code></td><td>Scaling factor for attention scores.</td></tr><tr><td><code>key_dim</code></td><td><code>int</code></td><td>Dimensionality of the keys and queries.</td></tr><tr><td><code>nh_kd</code></td><td><code>int</code></td><td>Product of num_heads and key_dim.</td></tr><tr><td><code>d</code></td><td><code>int</code></td><td>Dimensionality of the value vectors.</td></tr><tr><td><code>dh</code></td><td><code>int</code></td><td>Product of d and num_heads.</td></tr><tr><td><code>attn_ratio</code></td><td><code>float</code></td><td>Attention ratio affecting the dimensions of the value vectors.</td></tr><tr><td><code>norm</code></td><td><code>nn.LayerNorm</code></td><td>Layer normalization applied to input.</td></tr><tr><td><code>qkv</code></td><td><code>nn.Linear</code></td><td>Linear layer for computing query, key, and value projections.</td></tr><tr><td><code>proj</code></td><td><code>nn.Linear</code></td><td>Linear layer for final projection.</td></tr><tr><td><code>attention_biases</code></td><td><code>nn.Parameter</code></td><td>Learnable attention biases.</td></tr><tr><td><code>attention_bias_idxs</code></td><td><code>torch.Tensor</code></td><td>Indices for attention biases.</td></tr><tr><td><code>ab</code></td><td><code>torch.Tensor</code></td><td>Cached attention biases for inference, deleted during training.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.Attention.forward"><code>forward</code></a></td><td>Apply multi-head attention with spatial awareness and trainable attention biases.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.Attention.train"><code>train</code></a></td><td>Set the module in training mode and handle the 'ab' attribute for cached attention biases.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">attn</span> <span class="o">=</span> <span class="n">Attention</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">key_dim</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">attn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">256</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L396-L506"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Attention</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Multi-head attention module with spatial awareness and trainable attention biases.</span>
<span></span>
<span></span><span class="sd">    This module implements a multi-head attention mechanism with support for spatial awareness, applying attention</span>
<span></span><span class="sd">    biases based on spatial resolution. It includes trainable attention biases for each unique offset between spatial</span>
<span></span><span class="sd">    positions in the resolution grid.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        num_heads (int): Number of attention heads.</span>
<span></span><span class="sd">        scale (float): Scaling factor for attention scores.</span>
<span></span><span class="sd">        key_dim (int): Dimensionality of the keys and queries.</span>
<span></span><span class="sd">        nh_kd (int): Product of num_heads and key_dim.</span>
<span></span><span class="sd">        d (int): Dimensionality of the value vectors.</span>
<span></span><span class="sd">        dh (int): Product of d and num_heads.</span>
<span></span><span class="sd">        attn_ratio (float): Attention ratio affecting the dimensions of the value vectors.</span>
<span></span><span class="sd">        norm (nn.LayerNorm): Layer normalization applied to input.</span>
<span></span><span class="sd">        qkv (nn.Linear): Linear layer for computing query, key, and value projections.</span>
<span></span><span class="sd">        proj (nn.Linear): Linear layer for final projection.</span>
<span></span><span class="sd">        attention_biases (nn.Parameter): Learnable attention biases.</span>
<span></span><span class="sd">        attention_bias_idxs (torch.Tensor): Indices for attention biases.</span>
<span></span><span class="sd">        ab (torch.Tensor): Cached attention biases for inference, deleted during training.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; attn = Attention(dim=256, key_dim=64, num_heads=8, resolution=(14, 14))</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(1, 196, 256)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = attn(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 196, 256])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">key_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<span></span>        <span class="n">attn_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span></span>        <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the Attention module for multi-head attention with spatial awareness.</span>
<span></span>
<span></span><span class="sd">        This module implements a multi-head attention mechanism with support for spatial awareness, applying attention</span>
<span></span><span class="sd">        biases based on spatial resolution. It includes trainable attention biases for each unique offset between</span>
<span></span><span class="sd">        spatial positions in the resolution grid.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            dim (int): The dimensionality of the input and output.</span>
<span></span><span class="sd">            key_dim (int): The dimensionality of the keys and queries.</span>
<span></span><span class="sd">            num_heads (int, optional): Number of attention heads.</span>
<span></span><span class="sd">            attn_ratio (float, optional): Attention ratio, affecting the dimensions of the value vectors.</span>
<span></span><span class="sd">            resolution (tuple[int, int], optional): Spatial resolution of the input feature map.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>
<span></span>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"'resolution' argument not tuple of length 2"</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_heads</span> <span class="o">=</span> <span class="n">num_heads</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">key_dim</span><span class="o">**-</span><span class="mf">0.5</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">key_dim</span> <span class="o">=</span> <span class="n">key_dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">nh_kd</span> <span class="o">=</span> <span class="n">nh_kd</span> <span class="o">=</span> <span class="n">key_dim</span> <span class="o">*</span> <span class="n">num_heads</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attn_ratio</span> <span class="o">*</span> <span class="n">key_dim</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">attn_ratio</span> <span class="o">*</span> <span class="n">key_dim</span><span class="p">)</span> <span class="o">*</span> <span class="n">num_heads</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">attn_ratio</span> <span class="o">=</span> <span class="n">attn_ratio</span>
<span></span>        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dh</span> <span class="o">+</span> <span class="n">nh_kd</span> <span class="o">*</span> <span class="mi">2</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">qkv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dh</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
<span></span>
<span></span>        <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span></span>        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span></span>        <span class="n">attention_offsets</span> <span class="o">=</span> <span class="p">{}</span>
<span></span>        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>
<span></span>        <span class="k">for</span> <span class="n">p1</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
<span></span>            <span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
<span></span>                <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span></span>                <span class="k">if</span> <span class="n">offset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attention_offsets</span><span class="p">:</span>
<span></span>                    <span class="n">attention_offsets</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attention_offsets</span><span class="p">)</span>
<span></span>                <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attention_offsets</span><span class="p">[</span><span class="n">offset</span><span class="p">])</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">attention_biases</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_heads</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">attention_offsets</span><span class="p">)))</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">"attention_bias_idxs"</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.Attention.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.Attention.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Apply multi-head attention with spatial awareness and trainable attention biases.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L485-L506"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Apply multi-head attention with spatial awareness and trainable attention biases."""</span>
<span></span>    <span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># B, N, C</span>
<span></span>
<span></span>    <span class="c1"># Normalization</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">qkv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qkv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="c1"># (B, N, num_heads, d)</span>
<span></span>    <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">qkv</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_heads</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">key_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span></span>    <span class="c1"># (B, num_heads, N, d)</span>
<span></span>    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span></span>    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span></span>    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attention_biases</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">attn</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">@</span> <span class="n">k</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">+</span> <span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">attention_biases</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attention_bias_idxs</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">attn</span> <span class="o">=</span> <span class="n">attn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">attn</span> <span class="o">@</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dh</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.Attention.train"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.Attention.train</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div><p>Set the module in training mode and handle the 'ab' attribute for cached attention biases.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>mode</code></td><td><code>bool</code></td><td></td><td><code>True</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L477-L483"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set the module in training mode and handle the 'ab' attribute for cached attention biases."""</span>
<span></span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"ab"</span><span class="p">):</span>
<span></span>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attention_biases</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attention_bias_idxs</span><span class="p">]</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span></span>    <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>    <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>    <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>TinyViT Block that applies self-attention and a local convolution to the input.</p><p>This block is a key component of the TinyViT architecture, combining self-attention mechanisms with local convolutions to process input features efficiently. It supports windowed attention for computational efficiency and includes residual connections.</p><p>This block is a key component of the TinyViT architecture, combining self-attention mechanisms with local convolutions to process input features efficiently.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>Dimensionality of the input and output features.</td><td><em>required</em></td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>Spatial resolution of the input feature map (height, width).</td><td><em>required</em></td></tr><tr><td><code>num_heads</code></td><td><code>int</code></td><td>Number of attention heads.</td><td><em>required</em></td></tr><tr><td><code>window_size</code></td><td><code>int, optional</code></td><td>Size of the attention window. Must be greater than 0.</td><td><code>7</code></td></tr><tr><td><code>mlp_ratio</code></td><td><code>float, optional</code></td><td>Ratio of MLP hidden dimension to embedding dimension.</td><td><code>4.0</code></td></tr><tr><td><code>drop</code></td><td><code>float, optional</code></td><td>Dropout rate.</td><td><code>0.0</code></td></tr><tr><td><code>drop_path</code></td><td><code>float, optional</code></td><td>Stochastic depth rate.</td><td><code>0.0</code></td></tr><tr><td><code>local_conv_size</code></td><td><code>int, optional</code></td><td>Kernel size of the local convolution.</td><td><code>3</code></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function for MLP.</td><td><code>nn.GELU</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>The dimensionality of the input and output.</td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>Spatial resolution of the input feature map.</td></tr><tr><td><code>num_heads</code></td><td><code>int</code></td><td>Number of attention heads.</td></tr><tr><td><code>window_size</code></td><td><code>int</code></td><td>Size of the attention window.</td></tr><tr><td><code>mlp_ratio</code></td><td><code>float</code></td><td>Ratio of MLP hidden dimension to embedding dimension.</td></tr><tr><td><code>drop_path</code></td><td><code>nn.Module</code></td><td>Stochastic depth layer, identity function during inference.</td></tr><tr><td><code>attn</code></td><td><code>Attention</code></td><td>Self-attention module.</td></tr><tr><td><code>mlp</code></td><td><code>MLP</code></td><td>Multi-layer perceptron module.</td></tr><tr><td><code>local_conv</code></td><td><code>Conv2d_BN</code></td><td>Depth-wise local convolution layer.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr"><code>extra_repr</code></a></td><td>Return a string representation of the TinyViTBlock's parameters.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward"><code>forward</code></a></td><td>Apply self-attention, local convolution, and MLP operations to the input tensor.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">block</span> <span class="o">=</span> <span class="n">TinyViTBlock</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">input_resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">192</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L509-L647"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TinyViTBlock</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""TinyViT Block that applies self-attention and a local convolution to the input.</span>
<span></span>
<span></span><span class="sd">    This block is a key component of the TinyViT architecture, combining self-attention mechanisms with local</span>
<span></span><span class="sd">    convolutions to process input features efficiently. It supports windowed attention for computational efficiency and</span>
<span></span><span class="sd">    includes residual connections.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        dim (int): The dimensionality of the input and output.</span>
<span></span><span class="sd">        input_resolution (tuple[int, int]): Spatial resolution of the input feature map.</span>
<span></span><span class="sd">        num_heads (int): Number of attention heads.</span>
<span></span><span class="sd">        window_size (int): Size of the attention window.</span>
<span></span><span class="sd">        mlp_ratio (float): Ratio of MLP hidden dimension to embedding dimension.</span>
<span></span><span class="sd">        drop_path (nn.Module): Stochastic depth layer, identity function during inference.</span>
<span></span><span class="sd">        attn (Attention): Self-attention module.</span>
<span></span><span class="sd">        mlp (MLP): Multi-layer perceptron module.</span>
<span></span><span class="sd">        local_conv (Conv2d_BN): Depth-wise local convolution layer.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; input_tensor = torch.randn(1, 196, 192)</span>
<span></span><span class="sd">        &gt;&gt;&gt; block = TinyViTBlock(dim=192, input_resolution=(14, 14), num_heads=3)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = block(input_tensor)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 196, 192])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
<span></span>        <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>        <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>        <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize a TinyViT block with self-attention and local convolution.</span>
<span></span>
<span></span><span class="sd">        This block is a key component of the TinyViT architecture, combining self-attention mechanisms with local</span>
<span></span><span class="sd">        convolutions to process input features efficiently.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            dim (int): Dimensionality of the input and output features.</span>
<span></span><span class="sd">            input_resolution (tuple[int, int]): Spatial resolution of the input feature map (height, width).</span>
<span></span><span class="sd">            num_heads (int): Number of attention heads.</span>
<span></span><span class="sd">            window_size (int, optional): Size of the attention window. Must be greater than 0.</span>
<span></span><span class="sd">            mlp_ratio (float, optional): Ratio of MLP hidden dimension to embedding dimension.</span>
<span></span><span class="sd">            drop (float, optional): Dropout rate.</span>
<span></span><span class="sd">            drop_path (float, optional): Stochastic depth rate.</span>
<span></span><span class="sd">            local_conv_size (int, optional): Kernel size of the local convolution.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function for MLP.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_heads</span> <span class="o">=</span> <span class="n">num_heads</span>
<span></span>        <span class="k">assert</span> <span class="n">window_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"window_size must be greater than 0"</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">mlp_ratio</span> <span class="o">=</span> <span class="n">mlp_ratio</span>
<span></span>
<span></span>        <span class="c1"># NOTE: `DropPath` is needed only for training.</span>
<span></span>        <span class="c1"># self.drop_path = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">drop_path</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
<span></span>
<span></span>        <span class="k">assert</span> <span class="n">dim</span> <span class="o">%</span> <span class="n">num_heads</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"dim must be divisible by num_heads"</span>
<span></span>        <span class="n">head_dim</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">//</span> <span class="n">num_heads</span>
<span></span>
<span></span>        <span class="n">window_resolution</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">window_size</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">attn</span> <span class="o">=</span> <span class="n">Attention</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">head_dim</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">,</span> <span class="n">attn_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">window_resolution</span><span class="p">)</span>
<span></span>
<span></span>        <span class="n">mlp_hidden_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="n">mlp_ratio</span><span class="p">)</span>
<span></span>        <span class="n">mlp_activation</span> <span class="o">=</span> <span class="n">activation</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">mlp</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">hidden_features</span><span class="o">=</span><span class="n">mlp_hidden_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">mlp_activation</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">)</span>
<span></span>
<span></span>        <span class="n">pad</span> <span class="o">=</span> <span class="n">local_conv_size</span> <span class="o">//</span> <span class="mi">2</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">local_conv</span> <span class="o">=</span> <span class="n">Conv2d_BN</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">ks</span><span class="o">=</span><span class="n">local_conv_size</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.extra_repr</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div><p>Return a string representation of the TinyViTBlock's parameters.</p><p>This method provides a formatted string containing key information about the TinyViTBlock, including its dimension, input resolution, number of attention heads, window size, and MLP ratio.</p><p><strong>Returns</strong></p><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>str</code></td><td>A formatted string containing the block's parameters.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">block</span> <span class="o">=</span> <span class="n">TinyViTBlock</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">input_resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mlp_ratio</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">extra_repr</span><span class="p">())</span>
<span></span><span class="n">dim</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">input_resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mlp_ratio</span><span class="o">=</span><span class="mf">4.0</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L630-L647"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Return a string representation of the TinyViTBlock's parameters.</span>
<span></span>
<span></span><span class="sd">    This method provides a formatted string containing key information about the TinyViTBlock, including its</span>
<span></span><span class="sd">    dimension, input resolution, number of attention heads, window size, and MLP ratio.</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (str): A formatted string containing the block's parameters.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; block = TinyViTBlock(dim=192, input_resolution=(14, 14), num_heads=3, window_size=7, mlp_ratio=4.0)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(block.extra_repr())</span>
<span></span><span class="sd">        dim=192, input_resolution=(14, 14), num_heads=3, window_size=7, mlp_ratio=4.0</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="k">return</span> <span class="p">(</span>
<span></span>        <span class="sa">f</span><span class="s2">"dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2">, input_resolution=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span><span class="si">}</span><span class="s2">, num_heads=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_heads</span><span class="si">}</span><span class="s2">, "</span>
<span></span>        <span class="sa">f</span><span class="s2">"window_size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">, mlp_ratio=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_ratio</span><span class="si">}</span><span class="s2">"</span>
<span></span>    <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViTBlock.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Apply self-attention, local convolution, and MLP operations to the input tensor.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L588-L628"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Apply self-attention, local convolution, and MLP operations to the input tensor."""</span>
<span></span>    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span>
<span></span>    <span class="n">b</span><span class="p">,</span> <span class="n">hw</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># batch, height*width, channels</span>
<span></span>    <span class="k">assert</span> <span class="n">hw</span> <span class="o">==</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span><span class="p">,</span> <span class="s2">"input feature has wrong size"</span>
<span></span>    <span class="n">res_x</span> <span class="o">=</span> <span class="n">x</span>
<span></span>    <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">and</span> <span class="n">w</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span></span>        <span class="n">pad_b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">-</span> <span class="n">h</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<span></span>        <span class="n">pad_r</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">-</span> <span class="n">w</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<span></span>        <span class="n">padding</span> <span class="o">=</span> <span class="n">pad_b</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pad_r</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span></span>        <span class="k">if</span> <span class="n">padding</span><span class="p">:</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pad_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pad_b</span><span class="p">))</span>
<span></span>
<span></span>        <span class="n">pH</span><span class="p">,</span> <span class="n">pW</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">pad_b</span><span class="p">,</span> <span class="n">w</span> <span class="o">+</span> <span class="n">pad_r</span>
<span></span>        <span class="n">nH</span> <span class="o">=</span> <span class="n">pH</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<span></span>        <span class="n">nW</span> <span class="o">=</span> <span class="n">pW</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<span></span>
<span></span>        <span class="c1"># Window partition</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">nH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">nW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span></span>            <span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span></span>            <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">nH</span> <span class="o">*</span> <span class="n">nW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Window reverse</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">nH</span><span class="p">,</span> <span class="n">nW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">pH</span><span class="p">,</span> <span class="n">pW</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">padding</span><span class="p">:</span>
<span></span>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="n">h</span><span class="p">,</span> <span class="p">:</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
<span></span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hw</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">res_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_conv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">hw</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.BasicLayer"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.BasicLayer</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>    <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>    <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>    <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">downsample</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>    <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>    <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span>    <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>A basic TinyViT layer for one stage in a TinyViT architecture.</p><p>This class represents a single layer in the TinyViT model, consisting of multiple TinyViT blocks and an optional downsampling operation. It processes features at a specific resolution and dimensionality within the overall architecture.</p><p>This layer consists of multiple TinyViT blocks and an optional downsampling operation. It is designed to process feature maps at a specific resolution and dimensionality within the TinyViT model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>Dimensionality of the input and output features.</td><td><em>required</em></td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>Spatial resolution of the input feature map (height, width).</td><td><em>required</em></td></tr><tr><td><code>depth</code></td><td><code>int</code></td><td>Number of TinyViT blocks in this layer.</td><td><em>required</em></td></tr><tr><td><code>num_heads</code></td><td><code>int</code></td><td>Number of attention heads in each TinyViT block.</td><td><em>required</em></td></tr><tr><td><code>window_size</code></td><td><code>int</code></td><td>Size of the local window for attention computation.</td><td><em>required</em></td></tr><tr><td><code>mlp_ratio</code></td><td><code>float, optional</code></td><td>Ratio of MLP hidden dimension to embedding dimension.</td><td><code>4.0</code></td></tr><tr><td><code>drop</code></td><td><code>float, optional</code></td><td>Dropout rate.</td><td><code>0.0</code></td></tr><tr><td><code>drop_path</code></td><td><code>float | list[float], optional</code></td><td>Stochastic depth rate. Can be a float or a list of floats for each block.</td><td><code>0.0</code></td></tr><tr><td><code>downsample</code></td><td><code>nn.Module | None, optional</code></td><td>Downsampling layer at the end of the layer. None to skip downsampling.</td><td><code>None</code></td></tr><tr><td><code>use_checkpoint</code></td><td><code>bool, optional</code></td><td>Whether to use gradient checkpointing to save memory.</td><td><code>False</code></td></tr><tr><td><code>local_conv_size</code></td><td><code>int, optional</code></td><td>Kernel size for the local convolution in each TinyViT block.</td><td><code>3</code></td></tr><tr><td><code>activation</code></td><td><code>nn.Module</code></td><td>Activation function used in the MLP.</td><td><code>nn.GELU</code></td></tr><tr><td><code>out_dim</code></td><td><code>int | None, optional</code></td><td>Output dimension after downsampling. None means it will be the same as dim.</td><td><code>None</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dim</code></td><td><code>int</code></td><td>The dimensionality of the input and output features.</td></tr><tr><td><code>input_resolution</code></td><td><code>tuple[int, int]</code></td><td>Spatial resolution of the input feature map.</td></tr><tr><td><code>depth</code></td><td><code>int</code></td><td>Number of TinyViT blocks in this layer.</td></tr><tr><td><code>use_checkpoint</code></td><td><code>bool</code></td><td>Whether to use gradient checkpointing to save memory.</td></tr><tr><td><code>blocks</code></td><td><code>nn.ModuleList</code></td><td>List of TinyViT blocks that make up this layer.</td></tr><tr><td><code>downsample</code></td><td><code>nn.Module | None</code></td><td>Downsample layer at the end of the layer, if specified.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr"><code>extra_repr</code></a></td><td>Return a string with the layer's parameters for printing.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward"><code>forward</code></a></td><td>Process input through TinyViT blocks and optional downsampling.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3136</span><span class="p">,</span> <span class="mi">192</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">BasicLayer</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">input_resolution</span><span class="o">=</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">),</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_heads</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">784</span><span class="p">,</span> <span class="mi">384</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L650-L750"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BasicLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""A basic TinyViT layer for one stage in a TinyViT architecture.</span>
<span></span>
<span></span><span class="sd">    This class represents a single layer in the TinyViT model, consisting of multiple TinyViT blocks and an optional</span>
<span></span><span class="sd">    downsampling operation. It processes features at a specific resolution and dimensionality within the overall</span>
<span></span><span class="sd">    architecture.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        dim (int): The dimensionality of the input and output features.</span>
<span></span><span class="sd">        input_resolution (tuple[int, int]): Spatial resolution of the input feature map.</span>
<span></span><span class="sd">        depth (int): Number of TinyViT blocks in this layer.</span>
<span></span><span class="sd">        use_checkpoint (bool): Whether to use gradient checkpointing to save memory.</span>
<span></span><span class="sd">        blocks (nn.ModuleList): List of TinyViT blocks that make up this layer.</span>
<span></span><span class="sd">        downsample (nn.Module | None): Downsample layer at the end of the layer, if specified.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; input_tensor = torch.randn(1, 3136, 192)</span>
<span></span><span class="sd">        &gt;&gt;&gt; layer = BasicLayer(dim=192, input_resolution=(56, 56), depth=2, num_heads=3, window_size=7)</span>
<span></span><span class="sd">        &gt;&gt;&gt; output = layer(input_tensor)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(output.shape)</span>
<span></span><span class="sd">        torch.Size([1, 784, 384])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">input_resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span></span>        <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span></span>        <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>        <span class="n">drop</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">drop_path</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">downsample</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>        <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>        <span class="n">activation</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">GELU</span><span class="p">,</span>
<span></span>        <span class="n">out_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize a BasicLayer in the TinyViT architecture.</span>
<span></span>
<span></span><span class="sd">        This layer consists of multiple TinyViT blocks and an optional downsampling operation. It is designed to process</span>
<span></span><span class="sd">        feature maps at a specific resolution and dimensionality within the TinyViT model.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            dim (int): Dimensionality of the input and output features.</span>
<span></span><span class="sd">            input_resolution (tuple[int, int]): Spatial resolution of the input feature map (height, width).</span>
<span></span><span class="sd">            depth (int): Number of TinyViT blocks in this layer.</span>
<span></span><span class="sd">            num_heads (int): Number of attention heads in each TinyViT block.</span>
<span></span><span class="sd">            window_size (int): Size of the local window for attention computation.</span>
<span></span><span class="sd">            mlp_ratio (float, optional): Ratio of MLP hidden dimension to embedding dimension.</span>
<span></span><span class="sd">            drop (float, optional): Dropout rate.</span>
<span></span><span class="sd">            drop_path (float | list[float], optional): Stochastic depth rate. Can be a float or a list of floats for</span>
<span></span><span class="sd">                each block.</span>
<span></span><span class="sd">            downsample (nn.Module | None, optional): Downsampling layer at the end of the layer. None to skip</span>
<span></span><span class="sd">                downsampling.</span>
<span></span><span class="sd">            use_checkpoint (bool, optional): Whether to use gradient checkpointing to save memory.</span>
<span></span><span class="sd">            local_conv_size (int, optional): Kernel size for the local convolution in each TinyViT block.</span>
<span></span><span class="sd">            activation (nn.Module): Activation function used in the MLP.</span>
<span></span><span class="sd">            out_dim (int | None, optional): Output dimension after downsampling. None means it will be the same as dim.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">use_checkpoint</span> <span class="o">=</span> <span class="n">use_checkpoint</span>
<span></span>
<span></span>        <span class="c1"># Build blocks</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
<span></span>            <span class="p">[</span>
<span></span>                <span class="n">TinyViTBlock</span><span class="p">(</span>
<span></span>                    <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span>
<span></span>                    <span class="n">input_resolution</span><span class="o">=</span><span class="n">input_resolution</span><span class="p">,</span>
<span></span>                    <span class="n">num_heads</span><span class="o">=</span><span class="n">num_heads</span><span class="p">,</span>
<span></span>                    <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
<span></span>                    <span class="n">mlp_ratio</span><span class="o">=</span><span class="n">mlp_ratio</span><span class="p">,</span>
<span></span>                    <span class="n">drop</span><span class="o">=</span><span class="n">drop</span><span class="p">,</span>
<span></span>                    <span class="n">drop_path</span><span class="o">=</span><span class="n">drop_path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">drop_path</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">drop_path</span><span class="p">,</span>
<span></span>                    <span class="n">local_conv_size</span><span class="o">=</span><span class="n">local_conv_size</span><span class="p">,</span>
<span></span>                    <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
<span></span>                <span class="p">)</span>
<span></span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
<span></span>            <span class="p">]</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Patch merging layer</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="kc">None</span>
<span></span>            <span class="k">if</span> <span class="n">downsample</span> <span class="ow">is</span> <span class="kc">None</span>
<span></span>            <span class="k">else</span> <span class="n">downsample</span><span class="p">(</span><span class="n">input_resolution</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">out_dim</span><span class="o">=</span><span class="n">out_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">)</span>
<span></span>        <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.BasicLayer.extra_repr</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div><p>Return a string with the layer's parameters for printing.</p><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L748-L750"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Return a string with the layer's parameters for printing."""</span>
<span></span>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2">, input_resolution=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_resolution</span><span class="si">}</span><span class="s2">, depth=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.BasicLayer.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Process input through TinyViT blocks and optional downsampling.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L742-L746"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process input through TinyViT blocks and optional downsampling."""</span>
<span></span>    <span class="k">for</span> <span class="n">blk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">(</span><span class="n">blk</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_checkpoint</span> <span class="k">else</span> <span class="n">blk</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># warn: checkpoint is slow import</span>
<span></span>    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/><hr/><br/></p><h2 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT"><span class="doc-kind doc-kind-class">class</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT</code></h2><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>    <span class="bp">self</span><span class="p">,</span>
<span></span>    <span class="n">img_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">224</span><span class="p">,</span>
<span></span>    <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span></span>    <span class="n">embed_dims</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">768</span><span class="p">),</span>
<span></span>    <span class="n">depths</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span></span>    <span class="n">num_heads</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
<span></span>    <span class="n">window_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
<span></span>    <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>    <span class="n">drop_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>    <span class="n">drop_path_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<span></span>    <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>    <span class="n">mbconv_expand_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>    <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>    <span class="n">layer_lr_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span></span><span class="p">)</span>
</code></pre></div><p><strong>Bases:</strong> <code>nn.Module</code></p><p>TinyViT: A compact vision transformer architecture for efficient image classification and feature extraction.</p><p>This class implements the TinyViT model, which combines elements of vision transformers and convolutional neural networks for improved efficiency and performance on vision tasks. It features hierarchical processing with patch embedding, multiple stages of attention and convolution blocks, and a feature refinement neck.</p><p>This constructor sets up the TinyViT architecture, including patch embedding, multiple layers of attention and convolution blocks, and a classification head.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>img_size</code></td><td><code>int, optional</code></td><td>Size of the input image.</td><td><code>224</code></td></tr><tr><td><code>in_chans</code></td><td><code>int, optional</code></td><td>Number of input channels.</td><td><code>3</code></td></tr><tr><td><code>num_classes</code></td><td><code>int, optional</code></td><td>Number of classes for classification.</td><td><code>1000</code></td></tr><tr><td><code>embed_dims</code></td><td><code>tuple[int, int, int, int], optional</code></td><td>Embedding dimensions for each stage.</td><td><code>(96, 192, 384, 768)</code></td></tr><tr><td><code>depths</code></td><td><code>tuple[int, int, int, int], optional</code></td><td>Number of blocks in each stage.</td><td><code>(2, 2, 6, 2)</code></td></tr><tr><td><code>num_heads</code></td><td><code>tuple[int, int, int, int], optional</code></td><td>Number of attention heads in each stage.</td><td><code>(3, 6, 12, 24)</code></td></tr><tr><td><code>window_sizes</code></td><td><code>tuple[int, int, int, int], optional</code></td><td>Window sizes for each stage.</td><td><code>(7, 7, 14, 7)</code></td></tr><tr><td><code>mlp_ratio</code></td><td><code>float, optional</code></td><td>Ratio of MLP hidden dim to embedding dim.</td><td><code>4.0</code></td></tr><tr><td><code>drop_rate</code></td><td><code>float, optional</code></td><td>Dropout rate.</td><td><code>0.0</code></td></tr><tr><td><code>drop_path_rate</code></td><td><code>float, optional</code></td><td>Stochastic depth rate.</td><td><code>0.1</code></td></tr><tr><td><code>use_checkpoint</code></td><td><code>bool, optional</code></td><td>Whether to use checkpointing to save memory.</td><td><code>False</code></td></tr><tr><td><code>mbconv_expand_ratio</code></td><td><code>float, optional</code></td><td>Expansion ratio for MBConv layer.</td><td><code>4.0</code></td></tr><tr><td><code>local_conv_size</code></td><td><code>int, optional</code></td><td>Kernel size for local convolutions.</td><td><code>3</code></td></tr><tr><td><code>layer_lr_decay</code></td><td><code>float, optional</code></td><td>Layer-wise learning rate decay factor.</td><td><code>1.0</code></td></tr></tbody></table><p><strong>Attributes</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>img_size</code></td><td><code>int</code></td><td>Input image size.</td></tr><tr><td><code>num_classes</code></td><td><code>int</code></td><td>Number of classification classes.</td></tr><tr><td><code>depths</code></td><td><code>tuple[int, int, int, int]</code></td><td>Number of blocks in each stage.</td></tr><tr><td><code>num_layers</code></td><td><code>int</code></td><td>Total number of layers in the network.</td></tr><tr><td><code>mlp_ratio</code></td><td><code>float</code></td><td>Ratio of MLP hidden dimension to embedding dimension.</td></tr><tr><td><code>patch_embed</code></td><td><code>PatchEmbed</code></td><td>Module for patch embedding.</td></tr><tr><td><code>patches_resolution</code></td><td><code>tuple[int, int]</code></td><td>Resolution of embedded patches.</td></tr><tr><td><code>layers</code></td><td><code>nn.ModuleList</code></td><td>List of network layers.</td></tr><tr><td><code>norm_head</code></td><td><code>nn.LayerNorm</code></td><td>Layer normalization for the classifier head.</td></tr><tr><td><code>head</code></td><td><code>nn.Linear</code></td><td>Linear layer for final classification.</td></tr><tr><td><code>neck</code></td><td><code>nn.Sequential</code></td><td>Neck module for feature refinement.</td></tr></tbody></table><p><strong>Methods</strong></p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights"><code>_init_weights</code></a></td><td>Initialize weights for linear and normalization layers in the TinyViT model.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward"><code>forward</code></a></td><td>Perform the forward pass through the TinyViT model, extracting features from the input image.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features"><code>forward_features</code></a></td><td>Process input through feature extraction layers, returning spatial features.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords"><code>no_weight_decay_keywords</code></a></td><td>Return a set of keywords for parameters that should not use weight decay.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz"><code>set_imgsz</code></a></td><td>Set image size to make model compatible with different image sizes.</td></tr><tr><td><a href="#ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay"><code>set_layer_lr_decay</code></a></td><td>Set layer-wise learning rate decay for the TinyViT model based on depth.</td></tr></tbody></table><p><strong>Examples</strong></p><div class="highlight"><pre><span></span><code><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">TinyViT</span><span class="p">(</span><span class="n">img_size</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">features</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forward_features</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span><span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">])</span>
</code></pre></div><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L753-L979"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TinyViT</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""TinyViT: A compact vision transformer architecture for efficient image classification and feature extraction.</span>
<span></span>
<span></span><span class="sd">    This class implements the TinyViT model, which combines elements of vision transformers and convolutional neural</span>
<span></span><span class="sd">    networks for improved efficiency and performance on vision tasks. It features hierarchical processing with patch</span>
<span></span><span class="sd">    embedding, multiple stages of attention and convolution blocks, and a feature refinement neck.</span>
<span></span>
<span></span><span class="sd">    Attributes:</span>
<span></span><span class="sd">        img_size (int): Input image size.</span>
<span></span><span class="sd">        num_classes (int): Number of classification classes.</span>
<span></span><span class="sd">        depths (tuple[int, int, int, int]): Number of blocks in each stage.</span>
<span></span><span class="sd">        num_layers (int): Total number of layers in the network.</span>
<span></span><span class="sd">        mlp_ratio (float): Ratio of MLP hidden dimension to embedding dimension.</span>
<span></span><span class="sd">        patch_embed (PatchEmbed): Module for patch embedding.</span>
<span></span><span class="sd">        patches_resolution (tuple[int, int]): Resolution of embedded patches.</span>
<span></span><span class="sd">        layers (nn.ModuleList): List of network layers.</span>
<span></span><span class="sd">        norm_head (nn.LayerNorm): Layer normalization for the classifier head.</span>
<span></span><span class="sd">        head (nn.Linear): Linear layer for final classification.</span>
<span></span><span class="sd">        neck (nn.Sequential): Neck module for feature refinement.</span>
<span></span>
<span></span><span class="sd">    Examples:</span>
<span></span><span class="sd">        &gt;&gt;&gt; model = TinyViT(img_size=224, num_classes=1000)</span>
<span></span><span class="sd">        &gt;&gt;&gt; x = torch.randn(1, 3, 224, 224)</span>
<span></span><span class="sd">        &gt;&gt;&gt; features = model.forward_features(x)</span>
<span></span><span class="sd">        &gt;&gt;&gt; print(features.shape)</span>
<span></span><span class="sd">        torch.Size([1, 256, 56, 56])</span>
<span></span><span class="sd">    """</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="p">,</span>
<span></span>        <span class="n">img_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">224</span><span class="p">,</span>
<span></span>        <span class="n">in_chans</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span></span>        <span class="n">embed_dims</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">768</span><span class="p">),</span>
<span></span>        <span class="n">depths</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span></span>        <span class="n">num_heads</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span>
<span></span>        <span class="n">window_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
<span></span>        <span class="n">mlp_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>        <span class="n">drop_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span></span>        <span class="n">drop_path_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<span></span>        <span class="n">use_checkpoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span></span>        <span class="n">mbconv_expand_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
<span></span>        <span class="n">local_conv_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span></span>        <span class="n">layer_lr_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span></span>    <span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Initialize the TinyViT model.</span>
<span></span>
<span></span><span class="sd">        This constructor sets up the TinyViT architecture, including patch embedding, multiple layers of attention and</span>
<span></span><span class="sd">        convolution blocks, and a classification head.</span>
<span></span>
<span></span><span class="sd">        Args:</span>
<span></span><span class="sd">            img_size (int, optional): Size of the input image.</span>
<span></span><span class="sd">            in_chans (int, optional): Number of input channels.</span>
<span></span><span class="sd">            num_classes (int, optional): Number of classes for classification.</span>
<span></span><span class="sd">            embed_dims (tuple[int, int, int, int], optional): Embedding dimensions for each stage.</span>
<span></span><span class="sd">            depths (tuple[int, int, int, int], optional): Number of blocks in each stage.</span>
<span></span><span class="sd">            num_heads (tuple[int, int, int, int], optional): Number of attention heads in each stage.</span>
<span></span><span class="sd">            window_sizes (tuple[int, int, int, int], optional): Window sizes for each stage.</span>
<span></span><span class="sd">            mlp_ratio (float, optional): Ratio of MLP hidden dim to embedding dim.</span>
<span></span><span class="sd">            drop_rate (float, optional): Dropout rate.</span>
<span></span><span class="sd">            drop_path_rate (float, optional): Stochastic depth rate.</span>
<span></span><span class="sd">            use_checkpoint (bool, optional): Whether to use checkpointing to save memory.</span>
<span></span><span class="sd">            mbconv_expand_ratio (float, optional): Expansion ratio for MBConv layer.</span>
<span></span><span class="sd">            local_conv_size (int, optional): Kernel size for local convolutions.</span>
<span></span><span class="sd">            layer_lr_decay (float, optional): Layer-wise learning rate decay factor.</span>
<span></span><span class="sd">        """</span>
<span></span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="n">img_size</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_classes</span> <span class="o">=</span> <span class="n">num_classes</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">depths</span> <span class="o">=</span> <span class="n">depths</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">depths</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">mlp_ratio</span> <span class="o">=</span> <span class="n">mlp_ratio</span>
<span></span>
<span></span>        <span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GELU</span>
<span></span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span> <span class="o">=</span> <span class="n">PatchEmbed</span><span class="p">(</span>
<span></span>            <span class="n">in_chans</span><span class="o">=</span><span class="n">in_chans</span><span class="p">,</span> <span class="n">embed_dim</span><span class="o">=</span><span class="n">embed_dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">resolution</span><span class="o">=</span><span class="n">img_size</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>        <span class="n">patches_resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span><span class="o">.</span><span class="n">patches_resolution</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span> <span class="o">=</span> <span class="n">patches_resolution</span>
<span></span>
<span></span>        <span class="c1"># Stochastic depth</span>
<span></span>        <span class="n">dpr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop_path_rate</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">depths</span><span class="p">))]</span>  <span class="c1"># stochastic depth decay rule</span>
<span></span>
<span></span>        <span class="c1"># Build layers</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
<span></span>        <span class="k">for</span> <span class="n">i_layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">):</span>
<span></span>            <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span></span>                <span class="n">dim</span><span class="o">=</span><span class="n">embed_dims</span><span class="p">[</span><span class="n">i_layer</span><span class="p">],</span>
<span></span>                <span class="n">input_resolution</span><span class="o">=</span><span class="p">(</span>
<span></span>                    <span class="n">patches_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i_layer</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i_layer</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">i_layer</span><span class="p">)),</span>
<span></span>                    <span class="n">patches_resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i_layer</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i_layer</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">i_layer</span><span class="p">)),</span>
<span></span>                <span class="p">),</span>
<span></span>                <span class="c1">#   input_resolution=(patches_resolution[0] // (2 ** i_layer),</span>
<span></span>                <span class="c1">#                     patches_resolution[1] // (2 ** i_layer)),</span>
<span></span>                <span class="n">depth</span><span class="o">=</span><span class="n">depths</span><span class="p">[</span><span class="n">i_layer</span><span class="p">],</span>
<span></span>                <span class="n">drop_path</span><span class="o">=</span><span class="n">dpr</span><span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">depths</span><span class="p">[:</span><span class="n">i_layer</span><span class="p">])</span> <span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">depths</span><span class="p">[:</span> <span class="n">i_layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])],</span>
<span></span>                <span class="n">downsample</span><span class="o">=</span><span class="n">PatchMerging</span> <span class="k">if</span> <span class="p">(</span><span class="n">i_layer</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span></span>                <span class="n">use_checkpoint</span><span class="o">=</span><span class="n">use_checkpoint</span><span class="p">,</span>
<span></span>                <span class="n">out_dim</span><span class="o">=</span><span class="n">embed_dims</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i_layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">embed_dims</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span>
<span></span>                <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="n">i_layer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span></span>                <span class="n">layer</span> <span class="o">=</span> <span class="n">ConvLayer</span><span class="p">(</span><span class="n">conv_expand_ratio</span><span class="o">=</span><span class="n">mbconv_expand_ratio</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span></span>            <span class="k">else</span><span class="p">:</span>
<span></span>                <span class="n">layer</span> <span class="o">=</span> <span class="n">BasicLayer</span><span class="p">(</span>
<span></span>                    <span class="n">num_heads</span><span class="o">=</span><span class="n">num_heads</span><span class="p">[</span><span class="n">i_layer</span><span class="p">],</span>
<span></span>                    <span class="n">window_size</span><span class="o">=</span><span class="n">window_sizes</span><span class="p">[</span><span class="n">i_layer</span><span class="p">],</span>
<span></span>                    <span class="n">mlp_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_ratio</span><span class="p">,</span>
<span></span>                    <span class="n">drop</span><span class="o">=</span><span class="n">drop_rate</span><span class="p">,</span>
<span></span>                    <span class="n">local_conv_size</span><span class="o">=</span><span class="n">local_conv_size</span><span class="p">,</span>
<span></span>                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span></span>                <span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<span></span>
<span></span>        <span class="c1"># Classifier head</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">norm_head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">embed_dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">embed_dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_classes</span><span class="p">)</span> <span class="k">if</span> <span class="n">num_classes</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Identity</span><span class="p">()</span>
<span></span>
<span></span>        <span class="c1"># Init weights</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_weights</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">set_layer_lr_decay</span><span class="p">(</span><span class="n">layer_lr_decay</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">neck</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<span></span>                <span class="n">embed_dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span></span>                <span class="mi">256</span><span class="p">,</span>
<span></span>                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span></span>                <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span></span>            <span class="p">),</span>
<span></span>            <span class="n">LayerNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<span></span>                <span class="mi">256</span><span class="p">,</span>
<span></span>                <span class="mi">256</span><span class="p">,</span>
<span></span>                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span></span>                <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span></span>                <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span></span>            <span class="p">),</span>
<span></span>            <span class="n">LayerNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
<span></span>        <span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT._init_weights</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_init_weights</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div><p>Initialize weights for linear and normalization layers in the TinyViT model.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>m</code></td><td></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L930-L939"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@staticmethod</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">_init_weights</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Initialize weights for linear and normalization layers in the TinyViT model."""</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">):</span>
<span></span>        <span class="c1"># NOTE: This initialization is needed only for training.</span>
<span></span>        <span class="c1"># trunc_normal_(m.weight, std=.02)</span>
<span></span>        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>            <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span></span>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">):</span>
<span></span>        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span></span>        <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Perform the forward pass through the TinyViT model, extracting features from the input image.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L961-L963"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Perform the forward pass through the TinyViT model, extracting features from the input image."""</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_features</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT.forward_features</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</code></pre></div><p>Process input through feature extraction layers, returning spatial features.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>x</code></td><td><code>torch.Tensor</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L946-L959"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Process input through feature extraction layers, returning spatial features."""</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># x input is (N, C, H, W)</span>
<span></span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">start_i</span> <span class="o">=</span> <span class="mi">1</span>
<span></span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)):</span>
<span></span>        <span class="n">layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span></span>        <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">batch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neck</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT.no_weight_decay_keywords</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">no_weight_decay_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div><p>Return a set of keywords for parameters that should not use weight decay.</p><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L942-L944"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ignore</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">no_weight_decay_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Return a set of keywords for parameters that should not use weight decay."""</span>
<span></span>    <span class="k">return</span> <span class="p">{</span><span class="s2">"attention_biases"</span><span class="p">}</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_imgsz</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_imgsz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgsz</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
</code></pre></div><p>Set image size to make model compatible with different image sizes.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>imgsz</code></td><td><code>list[int]</code></td><td></td><td><code>[1024, 1024]</code></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L965-L979"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_imgsz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgsz</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]):</span>
<span></span><span class="w">    </span><span class="sd">"""Set image size to make model compatible with different image sizes."""</span>
<span></span>    <span class="n">imgsz</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">//</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">imgsz</span><span class="p">]</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">patches_resolution</span> <span class="o">=</span> <span class="n">imgsz</span>
<span></span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
<span></span>        <span class="n">input_resolution</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">i</span><span class="p">)),</span>
<span></span>            <span class="n">imgsz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">i</span><span class="p">)),</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">layer</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>            <span class="n">layer</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">BasicLayer</span><span class="p">):</span>
<span></span>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
<span></span>                <span class="n">b</span><span class="o">.</span><span class="n">input_resolution</span> <span class="o">=</span> <span class="n">input_resolution</span>
</code></pre></div></details><p><br/></p><h3 id="ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay"><span class="doc-kind doc-kind-method">method</span> <code>ultralytics.models.sam.modules.tiny_encoder.TinyViT.set_layer_lr_decay</code></h3><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_layer_lr_decay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_lr_decay</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div><p>Set layer-wise learning rate decay for the TinyViT model based on depth.</p><p><strong>Args</strong></p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>layer_lr_decay</code></td><td><code>float</code></td><td></td><td><em>required</em></td></tr></tbody></table><details><summary>Source code in <code>ultralytics/models/sam/modules/tiny_encoder.py</code></summary><a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/models/sam/modules/tiny_encoder.py#L894-L927"><i aria-hidden="true" class="fa-brands fa-github" style="margin-right:6px;"></i>View on GitHub</a><div class="highlight"><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">set_layer_lr_decay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer_lr_decay</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Set layer-wise learning rate decay for the TinyViT model based on depth."""</span>
<span></span>    <span class="n">decay_rate</span> <span class="o">=</span> <span class="n">layer_lr_decay</span>
<span></span>
<span></span>    <span class="c1"># Layers -&gt; blocks (depth)</span>
<span></span>    <span class="n">depth</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depths</span><span class="p">)</span>
<span></span>    <span class="n">lr_scales</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay_rate</span> <span class="o">**</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)]</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">_set_lr_scale</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Set the learning rate scale for each layer in the model based on the layer's depth."""</span>
<span></span>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<span></span>            <span class="n">p</span><span class="o">.</span><span class="n">lr_scale</span> <span class="o">=</span> <span class="n">scale</span>
<span></span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">patch_embed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_set_lr_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lr_scales</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span></span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span></span>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
<span></span>        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">layer</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
<span></span>            <span class="n">block</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_set_lr_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lr_scales</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span></span>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span></span>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">downsample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>            <span class="n">layer</span><span class="o">.</span><span class="n">downsample</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_set_lr_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lr_scales</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
<span></span>    <span class="k">assert</span> <span class="n">i</span> <span class="o">==</span> <span class="n">depth</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_head</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">}:</span>
<span></span>        <span class="n">m</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_set_lr_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lr_scales</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span></span>
<span></span>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
<span></span>        <span class="n">p</span><span class="o">.</span><span class="n">param_name</span> <span class="o">=</span> <span class="n">k</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_lr_scale</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Check if the learning rate scale attribute is present in module's parameters."""</span>
<span></span>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<span></span>            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">"lr_scale"</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">param_name</span>
<span></span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_check_lr_scale</span><span class="p">)</span>
</code></pre></div></details><p><br/><br/></p><br/><br/><div class="git-info"><div class="dates-container"><span class="date-item" title="This page was first created on November 12, 2023"><span class="hover-item">ğŸ“…</span> Created 2 years ago </span><span class="date-item" title="This page was last updated on November 23, 2025"><span class="hover-item">âœï¸</span> Updated 1 day ago </span></div><div class="authors-container"><a class="author-link" href="https://github.com/glenn-jocher" title="glenn-jocher (8 changes)"><img alt="glenn-jocher" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/26833433?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/jk4e" title="jk4e (1 change)"><img alt="jk4e" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/116908874?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/Laughing-q" title="Laughing-q (1 change)"><img alt="Laughing-q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/61612323?v=4&amp;s=96"/></a><a class="author-link" href="https://github.com/Burhan-Q" title="Burhan-Q (1 change)"><img alt="Burhan-Q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62214284?v=4&amp;s=96"/></a></div></div><div class="share-buttons"><button class="share-button hover-item" onclick="window.open('https://twitter.com/intent/tweet?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fmodels%2Fsam%2Fmodules%2Ftiny_encoder%2F', 'TwitterShare', 'width=550,height=680,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-x-twitter"></i> Tweet </button><button class="share-button hover-item linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fdocs.ultralytics.com%2Freference%2Fmodels%2Fsam%2Fmodules%2Ftiny_encoder%2F', 'LinkedinShare', 'width=550,height=730,menubar=no,toolbar=no'); return false;"><i class="fa-brands fa-linkedin-in"></i> Share </button></div><br/></article></div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div><button class="md-top md-icon" data-md-component="top" hidden="" type="button"><svg class="lucide lucide-circle-arrow-up" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"></circle><path d="m16 12-4-4-4 4M12 16V8"></path></svg> Back to top
</button></main><footer class="md-footer"><nav aria-label="Footer" class="md-footer__inner md-grid"><a aria-label="Previous: sam" class="md-footer__link md-footer__link--prev" href="../sam/"><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-left" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 19-7-7 7-7M19 12H5"></path></svg></div><div class="md-footer__title"><span class="md-footer__direction"> Previous </span><div class="md-ellipsis"> sam </div></div></a><a aria-label="Next: transformer" class="md-footer__link md-footer__link--next" href="../transformer/"><div class="md-footer__title"><span class="md-footer__direction"> Next </span><div class="md-ellipsis"> transformer </div></div><div class="md-footer__button md-icon"><svg class="lucide lucide-arrow-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 12h14M12 5l7 7-7 7"></path></svg></div></a></nav><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-copyright"><div class="md-copyright__highlight"><a href="https://www.ultralytics.com/" target="_blank">Â© 2025 Ultralytics Inc.</a> All rights reserved. </div> Made with <a href="https://zensical.org/" rel="noopener" target="_blank"> Zensical </a></div><div class="md-social"><a class="md-social__link" href="https://github.com/ultralytics" rel="noopener" target="_blank" title="github.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://www.linkedin.com/company/ultralytics/" rel="noopener" target="_blank" title="www.linkedin.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://x.com/ultralytics" rel="noopener" target="_blank" title="x.com"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://youtube.com/ultralytics?sub_confirmation=1" rel="noopener" target="_blank" title="youtube.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://hub.docker.com/r/ultralytics/ultralytics/" rel="noopener" target="_blank" title="hub.docker.com"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://pypi.org/project/ultralytics/" rel="noopener" target="_blank" title="pypi.org"><svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://discord.com/invite/ultralytics" rel="noopener" target="_blank" title="discord.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://reddit.com/r/ultralytics" rel="noopener" target="_blank" title="reddit.com"><svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5" fill="currentColor"></path></svg></a><a class="md-social__link" href="https://weixin.qq.com/r/mp/LxckPDfEgWr_rXNf90I9" rel="noopener" target="_blank" title="weixin.qq.com"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6" fill="currentColor"></path></svg></a></div></div></div></footer></div><div class="md-dialog" data-md-component="dialog"><div class="md-dialog__inner md-typeset"></div></div><div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"annotate":null,"base":"../../../../..","features":["content.action.edit","content.code.annotate","content.code.copy","content.tooltips","toc.follow","navigation.top","navigation.tabs","navigation.tabs.sticky","navigation.prune","navigation.footer","navigation.tracking","navigation.instant","navigation.instant.progress","navigation.indexes","navigation.sections","content.tabs.link"],"search":"../../../../../assets/javascripts/workers/search.5e1f2129.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
<script src="../../../../../assets/javascripts/bundle.21aa498e.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ultralytics/llm@v0.0.8/js/chat.min.js"></script>
<script src="https://unpkg.com/tablesort@5.6.0/dist/tablesort.min.js"></script>
<script src="../../../../../javascript/extra.js"></script>
<script src="../../../../../javascript/giscus.js"></script>
<script src="../../../../../javascript/tablesort.js"></script>
</body></html>