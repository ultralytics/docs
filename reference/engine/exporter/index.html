<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Learn how to export YOLOv8 models to formats like ONNX, TensorRT, CoreML, and more. Optimize your exports for different platforms." name="description"/>
<meta content="Ultralytics" name="author"/>
<link href="https://docs.ultralytics.com/reference/engine/exporter/" rel="canonical"/>
<link href="../../data/utils/" rel="prev"/>
<link href="../model/" rel="next"/>
<link href="https://raw.githubusercontent.com/ultralytics/assets/refs/heads/main/logo/favicon-yolo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator"/>
<title>Reference for ultralytics/engine/exporter.py - Ultralytics YOLO Docs</title>
<link href="../../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../stylesheets/style.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2M5EHKC0BH"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2M5EHKC0BH",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2M5EHKC0BH",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<meta content="exporter" name="title"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet"/><meta content="YOLOv8, export formats, ONNX, TensorRT, CoreML, machine learning model export, AI, deep learning" name="keywords"/><meta content="website" property="og:type"/><meta content="https://docs.ultralytics.com/reference/engine/exporter" property="og:url"/><meta content="exporter" property="og:title"/><meta content="Learn how to export YOLOv8 models to formats like ONNX, TensorRT, CoreML, and more. Optimize your exports for different platforms." property="og:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="og:image"/><meta content="summary_large_image" property="twitter:card"/><meta content="https://docs.ultralytics.com/reference/engine/exporter" property="twitter:url"/><meta content="exporter" property="twitter:title"/><meta content="Learn how to export YOLOv8 models to formats like ONNX, TensorRT, CoreML, and more. Optimize your exports for different platforms." property="twitter:description"/><meta content="https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png" property="twitter:image"/><script type="application/ld+json">{"@context": "https://schema.org", "@type": "Article", "headline": "exporter", "image": ["https://raw.githubusercontent.com/ultralytics/assets/main/yolov8/banner-yolov8.png"], "datePublished": "2023-11-12 02:49:37 +0100", "dateModified": "2025-09-19 15:15:58 +0100", "author": [{"@type": "Organization", "name": "Ultralytics", "url": "https://ultralytics.com/"}], "abstract": "Learn how to export YOLOv8 models to formats like ONNX, TensorRT, CoreML, and more. Optimize your exports for different platforms."}</script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#reference-for-ultralyticsengineexporterpy">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-banner">
<div class="md-banner__inner md-grid md-typeset">
<a class="banner-wrapper" href="https://www.ultralytics.com/events/yolovision" target="_blank">
<div class="banner-content-wrapper">
<p>Register now for</p>
<img alt="Ultralytics YOLO Vision" height="40" loading="lazy" src="https://cdn.prod.website-files.com/680a070c3b99253410dd3dcf/6895ca9b3ece7244d9981ab9_yv25-logo.avif"/>
<p class="shenzhen-text">Shenzhen</p>
</div>
</a>
</div>
</aside>
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Ultralytics YOLO Docs" class="md-header__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs">
<img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Ultralytics YOLO Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
              exporter
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="/" hreflang="en">
              🇬🇧 English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/zh/" hreflang="zh">
              🇨🇳 简体中文
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/ko/" hreflang="ko">
              🇰🇷 한국어
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/ja/" hreflang="ja">
              🇯🇵 日本語
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/ru/" hreflang="ru">
              🇷🇺 Русский
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/de/" hreflang="de">
              🇩🇪 Deutsch
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/fr/" hreflang="fr">
              🇫🇷 Français
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/es/" hreflang="es">
              🇪🇸 Español
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/pt/" hreflang="pt">
              🇵🇹 Português
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/it/" hreflang="it">
              🇮🇹 Italiano
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/tr/" hreflang="tr">
              🇹🇷 Türkçe
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/vi/" hreflang="vi">
              🇻🇳 Tiếng Việt
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="/ar/" hreflang="ar">
              🇸🇦 العربية
            </a>
</li>
</ul>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    ultralytics/ultralytics
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
  Home
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../quickstart/">
  Quickstart
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../modes/">
  Modes
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../tasks/">
  Tasks
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../models/">
  Models
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../datasets/">
  Datasets
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../solutions/">
  Solutions 🚀
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../guides/">
  Guides
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../integrations/">
  Integrations
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../hub/">
  HUB
        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../__init__/">
  Reference
        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../help/">
  Help
        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Ultralytics YOLO Docs" class="md-nav__button md-logo" data-md-component="logo" href="https://www.ultralytics.com/" title="Ultralytics YOLO Docs">
<img alt="logo" src="https://raw.githubusercontent.com/ultralytics/assets/main/logo/Ultralytics_Logotype_Reverse.svg"/>
</a>
    Ultralytics YOLO Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ultralytics/ultralytics" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    ultralytics/ultralytics
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../quickstart/">
<span class="md-ellipsis">
    Quickstart
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../modes/">
<span class="md-ellipsis">
    Modes
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../tasks/">
<span class="md-ellipsis">
    Tasks
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../models/">
<span class="md-ellipsis">
    Models
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../datasets/">
<span class="md-ellipsis">
    Datasets
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../solutions/">
<span class="md-ellipsis">
    Solutions 🚀
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../guides/">
<span class="md-ellipsis">
    Guides
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../integrations/">
<span class="md-ellipsis">
    Integrations
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../hub/">
<span class="md-ellipsis">
    HUB
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_11">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../__init__/">
<span class="md-ellipsis">
    __init__
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="">
<span class="md-ellipsis">
    cfg
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_2">
<span class="md-nav__icon md-icon"></span>
            cfg
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cfg/__init__/">
<span class="md-ellipsis">
    __init__
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="">
<span class="md-ellipsis">
    data
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_3">
<span class="md-nav__icon md-icon"></span>
            data
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/annotator/">
<span class="md-ellipsis">
    annotator
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/augment/">
<span class="md-ellipsis">
    augment
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/base/">
<span class="md-ellipsis">
    base
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/build/">
<span class="md-ellipsis">
    build
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/converter/">
<span class="md-ellipsis">
    converter
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/dataset/">
<span class="md-ellipsis">
    dataset
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/loaders/">
<span class="md-ellipsis">
    loaders
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/split/">
<span class="md-ellipsis">
    split
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/split_dota/">
<span class="md-ellipsis">
    split_dota
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../data/utils/">
<span class="md-ellipsis">
    utils
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_11_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex="">
<span class="md-ellipsis">
    engine
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_11_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_4">
<span class="md-nav__icon md-icon"></span>
            engine
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    exporter
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    exporter
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> Exporter
    </span>
</a>
<nav aria-label=" Exporter" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.__call__">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> __call__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.add_callback">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> add_callback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_coreml">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_coreml
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_edgetpu">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_edgetpu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_engine">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_imx">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_imx
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_mnn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_mnn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_ncnn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_ncnn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_onnx">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_onnx
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_openvino">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_openvino
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_paddle">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_paddle
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_pb">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_pb
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_rknn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_rknn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_saved_model">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_saved_model
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_tfjs">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_tfjs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_tflite">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_tflite
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_torchscript">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_torchscript
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.get_int8_calibration_dataloader">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> get_int8_calibration_dataloader
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.run_callbacks">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> run_callbacks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.IOSDetectModel">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> IOSDetectModel
    </span>
</a>
<nav aria-label=" IOSDetectModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.IOSDetectModel.forward">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> forward
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.NMSModel">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> NMSModel
    </span>
</a>
<nav aria-label=" NMSModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.NMSModel.forward">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> forward
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.export_formats">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> export_formats
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.best_onnx_opset">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> best_onnx_opset
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.validate_args">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> validate_args
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.gd_outputs">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> gd_outputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.try_export">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> try_export
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model/">
<span class="md-ellipsis">
    model
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../predictor/">
<span class="md-ellipsis">
    predictor
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../results/">
<span class="md-ellipsis">
    results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../trainer/">
<span class="md-ellipsis">
    trainer
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tuner/">
<span class="md-ellipsis">
    tuner
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../validator/">
<span class="md-ellipsis">
    validator
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_5" id="__nav_11_5_label" tabindex="">
<span class="md-ellipsis">
    hub
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_5">
<span class="md-nav__icon md-icon"></span>
            hub
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../hub/__init__/">
<span class="md-ellipsis">
    __init__
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hub/auth/">
<span class="md-ellipsis">
    auth
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../hub/google/__init__/">
<span class="md-ellipsis">
    google
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hub/session/">
<span class="md-ellipsis">
    session
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hub/utils/">
<span class="md-ellipsis">
    utils
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex="">
<span class="md-ellipsis">
    models
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_6">
<span class="md-nav__icon md-icon"></span>
            models
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/fastsam/model/">
<span class="md-ellipsis">
    fastsam
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/nas/model/">
<span class="md-ellipsis">
    nas
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/rtdetr/model/">
<span class="md-ellipsis">
    rtdetr
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/sam/amg/">
<span class="md-ellipsis">
    sam
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/utils/loss/">
<span class="md-ellipsis">
    utils
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../models/yolo/classify/predict/">
<span class="md-ellipsis">
    yolo
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_7" id="__nav_11_7_label" tabindex="">
<span class="md-ellipsis">
    nn
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_7">
<span class="md-nav__icon md-icon"></span>
            nn
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../nn/autobackend/">
<span class="md-ellipsis">
    autobackend
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../nn/modules/activation/">
<span class="md-ellipsis">
    modules
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../nn/tasks/">
<span class="md-ellipsis">
    tasks
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../nn/text_model/">
<span class="md-ellipsis">
    text_model
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_8" id="__nav_11_8_label" tabindex="">
<span class="md-ellipsis">
    solutions
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_8">
<span class="md-nav__icon md-icon"></span>
            solutions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/ai_gym/">
<span class="md-ellipsis">
    ai_gym
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/analytics/">
<span class="md-ellipsis">
    analytics
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/config/">
<span class="md-ellipsis">
    config
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/distance_calculation/">
<span class="md-ellipsis">
    distance_calculation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/heatmap/">
<span class="md-ellipsis">
    heatmap
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/instance_segmentation/">
<span class="md-ellipsis">
    instance_segmentation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/object_blurrer/">
<span class="md-ellipsis">
    object_blurrer
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/object_counter/">
<span class="md-ellipsis">
    object_counter
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/object_cropper/">
<span class="md-ellipsis">
    object_cropper
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/parking_management/">
<span class="md-ellipsis">
    parking_management
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/queue_management/">
<span class="md-ellipsis">
    queue_management
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/region_counter/">
<span class="md-ellipsis">
    region_counter
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/security_alarm/">
<span class="md-ellipsis">
    security_alarm
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/similarity_search/">
<span class="md-ellipsis">
    similarity_search
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/solutions/">
<span class="md-ellipsis">
    solutions
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/speed_estimation/">
<span class="md-ellipsis">
    speed_estimation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/streamlit_inference/">
<span class="md-ellipsis">
    streamlit_inference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/trackzone/">
<span class="md-ellipsis">
    trackzone
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../solutions/vision_eye/">
<span class="md-ellipsis">
    vision_eye
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_9" id="__nav_11_9_label" tabindex="">
<span class="md-ellipsis">
    trackers
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_9_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_9">
<span class="md-nav__icon md-icon"></span>
            trackers
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../trackers/basetrack/">
<span class="md-ellipsis">
    basetrack
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../trackers/bot_sort/">
<span class="md-ellipsis">
    bot_sort
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../trackers/byte_tracker/">
<span class="md-ellipsis">
    byte_tracker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../trackers/track/">
<span class="md-ellipsis">
    track
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../trackers/utils/gmc/">
<span class="md-ellipsis">
    utils
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_11_10" id="__nav_11_10_label" tabindex="">
<span class="md-ellipsis">
    utils
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_10_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_11_10">
<span class="md-nav__icon md-icon"></span>
            utils
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/__init__/">
<span class="md-ellipsis">
    __init__
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/autobatch/">
<span class="md-ellipsis">
    autobatch
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/autodevice/">
<span class="md-ellipsis">
    autodevice
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/benchmarks/">
<span class="md-ellipsis">
    benchmarks
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../utils/callbacks/base/">
<span class="md-ellipsis">
    callbacks
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/checks/">
<span class="md-ellipsis">
    checks
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/cpu/">
<span class="md-ellipsis">
    cpu
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/dist/">
<span class="md-ellipsis">
    dist
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/downloads/">
<span class="md-ellipsis">
    downloads
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/errors/">
<span class="md-ellipsis">
    errors
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/events/">
<span class="md-ellipsis">
    events
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../utils/export/__init__/">
<span class="md-ellipsis">
    export
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/files/">
<span class="md-ellipsis">
    files
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/git/">
<span class="md-ellipsis">
    git
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/instance/">
<span class="md-ellipsis">
    instance
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/logger/">
<span class="md-ellipsis">
    logger
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/loss/">
<span class="md-ellipsis">
    loss
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/metrics/">
<span class="md-ellipsis">
    metrics
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/nms/">
<span class="md-ellipsis">
    nms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/ops/">
<span class="md-ellipsis">
    ops
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/patches/">
<span class="md-ellipsis">
    patches
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/plotting/">
<span class="md-ellipsis">
    plotting
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/tal/">
<span class="md-ellipsis">
    tal
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/torch_utils/">
<span class="md-ellipsis">
    torch_utils
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/tqdm/">
<span class="md-ellipsis">
    tqdm
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/triton/">
<span class="md-ellipsis">
    triton
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utils/tuner/">
<span class="md-ellipsis">
    tuner
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../help/">
<span class="md-ellipsis">
    Help
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> Exporter
    </span>
</a>
<nav aria-label=" Exporter" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.__call__">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> __call__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.add_callback">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> add_callback
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_coreml">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_coreml
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_edgetpu">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_edgetpu
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_engine">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_imx">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_imx
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_mnn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_mnn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_ncnn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_ncnn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_onnx">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_onnx
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_openvino">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_openvino
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_paddle">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_paddle
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_pb">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_pb
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_rknn">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_rknn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_saved_model">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_saved_model
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_tfjs">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_tfjs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_tflite">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_tflite
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.export_torchscript">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> export_torchscript
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.get_int8_calibration_dataloader">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> get_int8_calibration_dataloader
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.Exporter.run_callbacks">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> run_callbacks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.IOSDetectModel">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> IOSDetectModel
    </span>
</a>
<nav aria-label=" IOSDetectModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.IOSDetectModel.forward">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> forward
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.NMSModel">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code> NMSModel
    </span>
</a>
<nav aria-label=" NMSModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.NMSModel.forward">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-method"></code> forward
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.export_formats">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> export_formats
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.best_onnx_opset">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> best_onnx_opset
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.validate_args">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> validate_args
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.gd_outputs">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> gd_outputs
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ultralytics.engine.exporter.try_export">
<span class="md-ellipsis">
<code class="doc-symbol doc-symbol-toc doc-symbol-function"></code> try_export
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/ultralytics/ultralytics/tree/main/docs/en/reference/engine/exporter.md" rel="edit" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a><a class="md-content__button md-icon" href="javascript:void(0)" onclick="copyMarkdownForLLM(this); return false;" title="Copy page in Markdown format"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></a>
<h1 id="reference-for-ultralyticsengineexporterpy">Reference for <code>ultralytics/engine/exporter.py</code></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This file is available at <a href="https://github.com/ultralytics/ultralytics/blob/main/ultralytics/engine/exporter.py">https://github.com/ultralytics/ultralytics/blob/main/ultralytics/engine/exporter.py</a>. If you spot a problem please help fix it by <a href="https://docs.ultralytics.com/help/contributing/">contributing</a> a <a href="https://github.com/ultralytics/ultralytics/edit/main/ultralytics/engine/exporter.py">Pull Request</a> 🛠️. Thank you 🙏!</p>
</div>
<p><br/></p>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">ultralytics.engine.exporter.Exporter</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">Exporter</span><span class="p">(</span><span class="n">cfg</span><span class="o">=</span><span class="n">DEFAULT_CFG</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>A class for exporting YOLO models to various formats.</p>
<p>This class provides functionality to export YOLO models to different formats including ONNX, TensorRT, CoreML,
TensorFlow, and others. It handles format validation, device selection, model preparation, and the actual export
process for each supported format.</p>
<p><span class="doc-section-title">Attributes:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.args">args</span></code></td>
<td>
<code><span title="SimpleNamespace">SimpleNamespace</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Configuration arguments for the exporter.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.callbacks">callbacks</span></code></td>
<td>
<code><span title="dict">dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Dictionary of callback functions for different export events.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.im">im</span></code></td>
<td>
<code><span title="torch.Tensor">Tensor</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Input tensor for model inference during export.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.model">model</span></code></td>
<td>
<code><span title="torch.nn.Module">Module</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The YOLO model to be exported.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.file">file</span></code></td>
<td>
<code><span title="pathlib.Path">Path</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to the model file being exported.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.output_shape">output_shape</span></code></td>
<td>
<code><span title="tuple">tuple</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Shape of the model output tensor(s).</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.pretty_name">pretty_name</span></code></td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Formatted model name for display purposes.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.metadata">metadata</span></code></td>
<td>
<code><span title="dict">dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Model metadata including description, author, version, etc.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.device">device</span></code></td>
<td>
<code><span title="torch.device">device</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Device on which the model is loaded.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><span title="ultralytics.engine.exporter.Exporter.imgsz">imgsz</span></code></td>
<td>
<code><span title="tuple">tuple</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Input image size for the model.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Methods:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.__call__" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;__call__&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.__call__&lt;/code&gt;)'>__call__</a></code></td>
<td>
<div class="doc-md-description">
<p>Main export method that handles the export process.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.get_int8_calibration_dataloader" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;get_int8_calibration_dataloader&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.get_int8_calibration_dataloader&lt;/code&gt;)'>get_int8_calibration_dataloader</a></code></td>
<td>
<div class="doc-md-description">
<p>Build dataloader for INT8 calibration.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_torchscript" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_torchscript&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_torchscript&lt;/code&gt;)'>export_torchscript</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TorchScript format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_onnx" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_onnx&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_onnx&lt;/code&gt;)'>export_onnx</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to ONNX format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_openvino" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_openvino&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_openvino&lt;/code&gt;)'>export_openvino</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to OpenVINO format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_paddle" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_paddle&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_paddle&lt;/code&gt;)'>export_paddle</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to PaddlePaddle format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_mnn" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_mnn&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_mnn&lt;/code&gt;)'>export_mnn</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to MNN format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_ncnn" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_ncnn&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_ncnn&lt;/code&gt;)'>export_ncnn</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to NCNN format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_coreml" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_coreml&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_coreml&lt;/code&gt;)'>export_coreml</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to CoreML format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_engine" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_engine&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_engine&lt;/code&gt;)'>export_engine</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TensorRT format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_saved_model" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_saved_model&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_saved_model&lt;/code&gt;)'>export_saved_model</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TensorFlow SavedModel format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_pb" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_pb&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_pb&lt;/code&gt;)'>export_pb</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TensorFlow GraphDef format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_tflite" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_tflite&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_tflite&lt;/code&gt;)'>export_tflite</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TensorFlow Lite format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_edgetpu" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_edgetpu&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_edgetpu&lt;/code&gt;)'>export_edgetpu</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to Edge TPU format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_tfjs" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_tfjs&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_tfjs&lt;/code&gt;)'>export_tfjs</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to TensorFlow.js format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_rknn" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_rknn&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_rknn&lt;/code&gt;)'>export_rknn</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to RKNN format.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td><code><a class="autorefs autorefs-internal" href="#ultralytics.engine.exporter.Exporter.export_imx" title='&lt;code class="doc-symbol doc-symbol-heading doc-symbol-method"&gt;&lt;/code&gt;            &lt;span class="doc doc-object-name doc-function-name"&gt;export_imx&lt;/span&gt; (&lt;code&gt;ultralytics.engine.exporter.Exporter.export_imx&lt;/code&gt;)'>export_imx</a></code></td>
<td>
<div class="doc-md-description">
<p>Export model to IMX format.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Examples:</span></p>
<p>Export a YOLOv8 model to ONNX format</p>
<div class="highlight"><pre><span></span><code><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.engine.exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Exporter</span>
<span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exporter</span> <span class="o">=</span> <span class="n">Exporter</span><span class="p">()</span>
<span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exporter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"yolov8n.pt"</span><span class="p">)</span>  <span class="c1"># exports to yolov8n.onnx</span>
</code></pre></div>
<p>Export with specific arguments</p>
<div class="highlight"><pre><span></span><code><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"format"</span><span class="p">:</span> <span class="s2">"onnx"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exporter</span> <span class="o">=</span> <span class="n">Exporter</span><span class="p">(</span><span class="n">overrides</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
<span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exporter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"yolov8n.pt"</span><span class="p">)</span>
</code></pre></div>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>cfg</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to a configuration file.</p>
</div>
</td>
<td>
<code><span title="ultralytics.utils.DEFAULT_CFG">DEFAULT_CFG</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>overrides</code>
</td>
<td>
<code><span title="dict">dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Configuration overrides.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>_callbacks</code>
</td>
<td>
<code><span title="dict">dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Dictionary of callback functions.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>289</span>
<span>290</span>
<span>291</span>
<span>292</span>
<span>293</span>
<span>294</span>
<span>295</span>
<span>296</span>
<span>297</span>
<span>298</span>
<span>299</span>
<span>300</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">DEFAULT_CFG</span><span class="p">,</span> <span class="n">overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""</span>
<span></span><span class="sd">    Initialize the Exporter class.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        cfg (str, optional): Path to a configuration file.</span>
<span></span><span class="sd">        overrides (dict, optional): Configuration overrides.</span>
<span></span><span class="sd">        _callbacks (dict, optional): Dictionary of callback functions.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">get_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">overrides</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">_callbacks</span> <span class="ow">or</span> <span class="n">callbacks</span><span class="o">.</span><span class="n">get_default_callbacks</span><span class="p">()</span>
<span></span>    <span class="n">callbacks</span><span class="o">.</span><span class="n">add_integration_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.__call__">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">__call__</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">__call__</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Return list of exported files/dirs after running callbacks.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>302</span>
<span>303</span>
<span>304</span>
<span>305</span>
<span>306</span>
<span>307</span>
<span>308</span>
<span>309</span>
<span>310</span>
<span>311</span>
<span>312</span>
<span>313</span>
<span>314</span>
<span>315</span>
<span>316</span>
<span>317</span>
<span>318</span>
<span>319</span>
<span>320</span>
<span>321</span>
<span>322</span>
<span>323</span>
<span>324</span>
<span>325</span>
<span>326</span>
<span>327</span>
<span>328</span>
<span>329</span>
<span>330</span>
<span>331</span>
<span>332</span>
<span>333</span>
<span>334</span>
<span>335</span>
<span>336</span>
<span>337</span>
<span>338</span>
<span>339</span>
<span>340</span>
<span>341</span>
<span>342</span>
<span>343</span>
<span>344</span>
<span>345</span>
<span>346</span>
<span>347</span>
<span>348</span>
<span>349</span>
<span>350</span>
<span>351</span>
<span>352</span>
<span>353</span>
<span>354</span>
<span>355</span>
<span>356</span>
<span>357</span>
<span>358</span>
<span>359</span>
<span>360</span>
<span>361</span>
<span>362</span>
<span>363</span>
<span>364</span>
<span>365</span>
<span>366</span>
<span>367</span>
<span>368</span>
<span>369</span>
<span>370</span>
<span>371</span>
<span>372</span>
<span>373</span>
<span>374</span>
<span>375</span>
<span>376</span>
<span>377</span>
<span>378</span>
<span>379</span>
<span>380</span>
<span>381</span>
<span>382</span>
<span>383</span>
<span>384</span>
<span>385</span>
<span>386</span>
<span>387</span>
<span>388</span>
<span>389</span>
<span>390</span>
<span>391</span>
<span>392</span>
<span>393</span>
<span>394</span>
<span>395</span>
<span>396</span>
<span>397</span>
<span>398</span>
<span>399</span>
<span>400</span>
<span>401</span>
<span>402</span>
<span>403</span>
<span>404</span>
<span>405</span>
<span>406</span>
<span>407</span>
<span>408</span>
<span>409</span>
<span>410</span>
<span>411</span>
<span>412</span>
<span>413</span>
<span>414</span>
<span>415</span>
<span>416</span>
<span>417</span>
<span>418</span>
<span>419</span>
<span>420</span>
<span>421</span>
<span>422</span>
<span>423</span>
<span>424</span>
<span>425</span>
<span>426</span>
<span>427</span>
<span>428</span>
<span>429</span>
<span>430</span>
<span>431</span>
<span>432</span>
<span>433</span>
<span>434</span>
<span>435</span>
<span>436</span>
<span>437</span>
<span>438</span>
<span>439</span>
<span>440</span>
<span>441</span>
<span>442</span>
<span>443</span>
<span>444</span>
<span>445</span>
<span>446</span>
<span>447</span>
<span>448</span>
<span>449</span>
<span>450</span>
<span>451</span>
<span>452</span>
<span>453</span>
<span>454</span>
<span>455</span>
<span>456</span>
<span>457</span>
<span>458</span>
<span>459</span>
<span>460</span>
<span>461</span>
<span>462</span>
<span>463</span>
<span>464</span>
<span>465</span>
<span>466</span>
<span>467</span>
<span>468</span>
<span>469</span>
<span>470</span>
<span>471</span>
<span>472</span>
<span>473</span>
<span>474</span>
<span>475</span>
<span>476</span>
<span>477</span>
<span>478</span>
<span>479</span>
<span>480</span>
<span>481</span>
<span>482</span>
<span>483</span>
<span>484</span>
<span>485</span>
<span>486</span>
<span>487</span>
<span>488</span>
<span>489</span>
<span>490</span>
<span>491</span>
<span>492</span>
<span>493</span>
<span>494</span>
<span>495</span>
<span>496</span>
<span>497</span>
<span>498</span>
<span>499</span>
<span>500</span>
<span>501</span>
<span>502</span>
<span>503</span>
<span>504</span>
<span>505</span>
<span>506</span>
<span>507</span>
<span>508</span>
<span>509</span>
<span>510</span>
<span>511</span>
<span>512</span>
<span>513</span>
<span>514</span>
<span>515</span>
<span>516</span>
<span>517</span>
<span>518</span>
<span>519</span>
<span>520</span>
<span>521</span>
<span>522</span>
<span>523</span>
<span>524</span>
<span>525</span>
<span>526</span>
<span>527</span>
<span>528</span>
<span>529</span>
<span>530</span>
<span>531</span>
<span>532</span>
<span>533</span>
<span>534</span>
<span>535</span>
<span>536</span>
<span>537</span>
<span>538</span>
<span>539</span>
<span>540</span>
<span>541</span>
<span>542</span>
<span>543</span>
<span>544</span>
<span>545</span>
<span>546</span>
<span>547</span>
<span>548</span>
<span>549</span>
<span>550</span>
<span>551</span>
<span>552</span>
<span>553</span>
<span>554</span>
<span>555</span>
<span>556</span>
<span>557</span>
<span>558</span>
<span>559</span>
<span>560</span>
<span>561</span>
<span>562</span>
<span>563</span>
<span>564</span>
<span>565</span>
<span>566</span>
<span>567</span>
<span>568</span>
<span>569</span>
<span>570</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Return list of exported files/dirs after running callbacks."""</span>
<span></span>    <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span></span>    <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># to lowercase</span>
<span></span>    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"tensorrt"</span><span class="p">,</span> <span class="s2">"trt"</span><span class="p">}:</span>  <span class="c1"># 'engine' aliases</span>
<span></span>        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">"engine"</span>
<span></span>    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"mlmodel"</span><span class="p">,</span> <span class="s2">"mlpackage"</span><span class="p">,</span> <span class="s2">"mlprogram"</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"ios"</span><span class="p">,</span> <span class="s2">"coreml"</span><span class="p">}:</span>  <span class="c1"># 'coreml' aliases</span>
<span></span>        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">"coreml"</span>
<span></span>    <span class="n">fmts_dict</span> <span class="o">=</span> <span class="n">export_formats</span><span class="p">()</span>
<span></span>    <span class="n">fmts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fmts_dict</span><span class="p">[</span><span class="s2">"Argument"</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>  <span class="c1"># available export formats</span>
<span></span>    <span class="k">if</span> <span class="n">fmt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fmts</span><span class="p">:</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">difflib</span>
<span></span>
<span></span>        <span class="c1"># Get the closest match if format is invalid</span>
<span></span>        <span class="n">matches</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">fmts</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>  <span class="c1"># 60% similarity required to match</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
<span></span>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Model is already in PyTorch format."</span> <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">"pt"</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">"Invalid export format='</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">'."</span>
<span></span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> Valid formats are </span><span class="si">{</span><span class="n">fmts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid export format='</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">', updating to format='</span><span class="si">{</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span></span>        <span class="n">fmt</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>    <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">fmt</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fmts</span><span class="p">]</span>
<span></span>    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<span></span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid export format='</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">'. Valid formats are </span><span class="si">{</span><span class="n">fmts</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>    <span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">onnx</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">coreml</span><span class="p">,</span> <span class="n">saved_model</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">tflite</span><span class="p">,</span> <span class="n">edgetpu</span><span class="p">,</span> <span class="n">tfjs</span><span class="p">,</span> <span class="n">paddle</span><span class="p">,</span> <span class="n">mnn</span><span class="p">,</span> <span class="n">ncnn</span><span class="p">,</span> <span class="n">imx</span><span class="p">,</span> <span class="n">rknn</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
<span></span>        <span class="n">flags</span>  <span class="c1"># export booleans</span>
<span></span>    <span class="p">)</span>
<span></span>
<span></span>    <span class="n">is_tf_format</span> <span class="o">=</span> <span class="nb">any</span><span class="p">((</span><span class="n">saved_model</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">tflite</span><span class="p">,</span> <span class="n">edgetpu</span><span class="p">,</span> <span class="n">tfjs</span><span class="p">))</span>
<span></span>
<span></span>    <span class="c1"># Device</span>
<span></span>    <span class="n">dla</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>    <span class="k">if</span> <span class="n">engine</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"TensorRT requires GPU export, automatically assigning device=0"</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">"0"</span>
<span></span>    <span class="k">if</span> <span class="n">engine</span> <span class="ow">and</span> <span class="s2">"dla"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>  <span class="c1"># convert int/list to str first</span>
<span></span>        <span class="n">dla</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">"0"</span>  <span class="c1"># update device to "0"</span>
<span></span>        <span class="k">assert</span> <span class="n">dla</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"0"</span><span class="p">,</span> <span class="s2">"1"</span><span class="p">},</span> <span class="sa">f</span><span class="s2">"Expected self.args.device='dla:0' or 'dla:1, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">."</span>
<span></span>    <span class="k">if</span> <span class="n">imx</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Exporting on CPU while CUDA is available, setting device=0 for faster export on GPU."</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">"0"</span>  <span class="c1"># update device to "0"</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">select_device</span><span class="p">(</span><span class="s2">"cpu"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Argument compatibility checks</span>
<span></span>    <span class="n">fmt_keys</span> <span class="o">=</span> <span class="n">fmts_dict</span><span class="p">[</span><span class="s2">"Arguments"</span><span class="p">][</span><span class="n">flags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span></span>    <span class="n">validate_args</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt_keys</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">imx</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"IMX export requires int8=True, setting int8=True."</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"IMX export requires nms=True, setting nms=True."</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"detect"</span><span class="p">,</span> <span class="s2">"pose"</span><span class="p">}:</span>
<span></span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"IMX export only supported for detection and pose estimation models."</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"names"</span><span class="p">):</span>
<span></span>        <span class="n">model</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">default_class_names</span><span class="p">()</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">check_class_names</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"half=True and int8=True are mutually exclusive, setting half=False."</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="ow">and</span> <span class="p">(</span><span class="n">onnx</span> <span class="ow">or</span> <span class="n">jit</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"cpu"</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"half=True only compatible with GPU export, i.e. use device=0, setting half=False."</span><span class="p">)</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span> <span class="o">=</span> <span class="n">check_imgsz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">imgsz</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">stride</span><span class="p">,</span> <span class="n">min_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># check image size</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">optimize</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">ncnn</span><span class="p">,</span> <span class="s2">"optimize=True not compatible with format='ncnn', i.e. use optimize=False"</span>
<span></span>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"cpu"</span><span class="p">,</span> <span class="s2">"optimize=True not compatible with cuda devices, i.e. use device='cpu'"</span>
<span></span>    <span class="k">if</span> <span class="n">rknn</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>                <span class="s2">"Rockchip RKNN export requires a missing 'name' arg for processor type. "</span>
<span></span>                <span class="s2">"Using default name='rk3588'."</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"rk3588"</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span></span>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">RKNN_CHIPS</span><span class="p">,</span> <span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"Invalid processor name '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for Rockchip RKNN export. Valid names are </span><span class="si">{</span><span class="n">RKNN_CHIPS</span><span class="si">}</span><span class="s2">."</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="ow">and</span> <span class="n">tflite</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="s2">"TFLite INT8 export not supported for end2end models."</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ClassificationModel</span><span class="p">),</span> <span class="s2">"'nms=True' is not valid for classification models."</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">tflite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ARM64</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">LINUX</span><span class="p">,</span> <span class="s2">"TFLite export with NMS unsupported on ARM64 Linux"</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_tf_format</span> <span class="ow">or</span> <span class="n">TORCH_1_13</span><span class="p">,</span> <span class="s2">"TensorFlow exports with NMS require torch&gt;=1.13"</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">onnx</span> <span class="ow">or</span> <span class="n">TORCH_1_13</span><span class="p">,</span> <span class="s2">"ONNX export with NMS requires torch&gt;=1.13"</span>
<span></span>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">RTDETRDecoder</span><span class="p">):</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"'nms=True' is not available for end2end models. Forcing 'nms=False'."</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">conf</span> <span class="ow">or</span> <span class="mf">0.25</span>  <span class="c1"># set conf default value for nms export</span>
<span></span>    <span class="k">if</span> <span class="p">(</span><span class="n">engine</span> <span class="ow">or</span> <span class="n">coreml</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"'dynamic=True' model with '</span><span class="si">{</span><span class="s1">'nms=True'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="sa">f</span><span class="s1">'format=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s1">'</span><span class="si">}</span><span class="s2">' requires max batch size, i.e. 'batch=16'"</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">edgetpu</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">LINUX</span> <span class="ow">or</span> <span class="n">ARM64</span><span class="p">:</span>
<span></span>            <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
<span></span>                <span class="s2">"Edge TPU export only supported on non-aarch64 Linux. See https://coral.ai/docs/edgetpu/compiler"</span>
<span></span>            <span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># see github.com/ultralytics/ultralytics/pull/13420</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Edge TPU export requires batch size 1, setting batch=1."</span><span class="p">)</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="mi">1</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">WorldModel</span><span class="p">):</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="s2">"YOLOWorld (original version) export is not supported to any format. "</span>
<span></span>            <span class="s2">"YOLOWorldv2 models (i.e. 'yolov8s-worldv2.pt') only support export to "</span>
<span></span>            <span class="s2">"(torchscript, onnx, openvino, engine, coreml) formats. "</span>
<span></span>            <span class="s2">"See https://docs.ultralytics.com/models/yolo-world for details."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">model</span><span class="o">.</span><span class="n">clip_model</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># openvino int8 export error: https://github.com/ultralytics/ultralytics/pull/18445</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">DEFAULT_CFG</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">TASK2DATA</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"task"</span><span class="p">,</span> <span class="s2">"detect"</span><span class="p">)]</span>  <span class="c1"># assign default data</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"INT8 export requires a missing 'data' arg for calibration. Using default 'data=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">'."</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">tfjs</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ARM64</span> <span class="ow">and</span> <span class="n">LINUX</span><span class="p">):</span>
<span></span>        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span><span class="s2">"TF.js exports are not currently supported on ARM64 Linux"</span><span class="p">)</span>
<span></span>    <span class="c1"># Recommend OpenVINO if export and Intel CPU</span>
<span></span>    <span class="k">if</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"openvino_msg"</span><span class="p">):</span>
<span></span>        <span class="k">if</span> <span class="n">is_intel</span><span class="p">():</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<span></span>                <span class="s2">"💡 ProTip: Export to OpenVINO format for best performance on Intel hardware."</span>
<span></span>                <span class="s2">" Learn more at https://docs.ultralytics.com/integrations/openvino/"</span>
<span></span>            <span class="p">)</span>
<span></span>        <span class="n">SETTINGS</span><span class="p">[</span><span class="s2">"openvino_msg"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>
<span></span>    <span class="c1"># Input</span>
<span></span>    <span class="n">im</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"channels"</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="n">file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<span></span>        <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"pt_path"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"yaml_file"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">model</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"yaml_file"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">".yaml"</span><span class="p">,</span> <span class="s2">".yml"</span><span class="p">}:</span>
<span></span>        <span class="n">file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Update model</span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<span></span>        <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span></span>    <span class="n">model</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span></span>    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fuse</span><span class="p">()</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="n">imx</span><span class="p">:</span>
<span></span>        <span class="kn">from</span><span class="w"> </span><span class="nn">ultralytics.utils.export.imx</span><span class="w"> </span><span class="kn">import</span> <span class="n">FXModel</span>
<span></span>
<span></span>        <span class="n">model</span> <span class="o">=</span> <span class="n">FXModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">modules</span><span class="p">():</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Classify</span><span class="p">):</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">export</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">Detect</span><span class="p">,</span> <span class="n">RTDETRDecoder</span><span class="p">)):</span>  <span class="c1"># includes all Detect subclasses like Segment, Pose, OBB</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">dynamic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">export</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">max_det</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">xyxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coreml</span>
<span></span>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"pe"</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"fuse"</span><span class="p">):</span>  <span class="c1"># for YOLOE models</span>
<span></span>                <span class="n">m</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">pe</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
<span></span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">C2f</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_tf_format</span><span class="p">:</span>
<span></span>            <span class="c1"># EdgeTPU does not support FlexSplitV while split provides cleaner ONNX graph</span>
<span></span>            <span class="n">m</span><span class="o">.</span><span class="n">forward</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">forward_split</span>
<span></span>
<span></span>    <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>  <span class="c1"># dry runs</span>
<span></span>        <span class="n">y</span> <span class="o">=</span> <span class="n">NMSModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)(</span><span class="n">im</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">coreml</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">imx</span> <span class="k">else</span> <span class="n">model</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="ow">and</span> <span class="p">(</span><span class="n">onnx</span> <span class="ow">or</span> <span class="n">jit</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">"cpu"</span><span class="p">:</span>
<span></span>        <span class="n">im</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">half</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>  <span class="c1"># to FP16</span>
<span></span>
<span></span>    <span class="c1"># Filter warnings</span>
<span></span>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">TracerWarning</span><span class="p">)</span>  <span class="c1"># suppress TracerWarning</span>
<span></span>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>  <span class="c1"># suppress shape prim::Constant missing ONNX warning</span>
<span></span>    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>  <span class="c1"># suppress CoreML np.bool deprecation warning</span>
<span></span>
<span></span>    <span class="c1"># Assign</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">im</span> <span class="o">=</span> <span class="n">im</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">output_shape</span> <span class="o">=</span> <span class="p">(</span>
<span></span>        <span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span>
<span></span>        <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">)</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">pretty_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"yaml_file"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">))</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"yolo"</span><span class="p">,</span> <span class="s2">"YOLO"</span><span class="p">)</span>
<span></span>    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"args"</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s2">""</span>
<span></span>    <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Ultralytics </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pretty_name</span><span class="si">}</span><span class="s2"> model </span><span class="si">{</span><span class="sa">f</span><span class="s1">'trained on </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1">'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">''</span><span class="si">}</span><span class="s2">"</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<span></span>        <span class="s2">"description"</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
<span></span>        <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Ultralytics"</span><span class="p">,</span>
<span></span>        <span class="s2">"date"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
<span></span>        <span class="s2">"version"</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
<span></span>        <span class="s2">"license"</span><span class="p">:</span> <span class="s2">"AGPL-3.0 License (https://ultralytics.com/license)"</span><span class="p">,</span>
<span></span>        <span class="s2">"docs"</span><span class="p">:</span> <span class="s2">"https://docs.ultralytics.com"</span><span class="p">,</span>
<span></span>        <span class="s2">"stride"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">stride</span><span class="p">)),</span>
<span></span>        <span class="s2">"task"</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
<span></span>        <span class="s2">"batch"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span>
<span></span>        <span class="s2">"imgsz"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">,</span>
<span></span>        <span class="s2">"names"</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
<span></span>        <span class="s2">"args"</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fmt_keys</span><span class="p">},</span>
<span></span>        <span class="s2">"channels"</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"channels"</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span></span>    <span class="p">}</span>  <span class="c1"># model metadata</span>
<span></span>    <span class="k">if</span> <span class="n">dla</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">"dla"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dla</span>  <span class="c1"># make sure `AutoBackend` uses correct dla device if it has one</span>
<span></span>    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"pose"</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">"kpt_shape"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">kpt_shape</span>
<span></span>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">"kpt_names"</span><span class="p">):</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">"kpt_names"</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">kpt_names</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<span></span>        <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'PyTorch:'</span><span class="p">)</span><span class="si">}</span><span class="s2"> starting from '</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">' with input shape </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2"> BCHW and "</span>
<span></span>        <span class="sa">f</span><span class="s2">"output shape(s) </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_shape</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">file_size</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB)"</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">run_callbacks</span><span class="p">(</span><span class="s2">"on_export_start"</span><span class="p">)</span>
<span></span>    <span class="c1"># Exports</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmts</span><span class="p">)</span>  <span class="c1"># exported filenames</span>
<span></span>    <span class="k">if</span> <span class="n">jit</span><span class="p">:</span>  <span class="c1"># TorchScript</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_torchscript</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">engine</span><span class="p">:</span>  <span class="c1"># TensorRT required before ONNX</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_engine</span><span class="p">(</span><span class="n">dla</span><span class="o">=</span><span class="n">dla</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">onnx</span> <span class="ow">or</span> <span class="n">ncnn</span><span class="p">:</span>  <span class="c1"># ONNX</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">xml</span><span class="p">:</span>  <span class="c1"># OpenVINO</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_openvino</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">coreml</span><span class="p">:</span>  <span class="c1"># CoreML</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_coreml</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">is_tf_format</span><span class="p">:</span>  <span class="c1"># TensorFlow formats</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="o">|=</span> <span class="n">edgetpu</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">keras_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_saved_model</span><span class="p">()</span>
<span></span>        <span class="k">if</span> <span class="n">pb</span> <span class="ow">or</span> <span class="n">tfjs</span><span class="p">:</span>  <span class="c1"># pb prerequisite to tfjs</span>
<span></span>            <span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_pb</span><span class="p">(</span><span class="n">keras_model</span><span class="o">=</span><span class="n">keras_model</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">tflite</span><span class="p">:</span>
<span></span>            <span class="n">f</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_tflite</span><span class="p">()</span>
<span></span>        <span class="k">if</span> <span class="n">edgetpu</span><span class="p">:</span>
<span></span>            <span class="n">f</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_edgetpu</span><span class="p">(</span><span class="n">tflite_model</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_full_integer_quant.tflite"</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">tfjs</span><span class="p">:</span>
<span></span>            <span class="n">f</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_tfjs</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">paddle</span><span class="p">:</span>  <span class="c1"># PaddlePaddle</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_paddle</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">mnn</span><span class="p">:</span>  <span class="c1"># MNN</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_mnn</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">ncnn</span><span class="p">:</span>  <span class="c1"># NCNN</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_ncnn</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">imx</span><span class="p">:</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_imx</span><span class="p">()</span>
<span></span>    <span class="k">if</span> <span class="n">rknn</span><span class="p">:</span>
<span></span>        <span class="n">f</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_rknn</span><span class="p">()</span>
<span></span>
<span></span>    <span class="c1"># Finish</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>  <span class="c1"># filter out '' and None</span>
<span></span>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span></span>        <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span></span>        <span class="n">square</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span></span>        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="s2">""</span>
<span></span>            <span class="k">if</span> <span class="n">square</span>
<span></span>            <span class="k">else</span> <span class="sa">f</span><span class="s2">"WARNING ⚠️ non-PyTorch val requires square images, 'imgsz=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="si">}</span><span class="s2">' will not "</span>
<span></span>            <span class="sa">f</span><span class="s2">"work. Use export 'imgsz=</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">)</span><span class="si">}</span><span class="s2">' if val is required."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">imgsz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">square</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<span></span>        <span class="n">predict_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"data=</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"segment"</span> <span class="ow">and</span> <span class="n">pb</span> <span class="k">else</span> <span class="s2">""</span>
<span></span>        <span class="n">q</span> <span class="o">=</span> <span class="s2">"int8"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="k">else</span> <span class="s2">"half"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="k">else</span> <span class="s2">""</span>  <span class="c1"># quantization</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Export complete (</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s)"</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Results saved to </span><span class="si">{</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'bold'</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span><span class="si">}</span><span class="s2">"</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Predict:         yolo predict task=</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2"> model=</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> imgsz=</span><span class="si">{</span><span class="n">imgsz</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">predict_data</span><span class="si">}</span><span class="s2">"</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Validate:        yolo val task=</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">task</span><span class="si">}</span><span class="s2"> model=</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> imgsz=</span><span class="si">{</span><span class="n">imgsz</span><span class="si">}</span><span class="s2"> data=</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">"</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Visualize:       https://netron.app"</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">run_callbacks</span><span class="p">(</span><span class="s2">"on_export_end"</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>  <span class="c1"># return list of exported files/dirs</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.add_callback">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">add_callback</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">add_callback</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Append the given callback to the specified event.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1358</span>
<span>1359</span>
<span>1360</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Append the given callback to the specified event."""</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">[</span><span class="n">event</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_coreml">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_coreml</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_coreml</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'CoreML:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to CoreML format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>871</span>
<span>872</span>
<span>873</span>
<span>874</span>
<span>875</span>
<span>876</span>
<span>877</span>
<span>878</span>
<span>879</span>
<span>880</span>
<span>881</span>
<span>882</span>
<span>883</span>
<span>884</span>
<span>885</span>
<span>886</span>
<span>887</span>
<span>888</span>
<span>889</span>
<span>890</span>
<span>891</span>
<span>892</span>
<span>893</span>
<span>894</span>
<span>895</span>
<span>896</span>
<span>897</span>
<span>898</span>
<span>899</span>
<span>900</span>
<span>901</span>
<span>902</span>
<span>903</span>
<span>904</span>
<span>905</span>
<span>906</span>
<span>907</span>
<span>908</span>
<span>909</span>
<span>910</span>
<span>911</span>
<span>912</span>
<span>913</span>
<span>914</span>
<span>915</span>
<span>916</span>
<span>917</span>
<span>918</span>
<span>919</span>
<span>920</span>
<span>921</span>
<span>922</span>
<span>923</span>
<span>924</span>
<span>925</span>
<span>926</span>
<span>927</span>
<span>928</span>
<span>929</span>
<span>930</span>
<span>931</span>
<span>932</span>
<span>933</span>
<span>934</span>
<span>935</span>
<span>936</span>
<span>937</span>
<span>938</span>
<span>939</span>
<span>940</span>
<span>941</span>
<span>942</span>
<span>943</span>
<span>944</span>
<span>945</span>
<span>946</span>
<span>947</span>
<span>948</span>
<span>949</span>
<span>950</span>
<span>951</span>
<span>952</span>
<span>953</span>
<span>954</span>
<span>955</span>
<span>956</span>
<span>957</span>
<span>958</span>
<span>959</span>
<span>960</span>
<span>961</span>
<span>962</span>
<span>963</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_coreml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"CoreML:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to CoreML format."""</span>
<span></span>    <span class="n">mlmodel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"mlmodel"</span>  <span class="c1"># legacy *.mlmodel export format requested</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"coremltools&gt;=8.0"</span><span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">coremltools</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ct</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with coremltools </span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="n">WINDOWS</span><span class="p">,</span> <span class="s2">"CoreML export is not supported on Windows, please run on macOS or Linux."</span>
<span></span>    <span class="k">assert</span> <span class="n">TORCH_1_11</span><span class="p">,</span> <span class="s2">"CoreML export requires torch&gt;=1.11"</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span> <span class="p">(</span>
<span></span>            <span class="s2">"batch sizes &gt; 1 are not supported without 'dynamic=True' for CoreML export. Please retry at 'dynamic=True'."</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">,</span> <span class="p">(</span>
<span></span>            <span class="s2">"'nms=True' cannot be used together with 'dynamic=True' for CoreML export. Please disable one of them."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">!=</span> <span class="s2">"classify"</span><span class="p">,</span> <span class="s2">"'dynamic=True' is not supported for CoreML classification models."</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".mlmodel"</span> <span class="k">if</span> <span class="n">mlmodel</span> <span class="k">else</span> <span class="s2">".mlpackage"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
<span></span>        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">classifier_config</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"classify"</span><span class="p">:</span>
<span></span>        <span class="n">classifier_config</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">ClassifierConfig</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span></span>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<span></span>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"detect"</span><span class="p">:</span>
<span></span>        <span class="n">model</span> <span class="o">=</span> <span class="n">IOSDetectModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">mlprogram</span><span class="o">=</span><span class="ow">not</span> <span class="n">mlmodel</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> 'nms=True' is only available for Detect models like 'yolo11n.pt'."</span><span class="p">)</span>
<span></span>            <span class="c1"># TODO CoreML Segment and Pose model pipelining</span>
<span></span>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
<span></span>    <span class="n">ts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># TorchScript model</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span><span class="p">:</span>
<span></span>        <span class="n">input_shape</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">Shape</span><span class="p">(</span>
<span></span>            <span class="n">shape</span><span class="o">=</span><span class="p">(</span>
<span></span>                <span class="n">ct</span><span class="o">.</span><span class="n">RangeDim</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span></span>                <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span></span>                <span class="n">ct</span><span class="o">.</span><span class="n">RangeDim</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<span></span>                <span class="n">ct</span><span class="o">.</span><span class="n">RangeDim</span><span class="p">(</span><span class="n">lower_bound</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">upper_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<span></span>            <span class="p">)</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="o">.</span><span class="n">TensorType</span><span class="p">(</span><span class="s2">"image"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">input_shape</span><span class="p">)]</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="o">.</span><span class="n">ImageType</span><span class="p">(</span><span class="s2">"image"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])]</span>
<span></span>
<span></span>    <span class="c1"># Based on apple's documentation it is better to leave out the minimum_deployment target and let that get set</span>
<span></span>    <span class="c1"># Internally based on the model conversion and output type.</span>
<span></span>    <span class="c1"># Setting minimum_depoloyment_target &gt;= iOS16 will require setting compute_precision=ct.precision.FLOAT32.</span>
<span></span>    <span class="c1"># iOS16 adds in better support for FP16, but none of the CoreML NMS specifications handle FP16 as input.</span>
<span></span>    <span class="n">ct_model</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
<span></span>        <span class="n">ts</span><span class="p">,</span>
<span></span>        <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
<span></span>        <span class="n">classifier_config</span><span class="o">=</span><span class="n">classifier_config</span><span class="p">,</span>
<span></span>        <span class="n">convert_to</span><span class="o">=</span><span class="s2">"neuralnetwork"</span> <span class="k">if</span> <span class="n">mlmodel</span> <span class="k">else</span> <span class="s2">"mlprogram"</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">bits</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">"kmeans"</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="k">else</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="s2">"linear"</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="k">else</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">bits</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="s2">"kmeans"</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span></span>            <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"scikit-learn"</span><span class="p">)</span>  <span class="c1"># scikit-learn package required for k-means quantization</span>
<span></span>        <span class="k">if</span> <span class="n">mlmodel</span><span class="p">:</span>
<span></span>            <span class="n">ct_model</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">neural_network</span><span class="o">.</span><span class="n">quantization_utils</span><span class="o">.</span><span class="n">quantize_weights</span><span class="p">(</span><span class="n">ct_model</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span></span>        <span class="k">elif</span> <span class="n">bits</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># mlprogram already quantized to FP16</span>
<span></span>            <span class="kn">import</span><span class="w"> </span><span class="nn">coremltools.optimize.coreml</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cto</span>
<span></span>
<span></span>            <span class="n">op_config</span> <span class="o">=</span> <span class="n">cto</span><span class="o">.</span><span class="n">OpPalettizerConfig</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">"kmeans"</span><span class="p">,</span> <span class="n">nbits</span><span class="o">=</span><span class="n">bits</span><span class="p">,</span> <span class="n">weight_threshold</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span></span>            <span class="n">config</span> <span class="o">=</span> <span class="n">cto</span><span class="o">.</span><span class="n">OptimizationConfig</span><span class="p">(</span><span class="n">global_config</span><span class="o">=</span><span class="n">op_config</span><span class="p">)</span>
<span></span>            <span class="n">ct_model</span> <span class="o">=</span> <span class="n">cto</span><span class="o">.</span><span class="n">palettize_weights</span><span class="p">(</span><span class="n">ct_model</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"detect"</span><span class="p">:</span>
<span></span>        <span class="n">ct_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_coreml</span><span class="p">(</span><span class="n">ct_model</span><span class="p">,</span> <span class="n">weights_dir</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">mlmodel</span> <span class="k">else</span> <span class="n">ct_model</span><span class="o">.</span><span class="n">weights_dir</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>  <span class="c1"># metadata dict</span>
<span></span>    <span class="n">ct_model</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"description"</span><span class="p">)</span>
<span></span>    <span class="n">ct_model</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"author"</span><span class="p">)</span>
<span></span>    <span class="n">ct_model</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"license"</span><span class="p">)</span>
<span></span>    <span class="n">ct_model</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"version"</span><span class="p">)</span>
<span></span>    <span class="n">ct_model</span><span class="o">.</span><span class="n">user_defined_metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"classify"</span><span class="p">:</span>
<span></span>        <span class="n">ct_model</span><span class="o">.</span><span class="n">user_defined_metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">"com.apple.coreml.model.preview.type"</span><span class="p">:</span> <span class="s2">"imageClassifier"</span><span class="p">})</span>
<span></span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="n">ct_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>  <span class="c1"># save *.mlpackage</span>
<span></span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> CoreML export to *.mlpackage failed (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">), reverting to *.mlmodel export. "</span>
<span></span>            <span class="sa">f</span><span class="s2">"Known coremltools Python 3.11 and Windows bugs https://github.com/apple/coremltools/issues/1928."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".mlmodel"</span><span class="p">)</span>
<span></span>        <span class="n">ct_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_edgetpu">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_edgetpu</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_edgetpu</span><span class="p">(</span><span class="n">tflite_model</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'Edge TPU:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to Edge TPU format <a href="https://coral.ai/docs/edgetpu/models-intro/">https://coral.ai/docs/edgetpu/models-intro/</a>.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1125</span>
<span>1126</span>
<span>1127</span>
<span>1128</span>
<span>1129</span>
<span>1130</span>
<span>1131</span>
<span>1132</span>
<span>1133</span>
<span>1134</span>
<span>1135</span>
<span>1136</span>
<span>1137</span>
<span>1138</span>
<span>1139</span>
<span>1140</span>
<span>1141</span>
<span>1142</span>
<span>1143</span>
<span>1144</span>
<span>1145</span>
<span>1146</span>
<span>1147</span>
<span>1148</span>
<span>1149</span>
<span>1150</span>
<span>1151</span>
<span>1152</span>
<span>1153</span>
<span>1154</span>
<span>1155</span>
<span>1156</span>
<span>1157</span>
<span>1158</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_edgetpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tflite_model</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"Edge TPU:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to Edge TPU format https://coral.ai/docs/edgetpu/models-intro/."""</span>
<span></span>    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">"edgetpu_compiler --version"</span>
<span></span>    <span class="n">help_url</span> <span class="o">=</span> <span class="s2">"https://coral.ai/docs/edgetpu/compiler/"</span>
<span></span>    <span class="k">assert</span> <span class="n">LINUX</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"export only supported on Linux. See </span><span class="si">{</span><span class="n">help_url</span><span class="si">}</span><span class="s2">"</span>
<span></span>    <span class="k">if</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> export requires Edge TPU compiler. Attempting install from </span><span class="si">{</span><span class="n">help_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span>
<span></span>            <span class="s2">"curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -"</span><span class="p">,</span>
<span></span>            <span class="s1">'echo "deb https://packages.cloud.google.com/apt coral-edgetpu-stable main" | '</span>
<span></span>            <span class="s2">"sudo tee /etc/apt/sources.list.d/coral-edgetpu.list"</span><span class="p">,</span>
<span></span>            <span class="s2">"sudo apt-get update"</span><span class="p">,</span>
<span></span>            <span class="s2">"sudo apt-get install edgetpu-compiler"</span><span class="p">,</span>
<span></span>        <span class="p">):</span>
<span></span>            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">c</span> <span class="k">if</span> <span class="n">is_sudo_available</span><span class="p">()</span> <span class="k">else</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"sudo "</span><span class="p">,</span> <span class="s2">""</span><span class="p">),</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>    <span class="n">ver</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with Edge TPU compiler </span><span class="si">{</span><span class="n">ver</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tflite_model</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".tflite"</span><span class="p">,</span> <span class="s2">"_edgetpu.tflite"</span><span class="p">)</span>  <span class="c1"># Edge TPU model</span>
<span></span>
<span></span>    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
<span></span>        <span class="s2">"edgetpu_compiler "</span>
<span></span>        <span class="sa">f</span><span class="s1">'--out_dir "</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s1">" '</span>
<span></span>        <span class="s2">"--show_operations "</span>
<span></span>        <span class="s2">"--search_delegate "</span>
<span></span>        <span class="s2">"--delegate_search_step 30 "</span>
<span></span>        <span class="s2">"--timeout_sec 180 "</span>
<span></span>        <span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">tflite_model</span><span class="si">}</span><span class="s1">"'</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> running '</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span></span>    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">_add_tflite_metadata</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_engine">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_engine</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_engine</span><span class="p">(</span><span class="n">dla</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TensorRT:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TensorRT format <a href="https://developer.nvidia.com/tensorrt">https://developer.nvidia.com/tensorrt</a>.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span> 965</span>
<span> 966</span>
<span> 967</span>
<span> 968</span>
<span> 969</span>
<span> 970</span>
<span> 971</span>
<span> 972</span>
<span> 973</span>
<span> 974</span>
<span> 975</span>
<span> 976</span>
<span> 977</span>
<span> 978</span>
<span> 979</span>
<span> 980</span>
<span> 981</span>
<span> 982</span>
<span> 983</span>
<span> 984</span>
<span> 985</span>
<span> 986</span>
<span> 987</span>
<span> 988</span>
<span> 989</span>
<span> 990</span>
<span> 991</span>
<span> 992</span>
<span> 993</span>
<span> 994</span>
<span> 995</span>
<span> 996</span>
<span> 997</span>
<span> 998</span>
<span> 999</span>
<span>1000</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dla</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TensorRT:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TensorRT format https://developer.nvidia.com/tensorrt."""</span>
<span></span>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s2">"cpu"</span><span class="p">,</span> <span class="s2">"export running on CPU but must be on GPU, i.e. use 'device=0'"</span>
<span></span>    <span class="n">f_onnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">()</span>  <span class="c1"># run before TRT import https://github.com/ultralytics/ultralytics/issues/7016</span>
<span></span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">tensorrt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">trt</span>  <span class="c1"># noqa</span>
<span></span>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span></span>        <span class="k">if</span> <span class="n">LINUX</span><span class="p">:</span>
<span></span>            <span class="n">cuda_version</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="n">check_requirements</span><span class="p">(</span><span class="sa">f</span><span class="s2">"tensorrt-cu</span><span class="si">{</span><span class="n">cuda_version</span><span class="si">}</span><span class="s2">&gt;7.0.0,!=10.1.0"</span><span class="p">)</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">tensorrt</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">trt</span>  <span class="c1"># noqa</span>
<span></span>    <span class="n">check_version</span><span class="p">(</span><span class="n">trt</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">"&gt;=7.0.0"</span><span class="p">,</span> <span class="n">hard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>    <span class="n">check_version</span><span class="p">(</span><span class="n">trt</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s2">"!=10.1.0"</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">"https://github.com/ultralytics/ultralytics/pull/14239"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Setup and checks</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with TensorRT </span><span class="si">{</span><span class="n">trt</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">f_onnx</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">"failed to export ONNX file: </span><span class="si">{</span><span class="n">f_onnx</span><span class="si">}</span><span class="s2">"</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".engine"</span><span class="p">)</span>  <span class="c1"># TensorRT engine file</span>
<span></span>    <span class="n">onnx2engine</span><span class="p">(</span>
<span></span>        <span class="n">f_onnx</span><span class="p">,</span>
<span></span>        <span class="n">f</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">workspace</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
<span></span>        <span class="n">dla</span><span class="o">=</span><span class="n">dla</span><span class="p">,</span>
<span></span>        <span class="n">dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_int8_calibration_dataloader</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
<span></span>        <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
<span></span>        <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_imx">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_imx</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_imx</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'IMX:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to IMX format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1220</span>
<span>1221</span>
<span>1222</span>
<span>1223</span>
<span>1224</span>
<span>1225</span>
<span>1226</span>
<span>1227</span>
<span>1228</span>
<span>1229</span>
<span>1230</span>
<span>1231</span>
<span>1232</span>
<span>1233</span>
<span>1234</span>
<span>1235</span>
<span>1236</span>
<span>1237</span>
<span>1238</span>
<span>1239</span>
<span>1240</span>
<span>1241</span>
<span>1242</span>
<span>1243</span>
<span>1244</span>
<span>1245</span>
<span>1246</span>
<span>1247</span>
<span>1248</span>
<span>1249</span>
<span>1250</span>
<span>1251</span>
<span>1252</span>
<span>1253</span>
<span>1254</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_imx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"IMX:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to IMX format."""</span>
<span></span>    <span class="k">assert</span> <span class="n">LINUX</span><span class="p">,</span> <span class="p">(</span>
<span></span>        <span class="s2">"export only supported on Linux. "</span>
<span></span>        <span class="s2">"See https://developer.aitrios.sony-semicon.com/en/raspberrypi-ai-camera/documentation/imx500-converter"</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">"end2end"</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<span></span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"IMX export is not supported for end2end models."</span><span class="p">)</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span>
<span></span>        <span class="p">(</span><span class="s2">"model-compression-toolkit&gt;=2.4.1"</span><span class="p">,</span> <span class="s2">"sony-custom-layers&gt;=0.3.0"</span><span class="p">,</span> <span class="s2">"edge-mdt-tpc&gt;=1.1.0"</span><span class="p">,</span> <span class="s2">"pydantic&lt;=2.11.7"</span><span class="p">)</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"imx500-converter[pt]&gt;=3.16.1"</span><span class="p">)</span>  <span class="c1"># Separate requirements for imx500-converter</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"mct-quantizers&gt;=1.6.0"</span><span class="p">)</span>  <span class="c1"># Separate for compatibility with model-compression-toolkit</span>
<span></span>
<span></span>    <span class="c1"># Install Java&gt;=17</span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="n">java_output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">"java"</span><span class="p">,</span> <span class="s2">"--version"</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span></span>        <span class="n">version_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"(?:openjdk|java) (\d+)"</span><span class="p">,</span> <span class="n">java_output</span><span class="p">)</span>
<span></span>        <span class="n">java_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">version_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">version_match</span> <span class="k">else</span> <span class="mi">0</span>
<span></span>        <span class="k">assert</span> <span class="n">java_version</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">"Java version too old"</span>
<span></span>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
<span></span>        <span class="n">cmd</span> <span class="o">=</span> <span class="p">([</span><span class="s2">"sudo"</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_sudo_available</span><span class="p">()</span> <span class="k">else</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"apt"</span><span class="p">,</span> <span class="s2">"install"</span><span class="p">,</span> <span class="s2">"-y"</span><span class="p">,</span> <span class="s2">"openjdk-21-jre"</span><span class="p">]</span>
<span></span>        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">torch2imx</span><span class="p">(</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">iou</span><span class="p">,</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span><span class="p">,</span>
<span></span>        <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
<span></span>        <span class="n">dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_int8_calibration_dataloader</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span>
<span></span>        <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_mnn">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_mnn</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_mnn</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'MNN:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to MNN format using MNN <a href="https://github.com/alibaba/MNN">https://github.com/alibaba/MNN</a>.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>778</span>
<span>779</span>
<span>780</span>
<span>781</span>
<span>782</span>
<span>783</span>
<span>784</span>
<span>785</span>
<span>786</span>
<span>787</span>
<span>788</span>
<span>789</span>
<span>790</span>
<span>791</span>
<span>792</span>
<span>793</span>
<span>794</span>
<span>795</span>
<span>796</span>
<span>797</span>
<span>798</span>
<span>799</span>
<span>800</span>
<span>801</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_mnn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"MNN:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to MNN format using MNN https://github.com/alibaba/MNN."""</span>
<span></span>    <span class="n">f_onnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">()</span>  <span class="c1"># get onnx model first</span>
<span></span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"MNN&gt;=2.9.6"</span><span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">MNN</span>  <span class="c1"># noqa</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">MNN.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">mnnconvert</span>
<span></span>
<span></span>    <span class="c1"># Setup and checks</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with MNN </span><span class="si">{</span><span class="n">MNN</span><span class="o">.</span><span class="n">version</span><span class="p">()</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="n">Path</span><span class="p">(</span><span class="n">f_onnx</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">"failed to export ONNX file: </span><span class="si">{</span><span class="n">f_onnx</span><span class="si">}</span><span class="s2">"</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".mnn"</span><span class="p">))</span>  <span class="c1"># MNN model file</span>
<span></span>    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">,</span> <span class="s2">"-f"</span><span class="p">,</span> <span class="s2">"ONNX"</span><span class="p">,</span> <span class="s2">"--modelFile"</span><span class="p">,</span> <span class="n">f_onnx</span><span class="p">,</span> <span class="s2">"--MNNModel"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s2">"--bizCode"</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)]</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s2">"--weightQuantBits"</span><span class="p">,</span> <span class="s2">"8"</span><span class="p">))</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span><span class="p">:</span>
<span></span>        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"--fp16"</span><span class="p">)</span>
<span></span>    <span class="n">mnnconvert</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span></span>    <span class="c1"># remove scratch file for model convert optimize</span>
<span></span>    <span class="n">convert_scratch</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">".__convert_external_data.bin"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">convert_scratch</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span></span>        <span class="n">convert_scratch</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_ncnn">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_ncnn</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_ncnn</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'NCNN:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to NCNN format using PNNX <a href="https://github.com/pnnx/pnnx">https://github.com/pnnx/pnnx</a>.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>803</span>
<span>804</span>
<span>805</span>
<span>806</span>
<span>807</span>
<span>808</span>
<span>809</span>
<span>810</span>
<span>811</span>
<span>812</span>
<span>813</span>
<span>814</span>
<span>815</span>
<span>816</span>
<span>817</span>
<span>818</span>
<span>819</span>
<span>820</span>
<span>821</span>
<span>822</span>
<span>823</span>
<span>824</span>
<span>825</span>
<span>826</span>
<span>827</span>
<span>828</span>
<span>829</span>
<span>830</span>
<span>831</span>
<span>832</span>
<span>833</span>
<span>834</span>
<span>835</span>
<span>836</span>
<span>837</span>
<span>838</span>
<span>839</span>
<span>840</span>
<span>841</span>
<span>842</span>
<span>843</span>
<span>844</span>
<span>845</span>
<span>846</span>
<span>847</span>
<span>848</span>
<span>849</span>
<span>850</span>
<span>851</span>
<span>852</span>
<span>853</span>
<span>854</span>
<span>855</span>
<span>856</span>
<span>857</span>
<span>858</span>
<span>859</span>
<span>860</span>
<span>861</span>
<span>862</span>
<span>863</span>
<span>864</span>
<span>865</span>
<span>866</span>
<span>867</span>
<span>868</span>
<span>869</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_ncnn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"NCNN:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to NCNN format using PNNX https://github.com/pnnx/pnnx."""</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"ncnn"</span><span class="p">,</span> <span class="n">cmds</span><span class="o">=</span><span class="s2">"--no-deps"</span><span class="p">)</span>  <span class="c1"># no deps to avoid installing opencv-python</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">ncnn</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with NCNN </span><span class="si">{</span><span class="n">ncnn</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"_ncnn_model</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
<span></span>    <span class="n">f_onnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".onnx"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"pnnx.exe"</span> <span class="k">if</span> <span class="n">WINDOWS</span> <span class="k">else</span> <span class="s2">"pnnx"</span><span class="p">)</span>  <span class="c1"># PNNX filename</span>
<span></span>    <span class="n">pnnx</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">ROOT</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">pnnx</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> PNNX not found. Attempting to download binary file from "</span>
<span></span>            <span class="s2">"https://github.com/pnnx/pnnx/.</span><span class="se">\n</span><span class="s2">Note PNNX Binary file must be placed in current working directory "</span>
<span></span>            <span class="sa">f</span><span class="s2">"or in </span><span class="si">{</span><span class="n">ROOT</span><span class="si">}</span><span class="s2">. See PNNX repo for full installation instructions."</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">system</span> <span class="o">=</span> <span class="s2">"macos"</span> <span class="k">if</span> <span class="n">MACOS</span> <span class="k">else</span> <span class="s2">"windows"</span> <span class="k">if</span> <span class="n">WINDOWS</span> <span class="k">else</span> <span class="s2">"linux-aarch64"</span> <span class="k">if</span> <span class="n">ARM64</span> <span class="k">else</span> <span class="s2">"linux"</span>
<span></span>        <span class="k">try</span><span class="p">:</span>
<span></span>            <span class="n">release</span><span class="p">,</span> <span class="n">assets</span> <span class="o">=</span> <span class="n">get_github_assets</span><span class="p">(</span><span class="n">repo</span><span class="o">=</span><span class="s2">"pnnx/pnnx"</span><span class="p">)</span>
<span></span>            <span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">assets</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">.zip"</span> <span class="ow">in</span> <span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">"Unable to retrieve PNNX repo assets"</span>  <span class="c1"># i.e. pnnx-20250930-macos.zip</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> successfully found latest PNNX asset file </span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span></span>            <span class="n">release</span> <span class="o">=</span> <span class="s2">"20250930"</span>
<span></span>            <span class="n">asset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"pnnx-</span><span class="si">{</span><span class="n">release</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">.zip"</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> PNNX GitHub assets not found: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using default </span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="n">unzip_dir</span> <span class="o">=</span> <span class="n">safe_download</span><span class="p">(</span><span class="sa">f</span><span class="s2">"https://github.com/pnnx/pnnx/releases/download/</span><span class="si">{</span><span class="n">release</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">check_is_path_safe</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span> <span class="n">unzip_dir</span><span class="p">):</span>  <span class="c1"># avoid path traversal security vulnerability</span>
<span></span>            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">unzip_dir</span> <span class="o">/</span> <span class="n">name</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">pnnx</span><span class="p">)</span>  <span class="c1"># move binary to ROOT</span>
<span></span>            <span class="n">pnnx</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="mo">0o777</span><span class="p">)</span>  <span class="c1"># set read, write, and execute permissions for everyone</span>
<span></span>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">unzip_dir</span><span class="p">)</span>  <span class="c1"># delete unzip dir</span>
<span></span>
<span></span>    <span class="n">ncnn_args</span> <span class="o">=</span> <span class="p">[</span>
<span></span>        <span class="sa">f</span><span class="s2">"ncnnparam=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model.ncnn.param'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"ncnnbin=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model.ncnn.bin'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"ncnnpy=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model_ncnn.py'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>    <span class="p">]</span>
<span></span>
<span></span>    <span class="n">pnnx_args</span> <span class="o">=</span> <span class="p">[</span>
<span></span>        <span class="sa">f</span><span class="s2">"pnnxparam=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model.pnnx.param'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"pnnxbin=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model.pnnx.bin'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"pnnxpy=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model_pnnx.py'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"pnnxonnx=</span><span class="si">{</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'model.pnnx.onnx'</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>    <span class="p">]</span>
<span></span>
<span></span>    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span>
<span></span>        <span class="nb">str</span><span class="p">(</span><span class="n">pnnx</span><span class="p">),</span>
<span></span>        <span class="nb">str</span><span class="p">(</span><span class="n">f_onnx</span><span class="p">),</span>
<span></span>        <span class="o">*</span><span class="n">ncnn_args</span><span class="p">,</span>
<span></span>        <span class="o">*</span><span class="n">pnnx_args</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"fp16=</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s2">"device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<span></span>        <span class="sa">f</span><span class="s1">'inputshape="</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">]</span><span class="si">}</span><span class="s1">"'</span><span class="p">,</span>
<span></span>    <span class="p">]</span>
<span></span>    <span class="n">f</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># make ncnn_model directory</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> running '</span><span class="si">{</span><span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span></span>    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Remove debug files</span>
<span></span>    <span class="n">pnnx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">"="</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pnnx_args</span><span class="p">]</span>
<span></span>    <span class="k">for</span> <span class="n">f_debug</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"debug.bin"</span><span class="p">,</span> <span class="s2">"debug.param"</span><span class="p">,</span> <span class="s2">"debug2.bin"</span><span class="p">,</span> <span class="s2">"debug2.param"</span><span class="p">,</span> <span class="o">*</span><span class="n">pnnx_files</span><span class="p">):</span>
<span></span>        <span class="n">Path</span><span class="p">(</span><span class="n">f_debug</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># add metadata.yaml</span>
<span></span>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_onnx">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_onnx</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_onnx</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'ONNX:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to ONNX format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>612</span>
<span>613</span>
<span>614</span>
<span>615</span>
<span>616</span>
<span>617</span>
<span>618</span>
<span>619</span>
<span>620</span>
<span>621</span>
<span>622</span>
<span>623</span>
<span>624</span>
<span>625</span>
<span>626</span>
<span>627</span>
<span>628</span>
<span>629</span>
<span>630</span>
<span>631</span>
<span>632</span>
<span>633</span>
<span>634</span>
<span>635</span>
<span>636</span>
<span>637</span>
<span>638</span>
<span>639</span>
<span>640</span>
<span>641</span>
<span>642</span>
<span>643</span>
<span>644</span>
<span>645</span>
<span>646</span>
<span>647</span>
<span>648</span>
<span>649</span>
<span>650</span>
<span>651</span>
<span>652</span>
<span>653</span>
<span>654</span>
<span>655</span>
<span>656</span>
<span>657</span>
<span>658</span>
<span>659</span>
<span>660</span>
<span>661</span>
<span>662</span>
<span>663</span>
<span>664</span>
<span>665</span>
<span>666</span>
<span>667</span>
<span>668</span>
<span>669</span>
<span>670</span>
<span>671</span>
<span>672</span>
<span>673</span>
<span>674</span>
<span>675</span>
<span>676</span>
<span>677</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_onnx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"ONNX:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to ONNX format."""</span>
<span></span>    <span class="n">requirements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"onnx&gt;=1.12.0"</span><span class="p">]</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">simplify</span><span class="p">:</span>
<span></span>        <span class="n">requirements</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"onnxslim&gt;=0.1.71"</span><span class="p">,</span> <span class="s2">"onnxruntime"</span> <span class="o">+</span> <span class="p">(</span><span class="s2">"-gpu"</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">""</span><span class="p">)]</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">onnx</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">opset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="ow">or</span> <span class="n">best_onnx_opset</span><span class="p">(</span><span class="n">onnx</span><span class="p">,</span> <span class="n">cuda</span><span class="o">=</span><span class="s2">"cuda"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with onnx </span><span class="si">{</span><span class="n">onnx</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2"> opset </span><span class="si">{</span><span class="n">opset</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">:</span>
<span></span>        <span class="k">assert</span> <span class="n">TORCH_1_13</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"'nms=True' ONNX export requires torch&gt;=1.13 (found torch==</span><span class="si">{</span><span class="n">TORCH_VERSION</span><span class="si">}</span><span class="s2">)"</span>
<span></span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".onnx"</span><span class="p">))</span>
<span></span>    <span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"output0"</span><span class="p">,</span> <span class="s2">"output1"</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">SegmentationModel</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="s2">"output0"</span><span class="p">]</span>
<span></span>    <span class="n">dynamic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span>
<span></span>    <span class="k">if</span> <span class="n">dynamic</span><span class="p">:</span>
<span></span>        <span class="n">dynamic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"images"</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"batch"</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">"height"</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">"width"</span><span class="p">}}</span>  <span class="c1"># shape(1,3,640,640)</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">SegmentationModel</span><span class="p">):</span>
<span></span>            <span class="n">dynamic</span><span class="p">[</span><span class="s2">"output0"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"batch"</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">"anchors"</span><span class="p">}</span>  <span class="c1"># shape(1, 116, 8400)</span>
<span></span>            <span class="n">dynamic</span><span class="p">[</span><span class="s2">"output1"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"batch"</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">"mask_height"</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">"mask_width"</span><span class="p">}</span>  <span class="c1"># shape(1,32,160,160)</span>
<span></span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">DetectionModel</span><span class="p">):</span>
<span></span>            <span class="n">dynamic</span><span class="p">[</span><span class="s2">"output0"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"batch"</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">"anchors"</span><span class="p">}</span>  <span class="c1"># shape(1, 84, 8400)</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span><span class="p">:</span>  <span class="c1"># only batch size is dynamic with NMS</span>
<span></span>            <span class="n">dynamic</span><span class="p">[</span><span class="s2">"output0"</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"obb"</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="o">=</span> <span class="n">opset</span>  <span class="c1"># for NMSModel</span>
<span></span>
<span></span>    <span class="k">with</span> <span class="n">arange_patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
<span></span>        <span class="n">torch2onnx</span><span class="p">(</span>
<span></span>            <span class="n">NMSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span>
<span></span>            <span class="n">f</span><span class="p">,</span>
<span></span>            <span class="n">opset</span><span class="o">=</span><span class="n">opset</span><span class="p">,</span>
<span></span>            <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"images"</span><span class="p">],</span>
<span></span>            <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">,</span>
<span></span>            <span class="n">dynamic</span><span class="o">=</span><span class="n">dynamic</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
<span></span>        <span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Checks</span>
<span></span>    <span class="n">model_onnx</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># load onnx model</span>
<span></span>
<span></span>    <span class="c1"># Simplify</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">simplify</span><span class="p">:</span>
<span></span>        <span class="k">try</span><span class="p">:</span>
<span></span>            <span class="kn">import</span><span class="w"> </span><span class="nn">onnxslim</span>
<span></span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> slimming with onnxslim </span><span class="si">{</span><span class="n">onnxslim</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>            <span class="n">model_onnx</span> <span class="o">=</span> <span class="n">onnxslim</span><span class="o">.</span><span class="n">slim</span><span class="p">(</span><span class="n">model_onnx</span><span class="p">)</span>
<span></span>
<span></span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> simplifier failure: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Metadata</span>
<span></span>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span></span>        <span class="n">meta</span> <span class="o">=</span> <span class="n">model_onnx</span><span class="o">.</span><span class="n">metadata_props</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span></span>        <span class="n">meta</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># IR version</span>
<span></span>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model_onnx</span><span class="p">,</span> <span class="s2">"ir_version"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> limiting IR version </span><span class="si">{</span><span class="n">model_onnx</span><span class="o">.</span><span class="n">ir_version</span><span class="si">}</span><span class="s2"> to 10 for ONNXRuntime compatibility..."</span><span class="p">)</span>
<span></span>        <span class="n">model_onnx</span><span class="o">.</span><span class="n">ir_version</span> <span class="o">=</span> <span class="mi">10</span>
<span></span>
<span></span>    <span class="n">onnx</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_onnx</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_openvino">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_openvino</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_openvino</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'OpenVINO:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to OpenVINO format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>679</span>
<span>680</span>
<span>681</span>
<span>682</span>
<span>683</span>
<span>684</span>
<span>685</span>
<span>686</span>
<span>687</span>
<span>688</span>
<span>689</span>
<span>690</span>
<span>691</span>
<span>692</span>
<span>693</span>
<span>694</span>
<span>695</span>
<span>696</span>
<span>697</span>
<span>698</span>
<span>699</span>
<span>700</span>
<span>701</span>
<span>702</span>
<span>703</span>
<span>704</span>
<span>705</span>
<span>706</span>
<span>707</span>
<span>708</span>
<span>709</span>
<span>710</span>
<span>711</span>
<span>712</span>
<span>713</span>
<span>714</span>
<span>715</span>
<span>716</span>
<span>717</span>
<span>718</span>
<span>719</span>
<span>720</span>
<span>721</span>
<span>722</span>
<span>723</span>
<span>724</span>
<span>725</span>
<span>726</span>
<span>727</span>
<span>728</span>
<span>729</span>
<span>730</span>
<span>731</span>
<span>732</span>
<span>733</span>
<span>734</span>
<span>735</span>
<span>736</span>
<span>737</span>
<span>738</span>
<span>739</span>
<span>740</span>
<span>741</span>
<span>742</span>
<span>743</span>
<span>744</span>
<span>745</span>
<span>746</span>
<span>747</span>
<span>748</span>
<span>749</span>
<span>750</span>
<span>751</span>
<span>752</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_openvino</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"OpenVINO:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to OpenVINO format."""</span>
<span></span>    <span class="c1"># OpenVINO &lt;= 2025.1.0 error on macOS 15.4+: https://github.com/openvinotoolkit/openvino/issues/30023"</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"openvino&gt;=2025.2.0"</span> <span class="k">if</span> <span class="n">MACOS</span> <span class="ow">and</span> <span class="n">MACOS_VERSION</span> <span class="o">&gt;=</span> <span class="s2">"15.4"</span> <span class="k">else</span> <span class="s2">"openvino&gt;=2024.0.0"</span><span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">openvino</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ov</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with openvino </span><span class="si">{</span><span class="n">ov</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="k">assert</span> <span class="n">TORCH_2_1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"OpenVINO export requires torch&gt;=2.1 but torch==</span><span class="si">{</span><span class="n">TORCH_VERSION</span><span class="si">}</span><span class="s2"> is installed"</span>
<span></span>    <span class="n">ov_model</span> <span class="o">=</span> <span class="n">ov</span><span class="o">.</span><span class="n">convert_model</span><span class="p">(</span>
<span></span>        <span class="n">NMSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<span></span>        <span class="nb">input</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">],</span>
<span></span>        <span class="n">example_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">ov_model</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Set RT info, serialize, and save metadata YAML."""</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">(</span><span class="s2">"YOLO"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"model_type"</span><span class="p">])</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"reverse_input_channels"</span><span class="p">])</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"pad_value"</span><span class="p">])</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">([</span><span class="mf">255.0</span><span class="p">],</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"scale_values"</span><span class="p">])</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">iou</span><span class="p">,</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"iou_threshold"</span><span class="p">])</span>
<span></span>        <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"labels"</span><span class="p">])</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">!=</span> <span class="s2">"classify"</span><span class="p">:</span>
<span></span>            <span class="n">ov_model</span><span class="o">.</span><span class="n">set_rt_info</span><span class="p">(</span><span class="s2">"fit_to_window_letterbox"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"model_info"</span><span class="p">,</span> <span class="s2">"resize_type"</span><span class="p">])</span>
<span></span>
<span></span>        <span class="n">ov</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">ov_model</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">compress_to_fp16</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span><span class="p">)</span>
<span></span>        <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># add metadata.yaml</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">fq</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"_int8_openvino_model</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>        <span class="n">fq_ov</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">fq</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".xml"</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span></span>        <span class="c1"># INT8 requires nncf, nncf requires packaging&gt;=23.2 https://github.com/openvinotoolkit/nncf/issues/3463</span>
<span></span>        <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"packaging&gt;=23.2"</span><span class="p">)</span>  <span class="c1"># must be installed first to build nncf wheel</span>
<span></span>        <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"nncf&gt;=2.14.0"</span><span class="p">)</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">nncf</span>
<span></span>
<span></span>        <span class="k">def</span><span class="w"> </span><span class="nf">transform_fn</span><span class="p">(</span><span class="n">data_item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span></span><span class="w">            </span><span class="sd">"""Quantization transform function."""</span>
<span></span>            <span class="n">data_item</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">data_item</span><span class="p">[</span><span class="s2">"img"</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data_item</span>
<span></span>            <span class="k">assert</span> <span class="n">data_item</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="s2">"Input image must be uint8 for the quantization preprocessing"</span>
<span></span>            <span class="n">im</span> <span class="o">=</span> <span class="n">data_item</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span>  <span class="c1"># uint8 to fp16/32 and 0-255 to 0.0-1.0</span>
<span></span>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">im</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">im</span>
<span></span>
<span></span>        <span class="c1"># Generate calibration data for integer quantization</span>
<span></span>        <span class="n">ignored_scope</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Detect</span><span class="p">):</span>
<span></span>            <span class="c1"># Includes all Detect subclasses like Segment, Pose, OBB, WorldDetect, YOLOEDetect</span>
<span></span>            <span class="n">head_module_name</span> <span class="o">=</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
<span></span>            <span class="n">ignored_scope</span> <span class="o">=</span> <span class="n">nncf</span><span class="o">.</span><span class="n">IgnoredScope</span><span class="p">(</span>  <span class="c1"># ignore operations</span>
<span></span>                <span class="n">patterns</span><span class="o">=</span><span class="p">[</span>
<span></span>                    <span class="sa">f</span><span class="s2">".*</span><span class="si">{</span><span class="n">head_module_name</span><span class="si">}</span><span class="s2">/.*/Add"</span><span class="p">,</span>
<span></span>                    <span class="sa">f</span><span class="s2">".*</span><span class="si">{</span><span class="n">head_module_name</span><span class="si">}</span><span class="s2">/.*/Sub*"</span><span class="p">,</span>
<span></span>                    <span class="sa">f</span><span class="s2">".*</span><span class="si">{</span><span class="n">head_module_name</span><span class="si">}</span><span class="s2">/.*/Mul*"</span><span class="p">,</span>
<span></span>                    <span class="sa">f</span><span class="s2">".*</span><span class="si">{</span><span class="n">head_module_name</span><span class="si">}</span><span class="s2">/.*/Div*"</span><span class="p">,</span>
<span></span>                    <span class="sa">f</span><span class="s2">".*</span><span class="si">{</span><span class="n">head_module_name</span><span class="si">}</span><span class="se">\\</span><span class="s2">.dfl.*"</span><span class="p">,</span>
<span></span>                <span class="p">],</span>
<span></span>                <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s2">"Sigmoid"</span><span class="p">],</span>
<span></span>            <span class="p">)</span>
<span></span>
<span></span>        <span class="n">quantized_ov_model</span> <span class="o">=</span> <span class="n">nncf</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span>
<span></span>            <span class="n">model</span><span class="o">=</span><span class="n">ov_model</span><span class="p">,</span>
<span></span>            <span class="n">calibration_dataset</span><span class="o">=</span><span class="n">nncf</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_int8_calibration_dataloader</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span> <span class="n">transform_fn</span><span class="p">),</span>
<span></span>            <span class="n">preset</span><span class="o">=</span><span class="n">nncf</span><span class="o">.</span><span class="n">QuantizationPreset</span><span class="o">.</span><span class="n">MIXED</span><span class="p">,</span>
<span></span>            <span class="n">ignored_scope</span><span class="o">=</span><span class="n">ignored_scope</span><span class="p">,</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">serialize</span><span class="p">(</span><span class="n">quantized_ov_model</span><span class="p">,</span> <span class="n">fq_ov</span><span class="p">)</span>
<span></span>        <span class="k">return</span> <span class="n">fq</span>
<span></span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"_openvino_model</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>    <span class="n">f_ov</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".xml"</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">serialize</span><span class="p">(</span><span class="n">ov_model</span><span class="p">,</span> <span class="n">f_ov</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_paddle">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_paddle</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_paddle</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'PaddlePaddle:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to PaddlePaddle format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>754</span>
<span>755</span>
<span>756</span>
<span>757</span>
<span>758</span>
<span>759</span>
<span>760</span>
<span>761</span>
<span>762</span>
<span>763</span>
<span>764</span>
<span>765</span>
<span>766</span>
<span>767</span>
<span>768</span>
<span>769</span>
<span>770</span>
<span>771</span>
<span>772</span>
<span>773</span>
<span>774</span>
<span>775</span>
<span>776</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_paddle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"PaddlePaddle:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to PaddlePaddle format."""</span>
<span></span>    <span class="k">assert</span> <span class="ow">not</span> <span class="n">IS_JETSON</span><span class="p">,</span> <span class="s2">"Jetson Paddle exports not supported yet"</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span>
<span></span>        <span class="p">(</span>
<span></span>            <span class="s2">"paddlepaddle-gpu"</span>
<span></span>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<span></span>            <span class="k">else</span> <span class="s2">"paddlepaddle==3.0.0"</span>  <span class="c1"># pin 3.0.0 for ARM64</span>
<span></span>            <span class="k">if</span> <span class="n">ARM64</span>
<span></span>            <span class="k">else</span> <span class="s2">"paddlepaddle&gt;=3.0.0"</span><span class="p">,</span>
<span></span>            <span class="s2">"x2paddle"</span><span class="p">,</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">x2paddle</span>  <span class="c1"># noqa</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">x2paddle.convert</span><span class="w"> </span><span class="kn">import</span> <span class="n">pytorch2paddle</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with X2Paddle </span><span class="si">{</span><span class="n">x2paddle</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"_paddle_model</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">pytorch2paddle</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">jit_type</span><span class="o">=</span><span class="s2">"trace"</span><span class="p">,</span> <span class="n">input_examples</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">])</span>  <span class="c1"># export</span>
<span></span>    <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># add metadata.yaml</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_pb">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_pb</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_pb</span><span class="p">(</span><span class="n">keras_model</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TensorFlow GraphDef:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TensorFlow GraphDef *.pb format <a href="https://github.com/leimao/Frozen-Graph-TensorFlow">https://github.com/leimao/Frozen-Graph-TensorFlow</a>.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1093</span>
<span>1094</span>
<span>1095</span>
<span>1096</span>
<span>1097</span>
<span>1098</span>
<span>1099</span>
<span>1100</span>
<span>1101</span>
<span>1102</span>
<span>1103</span>
<span>1104</span>
<span>1105</span>
<span>1106</span>
<span>1107</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_pb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keras_model</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TensorFlow GraphDef:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TensorFlow GraphDef *.pb format https://github.com/leimao/Frozen-Graph-TensorFlow."""</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>  <span class="c1"># noqa</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.python.framework.convert_to_constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_variables_to_constants_v2</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with tensorflow </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".pb"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">keras_model</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># full model</span>
<span></span>    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_concrete_function</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">(</span><span class="n">keras_model</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
<span></span>    <span class="n">frozen_func</span> <span class="o">=</span> <span class="n">convert_variables_to_constants_v2</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span></span>    <span class="n">frozen_func</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">as_graph_def</span><span class="p">()</span>
<span></span>    <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph_or_graph_def</span><span class="o">=</span><span class="n">frozen_func</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">logdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">as_text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_rknn">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_rknn</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_rknn</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'RKNN:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to RKNN format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1193</span>
<span>1194</span>
<span>1195</span>
<span>1196</span>
<span>1197</span>
<span>1198</span>
<span>1199</span>
<span>1200</span>
<span>1201</span>
<span>1202</span>
<span>1203</span>
<span>1204</span>
<span>1205</span>
<span>1206</span>
<span>1207</span>
<span>1208</span>
<span>1209</span>
<span>1210</span>
<span>1211</span>
<span>1212</span>
<span>1213</span>
<span>1214</span>
<span>1215</span>
<span>1216</span>
<span>1217</span>
<span>1218</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_rknn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"RKNN:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to RKNN format."""</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with rknn-toolkit2..."</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"rknn-toolkit2"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">IS_COLAB</span><span class="p">:</span>
<span></span>        <span class="c1"># Prevent 'exit' from closing the notebook https://github.com/airockchip/rknn-toolkit2/issues/259</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
<span></span>
<span></span>        <span class="n">builtins</span><span class="o">.</span><span class="n">exit</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span>
<span></span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">rknn.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">RKNN</span>
<span></span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">()</span>
<span></span>    <span class="n">export_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_rknn_model"</span><span class="p">)</span>
<span></span>    <span class="n">export_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">rknn</span> <span class="o">=</span> <span class="n">RKNN</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span></span>    <span class="n">rknn</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">mean_values</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">std_values</span><span class="o">=</span><span class="p">[[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]],</span> <span class="n">target_platform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span></span>    <span class="n">rknn</span><span class="o">.</span><span class="n">load_onnx</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
<span></span>    <span class="n">rknn</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">do_quantization</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># TODO: Add quantization support</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".onnx"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.rknn"</span><span class="p">)</span>
<span></span>    <span class="n">rknn</span><span class="o">.</span><span class="n">export_rknn</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">export_path</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>    <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">export_path</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">export_path</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_saved_model">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_saved_model</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_saved_model</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TensorFlow SavedModel:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TensorFlow SavedModel format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1002</span>
<span>1003</span>
<span>1004</span>
<span>1005</span>
<span>1006</span>
<span>1007</span>
<span>1008</span>
<span>1009</span>
<span>1010</span>
<span>1011</span>
<span>1012</span>
<span>1013</span>
<span>1014</span>
<span>1015</span>
<span>1016</span>
<span>1017</span>
<span>1018</span>
<span>1019</span>
<span>1020</span>
<span>1021</span>
<span>1022</span>
<span>1023</span>
<span>1024</span>
<span>1025</span>
<span>1026</span>
<span>1027</span>
<span>1028</span>
<span>1029</span>
<span>1030</span>
<span>1031</span>
<span>1032</span>
<span>1033</span>
<span>1034</span>
<span>1035</span>
<span>1036</span>
<span>1037</span>
<span>1038</span>
<span>1039</span>
<span>1040</span>
<span>1041</span>
<span>1042</span>
<span>1043</span>
<span>1044</span>
<span>1045</span>
<span>1046</span>
<span>1047</span>
<span>1048</span>
<span>1049</span>
<span>1050</span>
<span>1051</span>
<span>1052</span>
<span>1053</span>
<span>1054</span>
<span>1055</span>
<span>1056</span>
<span>1057</span>
<span>1058</span>
<span>1059</span>
<span>1060</span>
<span>1061</span>
<span>1062</span>
<span>1063</span>
<span>1064</span>
<span>1065</span>
<span>1066</span>
<span>1067</span>
<span>1068</span>
<span>1069</span>
<span>1070</span>
<span>1071</span>
<span>1072</span>
<span>1073</span>
<span>1074</span>
<span>1075</span>
<span>1076</span>
<span>1077</span>
<span>1078</span>
<span>1079</span>
<span>1080</span>
<span>1081</span>
<span>1082</span>
<span>1083</span>
<span>1084</span>
<span>1085</span>
<span>1086</span>
<span>1087</span>
<span>1088</span>
<span>1089</span>
<span>1090</span>
<span>1091</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_saved_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TensorFlow SavedModel:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TensorFlow SavedModel format."""</span>
<span></span>    <span class="n">cuda</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<span></span>    <span class="k">try</span><span class="p">:</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>  <span class="c1"># noqa</span>
<span></span>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span></span>        <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"tensorflow&gt;=2.0.0,&lt;=2.19.0"</span><span class="p">)</span>
<span></span>        <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>  <span class="c1"># noqa</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span>
<span></span>        <span class="p">(</span>
<span></span>            <span class="s2">"tf_keras&lt;=2.19.0"</span><span class="p">,</span>  <span class="c1"># required by 'onnx2tf' package</span>
<span></span>            <span class="s2">"sng4onnx&gt;=1.0.1"</span><span class="p">,</span>  <span class="c1"># required by 'onnx2tf' package</span>
<span></span>            <span class="s2">"onnx_graphsurgeon&gt;=0.3.26"</span><span class="p">,</span>  <span class="c1"># required by 'onnx2tf' package</span>
<span></span>            <span class="s2">"ai-edge-litert&gt;=1.2.0"</span> <span class="o">+</span> <span class="p">(</span><span class="s2">",&lt;1.4.0"</span> <span class="k">if</span> <span class="n">MACOS</span> <span class="k">else</span> <span class="s2">""</span><span class="p">),</span>  <span class="c1"># required by 'onnx2tf' package</span>
<span></span>            <span class="s2">"onnx&gt;=1.12.0"</span><span class="p">,</span>
<span></span>            <span class="s2">"onnx2tf&gt;=1.26.3"</span><span class="p">,</span>
<span></span>            <span class="s2">"onnxslim&gt;=0.1.71"</span><span class="p">,</span>
<span></span>            <span class="s2">"onnxruntime-gpu"</span> <span class="k">if</span> <span class="n">cuda</span> <span class="k">else</span> <span class="s2">"onnxruntime"</span><span class="p">,</span>
<span></span>            <span class="s2">"protobuf&gt;=5"</span><span class="p">,</span>
<span></span>        <span class="p">),</span>
<span></span>        <span class="n">cmds</span><span class="o">=</span><span class="s2">"--extra-index-url https://pypi.ngc.nvidia.com"</span><span class="p">,</span>  <span class="c1"># onnx_graphsurgeon only on NVIDIA</span>
<span></span>    <span class="p">)</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with tensorflow </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">check_version</span><span class="p">(</span>
<span></span>        <span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
<span></span>        <span class="s2">"&gt;=2.0.0"</span><span class="p">,</span>
<span></span>        <span class="n">name</span><span class="o">=</span><span class="s2">"tensorflow"</span><span class="p">,</span>
<span></span>        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span></span>        <span class="n">msg</span><span class="o">=</span><span class="s2">"https://github.com/ultralytics/ultralytics/issues/5161"</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">"_saved_model"</span><span class="p">))</span>
<span></span>    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
<span></span>        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># delete output folder</span>
<span></span>
<span></span>    <span class="c1"># Pre-download calibration file to fix https://github.com/PINTO0309/onnx2tf/issues/545</span>
<span></span>    <span class="n">onnx2tf_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"calibration_image_sample_data_20x128x128x3_float32.npy"</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">onnx2tf_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span></span>        <span class="n">attempt_download_asset</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">onnx2tf_file</span><span class="si">}</span><span class="s2">.zip"</span><span class="p">,</span> <span class="n">unzip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Export to ONNX</span>
<span></span>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">RTDETRDecoder</span><span class="p">):</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="ow">or</span> <span class="mi">19</span>
<span></span>        <span class="k">assert</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="o">&lt;=</span> <span class="mi">19</span><span class="p">,</span> <span class="s2">"RTDETR export requires opset&gt;=16;&lt;=19"</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">simplify</span> <span class="o">=</span> <span class="kc">True</span>
<span></span>    <span class="n">f_onnx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">()</span>
<span></span>
<span></span>    <span class="c1"># Export to TF</span>
<span></span>    <span class="n">np_data</span> <span class="o">=</span> <span class="kc">None</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">tmp_file</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="s2">"tmp_tflite_int8_calibration_images.npy"</span>  <span class="c1"># int8 calibration images file</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
<span></span>            <span class="n">f</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
<span></span>            <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch</span><span class="p">[</span><span class="s2">"img"</span><span class="p">]</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_int8_calibration_dataloader</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]</span>
<span></span>            <span class="n">images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span>
<span></span>                <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">),</span> <span class="n">images</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>  <span class="c1"># BHWC</span>
<span></span>            <span class="n">np_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">"images"</span><span class="p">,</span> <span class="n">tmp_file</span><span class="p">,</span> <span class="p">[[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]],</span> <span class="p">[[[[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]]]]]]</span>
<span></span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">onnx2tf</span>  <span class="c1"># scoped for after ONNX export for reduced conflict during import</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting TFLite export with onnx2tf </span><span class="si">{</span><span class="n">onnx2tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">keras_model</span> <span class="o">=</span> <span class="n">onnx2tf</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
<span></span>        <span class="n">input_onnx_file_path</span><span class="o">=</span><span class="n">f_onnx</span><span class="p">,</span>
<span></span>        <span class="n">output_folder_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
<span></span>        <span class="n">not_use_onnxsim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span></span>        <span class="n">verbosity</span><span class="o">=</span><span class="s2">"error"</span><span class="p">,</span>  <span class="c1"># note INT8-FP16 activation bug https://github.com/ultralytics/ultralytics/issues/15873</span>
<span></span>        <span class="n">output_integer_quantized_tflite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
<span></span>        <span class="n">custom_input_op_name_np_data_path</span><span class="o">=</span><span class="n">np_data</span><span class="p">,</span>
<span></span>        <span class="n">enable_batchmatmul_unfold</span><span class="o">=</span><span class="kc">True</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>  <span class="c1"># fix lower no. of detected objects on GPU delegate</span>
<span></span>        <span class="n">output_signaturedefs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># fix error with Attention block group convolution</span>
<span></span>        <span class="n">disable_group_convolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">"tfjs"</span><span class="p">,</span> <span class="s2">"edgetpu"</span><span class="p">},</span>  <span class="c1"># fix error with group convolution</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># add metadata.yaml</span>
<span></span>
<span></span>    <span class="c1"># Remove/rename TFLite models</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">tmp_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">"*_dynamic_range_quant.tflite"</span><span class="p">):</span>
<span></span>            <span class="n">file</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"_dynamic_range_quant"</span><span class="p">,</span> <span class="s2">"_int8"</span><span class="p">)</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">))</span>
<span></span>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">"*_integer_quant_with_int16_act.tflite"</span><span class="p">):</span>
<span></span>            <span class="n">file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>  <span class="c1"># delete extra fp16 activation TFLite files</span>
<span></span>
<span></span>    <span class="c1"># Add TFLite metadata</span>
<span></span>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">"*.tflite"</span><span class="p">):</span>
<span></span>        <span class="n">f</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span> <span class="k">if</span> <span class="s2">"quant_with_int16_act.tflite"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_tflite_metadata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">keras_model</span>  <span class="c1"># or keras_model = tf.saved_model.load(f, tags=None, options=None)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_tfjs">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_tfjs</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_tfjs</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TensorFlow.js:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TensorFlow.js format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1160</span>
<span>1161</span>
<span>1162</span>
<span>1163</span>
<span>1164</span>
<span>1165</span>
<span>1166</span>
<span>1167</span>
<span>1168</span>
<span>1169</span>
<span>1170</span>
<span>1171</span>
<span>1172</span>
<span>1173</span>
<span>1174</span>
<span>1175</span>
<span>1176</span>
<span>1177</span>
<span>1178</span>
<span>1179</span>
<span>1180</span>
<span>1181</span>
<span>1182</span>
<span>1183</span>
<span>1184</span>
<span>1185</span>
<span>1186</span>
<span>1187</span>
<span>1188</span>
<span>1189</span>
<span>1190</span>
<span>1191</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_tfjs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TensorFlow.js:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TensorFlow.js format."""</span>
<span></span>    <span class="n">check_requirements</span><span class="p">(</span><span class="s2">"tensorflowjs"</span><span class="p">)</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflowjs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tfjs</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with tensorflowjs </span><span class="si">{</span><span class="n">tfjs</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">"_web_model"</span><span class="p">)</span>  <span class="c1"># js dir</span>
<span></span>    <span class="n">f_pb</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".pb"</span><span class="p">))</span>  <span class="c1"># *.pb path</span>
<span></span>
<span></span>    <span class="n">gd</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">as_graph_def</span><span class="p">()</span>  <span class="c1"># TF GraphDef</span>
<span></span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_pb</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<span></span>        <span class="n">gd</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span></span>    <span class="n">outputs</span> <span class="o">=</span> <span class="s2">","</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gd_outputs</span><span class="p">(</span><span class="n">gd</span><span class="p">))</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> output node names: </span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">quantization</span> <span class="o">=</span> <span class="s2">"--quantize_float16"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span> <span class="k">else</span> <span class="s2">"--quantize_uint8"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span> <span class="k">else</span> <span class="s2">""</span>
<span></span>    <span class="k">with</span> <span class="n">spaces_in_path</span><span class="p">(</span><span class="n">f_pb</span><span class="p">)</span> <span class="k">as</span> <span class="n">fpb_</span><span class="p">,</span> <span class="n">spaces_in_path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_</span><span class="p">:</span>  <span class="c1"># exporter can not handle spaces in path</span>
<span></span>        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="s2">"tensorflowjs_converter "</span>
<span></span>            <span class="sa">f</span><span class="s1">'--input_format=tf_frozen_model </span><span class="si">{</span><span class="n">quantization</span><span class="si">}</span><span class="s1"> --output_node_names=</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s1"> "</span><span class="si">{</span><span class="n">fpb_</span><span class="si">}</span><span class="s1">" "</span><span class="si">{</span><span class="n">f_</span><span class="si">}</span><span class="s1">"'</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> running '</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span></span>        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">if</span> <span class="s2">" "</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> your model may not work correctly with spaces in path '</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">'."</span><span class="p">)</span>
<span></span>
<span></span>    <span class="c1"># Add metadata</span>
<span></span>    <span class="n">YAML</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">/</span> <span class="s2">"metadata.yaml"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>  <span class="c1"># add metadata.yaml</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_tflite">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_tflite</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_tflite</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TensorFlow Lite:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TensorFlow Lite format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1109</span>
<span>1110</span>
<span>1111</span>
<span>1112</span>
<span>1113</span>
<span>1114</span>
<span>1115</span>
<span>1116</span>
<span>1117</span>
<span>1118</span>
<span>1119</span>
<span>1120</span>
<span>1121</span>
<span>1122</span>
<span>1123</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_tflite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TensorFlow Lite:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TensorFlow Lite format."""</span>
<span></span>    <span class="c1"># BUG https://github.com/ultralytics/ultralytics/issues/13436</span>
<span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>  <span class="c1"># noqa</span>
<span></span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with tensorflow </span><span class="si">{</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">saved_model</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">"_saved_model"</span><span class="p">))</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
<span></span>        <span class="n">f</span> <span class="o">=</span> <span class="n">saved_model</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_int8.tflite"</span>  <span class="c1"># fp32 in/out</span>
<span></span>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">half</span><span class="p">:</span>
<span></span>        <span class="n">f</span> <span class="o">=</span> <span class="n">saved_model</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_float16.tflite"</span>  <span class="c1"># fp32 in/out</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">f</span> <span class="o">=</span> <span class="n">saved_model</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_float32.tflite"</span>
<span></span>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.export_torchscript">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">export_torchscript</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_torchscript</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s1">'TorchScript:'</span><span class="p">))</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Export YOLO model to TorchScript format.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>595</span>
<span>596</span>
<span>597</span>
<span>598</span>
<span>599</span>
<span>600</span>
<span>601</span>
<span>602</span>
<span>603</span>
<span>604</span>
<span>605</span>
<span>606</span>
<span>607</span>
<span>608</span>
<span>609</span>
<span>610</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="nd">@try_export</span>
<span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_torchscript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">colorstr</span><span class="p">(</span><span class="s2">"TorchScript:"</span><span class="p">)):</span>
<span></span><span class="w">    </span><span class="sd">"""Export YOLO model to TorchScript format."""</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> starting export with torch </span><span class="si">{</span><span class="n">TORCH_VERSION</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span></span>    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">".torchscript"</span><span class="p">)</span>
<span></span>
<span></span>    <span class="n">ts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">NMSModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nms</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span></span>    <span class="n">extra_files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"config.txt"</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)}</span>  <span class="c1"># torch._C.ExtraFilesMap()</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">optimize</span><span class="p">:</span>  <span class="c1"># https://pytorch.org/tutorials/recipes/mobile_interpreter.html</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> optimizing for mobile..."</span><span class="p">)</span>
<span></span>        <span class="kn">from</span><span class="w"> </span><span class="nn">torch.utils.mobile_optimizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize_for_mobile</span>
<span></span>
<span></span>        <span class="n">optimize_for_mobile</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">_save_for_lite_interpreter</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">_extra_files</span><span class="o">=</span><span class="n">extra_files</span><span class="p">)</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">ts</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">_extra_files</span><span class="o">=</span><span class="n">extra_files</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.get_int8_calibration_dataloader">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">get_int8_calibration_dataloader</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">get_int8_calibration_dataloader</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Build and return a dataloader for calibration of INT8 models.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>572</span>
<span>573</span>
<span>574</span>
<span>575</span>
<span>576</span>
<span>577</span>
<span>578</span>
<span>579</span>
<span>580</span>
<span>581</span>
<span>582</span>
<span>583</span>
<span>584</span>
<span>585</span>
<span>586</span>
<span>587</span>
<span>588</span>
<span>589</span>
<span>590</span>
<span>591</span>
<span>592</span>
<span>593</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_int8_calibration_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Build and return a dataloader for calibration of INT8 models."""</span>
<span></span>    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> collecting INT8 calibration images from 'data=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
<span></span>    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">check_cls_dataset</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"classify"</span> <span class="k">else</span> <span class="n">check_det_dataset</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span></span>    <span class="n">dataset</span> <span class="o">=</span> <span class="n">YOLODataset</span><span class="p">(</span>
<span></span>        <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">split</span> <span class="ow">or</span> <span class="s2">"val"</span><span class="p">],</span>
<span></span>        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<span></span>        <span class="n">fraction</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">fraction</span><span class="p">,</span>
<span></span>        <span class="n">task</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
<span></span>        <span class="n">imgsz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imgsz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span></span>        <span class="n">augment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span></span>        <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span>
<span></span>    <span class="p">)</span>
<span></span>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">:</span>
<span></span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span></span>            <span class="sa">f</span><span class="s2">"The calibration dataset (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> images) must have at least as many images as the batch size "</span>
<span></span>            <span class="sa">f</span><span class="s2">"('batch=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="si">}</span><span class="s2">')."</span>
<span></span>        <span class="p">)</span>
<span></span>    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
<span></span>        <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> &gt;300 images recommended for INT8 calibration, found </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> images."</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="n">build_dataloader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># required for batch loading</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.Exporter.run_callbacks">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">run_callbacks</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">run_callbacks</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Execute all callbacks for a given event.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1362</span>
<span>1363</span>
<span>1364</span>
<span>1365</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Execute all callbacks for a given event."""</span>
<span></span>    <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">[]):</span>
<span></span>        <span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.IOSDetectModel">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">ultralytics.engine.exporter.IOSDetectModel</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">IOSDetectModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">mlprogram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>
<p>Wrap an Ultralytics YOLO model for Apple iOS CoreML export.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>model</code>
</td>
<td>
<code><span title="torch.nn.Module">Module</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The YOLO model to wrap.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>im</code>
</td>
<td>
<code><span title="torch.Tensor">Tensor</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Example input tensor with shape (B, C, H, W).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>mlprogram</code>
</td>
<td>
<code><span title="bool">bool</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Whether exporting to MLProgram format to fix NMS bug.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1371</span>
<span>1372</span>
<span>1373</span>
<span>1374</span>
<span>1375</span>
<span>1376</span>
<span>1377</span>
<span>1378</span>
<span>1379</span>
<span>1380</span>
<span>1381</span>
<span>1382</span>
<span>1383</span>
<span>1384</span>
<span>1385</span>
<span>1386</span>
<span>1387</span>
<span>1388</span>
<span>1389</span>
<span>1390</span>
<span>1391</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">mlprogram</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""</span>
<span></span><span class="sd">    Initialize the IOSDetectModel class with a YOLO model and example image.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        model (torch.nn.Module): The YOLO model to wrap.</span>
<span></span><span class="sd">        im (torch.Tensor): Example input tensor with shape (B, C, H, W).</span>
<span></span><span class="sd">        mlprogram (bool): Whether exporting to MLProgram format to fix NMS bug.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># batch, channel, height, width</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># number of classes</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">mlprogram</span> <span class="o">=</span> <span class="n">mlprogram</span>
<span></span>    <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">w</span>  <span class="c1"># scalar</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
<span></span>            <span class="p">[</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">w</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">h</span><span class="p">],</span>  <span class="c1"># broadcast (slower, smaller)</span>
<span></span>            <span class="n">device</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
<span></span>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.IOSDetectModel.forward">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">forward</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Normalize predictions of object detection model with input size-dependent factors.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1393</span>
<span>1394</span>
<span>1395</span>
<span>1396</span>
<span>1397</span>
<span>1398</span>
<span>1399</span>
<span>1400</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Normalize predictions of object detection model with input size-dependent factors."""</span>
<span></span>    <span class="n">xywh</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlprogram</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># NMS bug https://github.com/ultralytics/ultralytics/issues/22309</span>
<span></span>        <span class="n">pad_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">+</span> <span class="mi">79</span><span class="p">)</span> <span class="o">//</span> <span class="mi">80</span><span class="p">)</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span>  <span class="c1"># pad class length to multiple of 80</span>
<span></span>        <span class="bp">cls</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">"constant"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">xywh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.NMSModel">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code> <span class="doc doc-object-name doc-class-name">ultralytics.engine.exporter.NMSModel</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">NMSModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>
<p>Model wrapper with embedded NMS for Detect, Segment, Pose and OBB.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>model</code>
</td>
<td>
<code><span title="torch.nn.Module">Module</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The model to wrap with NMS postprocessing.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>args</code>
</td>
<td>
<code><span title="Namespace">Namespace</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The export arguments.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1406</span>
<span>1407</span>
<span>1408</span>
<span>1409</span>
<span>1410</span>
<span>1411</span>
<span>1412</span>
<span>1413</span>
<span>1414</span>
<span>1415</span>
<span>1416</span>
<span>1417</span>
<span>1418</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""</span>
<span></span><span class="sd">    Initialize the NMSModel.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        model (torch.nn.Module): The model to wrap with NMS postprocessing.</span>
<span></span><span class="sd">        args (Namespace): The export arguments.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">obb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"obb"</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">is_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="ow">in</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s2">"saved_model"</span><span class="p">,</span> <span class="s2">"tflite"</span><span class="p">,</span> <span class="s2">"tfjs"</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="ultralytics.engine.exporter.NMSModel.forward">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code> <span class="doc doc-object-name doc-function-name">forward</span>
</h3>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents">
<p>Perform inference with NMS post-processing. Supports Detect, Segment, OBB and Pose.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>x</code>
</td>
<td>
<code><span title="torch.Tensor">Tensor</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The preprocessed tensor with shape (N, 3, H, W).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="torch.Tensor">Tensor</span></code>
</td>
<td>
<div class="doc-md-description">
<p>List of detections, each an (N, max_det, 4 + 2 + extra_shape) Tensor where N is the
number of detections after NMS.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>1420</span>
<span>1421</span>
<span>1422</span>
<span>1423</span>
<span>1424</span>
<span>1425</span>
<span>1426</span>
<span>1427</span>
<span>1428</span>
<span>1429</span>
<span>1430</span>
<span>1431</span>
<span>1432</span>
<span>1433</span>
<span>1434</span>
<span>1435</span>
<span>1436</span>
<span>1437</span>
<span>1438</span>
<span>1439</span>
<span>1440</span>
<span>1441</span>
<span>1442</span>
<span>1443</span>
<span>1444</span>
<span>1445</span>
<span>1446</span>
<span>1447</span>
<span>1448</span>
<span>1449</span>
<span>1450</span>
<span>1451</span>
<span>1452</span>
<span>1453</span>
<span>1454</span>
<span>1455</span>
<span>1456</span>
<span>1457</span>
<span>1458</span>
<span>1459</span>
<span>1460</span>
<span>1461</span>
<span>1462</span>
<span>1463</span>
<span>1464</span>
<span>1465</span>
<span>1466</span>
<span>1467</span>
<span>1468</span>
<span>1469</span>
<span>1470</span>
<span>1471</span>
<span>1472</span>
<span>1473</span>
<span>1474</span>
<span>1475</span>
<span>1476</span>
<span>1477</span>
<span>1478</span>
<span>1479</span>
<span>1480</span>
<span>1481</span>
<span>1482</span>
<span>1483</span>
<span>1484</span>
<span>1485</span>
<span>1486</span>
<span>1487</span>
<span>1488</span>
<span>1489</span>
<span>1490</span>
<span>1491</span>
<span>1492</span>
<span>1493</span>
<span>1494</span>
<span>1495</span>
<span>1496</span>
<span>1497</span>
<span>1498</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""</span>
<span></span><span class="sd">    Perform inference with NMS post-processing. Supports Detect, Segment, OBB and Pose.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        x (torch.Tensor): The preprocessed tensor with shape (N, 3, H, W).</span>
<span></span>
<span></span><span class="sd">    Returns:</span>
<span></span><span class="sd">        (torch.Tensor): List of detections, each an (N, max_det, 4 + 2 + extra_shape) Tensor where N is the</span>
<span></span><span class="sd">            number of detections after NMS.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span></span>
<span></span>    <span class="kn">from</span><span class="w"> </span><span class="nn">torchvision.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">nms</span>
<span></span>
<span></span>    <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span></span>    <span class="n">pred</span> <span class="o">=</span> <span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">preds</span>
<span></span>    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">pred</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">pred</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
<span></span>    <span class="n">bs</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>    <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># shape(1,84,6300) to shape(1,6300,84)</span>
<span></span>    <span class="n">extra_shape</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>  <span class="c1"># extras from Segment, OBB, Pose</span>
<span></span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">dynamic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># batch size needs to always be same due to loop unroll</span>
<span></span>        <span class="n">pad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">batch</span> <span class="o">-</span> <span class="n">bs</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="o">*</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span></span>        <span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">pred</span><span class="p">,</span> <span class="n">pad</span><span class="p">))</span>
<span></span>    <span class="n">boxes</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">split</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">names</span><span class="p">),</span> <span class="n">extra_shape</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span></span>    <span class="n">scores</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span><span class="p">)</span>  <span class="c1"># in case num_anchors &lt; max_det</span>
<span></span>    <span class="c1"># (N, max_det, 4 coords + 1 class score + 1 class label + extra_shape).</span>
<span></span>    <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span><span class="p">,</span> <span class="n">boxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">extra_shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bs</span><span class="p">):</span>
<span></span>        <span class="n">box</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">extras</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span></span>        <span class="n">mask</span> <span class="o">=</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">conf</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_tf</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"onnx"</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">obb</span><span class="p">):</span>
<span></span>            <span class="c1"># TFLite GatherND error if mask is empty</span>
<span></span>            <span class="n">score</span> <span class="o">*=</span> <span class="n">mask</span>
<span></span>            <span class="c1"># Explicit length otherwise reshape error, hardcoded to `self.args.max_det * 5`</span>
<span></span>            <span class="n">mask</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">score</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">indices</span>
<span></span>        <span class="n">box</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">score</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="bp">cls</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">extra</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span></span>        <span class="n">nmsbox</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span></span>        <span class="c1"># `8` is the minimum value experimented to get correct NMS results for obb</span>
<span></span>        <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">8</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obb</span> <span class="k">else</span> <span class="mi">1</span>
<span></span>        <span class="c1"># Normalize boxes for NMS since large values for class offset causes issue with int8 quantization</span>
<span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"tflite"</span><span class="p">:</span>  <span class="c1"># TFLite is already normalized</span>
<span></span>            <span class="n">nmsbox</span> <span class="o">*=</span> <span class="n">multiplier</span>
<span></span>        <span class="k">else</span><span class="p">:</span>
<span></span>            <span class="n">nmsbox</span> <span class="o">=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">nmsbox</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span></span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">agnostic_nms</span><span class="p">:</span>  <span class="c1"># class-specific NMS</span>
<span></span>            <span class="n">end</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obb</span> <span class="k">else</span> <span class="mi">4</span>
<span></span>            <span class="c1"># fully explicit expansion otherwise reshape error</span>
<span></span>            <span class="c1"># large max_wh causes issues when quantizing</span>
<span></span>            <span class="n">cls_offset</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">nmsbox</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="p">)</span>
<span></span>            <span class="n">offbox</span> <span class="o">=</span> <span class="n">nmsbox</span><span class="p">[:,</span> <span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">+</span> <span class="n">cls_offset</span> <span class="o">*</span> <span class="n">multiplier</span>
<span></span>            <span class="n">nmsbox</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">offbox</span><span class="p">,</span> <span class="n">nmsbox</span><span class="p">[:,</span> <span class="n">end</span><span class="p">:]),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span></span>        <span class="n">nms_fn</span> <span class="o">=</span> <span class="p">(</span>
<span></span>            <span class="n">partial</span><span class="p">(</span>
<span></span>                <span class="n">TorchNMS</span><span class="o">.</span><span class="n">fast_nms</span><span class="p">,</span>
<span></span>                <span class="n">use_triu</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span>
<span></span>                    <span class="bp">self</span><span class="o">.</span><span class="n">is_tf</span>
<span></span>                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">opset</span> <span class="ow">or</span> <span class="mi">14</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">14</span>
<span></span>                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">"openvino"</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>  <span class="c1"># OpenVINO int8 error with triu</span>
<span></span>                <span class="p">),</span>
<span></span>                <span class="n">iou_func</span><span class="o">=</span><span class="n">batch_probiou</span><span class="p">,</span>
<span></span>                <span class="n">exit_early</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span></span>            <span class="p">)</span>
<span></span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obb</span>
<span></span>            <span class="k">else</span> <span class="n">nms</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="n">keep</span> <span class="o">=</span> <span class="n">nms_fn</span><span class="p">(</span>
<span></span>            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">nmsbox</span><span class="p">,</span> <span class="n">extra</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obb</span> <span class="k">else</span> <span class="n">nmsbox</span><span class="p">,</span>
<span></span>            <span class="n">score</span><span class="p">,</span>
<span></span>            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">iou</span><span class="p">,</span>
<span></span>        <span class="p">)[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span><span class="p">]</span>
<span></span>        <span class="n">dets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
<span></span>            <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span> <span class="n">score</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">cls</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">extra</span><span class="p">[</span><span class="n">keep</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span>
<span></span>        <span class="p">)</span>
<span></span>        <span class="c1"># Zero-pad to max_det size to avoid reshape error</span>
<span></span>        <span class="n">pad</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">max_det</span> <span class="o">-</span> <span class="n">dets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span></span>        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[:</span><span class="n">bs</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">task</span> <span class="o">==</span> <span class="s2">"segment"</span> <span class="k">else</span> <span class="n">out</span><span class="p">[:</span><span class="n">bs</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.export_formats">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">ultralytics.engine.exporter.export_formats</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">export_formats</span><span class="p">()</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>Return a dictionary of Ultralytics YOLO export formats.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>118</span>
<span>119</span>
<span>120</span>
<span>121</span>
<span>122</span>
<span>123</span>
<span>124</span>
<span>125</span>
<span>126</span>
<span>127</span>
<span>128</span>
<span>129</span>
<span>130</span>
<span>131</span>
<span>132</span>
<span>133</span>
<span>134</span>
<span>135</span>
<span>136</span>
<span>137</span>
<span>138</span>
<span>139</span>
<span>140</span>
<span>141</span>
<span>142</span>
<span>143</span>
<span>144</span>
<span>145</span>
<span>146</span>
<span>147</span>
<span>148</span>
<span>149</span>
<span>150</span>
<span>151</span>
<span>152</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">export_formats</span><span class="p">():</span>
<span></span><span class="w">    </span><span class="sd">"""Return a dictionary of Ultralytics YOLO export formats."""</span>
<span></span>    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span>
<span></span>        <span class="p">[</span><span class="s2">"PyTorch"</span><span class="p">,</span> <span class="s2">"-"</span><span class="p">,</span> <span class="s2">".pt"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TorchScript"</span><span class="p">,</span> <span class="s2">"torchscript"</span><span class="p">,</span> <span class="s2">".torchscript"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"optimize"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"ONNX"</span><span class="p">,</span> <span class="s2">"onnx"</span><span class="p">,</span> <span class="s2">".onnx"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"opset"</span><span class="p">,</span> <span class="s2">"simplify"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span>
<span></span>            <span class="s2">"OpenVINO"</span><span class="p">,</span>
<span></span>            <span class="s2">"openvino"</span><span class="p">,</span>
<span></span>            <span class="s2">"_openvino_model"</span><span class="p">,</span>
<span></span>            <span class="kc">True</span><span class="p">,</span>
<span></span>            <span class="kc">False</span><span class="p">,</span>
<span></span>            <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">,</span> <span class="s2">"fraction"</span><span class="p">],</span>
<span></span>        <span class="p">],</span>
<span></span>        <span class="p">[</span>
<span></span>            <span class="s2">"TensorRT"</span><span class="p">,</span>
<span></span>            <span class="s2">"engine"</span><span class="p">,</span>
<span></span>            <span class="s2">".engine"</span><span class="p">,</span>
<span></span>            <span class="kc">False</span><span class="p">,</span>
<span></span>            <span class="kc">True</span><span class="p">,</span>
<span></span>            <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"simplify"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">,</span> <span class="s2">"fraction"</span><span class="p">],</span>
<span></span>        <span class="p">],</span>
<span></span>        <span class="p">[</span><span class="s2">"CoreML"</span><span class="p">,</span> <span class="s2">"coreml"</span><span class="p">,</span> <span class="s2">".mlpackage"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TensorFlow SavedModel"</span><span class="p">,</span> <span class="s2">"saved_model"</span><span class="p">,</span> <span class="s2">"_saved_model"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"keras"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TensorFlow GraphDef"</span><span class="p">,</span> <span class="s2">"pb"</span><span class="p">,</span> <span class="s2">".pb"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TensorFlow Lite"</span><span class="p">,</span> <span class="s2">"tflite"</span><span class="p">,</span> <span class="s2">".tflite"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">,</span> <span class="s2">"fraction"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TensorFlow Edge TPU"</span><span class="p">,</span> <span class="s2">"edgetpu"</span><span class="p">,</span> <span class="s2">"_edgetpu.tflite"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[]],</span>
<span></span>        <span class="p">[</span><span class="s2">"TensorFlow.js"</span><span class="p">,</span> <span class="s2">"tfjs"</span><span class="p">,</span> <span class="s2">"_web_model"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"PaddlePaddle"</span><span class="p">,</span> <span class="s2">"paddle"</span><span class="p">,</span> <span class="s2">"_paddle_model"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"MNN"</span><span class="p">,</span> <span class="s2">"mnn"</span><span class="p">,</span> <span class="s2">".mnn"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"NCNN"</span><span class="p">,</span> <span class="s2">"ncnn"</span><span class="p">,</span> <span class="s2">"_ncnn_model"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"half"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"IMX"</span><span class="p">,</span> <span class="s2">"imx"</span><span class="p">,</span> <span class="s2">"_imx_model"</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"fraction"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">]],</span>
<span></span>        <span class="p">[</span><span class="s2">"RKNN"</span><span class="p">,</span> <span class="s2">"rknn"</span><span class="p">,</span> <span class="s2">"_rknn_model"</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">]],</span>
<span></span>    <span class="p">]</span>
<span></span>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s2">"Format"</span><span class="p">,</span> <span class="s2">"Argument"</span><span class="p">,</span> <span class="s2">"Suffix"</span><span class="p">,</span> <span class="s2">"CPU"</span><span class="p">,</span> <span class="s2">"GPU"</span><span class="p">,</span> <span class="s2">"Arguments"</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.best_onnx_opset">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">ultralytics.engine.exporter.best_onnx_opset</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">best_onnx_opset</span><span class="p">(</span><span class="n">onnx</span><span class="p">,</span> <span class="n">cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>Return max ONNX opset for this torch version with ONNX fallback.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>155</span>
<span>156</span>
<span>157</span>
<span>158</span>
<span>159</span>
<span>160</span>
<span>161</span>
<span>162</span>
<span>163</span>
<span>164</span>
<span>165</span>
<span>166</span>
<span>167</span>
<span>168</span>
<span>169</span>
<span>170</span>
<span>171</span>
<span>172</span>
<span>173</span>
<span>174</span>
<span>175</span>
<span>176</span>
<span>177</span>
<span>178</span>
<span>179</span>
<span>180</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">best_onnx_opset</span><span class="p">(</span><span class="n">onnx</span><span class="p">,</span> <span class="n">cuda</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span></span><span class="w">    </span><span class="sd">"""Return max ONNX opset for this torch version with ONNX fallback."""</span>
<span></span>    <span class="n">version</span> <span class="o">=</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TORCH_VERSION</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span>
<span></span>    <span class="k">if</span> <span class="n">TORCH_2_4</span><span class="p">:</span>  <span class="c1"># _constants.ONNX_MAX_OPSET first defined in torch 1.13</span>
<span></span>        <span class="n">opset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">_constants</span><span class="o">.</span><span class="n">ONNX_MAX_OPSET</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># use second-latest version for safety</span>
<span></span>        <span class="k">if</span> <span class="n">cuda</span><span class="p">:</span>
<span></span>            <span class="n">opset</span> <span class="o">-=</span> <span class="mi">2</span>  <span class="c1"># fix CUDA ONNXRuntime NMS squeeze op errors</span>
<span></span>    <span class="k">else</span><span class="p">:</span>
<span></span>        <span class="n">opset</span> <span class="o">=</span> <span class="p">{</span>
<span></span>            <span class="s2">"1.8"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
<span></span>            <span class="s2">"1.9"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
<span></span>            <span class="s2">"1.10"</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
<span></span>            <span class="s2">"1.11"</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
<span></span>            <span class="s2">"1.12"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
<span></span>            <span class="s2">"1.13"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
<span></span>            <span class="s2">"2.0"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="c1"># reduced from 18 to fix ONNX errors</span>
<span></span>            <span class="s2">"2.1"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="c1"># reduced from 19</span>
<span></span>            <span class="s2">"2.2"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="c1"># reduced from 19</span>
<span></span>            <span class="s2">"2.3"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>  <span class="c1"># reduced from 19</span>
<span></span>            <span class="s2">"2.4"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<span></span>            <span class="s2">"2.5"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<span></span>            <span class="s2">"2.6"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<span></span>            <span class="s2">"2.7"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<span></span>            <span class="s2">"2.8"</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
<span></span>        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">opset</span><span class="p">,</span> <span class="n">onnx</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">onnx_opset_version</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.validate_args">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">ultralytics.engine.exporter.validate_args</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">validate_args</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">passed_args</span><span class="p">,</span> <span class="n">valid_args</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>Validate arguments based on the export format.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>format</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The export format.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>passed_args</code>
</td>
<td>
<code><span title="Namespace">Namespace</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The arguments used during export.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>valid_args</code>
</td>
<td>
<code><span title="list">list</span></code>
</td>
<td>
<div class="doc-md-description">
<p>List of valid arguments for the format.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="AssertionError">AssertionError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If an unsupported argument is used, or if the format lacks supported argument listings.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>183</span>
<span>184</span>
<span>185</span>
<span>186</span>
<span>187</span>
<span>188</span>
<span>189</span>
<span>190</span>
<span>191</span>
<span>192</span>
<span>193</span>
<span>194</span>
<span>195</span>
<span>196</span>
<span>197</span>
<span>198</span>
<span>199</span>
<span>200</span>
<span>201</span>
<span>202</span>
<span>203</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_args</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">passed_args</span><span class="p">,</span> <span class="n">valid_args</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""</span>
<span></span><span class="sd">    Validate arguments based on the export format.</span>
<span></span>
<span></span><span class="sd">    Args:</span>
<span></span><span class="sd">        format (str): The export format.</span>
<span></span><span class="sd">        passed_args (Namespace): The arguments used during export.</span>
<span></span><span class="sd">        valid_args (list): List of valid arguments for the format.</span>
<span></span>
<span></span><span class="sd">    Raises:</span>
<span></span><span class="sd">        AssertionError: If an unsupported argument is used, or if the format lacks supported argument listings.</span>
<span></span><span class="sd">    """</span>
<span></span>    <span class="n">export_args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"half"</span><span class="p">,</span> <span class="s2">"int8"</span><span class="p">,</span> <span class="s2">"dynamic"</span><span class="p">,</span> <span class="s2">"keras"</span><span class="p">,</span> <span class="s2">"nms"</span><span class="p">,</span> <span class="s2">"batch"</span><span class="p">,</span> <span class="s2">"fraction"</span><span class="p">]</span>
<span></span>
<span></span>    <span class="k">assert</span> <span class="n">valid_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"ERROR ❌️ valid arguments for '</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">' not listed."</span>
<span></span>    <span class="n">custom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"batch"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">"device"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># exporter defaults</span>
<span></span>    <span class="n">default_args</span> <span class="o">=</span> <span class="n">get_cfg</span><span class="p">(</span><span class="n">DEFAULT_CFG</span><span class="p">,</span> <span class="n">custom</span><span class="p">)</span>
<span></span>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">export_args</span><span class="p">:</span>
<span></span>        <span class="n">not_default</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">passed_args</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">default_args</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span></span>        <span class="k">if</span> <span class="n">not_default</span><span class="p">:</span>
<span></span>            <span class="k">assert</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">valid_args</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"ERROR ❌️ argument '</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">' is not supported for format='</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">'"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.gd_outputs">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">ultralytics.engine.exporter.gd_outputs</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">gd_outputs</span><span class="p">(</span><span class="n">gd</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>Return TensorFlow GraphDef model output node names.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>206</span>
<span>207</span>
<span>208</span>
<span>209</span>
<span>210</span>
<span>211</span>
<span>212</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">gd_outputs</span><span class="p">(</span><span class="n">gd</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""Return TensorFlow GraphDef model output node names."""</span>
<span></span>    <span class="n">name_list</span><span class="p">,</span> <span class="n">input_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span></span>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">gd</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>  <span class="c1"># tensorflow.core.framework.node_def_pb2.NodeDef</span>
<span></span>        <span class="n">name_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span></span>        <span class="n">input_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
<span></span>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">:0"</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">input_list</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"NoOp"</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div><p><br/><br/><hr/><br/></p>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="ultralytics.engine.exporter.try_export">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code> <span class="doc doc-object-name doc-function-name">ultralytics.engine.exporter.try_export</span>
</h2>
<div class="doc-signature highlight"><pre><span></span><code><span></span><span class="nf">try_export</span><span class="p">(</span><span class="n">inner_func</span><span class="p">)</span>
</code></pre></div>
<div class="doc doc-contents first">
<p>YOLO export decorator, i.e. @try_export.</p>
<details class="quote">
<summary>Source code in <code>ultralytics/engine/exporter.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span>215</span>
<span>216</span>
<span>217</span>
<span>218</span>
<span>219</span>
<span>220</span>
<span>221</span>
<span>222</span>
<span>223</span>
<span>224</span>
<span>225</span>
<span>226</span>
<span>227</span>
<span>228</span>
<span>229</span>
<span>230</span>
<span>231</span>
<span>232</span>
<span>233</span>
<span>234</span>
<span>235</span></pre></div></td><td class="code"><div><pre><span></span><code><span></span><span class="k">def</span><span class="w"> </span><span class="nf">try_export</span><span class="p">(</span><span class="n">inner_func</span><span class="p">):</span>
<span></span><span class="w">    </span><span class="sd">"""YOLO export decorator, i.e. @try_export."""</span>
<span></span>    <span class="n">inner_args</span> <span class="o">=</span> <span class="n">get_default_args</span><span class="p">(</span><span class="n">inner_func</span><span class="p">)</span>
<span></span>
<span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">outer_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span></span><span class="w">        </span><span class="sd">"""Export a model."""</span>
<span></span>        <span class="n">prefix</span> <span class="o">=</span> <span class="n">inner_args</span><span class="p">[</span><span class="s2">"prefix"</span><span class="p">]</span>
<span></span>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0</span>
<span></span>        <span class="k">try</span><span class="p">:</span>
<span></span>            <span class="k">with</span> <span class="n">Profile</span><span class="p">()</span> <span class="k">as</span> <span class="n">dt</span><span class="p">:</span>
<span></span>                <span class="n">f</span> <span class="o">=</span> <span class="n">inner_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># exported file/dir or tuple of (file/dir, *)</span>
<span></span>            <span class="n">path</span> <span class="o">=</span> <span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span> <span class="k">else</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span></span>            <span class="n">mb</span> <span class="o">=</span> <span class="n">file_size</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span></span>            <span class="k">assert</span> <span class="n">mb</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">"0.0 MB output model size"</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> export success ✅ </span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">t</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s, saved as '</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">' (</span><span class="si">{</span><span class="n">mb</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB)"</span><span class="p">)</span>
<span></span>            <span class="k">return</span> <span class="n">f</span>
<span></span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span></span>            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> export failure </span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">t</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span></span>            <span class="k">raise</span> <span class="n">e</span>
<span></span>
<span></span>    <span class="k">return</span> <span class="n">outer_func</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div><p><br/><br/></p>
<br/><br/>
<div class="git-info">
<div class="dates-container">
<span class="date-item" title="This page was first created on November 12, 2023">
<span class="hover-item">📅</span> Created 1 year ago
    </span>
<span class="date-item" title="This page was last updated on September 19, 2025">
<span class="hover-item">✏️</span> Updated 1 month ago
    </span>
</div>
<div class="authors-container">
<a class="author-link" href="https://github.com/glenn-jocher" title="glenn-jocher (9 changes)">
<img alt="glenn-jocher" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/26833433?v=4&amp;s=96"/>
</a>
<a class="author-link" href="https://github.com/Y-T-G" title="Y-T-G (4 changes)">
<img alt="Y-T-G" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/32206511?v=4&amp;s=96"/>
</a>
<a class="author-link" href="https://github.com/jk4e" title="jk4e (1 change)">
<img alt="jk4e" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/116908874?v=4&amp;s=96"/>
</a>
<a class="author-link" href="https://github.com/Burhan-Q" title="Burhan-Q (1 change)">
<img alt="Burhan-Q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/62214284?v=4&amp;s=96"/>
</a>
<a class="author-link" href="https://github.com/Laughing-q" title="Laughing-q (1 change)">
<img alt="Laughing-q" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/61612323?v=4&amp;s=96"/>
</a>
</div></div><div class="share-buttons">
<button class="share-button hover-item" onclick="window.open('https://twitter.com/intent/tweet?url=https://docs.ultralytics.com/reference/engine/exporter', 'TwitterShare', 'width=550,height=680,menubar=no,toolbar=no'); return false;">
<i class="fa-brands fa-x-twitter"></i> Tweet
    </button>
<button class="share-button hover-item linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?url=https://docs.ultralytics.com/reference/engine/exporter', 'LinkedinShare', 'width=550,height=730,menubar=no,toolbar=no'); return false;">
<i class="fa-brands fa-linkedin-in"></i> Share
    </button>
</div>
<br/>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: utils" class="md-footer__link md-footer__link--prev" href="../../data/utils/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                utils
              </div>
</div>
</a>
<a aria-label="Next: model" class="md-footer__link md-footer__link--next" href="../model/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                model
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
<a href="https://www.ultralytics.com/" target="_blank">© 2025 Ultralytics Inc.</a> All rights reserved.
    </div>
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/ultralytics" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/ultralytics/" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg>
</a>
<a class="md-social__link" href="https://x.com/ultralytics" rel="noopener" target="_blank" title="x.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg>
</a>
<a class="md-social__link" href="https://youtube.com/ultralytics?sub_confirmation=1" rel="noopener" target="_blank" title="youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"></path></svg>
</a>
<a class="md-social__link" href="https://hub.docker.com/r/ultralytics/ultralytics/" rel="noopener" target="_blank" title="hub.docker.com">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"></path></svg>
</a>
<a class="md-social__link" href="https://pypi.org/project/ultralytics/" rel="noopener" target="_blank" title="pypi.org">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"></path></svg>
</a>
<a class="md-social__link" href="https://discord.com/invite/ultralytics" rel="noopener" target="_blank" title="discord.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"></path></svg>
</a>
<a class="md-social__link" href="https://reddit.com/r/ultralytics" rel="noopener" target="_blank" title="reddit.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M0 256C0 114.6 114.6 0 256 0s256 114.6 256 256-114.6 256-256 256H37.1c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256m349.6-102.4c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34-34.5 3.7-61.4 33-61.4 68.4v.2c-37.5 1.6-71.8 12.3-99 29.1-10.1-7.8-22.8-12.5-36.5-12.5-33 0-59.8 26.8-59.8 59.8 0 24 14.1 44.6 34.4 54.1 2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54 0-33-26.8-59.8-59.8-59.8-13.7 0-26.3 4.6-36.4 12.4-27.4-17-62.1-27.7-100-29.1v-.2c0-25.4 18.9-46.5 43.4-49.9 4.4 18.8 21.3 32.8 41.5 32.8zm-172.5 93.3c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6-31.4-8.8-30.4-30.5S160.3 247 177 247zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6 11.8-39.3 28.5-39.3 31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9.8-6.2 3.9-6.5 18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1.3 5.1 3.6 3.9 6.5"></path></svg>
</a>
<a class="md-social__link" href="https://weixin.qq.com/r/mp/LxckPDfEgWr_rXNf90I9" rel="noopener" target="_blank" title="weixin.qq.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.action.edit", "content.code.annotate", "content.code.copy", "content.tooltips", "toc.follow", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "navigation.indexes", "navigation.sections", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../../javascript/extra.js"></script>
<script src="../../../javascript/giscus.js"></script>
<script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
<script src="../../../javascript/tablesort.js"></script>
<script>
                    async function copyMarkdownForLLM(button) {
                        const editBtn = document.querySelector('a[title="Edit this page"]');
                        if (!editBtn) return;
                        const originalHTML = button.innerHTML;
                        const checkIcon = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19L21 7l-1.41-1.41L9 16.17z"></path></svg>';
                        // Handle both /blob/ and /tree/ in GitHub URLs
                        let rawUrl = editBtn.href.replace('github.com', 'raw.githubusercontent.com');
                        // Remove /blob/ or /tree/ from the URL
                        rawUrl = rawUrl.replace('/blob/', '/').replace('/tree/', '/');
                        try {
                            const response = await fetch(rawUrl);
                            let markdown = await response.text();
                            // Remove YAML front matter if present
                            if (markdown.startsWith('---')) {
                                const frontMatterEnd = markdown.indexOf('\n---\n', 3);
                                if (frontMatterEnd !== -1) {
                                    markdown = markdown.substring(frontMatterEnd + 5).trim();
                                }
                            }
                            const title = document.querySelector('h1')?.textContent || document.title;
                            const content = `# ${title}\n\nSource: ${window.location.href}\n\n---\n\n${markdown}`;
                            await navigator.clipboard.writeText(content);
                            button.innerHTML = checkIcon + ' Copied!';
                            setTimeout(() => { button.innerHTML = originalHTML; }, 2000);
                        } catch (err) {
                            button.innerHTML = '❌ Failed';
                            setTimeout(() => { button.innerHTML = originalHTML; }, 2000);
                        }
                    }
                    </script></body>
</html>